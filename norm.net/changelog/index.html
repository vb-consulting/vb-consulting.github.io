<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Norm.net Changelog</title><meta name=description content="Norm.net High Performance Micro-ORM Data Access for .NET"><meta name=keywords content="net, dotnet, c#, csharp, netcore, orm, microorm, database-mapper, mapper, data, sql"><link href=https://vb-consulting.github.io//norm.net/changelog/ rel=canonical><link rel=stylesheet href=/_elderjs/assets/svelte-82694252.css media=all><style></style><link href=/style.css?1701975185698 rel=stylesheet><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script><body class="d-flex flex-column h-100"><header id=header><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-13wa5zp"><div class="container-fluid flex-nowrap svelte-13wa5zp"><div class="d-flex svelte-13wa5zp"><button id=nav-btn type=button class="d-flex btn btn-sm logo animate-rotate svelte-13wa5zp"><i class=material-icons-outlined>menu</i></button></div><div class="d-flex right svelte-13wa5zp"><a class="nav-link my-auto me-2 svelte-13wa5zp"href=https://github.com/vb-consulting/norm.net/ ><i class=bi-github></i></a> <a class="github-button svelte-13wa5zp"href=https://github.com/vb-consulting/norm.net/ data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;"data-icon=octicon-star data-show-count=true aria-label="Star vb-consulting/norm.net/ on GitHub"></a><div class="vr text-white my-auto svelte-13wa5zp"></div><button id=theme-btn type=button aria-pressed=true aria-label=theme class=svelte-13wa5zp><span class="check hidden svelte-13wa5zp"><span class="icon svelte-13wa5zp"><svg xmlns=http://www.w3.org/2000/svg width=32 height=32 viewBox="0 0 24 24"class=svelte-13wa5zp><path fill=currentColor d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns=http://www.w3.org/2000/svg width=32 height=32 viewBox="0 0 24 24"class=svelte-13wa5zp><g fill=none stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M0 0h24v24H0z"></path><path fill=currentColor d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class=svelte-2kl70j><div class="sidebar sidebar-hide svelte-2kl70j"><div class=svelte-2kl70j><ul class="navbar-nav sidenav accordion svelte-2kl70j"><li class="accordion-item svelte-2kl70j"title=VB-Consulting><button class="accordion-header accordion-button collapsed svelte-2kl70j text-uppercase"href=/ type=button data-bs-toggle=collapse data-bs-target=#accordion-vb-consulting aria-expanded=false aria-controls=accordion-vb-consulting>VB-Consulting</button><div id=accordion-vb-consulting class="accordion-collapse collapse"><div class="accordion-body svelte-2kl70j"><ul class=navbar-nav><li class="nav-item svelte-2kl70j"data-id=""title=Home><a class="nav-link svelte-2kl70j text-uppercase"href=/ >Home</a><li class="nav-divider svelte-2kl70j"><hr class=svelte-2kl70j><li class="nav-item toc2 svelte-2kl70j"data-id=""title=RazorSvelte><a class="nav-link svelte-2kl70j text-uppercase"href=/razorsvelte/ >RazorSvelte</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=PgRoutiner><a class="nav-link svelte-2kl70j text-uppercase"href=/pgroutiner/ >PgRoutiner</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=XUnit.Npgsql><a class="nav-link svelte-2kl70j text-uppercase"href=/xunit.npgsql/ >XUnit.Npgsql</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title="PostrgeSQL Schema Tools"><a class="nav-link svelte-2kl70j text-uppercase"href=/pg_schema_tools/ >PostrgeSQL Schema Tools</a></ul></div></div><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>norm.net</span><hr class=svelte-2kl70j><li class="nav-item toc2 svelte-2kl70j"data-id=""title=Norm.Net><a class="nav-link svelte-2kl70j text-uppercase"href=/norm.net/ >Norm.Net</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title="example project"><a class="nav-link svelte-2kl70j text-uppercase"href=/norm.net/example/ >example project</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=benchmarks><a class="nav-link svelte-2kl70j text-uppercase"href=/norm.net/benchmarks/ >benchmarks</a><li class="nav-item toc2 svelte-2kl70j active"data-id=""title=changelog><a class="nav-link svelte-2kl70j text-uppercase"href=/norm.net/changelog/ >changelog</a><li class="accordion-item toc2 svelte-2kl70j"title=docs><button class="accordion-header accordion-button collapsed svelte-2kl70j lr-arrow text-uppercase"type=button data-bs-toggle=collapse data-bs-target=#accordion-docs aria-expanded=false aria-controls=accordion-docs><i class="bi bi-file-earmark-text svelte-2kl70j"></i> docs</button><div id=accordion-docs class="accordion-collapse collapse"><div class="accordion-body svelte-2kl70j"><ul class=navbar-nav><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>getting started</span><hr class=svelte-2kl70j><li class="nav-item svelte-2kl70j"data-id=""title=Introduction><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/getting-started/introduction/ ><i class="bi bi-file-text svelte-2kl70j"></i> Introduction</a><li class="nav-item svelte-2kl70j"data-id=""title=Installation><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/getting-started/installation/ ><i class="bi bi-file-text svelte-2kl70j"></i> Installation</a><li class="nav-item svelte-2kl70j"data-id=""title="First Use"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/getting-started/first-use/ ><i class="bi bi-file-text svelte-2kl70j"></i> First Use</a><li class="nav-item svelte-2kl70j"data-id=""title="Basic Concepts"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/getting-started/basic-concepts/ ><i class="bi bi-file-text svelte-2kl70j"></i> Basic Concepts</a><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>reference</span><hr class=svelte-2kl70j><li class="nav-item svelte-2kl70j"data-id=""title=Methods><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/reference/methods/ ><i class="bi bi-file-text svelte-2kl70j"></i> Methods</a><li class="nav-item svelte-2kl70j"data-id=""title=Options><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/reference/options/ ><i class="bi bi-file-text svelte-2kl70j"></i> Options</a><li class="nav-item svelte-2kl70j"data-id=""title=Parameters><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/reference/parameters/ ><i class="bi bi-file-text svelte-2kl70j"></i> Parameters</a><li class="nav-item svelte-2kl70j"data-id=""title="Read Mappings"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/reference/read/ ><i class="bi bi-file-text svelte-2kl70j"></i> Read Mappings</a><li class="nav-item svelte-2kl70j"data-id=""title="Multiple Mappings"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/norm.net/docs/reference/multiple/ ><i class="bi bi-file-text svelte-2kl70j"></i> Multiple Mappings</a></ul></div></div></ul></div></div><div class="content svelte-2kl70j"><div class="container main-content gh-content"><h1 id=changelog>Changelog<a class="anchor bookmark-target"href=#changelog><i class="bi bi-link-45deg"></i></a></h1><a href=https://github.com/vb-consulting/Norm.net/blob/master/changelog.md class=github-edit><i class="bi bi-github"></i>Edit this page on GitHub</a><p>Note: changelogs prior to version 5.3.0 can be found in archive markup: <a href=https://github.com/vb-consulting/Norm.net/blob/master/changelog-archive.md>changelog-archive.md</a><h2 id=540-2023-11-27><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.9>5.4.0</a> (2023-11-27)<a class="anchor bookmark-target"href=#540-2023-11-27><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.9...5.4.0>Full Changelog</a><h3 id=new-feature-getrecordsaffected-method>New feature: GetRecordsAffected method<a class="anchor bookmark-target"href=#new-feature-getrecordsaffected-method><i class="bi bi-link-45deg"></i></a></h3><p>Signature:<ul><li>Extension: <code>public static int? GetRecordsAffected(this DbConnection connection)</code><li>Instance: <code>public int? GetRecordsAffected()</code></ul><p>Returns a number of records affected by the last query.<p>This is the value that <a href=https://learn.microsoft.com/en-us/dotnet/api/system.data.sqlclient.sqlcommand.executenonquery><code>ExecuteNonQuery()</code></a> method returns if one of the <code>Execute</code> versions is executed.<p>Example:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">rowsAffected</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Execute</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"insert into rows_affected_test values ('foo')"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">GetRecordsAffected</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">rowsAffected</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Execute</span><span style="color: #000000">(</span><span style="color: #A31515">"insert into rows_affected_test values ('foo')"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">GetRecordsAffected</span><span style="color: #000000">();</span></span></code></pre></div><p>If one of the <code>Read</code> methods is executed, this method will contain a value of <a href=https://learn.microsoft.com/en-us/dotnet/api/system.data.sqlclient.sqldatareader.recordsaffected><code>RecordsAffected</code> reader property</a><p>However, <code>Read</code> methods will always return a value of the read operation (enumerator), so access to the instance is hidden.<p>That is why the <code>Norm</code> extension method is also introduced.<h3 id=new-feature-norm-extension-method>New feature: Norm extension method<a class="anchor bookmark-target"href=#new-feature-norm-extension-method><i class="bi bi-link-45deg"></i></a></h3><p>Signature:<ul><li>Extension: <code>public static Norm Norm(this DbConnection connection)</code></ul><p>Creates and returns a new <code>Norm</code> instance from the connection.<p>Example:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">instance</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Norm</span><span style="color: #E6E6E6">();</span></span>
<span class=line><span style="color: #9CDCFE">instance</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"select * from rows_affected_test"</span><span style="color: #E6E6E6">).</span><span style="color: #DCDCAA">ToList</span><span style="color: #E6E6E6">();</span></span>
<span class=line><span style="color: #9CDCFE">rowsAffected</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">instance</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetRecordsAffected</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">instance</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Norm</span><span style="color: #000000">();</span></span>
<span class=line><span style="color: #001080">instance</span><span style="color: #000000">.</span><span style="color: #795E26">Read</span><span style="color: #000000">(</span><span style="color: #A31515">"select * from rows_affected_test"</span><span style="color: #000000">).</span><span style="color: #795E26">ToList</span><span style="color: #000000">();</span></span>
<span class=line><span style="color: #001080">rowsAffected</span><span style="color: #000000"> = </span><span style="color: #001080">instance</span><span style="color: #000000">.</span><span style="color: #795E26">GetRecordsAffected</span><span style="color: #000000">();</span></span></code></pre></div><h3 id=breaking-changes>Breaking changes:<a class="anchor bookmark-target"href=#breaking-changes><i class="bi bi-link-45deg"></i></a></h3><ul><li>Extensions <code>Execute</code> and <code>ExecuteFormat</code> were returning the connection instance in previous versions.<li>This is changed to return the current <code>Norm</code> instance instead.</ul><p>This may break certain codebases.<p>For example, before this version, it was possible to chain <code>Execute</code> method with connection creation like this:<div class=one-liner><div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">var</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">connection</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlConnection</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">connectionString</span><span style="color: #E6E6E6">).</span><span style="color: #4EC9B0">Execute</span><span style="color: #E6E6E6">("</span><span style="color: #4EC9B0">create</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">temp</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">table</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">test</span><span style="color: #E6E6E6"> (</span><span style="color: #4EC9B0">i</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">int</span><span style="color: #E6E6E6">);</span><span style="color: #CE9178">")</span><span style="color: #F44747">;</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #267F99">var</span><span style="color: #000000"> </span><span style="color: #267F99">connection</span><span style="color: #000000"> = </span><span style="color: #267F99">new</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlConnection</span><span style="color: #000000">(</span><span style="color: #267F99">connectionString</span><span style="color: #000000">).</span><span style="color: #267F99">Execute</span><span style="color: #000000">("</span><span style="color: #267F99">create</span><span style="color: #000000"> </span><span style="color: #267F99">temp</span><span style="color: #000000"> </span><span style="color: #267F99">table</span><span style="color: #000000"> </span><span style="color: #267F99">test</span><span style="color: #000000"> (</span><span style="color: #267F99">i</span><span style="color: #000000"> </span><span style="color: #267F99">int</span><span style="color: #000000">);</span><span style="color: #A31515">")</span><span style="color: #CD3131">;</span></span></code></pre></div></div><p>Now, this code won't work because <code>Execute</code> method returns <code>Norm</code> instance. Instead, it should look like this:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">var</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">connection</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlConnection</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">connectionString</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Execute</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"create temp table test (i int);"</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #267F99">var</span><span style="color: #000000"> </span><span style="color: #267F99">connection</span><span style="color: #000000"> = </span><span style="color: #267F99">new</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlConnection</span><span style="color: #000000">(</span><span style="color: #267F99">connectionString</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Execute</span><span style="color: #000000">(</span><span style="color: #A31515">"create temp table test (i int);"</span><span style="color: #000000">);</span></span></code></pre></div><h2 id=539-2023-10-07><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.9>5.3.9</a> (2023-10-07)<a class="anchor bookmark-target"href=#539-2023-10-07><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.8...5.3.9>Full Changelog</a><p>Fix the issue with mapping protected properties.<p>Setting the global option should also include mapping to protected properties:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #9CDCFE">NormOptions</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Configure</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">MapPrivateSetters</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">});</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #001080">NormOptions</span><span style="color: #000000">.</span><span style="color: #795E26">Configure</span><span style="color: #000000">(</span><span style="color: #001080">options</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">options</span><span style="color: #000000">.</span><span style="color: #001080">MapPrivateSetters</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">});</span></span></code></pre></div><p>By setting this global option, it was possible to map public properties with protected setter <code>public int ProtectedSetInt { get; protected set; }</code>, but not protected properties <code>protected int ProtectedInt { get; set; }</code>.<p>This inconsistency is fixed with this release.<h2 id=538-2023-09-07><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.8>5.3.8</a> (2023-09-07)<a class="anchor bookmark-target"href=#538-2023-09-07><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.7...5.3.8>Full Changelog</a><p>Support for HSTORE PostgreSQL data type.<p>HSTORE is a key/value data type that is returned as <code>Dictionary&lt;string, string></code> by the Npgsql reader.<p>There was a <a href=https://github.com/vb-consulting/Norm.net/issues/20>mapping issue with HSTORE data type</a> - when mapping to class instances by name that was fixed in this release.<p>This works properly now:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">HstoreTest</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">I</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Dictionary</span><span style="color: #E6E6E6">&lt;</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">> </span><span style="color: #9CDCFE">J</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span>
<span class=line><span style="color: #E6E6E6">        </span></span>
<span class=line><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">Fact</span><span style="color: #E6E6E6">]</span></span>
<span class=line><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">void</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">Hstore_Read_Class_Instance_Sync</span><span style="color: #E6E6E6">()</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlConnection</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">fixture</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">ConnectionString</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Execute</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"create extension if not exists hstore"</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReloadTypes</span><span style="color: #E6E6E6">();</span></span>
<span class=line></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">        .</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">HstoreTest</span><span style="color: #E6E6E6">>(</span><span style="color: #9CDCFE">query</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">        .</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span>
<span class=line></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsType</span><span style="color: #E6E6E6">&lt;</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">>(</span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">I</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsType</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Dictionary</span><span style="color: #E6E6E6">&lt;</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">>>(</span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">J</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"123"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">J</span><span style="color: #E6E6E6">[</span><span style="color: #CE9178">"foo"</span><span style="color: #E6E6E6">]);</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">HstoreTest</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">I</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #0000FF">string</span><span style="color: #000000">, </span><span style="color: #0000FF">string</span><span style="color: #000000">> </span><span style="color: #001080">J</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">}</span></span>
<span class=line><span style="color: #000000">        </span></span>
<span class=line><span style="color: #000000">[</span><span style="color: #267F99">Fact</span><span style="color: #000000">]</span></span>
<span class=line><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">void</span><span style="color: #000000"> </span><span style="color: #795E26">Hstore_Read_Class_Instance_Sync</span><span style="color: #000000">()</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">connection</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlConnection</span><span style="color: #000000">(</span><span style="color: #001080">fixture</span><span style="color: #000000">.</span><span style="color: #001080">ConnectionString</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Execute</span><span style="color: #000000">(</span><span style="color: #A31515">"create extension if not exists hstore"</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">ReloadTypes</span><span style="color: #000000">();</span></span>
<span class=line></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">        .</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">HstoreTest</span><span style="color: #000000">>(</span><span style="color: #001080">query</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">        .</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span>
<span class=line></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">IsType</span><span style="color: #000000">&lt;</span><span style="color: #0000FF">string</span><span style="color: #000000">>(</span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">I</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">IsType</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Dictionary</span><span style="color: #000000">&lt;</span><span style="color: #0000FF">string</span><span style="color: #000000">, </span><span style="color: #0000FF">string</span><span style="color: #000000">>>(</span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">J</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #A31515">"123"</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">J</span><span style="color: #000000">[</span><span style="color: #A31515">"foo"</span><span style="color: #000000">]);</span></span>
<span class=line><span style="color: #000000">}</span></span></code></pre></div><p>Also, this release includes some minor performance optimizations too (objects not passed by reference). There will be new performance tests soon.<h2 id=537-2023-07-17><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.7>5.3.7</a> (2023-07-17)<a class="anchor bookmark-target"href=#537-2023-07-17><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.6...5.3.7>Full Changelog</a><h3 id=new-feature-nameparsercallback-option>New feature NameParserCallback option<a class="anchor bookmark-target"href=#new-feature-nameparsercallback-option><i class="bi bi-link-45deg"></i></a></h3><p>This is a new global option that can be set for all <code>Read</code> operations globally via options:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NormOptions</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// ...</span></span>
<span class=line></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #6A9955">/// </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">summary</span><span style="color: #808080">></span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #6A9955">/// Set the global name parser to return custom names for columns.</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #6A9955">/// </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">summary</span><span style="color: #808080">></span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Func</span><span style="color: #E6E6E6">&lt;(</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">), </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">> </span><span style="color: #9CDCFE">NameParserCallback</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">;</span></span>
<span class=line></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// ...</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">NormOptions</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #008000">// ...</span></span>
<span class=line></span>
<span class=line><span style="color: #000000">    </span><span style="color: #008000">/// </span><span style="color: #800000">&lt;summary></span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #008000">/// Set the global name parser to return custom names for columns.</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #008000">/// </span><span style="color: #800000">&lt;/summary></span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">Func</span><span style="color: #000000">&lt;(</span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000">, </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Ordinal</span><span style="color: #000000">), </span><span style="color: #0000FF">string</span><span style="color: #000000">> </span><span style="color: #001080">NameParserCallback</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; } = </span><span style="color: #0000FF">null</span><span style="color: #000000">;</span></span>
<span class=line></span>
<span class=line><span style="color: #000000">    </span><span style="color: #008000">// ...</span></span>
<span class=line><span style="color: #000000">}</span></span></code></pre></div><p>This callback is invoked once per query for every column when column names are retrieved before any mapping.<p>It is very useful in situations where you need to map column names to a different format, or in general to be able to map to different names.<p>Input parameter is a tuple with the column name (as it is retrieved from database connection) and ordinal position. Use return value to set the name for the column.<p>For example, if you want to remove a prefix (<code>prefix_</code> for example) string from all column names where it appears, you can do it like this:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #6A9955">//</span></span>
<span class=line><span style="color: #6A9955">// Program startup</span></span>
<span class=line><span style="color: #6A9955">//</span></span>
<span class=line></span>
<span class=line><span style="color: #9CDCFE">NormOptions</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Configure</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">o</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">o</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">NameParserCallback</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">StartsWith</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"prefix_"</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">[</span><span style="color: #F44747">7..</span><span style="color: #E6E6E6">] </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">});</span></span>
<span class=line></span>
<span class=line><span style="color: #6A9955">//</span></span>
<span class=line><span style="color: #6A9955">// In your code, when mapping by name, target class doesn't require prefix "prefix_" in property name</span></span>
<span class=line><span style="color: #6A9955">//</span></span>
<span class=line><span style="color: #569CD6">private</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NameParserTest</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">? </span><span style="color: #9CDCFE">Foo</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">? </span><span style="color: #9CDCFE">Bar</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A9955">// Read to single result:</span></span>
<span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">NameParserTest</span><span style="color: #E6E6E6">>(</span><span style="color: #CE9178">"select * from name_parser_test"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #008000">//</span></span>
<span class=line><span style="color: #008000">// Program startup</span></span>
<span class=line><span style="color: #008000">//</span></span>
<span class=line></span>
<span class=line><span style="color: #001080">NormOptions</span><span style="color: #000000">.</span><span style="color: #795E26">Configure</span><span style="color: #000000">(</span><span style="color: #001080">o</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">o</span><span style="color: #000000">.</span><span style="color: #001080">NameParserCallback</span><span style="color: #000000"> = </span><span style="color: #001080">arg</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000">.</span><span style="color: #795E26">StartsWith</span><span style="color: #000000">(</span><span style="color: #A31515">"prefix_"</span><span style="color: #000000">) ? </span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000">[</span><span style="color: #CD3131">7..</span><span style="color: #000000">] : </span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">});</span></span>
<span class=line></span>
<span class=line><span style="color: #008000">//</span></span>
<span class=line><span style="color: #008000">// In your code, when mapping by name, target class doesn't require prefix "prefix_" in property name</span></span>
<span class=line><span style="color: #008000">//</span></span>
<span class=line><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">NameParserTest</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000">? </span><span style="color: #001080">Foo</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000">? </span><span style="color: #001080">Bar</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">}</span></span>
<span class=line></span>
<span class=line><span style="color: #008000">// Read to single result:</span></span>
<span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">NameParserTest</span><span style="color: #000000">>(</span><span style="color: #A31515">"select * from name_parser_test"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span></code></pre></div><p>Since this callback, if defined, is executed once per query it doesn't have any impact on mapping performances.<h3 id=more-internal-optimizations>More internal optimizations<a class="anchor bookmark-target"href=#more-internal-optimizations><i class="bi bi-link-45deg"></i></a></h3><p>There were two missed optimization opportunities in the code that were fixed in this release:<ul><li>Passing some structures by references instead of values.<li>Retrieving column names from the reader once per query instead of once per row.</ul><p>These optimizations aren't significant and are hardly noticeable, but they required a completely new set of performance tests. See <a href=https://github.com/vb-consulting/Norm.net/blob/5.3.4/performance-tests.md>performance test results here.</a><p>To facilitate easier performance testing, there is a <a href=https://github.com/vb-consulting/Norm.net/blob/master/Benchmarks/Dockerfile>docker file</a> that can be used to run performance tests in a docker environment.<h3 id=changed-access-modifiers-for-internal-mappers>Changed access modifiers for internal mappers<a class="anchor bookmark-target"href=#changed-access-modifiers-for-internal-mappers><i class="bi bi-link-45deg"></i></a></h3><p>Previously public parts of internal mappers that were marked as <code>public</code> are now <code>internal</code>.<h2 id=536-2023-07-02><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.6>5.3.6</a> (2023-07-02)<a class="anchor bookmark-target"href=#536-2023-07-02><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.5...5.3.6>Full Changelog</a><h3 id=global-handler-for-reader-callback>Global handler for reader callback<a class="anchor bookmark-target"href=#global-handler-for-reader-callback><i class="bi bi-link-45deg"></i></a></h3><p>Added global handler that can be set for all Read operations globally via options:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #9CDCFE">NormOptions</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Configure</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">DbReaderCallback</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">r</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">r</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">switch</span></span>
<span class=line><span style="color: #E6E6E6">    {</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">r</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetInt32</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">,  </span><span style="color: #6A9955">// add 1 to the first field with ordinal 0, mapped to the first tuple named "a"</span></span>
<span class=line><span style="color: #E6E6E6">        _ </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">                       </span><span style="color: #6A9955">// for all other fields, use the default mapping</span></span>
<span class=line><span style="color: #E6E6E6">    });</span></span>
<span class=line><span style="color: #E6E6E6">});</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #001080">NormOptions</span><span style="color: #000000">.</span><span style="color: #795E26">Configure</span><span style="color: #000000">(</span><span style="color: #001080">options</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">options</span><span style="color: #000000">.</span><span style="color: #001080">DbReaderCallback</span><span style="color: #000000"> = </span><span style="color: #001080">r</span><span style="color: #000000"> => </span><span style="color: #001080">r</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000"> </span><span style="color: #AF00DB">switch</span></span>
<span class=line><span style="color: #000000">    {</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #098658">0</span><span style="color: #000000"> => </span><span style="color: #001080">r</span><span style="color: #000000">.</span><span style="color: #001080">Reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetInt32</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">) + </span><span style="color: #098658">1</span><span style="color: #000000">,  </span><span style="color: #008000">// add 1 to the first field with ordinal 0, mapped to the first tuple named "a"</span></span>
<span class=line><span style="color: #000000">        _ => </span><span style="color: #0000FF">null</span><span style="color: #000000">                       </span><span style="color: #008000">// for all other fields, use the default mapping</span></span>
<span class=line><span style="color: #000000">    });</span></span>
<span class=line><span style="color: #000000">});</span></span></code></pre></div><p>This would be equivalent to executing every Read operation with the <code>WithReaderCallback</code> method like this:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">array</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">WithReaderCallback</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">r</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">r</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">switch</span></span>
<span class=line><span style="color: #E6E6E6">    {</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">r</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetInt32</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">,  </span><span style="color: #6A9955">// add 1 to the first field with ordinal 0, mapped to the first tuple named "a"</span></span>
<span class=line><span style="color: #E6E6E6">        _ </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">                       </span><span style="color: #6A9955">// for all other fields, use the default mapping</span></span>
<span class=line><span style="color: #E6E6E6">    })</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;(</span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">a</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">b</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">c</span><span style="color: #E6E6E6">)>(</span><span style="color: #CE9178">"select * from (values (1, 1, 1), (2, 2, 2), (3, 3, 3)) t(a, b, c)"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">ToArray</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">array</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">WithReaderCallback</span><span style="color: #000000">(</span><span style="color: #001080">r</span><span style="color: #000000"> => </span><span style="color: #001080">r</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000"> </span><span style="color: #AF00DB">switch</span></span>
<span class=line><span style="color: #000000">    {</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #098658">0</span><span style="color: #000000"> => </span><span style="color: #001080">r</span><span style="color: #000000">.</span><span style="color: #001080">Reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetInt32</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">) + </span><span style="color: #098658">1</span><span style="color: #000000">,  </span><span style="color: #008000">// add 1 to the first field with ordinal 0, mapped to the first tuple named "a"</span></span>
<span class=line><span style="color: #000000">        _ => </span><span style="color: #0000FF">null</span><span style="color: #000000">                       </span><span style="color: #008000">// for all other fields, use the default mapping</span></span>
<span class=line><span style="color: #000000">    })</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;(</span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">a</span><span style="color: #000000">, </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">b</span><span style="color: #000000">, </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">c</span><span style="color: #000000">)>(</span><span style="color: #A31515">"select * from (values (1, 1, 1), (2, 2, 2), (3, 3, 3)) t(a, b, c)"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">ToArray</span><span style="color: #000000">();</span></span></code></pre></div><blockquote><p>Important: reader callback can be set only once per read operation and that includes global reader callbacks.</blockquote><p>If you set global reader callback and another reader callback with <code>WithReaderCallback</code> - a <code>NormReaderAlreadyAssignedException</code> exception will be thrown.<ul><li>You can assign reader callbacks from private methods, for example:</ul><div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">private</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">object</span><span style="color: #E6E6E6">? </span><span style="color: #DCDCAA">ReaderCallback</span><span style="color: #E6E6E6">((</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">DbDataReader</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">) </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetDataTypeName</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">) </span><span style="color: #C586C0">switch</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"json"</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">JsonNode</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Parse</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetString</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">))</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AsObject</span><span style="color: #E6E6E6">(),</span></span>
<span class=line><span style="color: #E6E6E6">    _ </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span></span>
<span class=line><span style="color: #E6E6E6">};</span></span>
<span class=line></span>
<span class=line><span style="color: #6A9955">//</span></span>
<span class=line><span style="color: #6A9955">// in your startup</span></span>
<span class=line><span style="color: #9CDCFE">NormOptions</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Configure</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">o</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">o</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">DbReaderCallback</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">ReaderCallback</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">object</span><span style="color: #000000">? </span><span style="color: #795E26">ReaderCallback</span><span style="color: #000000">((</span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000">, </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Ordinal</span><span style="color: #000000">, </span><span style="color: #267F99">DbDataReader</span><span style="color: #000000"> </span><span style="color: #001080">Reader</span><span style="color: #000000">) </span><span style="color: #001080">arg</span><span style="color: #000000">) => </span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetDataTypeName</span><span style="color: #000000">(</span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000">) </span><span style="color: #AF00DB">switch</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #A31515">"json"</span><span style="color: #000000"> => </span><span style="color: #001080">JsonNode</span><span style="color: #000000">.</span><span style="color: #795E26">Parse</span><span style="color: #000000">(</span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetString</span><span style="color: #000000">(</span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000">))?.</span><span style="color: #795E26">AsObject</span><span style="color: #000000">(),</span></span>
<span class=line><span style="color: #000000">    _ => </span><span style="color: #0000FF">null</span></span>
<span class=line><span style="color: #000000">};</span></span>
<span class=line></span>
<span class=line><span style="color: #008000">//</span></span>
<span class=line><span style="color: #008000">// in your startup</span></span>
<span class=line><span style="color: #001080">NormOptions</span><span style="color: #000000">.</span><span style="color: #795E26">Configure</span><span style="color: #000000">(</span><span style="color: #001080">o</span><span style="color: #000000"> => </span><span style="color: #001080">o</span><span style="color: #000000">.</span><span style="color: #001080">DbReaderCallback</span><span style="color: #000000"> = </span><span style="color: #001080">ReaderCallback</span><span style="color: #000000">);</span></span></code></pre></div><p>The example above of the global reader handler shows how to implement a custom type mapping in your application: If the record type is <code>json</code> it will be automatically parsed to <code>JsonObject</code> object.<p>Example:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">private</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">object</span><span style="color: #E6E6E6">? </span><span style="color: #DCDCAA">ReaderCallback</span><span style="color: #E6E6E6">((</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">DbDataReader</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">) </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetDataTypeName</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">) </span><span style="color: #C586C0">switch</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"json"</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">JsonNode</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Parse</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetString</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">arg</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">))</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AsObject</span><span style="color: #E6E6E6">(),</span></span>
<span class=line><span style="color: #E6E6E6">    _ </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span></span>
<span class=line><span style="color: #E6E6E6">};</span></span>
<span class=line></span>
<span class=line><span style="color: #6A9955">//</span></span>
<span class=line><span style="color: #6A9955">// in your startup</span></span>
<span class=line><span style="color: #9CDCFE">NormOptions</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Configure</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">o</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">o</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">DbReaderCallback</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">ReaderCallback</span><span style="color: #E6E6E6">);</span></span>
<span class=line></span>
<span class=line><span style="color: #569CD6">private</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">JsonTest</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">I</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">JsonObject</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">J</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A9955">// all `json` types are automatically converted to `JsonObject` object</span></span>
<span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">instance</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">JsonTest</span><span style="color: #E6E6E6">>(</span><span style="color: #CE9178">"select '{</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">a</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">: 1}'::text as i, '{</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">a</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">: 1}'::json as j"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">object</span><span style="color: #000000">? </span><span style="color: #795E26">ReaderCallback</span><span style="color: #000000">((</span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000">, </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Ordinal</span><span style="color: #000000">, </span><span style="color: #267F99">DbDataReader</span><span style="color: #000000"> </span><span style="color: #001080">Reader</span><span style="color: #000000">) </span><span style="color: #001080">arg</span><span style="color: #000000">) => </span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetDataTypeName</span><span style="color: #000000">(</span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000">) </span><span style="color: #AF00DB">switch</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #A31515">"json"</span><span style="color: #000000"> => </span><span style="color: #001080">JsonNode</span><span style="color: #000000">.</span><span style="color: #795E26">Parse</span><span style="color: #000000">(</span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetString</span><span style="color: #000000">(</span><span style="color: #001080">arg</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000">))?.</span><span style="color: #795E26">AsObject</span><span style="color: #000000">(),</span></span>
<span class=line><span style="color: #000000">    _ => </span><span style="color: #0000FF">null</span></span>
<span class=line><span style="color: #000000">};</span></span>
<span class=line></span>
<span class=line><span style="color: #008000">//</span></span>
<span class=line><span style="color: #008000">// in your startup</span></span>
<span class=line><span style="color: #001080">NormOptions</span><span style="color: #000000">.</span><span style="color: #795E26">Configure</span><span style="color: #000000">(</span><span style="color: #001080">o</span><span style="color: #000000"> => </span><span style="color: #001080">o</span><span style="color: #000000">.</span><span style="color: #001080">DbReaderCallback</span><span style="color: #000000"> = </span><span style="color: #001080">ReaderCallback</span><span style="color: #000000">);</span></span>
<span class=line></span>
<span class=line><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">JsonTest</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">I</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">JsonObject</span><span style="color: #000000"> </span><span style="color: #001080">J</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">}</span></span>
<span class=line></span>
<span class=line><span style="color: #008000">// all `json` types are automatically converted to `JsonObject` object</span></span>
<span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">instance</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">JsonTest</span><span style="color: #000000">>(</span><span style="color: #A31515">"select '{</span><span style="color: #EE0000">\"</span><span style="color: #A31515">a</span><span style="color: #EE0000">\"</span><span style="color: #A31515">: 1}'::text as i, '{</span><span style="color: #EE0000">\"</span><span style="color: #A31515">a</span><span style="color: #EE0000">\"</span><span style="color: #A31515">: 1}'::json as j"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span></code></pre></div><h2 id=535-2023-07-01><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.5>5.3.5</a> (2023-07-01)<a class="anchor bookmark-target"href=#535-2023-07-01><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.4...5.3.5>Full Changelog</a><p>When using the method for mapping anonymous instances based on instance prototype, e.g.:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">(</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> {</span><span style="color: #9CDCFE">id</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">), </span><span style="color: #9CDCFE">name</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">)}, </span><span style="color: #6A9955">// anonymous instance prototype</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #CE9178">"select 1 as id, 'foo' as name"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span>
<span class=line></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result1</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"foo"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result1</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result1</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Read</span><span style="color: #000000">(</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">new</span><span style="color: #000000"> {</span><span style="color: #001080">id</span><span style="color: #000000"> = </span><span style="color: #0000FF">default</span><span style="color: #000000">(</span><span style="color: #0000FF">int</span><span style="color: #000000">), </span><span style="color: #001080">name</span><span style="color: #000000"> = </span><span style="color: #0000FF">default</span><span style="color: #000000">(</span><span style="color: #0000FF">string</span><span style="color: #000000">)}, </span><span style="color: #008000">// anonymous instance prototype</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #A31515">"select 1 as id, 'foo' as name"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span>
<span class=line></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">result1</span><span style="color: #000000">.</span><span style="color: #001080">Id</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #A31515">"foo"</span><span style="color: #000000">, </span><span style="color: #001080">result1</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000">);</span></span></code></pre></div><p>From version <code>5.3.5</code> you can use a normal instance as a prototype, e.g.:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Class1</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span>
<span class=line></span>
<span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">instance1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Class1</span><span style="color: #E6E6E6">();</span></span>
<span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">instance1</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"select 1 as id, 'foo' as name"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span>
<span class=line></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result1</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"foo"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result1</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Class1</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Id</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">}</span></span>
<span class=line></span>
<span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">instance1</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Class1</span><span style="color: #000000">();</span></span>
<span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result1</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Read</span><span style="color: #000000">(</span><span style="color: #001080">instance1</span><span style="color: #000000">, </span><span style="color: #A31515">"select 1 as id, 'foo' as name"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span>
<span class=line></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">result1</span><span style="color: #000000">.</span><span style="color: #001080">Id</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #A31515">"foo"</span><span style="color: #000000">, </span><span style="color: #001080">result1</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000">);</span></span></code></pre></div><p>When the mapper encounters an instance that is not anonymous, it will use the standard method of mapping instances.<h2 id=534-2023-05-26><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.4>5.3.4</a> (2023-05-26)<a class="anchor bookmark-target"href=#534-2023-05-26><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.3...5.3.4>Full Changelog</a><h3 id=new-option---keeporiginalnames>New option - KeepOriginalNames<a class="anchor bookmark-target"href=#new-option---keeporiginalnames><i class="bi bi-link-45deg"></i></a></h3><p>When matching by name, the default behavior is to strip all database names of underscores and @ at characters.<p>This is done to make it easier to map underscore-separated names to C# properties (<code>field_name</code> to <code>FieldName</code> for example).<p>Set this option to true to skip this behavior and keep the original names.<p>Example:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #6A9955">//</span></span>
<span class=line><span style="color: #6A9955">// in your startup</span></span>
<span class=line><span style="color: #6A9955">//</span></span>
<span class=line><span style="color: #9CDCFE">NormOptions</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Configure</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">KeepOriginalNames</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">});</span></span>
<span class=line></span>
<span class=line><span style="color: #E6E6E6">...</span></span>
<span class=line></span>
<span class=line><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">FooBarClass</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">? </span><span style="color: #9CDCFE">Foo_Bar</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">? </span><span style="color: #9CDCFE">FooBar</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span>
<span class=line></span>
<span class=line><span style="color: #E6E6E6">...</span></span>
<span class=line></span>
<span class=line><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">FooBarClass</span><span style="color: #E6E6E6">>(</span><span style="color: #CE9178">"select 'foobar' as foo_bar"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span>
<span class=line></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"foobar"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Foo_Bar</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Null</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">FooBar</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #008000">//</span></span>
<span class=line><span style="color: #008000">// in your startup</span></span>
<span class=line><span style="color: #008000">//</span></span>
<span class=line><span style="color: #001080">NormOptions</span><span style="color: #000000">.</span><span style="color: #795E26">Configure</span><span style="color: #000000">(</span><span style="color: #001080">options</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">options</span><span style="color: #000000">.</span><span style="color: #001080">KeepOriginalNames</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">});</span></span>
<span class=line></span>
<span class=line><span style="color: #000000">...</span></span>
<span class=line></span>
<span class=line><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">FooBarClass</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000">? </span><span style="color: #001080">Foo_Bar</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000">? </span><span style="color: #001080">FooBar</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">}</span></span>
<span class=line></span>
<span class=line><span style="color: #000000">...</span></span>
<span class=line></span>
<span class=line><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">FooBarClass</span><span style="color: #000000">>(</span><span style="color: #A31515">"select 'foobar' as foo_bar"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span>
<span class=line></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #A31515">"foobar"</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">Foo_Bar</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Null</span><span style="color: #000000">(</span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">FooBar</span><span style="color: #000000">);</span></span></code></pre></div><h3 id=new-optimization-and-new-performance-tests>New optimization and new performance tests<a class="anchor bookmark-target"href=#new-optimization-and-new-performance-tests><i class="bi bi-link-45deg"></i></a></h3><p>Some missed performance optimizations were added in this version. See the <a href=https://github.com/vb-consulting/Norm.net/compare/5.3.3...5.3.4>changelog</a> for more details.<p>Also, see <a href=https://github.com/vb-consulting/Norm.net/blob/5.3.4/performance-tests.md>performance tests results</a>.<h2 id=533-2023-05-16><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.3>5.3.3</a> (2023-05-16)<a class="anchor bookmark-target"href=#533-2023-05-16><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.2...5.3.3>Full Changelog</a><h3 id=fix---nullableinstances-option-turned-on-but-have-non-nullable-properties>Fix - NullableInstances option turned on but have non-nullable properties<a class="anchor bookmark-target"href=#fix---nullableinstances-option-turned-on-but-have-non-nullable-properties><i class="bi bi-link-45deg"></i></a></h3><ul><li><p>In previous version a new feature - when <code>NullableInstances</code> option is turned on, the mapper will return <code>null</code> instances if all mapped values are <code>null</code>.<li><p>However, there was a edge-case bug in this implementation: Mapper tried first to assign a <code>null</code> value to instance, and if the property being mapped is not nullable - mapper would crash.<li><p>This is now fixed in this version - if all mapped values are null, and <code>NullableInstances</code> option is on - return instance will be null, regardless of property types.</ul><h3 id=new-feature---normnullexception>New feature - NormNullException<a class="anchor bookmark-target"href=#new-feature---normnullexception><i class="bi bi-link-45deg"></i></a></h3><ul><li>Attempted mapping of database null value to a non-nullable property will now throw <code>NormNullException</code> exception with nice message, for example: <code>Can't map null value for database field "foo" to non-nullable property "Foo".</code>.</ul><h2 id=532-2023-05-03><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.2>5.3.2</a> (2023-05-03)<a class="anchor bookmark-target"href=#532-2023-05-03><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.1...5.3.2>Full Changelog</a><h3 id=new-feature---nullableinstances>New Feature - NullableInstances<a class="anchor bookmark-target"href=#new-feature---nullableinstances><i class="bi bi-link-45deg"></i></a></h3><ul><li><p>There is a new option <code>NullableInstances</code> that can be used to control whether to return <code>null</code> instances or not.<li><p>When this option is set to <code>true</code>, the mapper will return <code>null</code> instances for all classes that have all properties set to <code>null</code>.<li><p>The default is <code>false</code> which is the same behavior as before (no changes).<li><p>Example:</ul><ol><li>Set this option switch to true in your program startup:</ol><div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #9CDCFE">NormOptions</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Configure</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">NullableInstances</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">});</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #001080">NormOptions</span><span style="color: #000000">.</span><span style="color: #795E26">Configure</span><span style="color: #000000">(</span><span style="color: #001080">options</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">options</span><span style="color: #000000">.</span><span style="color: #001080">NullableInstances</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">});</span></span></code></pre></div><ol start=2><li>When all mapped property values are <code>NULL</code>, instance will be null as well:</ol><div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">TestClass</span></span>
<span class=line><span style="color: #E6E6E6">    {</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">? </span><span style="color: #9CDCFE">Foo</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">? </span><span style="color: #9CDCFE">Bar</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    }</span></span>
<span class=line></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">TestClass</span><span style="color: #E6E6E6">?>(</span><span style="color: #CE9178">"select NULL as foo, NULL as bar"</span><span style="color: #E6E6E6">).</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span>
<span class=line><span style="color: #E6E6E6">    </span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// result is null since all properties are null</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Null</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">TestClass</span></span>
<span class=line><span style="color: #000000">    {</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000">? </span><span style="color: #001080">Foo</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000">? </span><span style="color: #001080">Bar</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    }</span></span>
<span class=line></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">TestClass</span><span style="color: #000000">?>(</span><span style="color: #A31515">"select NULL as foo, NULL as bar"</span><span style="color: #000000">).</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span>
<span class=line><span style="color: #000000">    </span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #008000">// result is null since all properties are null</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Null</span><span style="color: #000000">(</span><span style="color: #001080">result</span><span style="color: #000000">);</span></span></code></pre></div><p>This is can be useful when doing left joins and you want to know if join is matched. Example:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">asset</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">vehicle</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsync</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Asset</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">Vehicle</span><span style="color: #E6E6E6">?>(</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #CE9178">"""</span></span>
<span class=line><span style="color: #CE9178">        select a.*, v.</span><span style="color: #F44747">*</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">from</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">assets</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">a</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">left</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">join</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">vehicles</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">v</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">on</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">a</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">id</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">v</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">id</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #CE9178">"""</span></span>
<span class=line><span style="color: #CE9178">    </span><span style="color: #F44747">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Single</span><span style="color: #E6E6E6">();</span></span>
<span class=line><span style="color: #E6E6E6">    </span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">if</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">vehicle</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">is</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">null</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    {</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #6A9955">// no matching vehicle</span></span>
<span class=line><span style="color: #E6E6E6">    }</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> (</span><span style="color: #001080">asset</span><span style="color: #000000">, </span><span style="color: #001080">vehicle</span><span style="color: #000000">) = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsync</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Asset</span><span style="color: #000000">, </span><span style="color: #267F99">Vehicle</span><span style="color: #000000">?>(</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #A31515">"""</span></span>
<span class=line><span style="color: #A31515">        select a.*, v.</span><span style="color: #CD3131">*</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #001080">from</span><span style="color: #000000"> </span><span style="color: #001080">assets</span><span style="color: #000000"> </span><span style="color: #001080">a</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #001080">left</span><span style="color: #000000"> </span><span style="color: #001080">join</span><span style="color: #000000"> </span><span style="color: #001080">vehicles</span><span style="color: #000000"> </span><span style="color: #001080">v</span><span style="color: #000000"> </span><span style="color: #001080">on</span><span style="color: #000000"> </span><span style="color: #001080">a</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000"> = </span><span style="color: #001080">v</span><span style="color: #000000">.</span><span style="color: #001080">id</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #A31515">"""</span></span>
<span class=line><span style="color: #A31515">    </span><span style="color: #CD3131">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Single</span><span style="color: #000000">();</span></span>
<span class=line><span style="color: #000000">    </span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #795E26">if</span><span style="color: #000000"> (</span><span style="color: #001080">vehicle</span><span style="color: #000000"> </span><span style="color: #267F99">is</span><span style="color: #000000"> </span><span style="color: #001080">null</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    {</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #008000">// no matching vehicle</span></span>
<span class=line><span style="color: #000000">    }</span></span></code></pre></div><h3 id=improvements>Improvements<a class="anchor bookmark-target"href=#improvements><i class="bi bi-link-45deg"></i></a></h3><ul><li>All tests with SqlServer are now using Microsoft.Data.SqlClient instead of System.Data.SqlClient.</ul><h2 id=531-2022-11-18><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.1>5.3.1</a> (2022-11-18)<a class="anchor bookmark-target"href=#531-2022-11-18><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.3.0...5.3.1>Full Changelog</a><p>Minor optimizations and improvements.<h2 id=530-2022-10-16><a href=https://github.com/vb-consulting/Norm.net/tree/5.3.0>5.3.0</a> (2022-10-16)<a class="anchor bookmark-target"href=#530-2022-10-16><i class="bi bi-link-45deg"></i></a></h2><p><a href=https://github.com/vb-consulting/Norm.net/compare/5.2.5...5.3.0>Full Changelog</a><h3 id=new-feature---dynamic-mapping-support>New feature - dynamic mapping support<a class="anchor bookmark-target"href=#new-feature---dynamic-mapping-support><i class="bi bi-link-45deg"></i></a></h3><p>For this version <code>5.3.0</code> it is possible to map objects to a dynamic class.<p>Simply, instead of class or record name - use <code>dynamic</code> and the mapper will return a dynamic instance of <code>ExpandoObjects</code> objects:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #569CD6">dynamic</span><span style="color: #E6E6E6">>(</span><span style="color: #CE9178">@"select *</span></span>
<span class=line><span style="color: #CE9178">                from (</span></span>
<span class=line><span style="color: #CE9178">                values </span></span>
<span class=line><span style="color: #CE9178">                    (1, 'foo1', '1977-05-19'::date, true, null),</span></span>
<span class=line><span style="color: #CE9178">                    (2, 'foo2', '1978-05-19'::date, false, 'bar2'),</span></span>
<span class=line><span style="color: #CE9178">                    (3, 'foo3', '1979-05-19'::date, null, 'bar3')</span></span>
<span class=line><span style="color: #CE9178">                ) t(id, foo, day, bool, foo_bar)"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">ToList</span><span style="color: #E6E6E6">();</span></span>
<span class=line></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Count</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">[</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">].</span><span style="color: #9CDCFE">id</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">[</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">].</span><span style="color: #9CDCFE">id</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">[</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">].</span><span style="color: #9CDCFE">id</span><span style="color: #E6E6E6">);</span></span>
<span class=line></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"foo1"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">[</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">].</span><span style="color: #9CDCFE">foo</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"foo2"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">[</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">].</span><span style="color: #9CDCFE">foo</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #9CDCFE">Assert</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equal</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"foo3"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6">[</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">].</span><span style="color: #9CDCFE">foo</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #0000FF">dynamic</span><span style="color: #000000">>(</span><span style="color: #A31515">@"select *</span></span>
<span class=line><span style="color: #A31515">                from (</span></span>
<span class=line><span style="color: #A31515">                values </span></span>
<span class=line><span style="color: #A31515">                    (1, 'foo1', '1977-05-19'::date, true, null),</span></span>
<span class=line><span style="color: #A31515">                    (2, 'foo2', '1978-05-19'::date, false, 'bar2'),</span></span>
<span class=line><span style="color: #A31515">                    (3, 'foo3', '1979-05-19'::date, null, 'bar3')</span></span>
<span class=line><span style="color: #A31515">                ) t(id, foo, day, bool, foo_bar)"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">ToList</span><span style="color: #000000">();</span></span>
<span class=line></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #098658">3</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">.</span><span style="color: #001080">Count</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">[</span><span style="color: #098658">0</span><span style="color: #000000">].</span><span style="color: #001080">id</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">[</span><span style="color: #098658">1</span><span style="color: #000000">].</span><span style="color: #001080">id</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #098658">3</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">[</span><span style="color: #098658">2</span><span style="color: #000000">].</span><span style="color: #001080">id</span><span style="color: #000000">);</span></span>
<span class=line></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #A31515">"foo1"</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">[</span><span style="color: #098658">0</span><span style="color: #000000">].</span><span style="color: #001080">foo</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #A31515">"foo2"</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">[</span><span style="color: #098658">1</span><span style="color: #000000">].</span><span style="color: #001080">foo</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #001080">Assert</span><span style="color: #000000">.</span><span style="color: #795E26">Equal</span><span style="color: #000000">(</span><span style="color: #A31515">"foo3"</span><span style="color: #000000">, </span><span style="color: #001080">result</span><span style="color: #000000">[</span><span style="color: #098658">2</span><span style="color: #000000">].</span><span style="color: #001080">foo</span><span style="color: #000000">);</span></span></code></pre></div><p>Note that <code>ExpandoObjects</code> are a bit slow and you will lose on auto-complete features as well as static typing.<p><code>dynamic</code> can also be mixed with mapping to normal classes, for example:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Class1</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">dynamic</span><span style="color: #E6E6E6">>(</span><span style="color: #CE9178">@"select *</span></span>
<span class=line><span style="color: #CE9178">                from (</span></span>
<span class=line><span style="color: #CE9178">                values </span></span>
<span class=line><span style="color: #CE9178">                    (1, 'foo1', '1977-05-19'::date, true, null),</span></span>
<span class=line><span style="color: #CE9178">                    (2, 'foo2', '1978-05-19'::date, false, 'bar2'),</span></span>
<span class=line><span style="color: #CE9178">                    (3, 'foo3', '1979-05-19'::date, null, 'bar3')</span></span>
<span class=line><span style="color: #CE9178">                ) t(id, foo, day, bool, foo_bar)"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">ToList</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Class1</span><span style="color: #000000">, </span><span style="color: #0000FF">dynamic</span><span style="color: #000000">>(</span><span style="color: #A31515">@"select *</span></span>
<span class=line><span style="color: #A31515">                from (</span></span>
<span class=line><span style="color: #A31515">                values </span></span>
<span class=line><span style="color: #A31515">                    (1, 'foo1', '1977-05-19'::date, true, null),</span></span>
<span class=line><span style="color: #A31515">                    (2, 'foo2', '1978-05-19'::date, false, 'bar2'),</span></span>
<span class=line><span style="color: #A31515">                    (3, 'foo3', '1979-05-19'::date, null, 'bar3')</span></span>
<span class=line><span style="color: #A31515">                ) t(id, foo, day, bool, foo_bar)"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">ToList</span><span style="color: #000000">();</span></span></code></pre></div><p>In this example, whatever is not mapped to <code>Class1</code> will be mapped to a dynamic type.<p>See examples in <a href=https://github.com/vb-consulting/Norm.net/blob/5.3.0/Tests/PostgreSqlUnitTests/DynamicMapUnitTests.cs>this unit tests</a>.<h3 id=fix---duplicate-field-names-in-multi-mapping>Fix - duplicate field names in multi mapping<a class="anchor bookmark-target"href=#fix---duplicate-field-names-in-multi-mapping><i class="bi bi-link-45deg"></i></a></h3><p>Some queries can return duplicate field names.<p>For example, if we have these multiple mappings:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Shop</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">IList</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Account</span><span style="color: #E6E6E6">> </span><span style="color: #9CDCFE">Accounts</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span>
<span class=line></span>
<span class=line><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Account</span></span>
<span class=line><span style="color: #E6E6E6">{</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Address</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Country</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">ShopId</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Shop</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Shop</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class=line><span style="color: #E6E6E6">}</span></span>
<span class=line></span>
<span class=line><span style="color: #6A9955">//...</span></span>
<span class=line><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Shop</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">Account</span><span style="color: #E6E6E6">>(</span><span style="color: #CE9178">@"</span></span>
<span class=line><span style="color: #CE9178">        select s.*, a.*</span></span>
<span class=line><span style="color: #CE9178">        from shop s </span></span>
<span class=line><span style="color: #CE9178">        inner join account a on s.id = a.shop_id"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #6A9955">//...</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Shop</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Id</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">IList</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Account</span><span style="color: #000000">> </span><span style="color: #001080">Accounts</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">}</span></span>
<span class=line></span>
<span class=line><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Account</span></span>
<span class=line><span style="color: #000000">{</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Id</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Address</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Country</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">ShopId</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">Shop</span><span style="color: #000000"> </span><span style="color: #001080">Shop</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class=line><span style="color: #000000">}</span></span>
<span class=line></span>
<span class=line><span style="color: #008000">//...</span></span>
<span class=line><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Shop</span><span style="color: #000000">, </span><span style="color: #267F99">Account</span><span style="color: #000000">>(</span><span style="color: #A31515">@"</span></span>
<span class=line><span style="color: #A31515">        select s.*, a.*</span></span>
<span class=line><span style="color: #A31515">        from shop s </span></span>
<span class=line><span style="color: #A31515">        inner join account a on s.id = a.shop_id"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #008000">//...</span></span></code></pre></div><p>This query returns duplicate names (<code>id</code> and <code>name</code>):<table class="table table-hover table-sm table-responsive-sm"><thead><tr><th><strong>id</strong><th><strong>name</strong><th><strong>id</strong><th><strong>name</strong><th>address<th>country<th>shop_id<tbody class=table-group-divider><tr><td>1<td>shop1<td>3<td>account3<td>addr3<td>country3<td>1<tr><td>1<td>shop1<td>2<td>account2<td>addr2<td>country2<td>1<tr><td>1<td>shop1<td>1<td>account1<td>addr1<td>country1<td>1<tr><td>2<td>shop2<td>5<td>account5<td>addr5<td>country5<td>2<tr><td>2<td>shop2<td>4<td>account4<td>addr4<td>country4<td>2</table><p>In previous versions, duplicate names were not handled correctly. In this example, only <code>Id</code> and <code>Name</code> from <code>Shop</code> class would be mapped correctly and the <code>Id</code> and <code>Name</code> from <code>Account</code> class would be skipped because the mapper would incorrectly conclude that those fields were already mapped.<p>In this version, this is fixed and classes <code>Shop</code> and <code>Account</code> are mapped correctly.<p>This makes it easier to build nested object maps with the <code>Linq</code> expressions for example:<div class="code csharp"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">shops</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Read</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Shop</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">Account</span><span style="color: #E6E6E6">>(</span><span style="color: #CE9178">@"</span></span>
<span class=line><span style="color: #CE9178">    select s.*, a.*</span></span>
<span class=line><span style="color: #CE9178">    from shop s </span></span>
<span class=line><span style="color: #CE9178">    inner join account a on s.id = a.shop_id"</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">GroupBy</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">item</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">item</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Item1</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">Select</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">group</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">    {</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">shop</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">group</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">First</span><span style="color: #E6E6E6">().</span><span style="color: #9CDCFE">Item1</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">shop</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Accounts</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">group</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Select</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">item</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class=line><span style="color: #E6E6E6">        {</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">account</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">item</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Item2</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #9CDCFE">account</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Shop</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">shop</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">account</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">        }).</span><span style="color: #DCDCAA">ToList</span><span style="color: #E6E6E6">();</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">shop</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    })</span></span>
<span class=line><span style="color: #E6E6E6">    .</span><span style="color: #DCDCAA">ToList</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">shops</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">Read</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Shop</span><span style="color: #000000">, </span><span style="color: #267F99">Account</span><span style="color: #000000">>(</span><span style="color: #A31515">@"</span></span>
<span class=line><span style="color: #A31515">    select s.*, a.*</span></span>
<span class=line><span style="color: #A31515">    from shop s </span></span>
<span class=line><span style="color: #A31515">    inner join account a on s.id = a.shop_id"</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">GroupBy</span><span style="color: #000000">(</span><span style="color: #001080">item</span><span style="color: #000000"> => </span><span style="color: #001080">item</span><span style="color: #000000">.</span><span style="color: #001080">Item1</span><span style="color: #000000">.</span><span style="color: #001080">Id</span><span style="color: #000000">)</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">Select</span><span style="color: #000000">(</span><span style="color: #001080">group</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">    {</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">shop</span><span style="color: #000000"> = </span><span style="color: #001080">group</span><span style="color: #000000">.</span><span style="color: #795E26">First</span><span style="color: #000000">().</span><span style="color: #001080">Item1</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #001080">shop</span><span style="color: #000000">.</span><span style="color: #001080">Accounts</span><span style="color: #000000"> = </span><span style="color: #001080">group</span><span style="color: #000000">.</span><span style="color: #795E26">Select</span><span style="color: #000000">(</span><span style="color: #001080">item</span><span style="color: #000000"> =></span></span>
<span class=line><span style="color: #000000">        {</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">account</span><span style="color: #000000"> = </span><span style="color: #001080">item</span><span style="color: #000000">.</span><span style="color: #001080">Item2</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #001080">account</span><span style="color: #000000">.</span><span style="color: #001080">Shop</span><span style="color: #000000"> = </span><span style="color: #001080">shop</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">account</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">        }).</span><span style="color: #795E26">ToList</span><span style="color: #000000">();</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">shop</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    })</span></span>
<span class=line><span style="color: #000000">    .</span><span style="color: #795E26">ToList</span><span style="color: #000000">();</span></span></code></pre></div><p>This will build a nested object tree where each shop contains a list of accounts and that every account has a reference to a shop instance, and so on.<p>See the example in <a href=https://github.com/vb-consulting/Norm.net/blob/5.3.0/Tests/PostgreSqlUnitTests/NestedObjectMapUnitTests.cs>this unit tests</a>.<h3 id=new-benchmarks>New benchmarks<a class="anchor bookmark-target"href=#new-benchmarks><i class="bi bi-link-45deg"></i></a></h3><p>Since the mapper code was changed, there are also new benchmarks for this version: <a href=https://github.com/vb-consulting/Norm.net/blob/5.3.0/PERFOMANCE-TESTS.md>PERFOMANCE-TESTS</a></div></div><div class="rightside svelte-2kl70j"><div class=svelte-2kl70j><ul class="navbar-nav sidenav svelte-2kl70j"><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>on this page</span><hr class=svelte-2kl70j><li class="nav-item toc1 right svelte-2kl70j bookmark-nav"data-id=changelog title=Changelog><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#changelog>Changelog</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=540-2023-11-27 title="5.4.0 (2023-11-27)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#540-2023-11-27>5.4.0 (2023-11-27)</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-feature-getrecordsaffected-method title="New feature: GetRecordsAffected method"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-feature-getrecordsaffected-method>New feature: GetRecordsAffected method</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-feature-norm-extension-method title="New feature: Norm extension method"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-feature-norm-extension-method>New feature: Norm extension method</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=breaking-changes title="Breaking changes:"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#breaking-changes>Breaking changes:</a><li class="nav-item toc2 mt-2 right svelte-2kl70j bookmark-nav"data-id=539-2023-10-07 title="5.3.9 (2023-10-07)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#539-2023-10-07>5.3.9 (2023-10-07)</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=538-2023-09-07 title="5.3.8 (2023-09-07)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#538-2023-09-07>5.3.8 (2023-09-07)</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=537-2023-07-17 title="5.3.7 (2023-07-17)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#537-2023-07-17>5.3.7 (2023-07-17)</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-feature-nameparsercallback-option title="New feature NameParserCallback option"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-feature-nameparsercallback-option>New feature NameParserCallback option</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=more-internal-optimizations title="More internal optimizations"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#more-internal-optimizations>More internal optimizations</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=changed-access-modifiers-for-internal-mappers title="Changed access modifiers for internal mappers"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#changed-access-modifiers-for-internal-mappers>Changed access modifiers for internal mappers</a><li class="nav-item toc2 mt-2 right svelte-2kl70j bookmark-nav"data-id=536-2023-07-02 title="5.3.6 (2023-07-02)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#536-2023-07-02>5.3.6 (2023-07-02)</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=global-handler-for-reader-callback title="Global handler for reader callback"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#global-handler-for-reader-callback>Global handler for reader callback</a><li class="nav-item toc2 mt-2 right svelte-2kl70j bookmark-nav"data-id=535-2023-07-01 title="5.3.5 (2023-07-01)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#535-2023-07-01>5.3.5 (2023-07-01)</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=534-2023-05-26 title="5.3.4 (2023-05-26)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#534-2023-05-26>5.3.4 (2023-05-26)</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-option---keeporiginalnames title="New option - KeepOriginalNames"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-option---keeporiginalnames>New option - KeepOriginalNames</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-optimization-and-new-performance-tests title="New optimization and new performance tests"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-optimization-and-new-performance-tests>New optimization and new performance tests</a><li class="nav-item toc2 mt-2 right svelte-2kl70j bookmark-nav"data-id=533-2023-05-16 title="5.3.3 (2023-05-16)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#533-2023-05-16>5.3.3 (2023-05-16)</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=fix---nullableinstances-option-turned-on-but-have-non-nullable-properties title="Fix - NullableInstances option turned on but have non-nullable properties"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#fix---nullableinstances-option-turned-on-but-have-non-nullable-properties>Fix - NullableInstances option turned on but have non-nullable properties</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-feature---normnullexception title="New feature - NormNullException"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-feature---normnullexception>New feature - NormNullException</a><li class="nav-item toc2 mt-2 right svelte-2kl70j bookmark-nav"data-id=532-2023-05-03 title="5.3.2 (2023-05-03)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#532-2023-05-03>5.3.2 (2023-05-03)</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-feature---nullableinstances title="New Feature - NullableInstances"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-feature---nullableinstances>New Feature - NullableInstances</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=improvements title=Improvements><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#improvements>Improvements</a><li class="nav-item toc2 mt-2 right svelte-2kl70j bookmark-nav"data-id=531-2022-11-18 title="5.3.1 (2022-11-18)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#531-2022-11-18>5.3.1 (2022-11-18)</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=530-2022-10-16 title="5.3.0 (2022-10-16)"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#530-2022-10-16>5.3.0 (2022-10-16)</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-feature---dynamic-mapping-support title="New feature - dynamic mapping support"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-feature---dynamic-mapping-support>New feature - dynamic mapping support</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=fix---duplicate-field-names-in-multi-mapping title="Fix - duplicate field names in multi mapping"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#fix---duplicate-field-names-in-multi-mapping>Fix - duplicate field names in multi mapping</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=new-benchmarks title="New benchmarks"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#new-benchmarks>New benchmarks</a></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],s=document.querySelectorAll("div.code");function k(e,t){for(var n=2;n<arguments.length;n++)e.classList.remove(arguments[n]);e.classList.add(t)}var t=document.getElementsByTagName("html")[0],a=i.querySelector("#theme-btn"),o="theme";function n(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<s.length;n++){var i=s[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",s=0;s<n.classList.length;s++)if(n.classList[s].startsWith("bi-")){i=n.classList[s];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}function e(e){r(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function l(e){r(e,function(e,t){var n=localStorage.getItem(o);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(o)?"light":"dark";localStorage.setItem(o,e),n(t.dataset.bsTheme=e)}),n(localStorage.getItem(o)),a.children[0].classList.remove("hidden");for(var c=0;c<s.length;c++)s[c].getElementsByClassName("copy-code")[0].addEventListener("click",e),s[c].getElementsByClassName("photo-code")[0].addEventListener("click",l);for(var d,E=function(){var a,s,o;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.children[1].children[0].querySelectorAll("[id]"),s=void 0,this.initNavs=function(e){o=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,s=0;s<o.length;s++)if(o[s].dataset.id==n){i=o[s];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(r(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),l()},f.children[1].addEventListener("scroll",l),this;function r(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function l(){if(o&&o.length){for(var e=0;e<o.length;e++)o[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=r(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),s&&clearTimeout(s),void(s=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),s=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),s&&clearTimeout(s),s=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),s=void 0},250))}}}(),h=function(){var r,l=i.querySelector("#nav-btn"),c=480,d="200px",h="0.25fr",v=730,m=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],e="sidebar-pinned",b=null==localStorage.getItem(e)||"true"==localStorage.getItem(e),p=!1,y=!1;function t(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?p?"100%":"0":b?""+d:"0",i=`grid-template-columns: ${n} 1fr`,s=t&&p?"width: 100%":"0"!=n?"":"display: none",a=t&&p?"display: none":"",o=t?p?"sidebar-show":"sidebar-hide":b?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(h&&v&&m&&(n&&e<m||!n&&e<v?y||(u.innerHTML=r+g.innerHTML,E.initNavs(u),y=!0):y&&(u.innerHTML=r,E.initNavs(g),y=!1)),!h||t||y?(i+=";",f.children[2].style.display="none"):(i+=` ${h};`,f.children[2].style.display="")),k(l,!t&&b||t&&p?"rotate":"rotate-back","rotate","rotate-back"),b?l.classList.add("text-shadow"):l.classList.remove("text-shadow"),f.style=L?i:"display: grid;",L&&k(L,o,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=s),w.style=a}function n(){window.outerWidth<c?p=!p:b=!b,localStorage.setItem(e,b.toString()),t(),b?l.classList.add("text-shadow"):l.classList.remove("text-shadow")}return h&&v&&m&&g&&(r=u.innerHTML,E.initNavs(g)),l.addEventListener("click",n),(window.onresize=t)(),this.closeSidebar=function(){window.outerWidth<c&&p&&n()},this}(),v=document.getElementsByClassName("auto-close"),m=0;m<v.length;m++)v[m].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(d=document.getElementById(location.hash.replace("#","")))&&d.scrollIntoView()}();</script><script src=/bootstrap.bundle.min.js></script><script>!function(){for(var t=document.querySelectorAll('[data-bs-toggle="tooltip"]'),e=0;e<t.length;e++)new bootstrap.Tooltip(t[e]);var o=document.getElementsByClassName("accordion-item");if(o.length)for(e=0;e<o.length;e++){var l=o[e];l.querySelectorAll("[href='"+document.location.pathname+"']").length&&l.firstChild.click()}}();</script><script src=/html2canvas.min.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script async data-id=101435862 src=//static.getclicky.com/js></script>