<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NpgsqlRest - Automatic REST API for PostgreSQL Database as .NET8 Middleware</title><meta name="description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><meta name="keywords" content="api, api-rest, restful-api, http, postgres, dotnet, net8, c#, aot, database, rest, server, postgresql, npgsqlrest, pgsql, pg, automatic"><link href="https://vb-consulting.github.io//npgsqlrest/changelog/" rel="canonical"><link rel="stylesheet" href="/_elderjs/assets/svelte-b36cd0a0.css" media="all"><style></style><link href="/style.css?1706982034098" rel="stylesheet"><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script></head><body class="d-flex flex-column h-100"><header id="header"><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-13wa5zp"><div class="container-fluid flex-nowrap svelte-13wa5zp"><div class="d-flex svelte-13wa5zp"><button id="nav-btn" type="button" class="d-flex btn btn-sm logo animate-rotate svelte-13wa5zp"><i class="material-icons-outlined">menu</i></button> <a class="nav-link my-auto ms-2 fw-semibold home svelte-13wa5zp" href="/"><i class="bi-chevron-double-left"></i> VB Home</a></div><div class="d-flex right svelte-13wa5zp"><a class="nav-link my-auto me-2 svelte-13wa5zp" href="https://github.com/vb-consulting/npgsqlrest/"><i class="bi-github"></i></a> <a class="github-button svelte-13wa5zp" href="https://github.com/vb-consulting/npgsqlrest/" data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;" data-icon="octicon-star" data-show-count="true" aria-label="Star vb-consulting/npgsqlrest/ on GitHub"></a><div class="vr text-white my-auto svelte-13wa5zp"></div><button id="theme-btn" type="button" aria-pressed="true" aria-label="theme" class="svelte-13wa5zp"><span class="check hidden svelte-13wa5zp"><span class="icon svelte-13wa5zp"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-13wa5zp"><path fill="currentColor" d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-13wa5zp"><g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M0 0h24v24H0z"></path><path fill="currentColor" d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class="svelte-9zwk14"><div class="sidebar sidebar-hide svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav accordion svelte-9zwk14"><li class="accordion-item svelte-9zwk14" title="VB-Consulting"><button class="accordion-header accordion-button collapsed svelte-9zwk14 text-uppercase" href="/" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-vb-consulting" aria-expanded="false" aria-controls="accordion-vb-consulting">VB-Consulting</button><div id="accordion-vb-consulting" class="accordion-collapse collapse"><div class="accordion-body svelte-9zwk14"><ul class="navbar-nav"><li class="nav-item svelte-9zwk14" data-id="" title="Home"><a class="nav-link svelte-9zwk14 text-uppercase" href="/">Home</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="Norm.Net"><a class="nav-link svelte-9zwk14 text-uppercase" href="/norm.net/">Norm.Net</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="RazorSvelte"><a class="nav-link svelte-9zwk14 text-uppercase" href="/razorsvelte/">RazorSvelte</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PgRoutiner"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pgroutiner/">PgRoutiner</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="XUnit.Npgsql"><a class="nav-link svelte-9zwk14 text-uppercase" href="/xunit.npgsql/">XUnit.Npgsql</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PostrgeSQL Schema Tools"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pg_schema_tools/">PostrgeSQL Schema Tools</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">blogs</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="<span class='btn-link'>ALL BLOGS</span>"><a class="nav-link btn btn-sm w-fit px-3 mx-auto svelte-9zwk14 lr-arrow text-uppercase" href="/blogs/"><i class="bi bi-arrow-right-circle svelte-9zwk14"></i> <span class="btn-link">ALL BLOGS</span></a></li><li class="nav-item svelte-9zwk14" data-id="" title="NpgsqlRest NuGet Library"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest NuGet Library</a></li><li class="nav-item svelte-9zwk14" data-id="" title="What is Micro ORM?"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/micro-orm/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>What is Micro ORM?</a></li><li class="nav-item svelte-9zwk14" data-id="" title="What have the STORED PROCEDURES ever done for us?"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/what-have-stored-procedures-ever-done/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>What have the STORED PROCEDURES ever done for us?</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Which Way .NET Developer?"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/where-to/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Which Way .NET Developer?</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Custom Temporal Tables in PostgreSQL"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-temporal-tables/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Custom Temporal Tables in PostgreSQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Haters Build Software"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/haters-build-software/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Haters Build Software</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Recursion with PostgreSQL Part 1 - A Different Type of Recursion"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part1-different-type-of-recursion/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 1 - A Different Type of Recursion</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Recursion with PostgreSQL Part 2 - Performances"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part2-performances/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 2 - Performances</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Recursion with PostgreSQL Part 3 - Cycle Detection"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part3-cycle-detection/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 3 - Cycle Detection</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Recursion with PostgreSQL Part 4 - Finding the Right Path"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part4-right-path/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 4 - Finding the Right Path</a></li></ul></div></div></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">NpgsqlRest</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/">NpgsqlRest</a></li><li class="nav-item toc2 svelte-9zwk14 active" data-id="" title="changelog"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/changelog/">changelog</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="blog post"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-file-earmark-text svelte-9zwk14"></i>blog post</a></li></ul></div></div><div class="content svelte-9zwk14"><div class="container-sm main-content gh-content"><h1 id="changelog">Changelog<a class="anchor bookmark-target" href="#changelog"><i class="bi bi-link-45deg"></i></a></h1><a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/changelog.md" class="github-edit"><i class="bi bi-github"></i>Edit this page on GitHub</a><h2 id="version-162-2024-02-03">Version <a href="https://github.com/vb-consulting/NpgsqlRest/tree/1.6.2">1.6.2</a> (2024-02-03)<a class="anchor bookmark-target" href="#version-162-2024-02-03"><i class="bi bi-link-45deg"></i></a></h2><p><a href="https://github.com/vb-consulting/NpgsqlRest/compare/1.6.1...1.6.2">Full Changelog</a></p><ul><li>Fixed and tested full support for PostgreSQL stored procedures (as opposed to user-defined functions which are used primarily).</li></ul><hr><h2 id="version-161-2024-02-02">Version <a href="https://github.com/vb-consulting/NpgsqlRest/tree/1.6.1">1.6.1</a> (2024-02-02)<a class="anchor bookmark-target" href="#version-161-2024-02-02"><i class="bi bi-link-45deg"></i></a></h2><p><a href="https://github.com/vb-consulting/NpgsqlRest/compare/1.6.0...1.6.1">Full Changelog</a></p><h3 id="1-smaller-options-tweaks">1) Smaller Options Tweaks<a class="anchor bookmark-target" href="#1-smaller-options-tweaks"><i class="bi bi-link-45deg"></i></a></h3><p>The following options will be ignored under these conditions:</p><ul><li><code>SchemaSimilarTo</code>: ignore if the string is empty.</li><li><code>SchemaNotSimilarTo</code>: ignore if the string is empty.</li><li><code>IncludeSchemas</code>: ignore if the array is empty.</li><li><code>ExcludeSchemas</code>: ignore if the array is empty.</li><li><code>NameSimilarTo</code>: ignore if the string is empty.</li><li><code>NameNotSimilarTo</code>: ignore if the string is empty.</li><li><code>IncludeNames</code>: ignore if the array is empty.</li><li><code>ExcludeNames</code>: ignore if the array is empty.</li></ul><p>Previously, they were ignored only when they were NULL.</p><h3 id="2-logging-improvements">2) Logging Improvements<a class="anchor bookmark-target" href="#2-logging-improvements"><i class="bi bi-link-45deg"></i></a></h3><p>NpgsqlRest default logger is now created at the build stage by the default application logger factory. That means when the default ASP.NET application is configured then:</p><p>a) The Logger name is now by default the same as the default namespace of the library which is <code>NpgsqlRest</code>.</p><p>Previously, the default application logger was used and the default name was equal to your application default logger which made it harder to distinguish and configure.</p><p>It's possible to set a custom logger name with the new configuration option: <code>LoggerName</code>. The <code>LoggerName</code> when set to null (default) will use the default logger name which is <code>NpgsqlRest</code> (the default namespace).</p><p>b) Since the logger is created with a different name, now it's possible to apply configuration from the configuration file, such as <code>appsettings.json</code> file:</p><div class="code json"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #CE9178">"Logging"</span><span style="color: #E6E6E6">: {</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">"LogLevel"</span><span style="color: #E6E6E6">: {</span></span>
<span class="line"><span style="color: #E6E6E6">      </span><span style="color: #9CDCFE">"Default"</span><span style="color: #E6E6E6">: </span><span style="color: #CE9178">"Information"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">      </span><span style="color: #9CDCFE">"Microsoft.AspNetCore"</span><span style="color: #E6E6E6">: </span><span style="color: #CE9178">"Warning"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">      </span><span style="color: #9CDCFE">"NpgsqlRest"</span><span style="color: #E6E6E6">: </span><span style="color: #CE9178">"Warning"</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">  }</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #A31515">"Logging"</span><span style="color: #000000">: {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0451A5">"LogLevel"</span><span style="color: #000000">: {</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5">"Default"</span><span style="color: #000000">: </span><span style="color: #A31515">"Information"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5">"Microsoft.AspNetCore"</span><span style="color: #000000">: </span><span style="color: #A31515">"Warning"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #0451A5">"NpgsqlRest"</span><span style="color: #000000">: </span><span style="color: #A31515">"Warning"</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">  }</span></span></code></pre></div><p>This example configures the <code>NpgsqlRest</code> logger to the warning level only.</p><h3 id="3-logcommands-includes-request-info">3) LogCommands Includes Request Info<a class="anchor bookmark-target" href="#3-logcommands-includes-request-info"><i class="bi bi-link-45deg"></i></a></h3><p>When logging commands (<code>LogCommands</code> option set to true), request info (method and the URL) will be included in log output:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #E6E6E6">      -- POST http://localhost:5000/api/perf-test</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $1 integer = 1</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $2 text = 'XYZ'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $3 integer = 3</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $4 timestamp without time zone = '2024-04-04T03:03:03'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $5 boolean = false</span></span>
<span class="line"><span style="color: #E6E6E6">      select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from public.perf_test($1, $2, $3, $4, $5)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #E6E6E6">      -- GET http://localhost:5000/api/get-csv-data</span></span>
<span class="line"><span style="color: #E6E6E6">      select id, name, date, status from public.get_csv_data()</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #000000">      -- POST http://localhost:5000/api/perf-test</span></span>
<span class="line"><span style="color: #000000">      -- $1 integer = 1</span></span>
<span class="line"><span style="color: #000000">      -- $2 text = 'XYZ'</span></span>
<span class="line"><span style="color: #000000">      -- $3 integer = 3</span></span>
<span class="line"><span style="color: #000000">      -- $4 timestamp without time zone = '2024-04-04T03:03:03'</span></span>
<span class="line"><span style="color: #000000">      -- $5 boolean = false</span></span>
<span class="line"><span style="color: #000000">      select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from public.perf_test($1, $2, $3, $4, $5)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #000000">      -- GET http://localhost:5000/api/get-csv-data</span></span>
<span class="line"><span style="color: #000000">      select id, name, date, status from public.get_csv_data()</span></span></code></pre></div><h3 id="3-fix-using-identifiers">3) Fix Using Identifiers<a class="anchor bookmark-target" href="#3-fix-using-identifiers"><i class="bi bi-link-45deg"></i></a></h3><p>PostgreSQL allows language identifiers to be used as names with double quotes. For example, a function that uses <code>select</code>, <code>group</code>, <code>order</code>, <code>from</code>, <code>join</code> as names:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> "</span><span style="color: #DCDCAA">select</span><span style="color: #E6E6E6">"(</span><span style="color: #CE9178">"group"</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"order"</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"from"</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"join"</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> query </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> t.</span><span style="color: #D4D4D4">*</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">values</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">        (</span><span style="color: #CE9178">"group"</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"order"</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    ) t;</span></span>
<span class="line"><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> "</span><span style="color: #795E26">select</span><span style="color: #000000">"(</span><span style="color: #A31515">"group"</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000">, </span><span style="color: #A31515">"order"</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">"from"</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">"join"</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">return</span><span style="color: #000000"> query </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> t.*</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">values</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">        (</span><span style="color: #A31515">"group"</span><span style="color: #000000">, </span><span style="color: #A31515">"order"</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    ) t;</span></span>
<span class="line"><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p>This type of function would cause errors in previous versions. This is now fixed and it works normally.</p><h3 id="4-other-changes">4) Other Changes<a class="anchor bookmark-target" href="#4-other-changes"><i class="bi bi-link-45deg"></i></a></h3><ul><li><code>DefaultUrlBuilder</code> and <code>DefaultNameConverter</code> static classes made public.</li><li>Removed a need for suppression of AOT warning in an HTTP file handler module when getting the host from the configuration.</li></ul><hr><h2 id="version-160-2024-28-01">Version <a href="https://github.com/vb-consulting/NpgsqlRest/tree/1.6.0">1.6.0</a> (2024-28-01)<a class="anchor bookmark-target" href="#version-160-2024-28-01"><i class="bi bi-link-45deg"></i></a></h2><p><a href="https://github.com/vb-consulting/NpgsqlRest/compare/1.5.1...1.6.0">Full Changelog</a></p><h3 id="1-http-file-improvements">1) HTTP File Improvements<a class="anchor bookmark-target" href="#1-http-file-improvements"><i class="bi bi-link-45deg"></i></a></h3><ul><li>HTTP file generation will now consider if the endpoint has configured a <code>BodyParameterName</code> - the name of the parameter that is configured to be sent by the request body.</li></ul><p>For example, if the function <code>body_param</code> has two parameters (<code>_i</code> and <code>_p</code>), and <code>_p</code> is configured to be sent by the request body, the HTTP file builder will create this callable example:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">POST {{!host!}}/api/body-param?i=1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">XYZ</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">POST {{!host!}}/api/body-param?i=1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">XYZ</span></span></code></pre></div><p>Note, that parameter <code>_p</code> is set to request body as <code>XYZ</code>.</p><ul><li>HTTP file endpoints with comment header will now optionally include a routine database comment. In the example above comment header is:</li></ul><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">HTTP</span></span>
<span class="line"><span style="color: #E6E6E6">body-param-name _p</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">HTTP</span></span>
<span class="line"><span style="color: #000000">body-param-name _p</span></span></code></pre></div><p>And resulting HTTP file generated callable endpoint with comment will now look like this:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">// function public.body_param(</span></span>
<span class="line"><span style="color: #E6E6E6">//     _i integer,</span></span>
<span class="line"><span style="color: #E6E6E6">//     _p text</span></span>
<span class="line"><span style="color: #E6E6E6">// )</span></span>
<span class="line"><span style="color: #E6E6E6">// returns text</span></span>
<span class="line"><span style="color: #E6E6E6">//</span></span>
<span class="line"><span style="color: #E6E6E6">// comment on function public.body_param is '</span></span>
<span class="line"><span style="color: #E6E6E6">// HTTP</span></span>
<span class="line"><span style="color: #E6E6E6">// body-param-name _p';</span></span>
<span class="line"><span style="color: #E6E6E6">POST {{!host!}}/api/body-param?i=1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">XYZ</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">// function public.body_param(</span></span>
<span class="line"><span style="color: #000000">//     _i integer,</span></span>
<span class="line"><span style="color: #000000">//     _p text</span></span>
<span class="line"><span style="color: #000000">// )</span></span>
<span class="line"><span style="color: #000000">// returns text</span></span>
<span class="line"><span style="color: #000000">//</span></span>
<span class="line"><span style="color: #000000">// comment on function public.body_param is '</span></span>
<span class="line"><span style="color: #000000">// HTTP</span></span>
<span class="line"><span style="color: #000000">// body-param-name _p';</span></span>
<span class="line"><span style="color: #000000">POST {{!host!}}/api/body-param?i=1</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">XYZ</span></span></code></pre></div><p>This also applies to the full header comments.</p><p>This feature can be changed with <code>CommentHeaderIncludeComments</code> boolean option, in the <code>HttpFileOptions</code> options (default is true). Example:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">HttpFileOptions</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">() </span></span>
<span class="line"><span style="color: #E6E6E6">    { </span></span>
<span class="line"><span style="color: #6A9955">        // turn off http file comments in header</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">CommentHeaderIncludeComments</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">false</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">HttpFileOptions</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000">() </span></span>
<span class="line"><span style="color: #000000">    { </span></span>
<span class="line"><span style="color: #008000">        // turn off http file comments in header</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">CommentHeaderIncludeComments</span><span style="color: #000000"> = </span><span style="color: #0000FF">false</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><h3 id="2-comment-annotation-breaking-change">2) Comment Annotation Breaking Change<a class="anchor bookmark-target" href="#2-comment-annotation-breaking-change"><i class="bi bi-link-45deg"></i></a></h3><p>Comment annotations that are not <code>HTTP</code> (for example authorize, etc) don't require <code>HTTP</code> line above.</p><p>For example, before:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">comment on function comment_authorize() is </span><span style="color: #CE9178">'</span></span>
<span class="line"><span style="color: #CE9178">HTTP</span></span>
<span class="line"><span style="color: #CE9178">Authorize'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">comment on function comment_authorize() is </span><span style="color: #A31515">'</span></span>
<span class="line"><span style="color: #A31515">HTTP</span></span>
<span class="line"><span style="color: #A31515">Authorize'</span><span style="color: #000000">;</span></span></code></pre></div><p>And now it is enough to do:</p><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">comment on function comment_authorize() is </span><span style="color: #CE9178">'Authorize'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">comment on function comment_authorize() is </span><span style="color: #A31515">'Authorize'</span><span style="color: #000000">;</span></span></code></pre></div></div><p>Reason: it was really stupid, this is much better.</p><h3 id="3-logging-commands">3) Logging Commands<a class="anchor bookmark-target" href="#3-logging-commands"><i class="bi bi-link-45deg"></i></a></h3><p>There is a new option named <code>LogCommands</code> that, (well, obviously duh), enables logging command text before the execution, together with parameter values. The default is false (since it has a slight performance impact).</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">LogCommands</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">LogCommands</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><p>Examples:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">// function public.case_get_default_params(</span></span>
<span class="line"><span style="color: #E6E6E6">//     _p1 integer,</span></span>
<span class="line"><span style="color: #E6E6E6">//     _p2 integer DEFAULT 2,</span></span>
<span class="line"><span style="color: #E6E6E6">//     _p3 integer DEFAULT 3,</span></span>
<span class="line"><span style="color: #E6E6E6">//     _p4 integer DEFAULT 4</span></span>
<span class="line"><span style="color: #E6E6E6">// )</span></span>
<span class="line"><span style="color: #E6E6E6">// returns json</span></span>
<span class="line"><span style="color: #E6E6E6">GET {{!host!}}/api/case-get-default-params?p1=1&p2=2&p3=3&p4=4</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">// function public.case_get_default_params(</span></span>
<span class="line"><span style="color: #000000">//     _p1 integer,</span></span>
<span class="line"><span style="color: #000000">//     _p2 integer DEFAULT 2,</span></span>
<span class="line"><span style="color: #000000">//     _p3 integer DEFAULT 3,</span></span>
<span class="line"><span style="color: #000000">//     _p4 integer DEFAULT 4</span></span>
<span class="line"><span style="color: #000000">// )</span></span>
<span class="line"><span style="color: #000000">// returns json</span></span>
<span class="line"><span style="color: #000000">GET {{!host!}}/api/case-get-default-params?p1=1&p2=2&p3=3&p4=4</span></span></code></pre></div><p>Execution produces the following log:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">info: NpgsqlRestTestWebApi[0]</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $1 integer = 1</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $2 integer = 2</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $3 integer = 3</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $4 integer = 4</span></span>
<span class="line"><span style="color: #E6E6E6">      select public.case_get_default_params($1, $2, $3, $4)</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">info: NpgsqlRestTestWebApi[0]</span></span>
<span class="line"><span style="color: #000000">      -- $1 integer = 1</span></span>
<span class="line"><span style="color: #000000">      -- $2 integer = 2</span></span>
<span class="line"><span style="color: #000000">      -- $3 integer = 3</span></span>
<span class="line"><span style="color: #000000">      -- $4 integer = 4</span></span>
<span class="line"><span style="color: #000000">      select public.case_get_default_params($1, $2, $3, $4)</span></span></code></pre></div><p>And of course, complicated and complex types are also supported:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">info: NpgsqlRestTestWebApi[0]</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $1 smallint = 1</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $2 integer = 2</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $3 bigint = 3</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $4 numeric = 4</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $5 text = 'XYZ'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $6 character varying = 'IJK'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $7 character = 'ABC'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $8 json = '{}'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $9 jsonb = '{}'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $10 smallint[] = {10,11,12}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $11 integer[] = {11,12,13}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $12 bigint[] = {12,13,14}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $13 numeric[] = {13,14,15}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $14 text[] = {'XYZ','IJK','ABC'}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $15 character varying[] = {'IJK','ABC','XYZ'}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $16 character[] = {'ABC','XYZ','IJK'}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $17 json[] = {'{}','{}','{}'}</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $18 jsonb[] = {'{}','{}','{}'}</span></span>
<span class="line"><span style="color: #E6E6E6">      select public.case_get_multi_params1($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18)</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">info: NpgsqlRestTestWebApi[0]</span></span>
<span class="line"><span style="color: #000000">      -- $1 smallint = 1</span></span>
<span class="line"><span style="color: #000000">      -- $2 integer = 2</span></span>
<span class="line"><span style="color: #000000">      -- $3 bigint = 3</span></span>
<span class="line"><span style="color: #000000">      -- $4 numeric = 4</span></span>
<span class="line"><span style="color: #000000">      -- $5 text = 'XYZ'</span></span>
<span class="line"><span style="color: #000000">      -- $6 character varying = 'IJK'</span></span>
<span class="line"><span style="color: #000000">      -- $7 character = 'ABC'</span></span>
<span class="line"><span style="color: #000000">      -- $8 json = '{}'</span></span>
<span class="line"><span style="color: #000000">      -- $9 jsonb = '{}'</span></span>
<span class="line"><span style="color: #000000">      -- $10 smallint[] = {10,11,12}</span></span>
<span class="line"><span style="color: #000000">      -- $11 integer[] = {11,12,13}</span></span>
<span class="line"><span style="color: #000000">      -- $12 bigint[] = {12,13,14}</span></span>
<span class="line"><span style="color: #000000">      -- $13 numeric[] = {13,14,15}</span></span>
<span class="line"><span style="color: #000000">      -- $14 text[] = {'XYZ','IJK','ABC'}</span></span>
<span class="line"><span style="color: #000000">      -- $15 character varying[] = {'IJK','ABC','XYZ'}</span></span>
<span class="line"><span style="color: #000000">      -- $16 character[] = {'ABC','XYZ','IJK'}</span></span>
<span class="line"><span style="color: #000000">      -- $17 json[] = {'{}','{}','{}'}</span></span>
<span class="line"><span style="color: #000000">      -- $18 jsonb[] = {'{}','{}','{}'}</span></span>
<span class="line"><span style="color: #000000">      select public.case_get_multi_params1($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18)</span></span></code></pre></div><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">info: NpgsqlRestTestWebApi[0]</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $1 real = 1.2</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $2 double precision = 2.3</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $3 jsonpath = '$.user.addresses[0].city'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $4 timestamp without time zone = '2024-04-04T03:03:03'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $5 timestamp with time zone = '2024-05-05T04:04:04.0000000Z'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $6 date = '2024-06-06'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $7 time without time zone = '06:06'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $8 time with time zone = '07:07:00'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $9 interval = '8 minutes 9 seconds'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $10 boolean = true</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $11 uuid = '00000000-0000-0000-0000-000000000000'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $12 bit varying = '101'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $13 varbit = '010'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $14 inet = '192.168.5.13'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $15 macaddr = '00-B0-D0-63-C2-26'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $16 bytea = '\\xDEADBEEF'</span></span>
<span class="line"><span style="color: #E6E6E6">      select public.case_get_multi_params2($1, $2, $3, $4, $5, $6, $7, $8, $9::interval, $10, $11, $12::bit varying, $13::varbit, $14::inet, $15::macaddr, $16::bytea)</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">info: NpgsqlRestTestWebApi[0]</span></span>
<span class="line"><span style="color: #000000">      -- $1 real = 1.2</span></span>
<span class="line"><span style="color: #000000">      -- $2 double precision = 2.3</span></span>
<span class="line"><span style="color: #000000">      -- $3 jsonpath = '$.user.addresses[0].city'</span></span>
<span class="line"><span style="color: #000000">      -- $4 timestamp without time zone = '2024-04-04T03:03:03'</span></span>
<span class="line"><span style="color: #000000">      -- $5 timestamp with time zone = '2024-05-05T04:04:04.0000000Z'</span></span>
<span class="line"><span style="color: #000000">      -- $6 date = '2024-06-06'</span></span>
<span class="line"><span style="color: #000000">      -- $7 time without time zone = '06:06'</span></span>
<span class="line"><span style="color: #000000">      -- $8 time with time zone = '07:07:00'</span></span>
<span class="line"><span style="color: #000000">      -- $9 interval = '8 minutes 9 seconds'</span></span>
<span class="line"><span style="color: #000000">      -- $10 boolean = true</span></span>
<span class="line"><span style="color: #000000">      -- $11 uuid = '00000000-0000-0000-0000-000000000000'</span></span>
<span class="line"><span style="color: #000000">      -- $12 bit varying = '101'</span></span>
<span class="line"><span style="color: #000000">      -- $13 varbit = '010'</span></span>
<span class="line"><span style="color: #000000">      -- $14 inet = '192.168.5.13'</span></span>
<span class="line"><span style="color: #000000">      -- $15 macaddr = '00-B0-D0-63-C2-26'</span></span>
<span class="line"><span style="color: #000000">      -- $16 bytea = '\\xDEADBEEF'</span></span>
<span class="line"><span style="color: #000000">      select public.case_get_multi_params2($1, $2, $3, $4, $5, $6, $7, $8, $9::interval, $10, $11, $12::bit varying, $13::varbit, $14::inet, $15::macaddr, $16::bytea)</span></span></code></pre></div><h3 id="3-command-callback">3) Command Callback<a class="anchor bookmark-target" href="#3-command-callback"><i class="bi bi-link-45deg"></i></a></h3><p>New feature: Now it's possible to define a lambda callback in options, that, if not null - will be called after every command is created and before it is executed.</p><p>This option has the following signature:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #6A9955">/// </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">summary</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #6A9955">/// Command callback, if not null, will be called after every command is created and before it is executed.</span></span>
<span class="line"><span style="color: #6A9955">/// Setting the the HttpContext response status or start writing response body will the default command execution.</span></span>
<span class="line"><span style="color: #6A9955">/// </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">summary</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Func</span><span style="color: #D4D4D4">&lt;</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">Routine</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">NpgsqlCommand</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">HttpContext</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">), </span><span style="color: #9CDCFE">Task</span><span style="color: #D4D4D4">>?</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">CommandCallbackAsync</span><span style="color: #E6E6E6"> { </span><span style="color: #9CDCFE">get</span><span style="color: #E6E6E6">; </span><span style="color: #9CDCFE">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">commandCallbackAsync</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #008000">/// </span><span style="color: #800000">&lt;summary></span></span>
<span class="line"><span style="color: #008000">/// Command callback, if not null, will be called after every command is created and before it is executed.</span></span>
<span class="line"><span style="color: #008000">/// Setting the the HttpContext response status or start writing response body will the default command execution.</span></span>
<span class="line"><span style="color: #008000">/// </span><span style="color: #800000">&lt;/summary></span></span>
<span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #001080">Func</span><span style="color: #000000">&lt;(</span><span style="color: #001080">Routine</span><span style="color: #000000"> </span><span style="color: #001080">routine</span><span style="color: #000000">, </span><span style="color: #001080">NpgsqlCommand</span><span style="color: #000000"> </span><span style="color: #001080">command</span><span style="color: #000000">, </span><span style="color: #001080">HttpContext</span><span style="color: #000000"> </span><span style="color: #001080">context</span><span style="color: #000000">), </span><span style="color: #001080">Task</span><span style="color: #000000">>? </span><span style="color: #001080">CommandCallbackAsync</span><span style="color: #000000"> { </span><span style="color: #001080">get</span><span style="color: #000000">; </span><span style="color: #001080">set</span><span style="color: #000000">; } = </span><span style="color: #001080">commandCallbackAsync</span><span style="color: #000000">;</span></span></code></pre></div><ul><li>The input parameter is a <strong>named tuple</strong> <code>(Routine routine, NpgsqlCommand command, HttpContext context)</code>.</li><li>The expected result is <code>Task</code> since it must be an async function.</li></ul><p>If something is written into the <code>HttpContext</code> response, execution will skip the default behavior and exit immediately. This provides a chance to write a custom implementation logic.</p><p>For example, we have an ordinary function that returns some table:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">get_csv_data</span><span style="color: #E6E6E6">() </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> (id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">date</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">status</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">boolean</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">values</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'foo'</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'2024-01-31'</span><span style="color: #E6E6E6">::</span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">, true), </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'bar'</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'2024-01-29'</span><span style="color: #E6E6E6">::</span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">, true), </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'xyz'</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'2024-01-25'</span><span style="color: #E6E6E6">::</span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">, false)</span></span>
<span class="line"><span style="color: #E6E6E6">) t;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">get_csv_data</span><span style="color: #000000">() </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> (id </span><span style="color: #0000FF">int</span><span style="color: #000000">, </span><span style="color: #0000FF">name</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span><span style="color: #0000FF">date</span><span style="color: #000000"> </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">, </span><span style="color: #0000FF">status</span><span style="color: #000000"> </span><span style="color: #0000FF">boolean</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">values</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #A31515">'foo'</span><span style="color: #000000">, </span><span style="color: #A31515">'2024-01-31'</span><span style="color: #000000">::</span><span style="color: #0000FF">timestamp</span><span style="color: #000000">, true), </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #A31515">'bar'</span><span style="color: #000000">, </span><span style="color: #A31515">'2024-01-29'</span><span style="color: #000000">::</span><span style="color: #0000FF">timestamp</span><span style="color: #000000">, true), </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">3</span><span style="color: #000000">, </span><span style="color: #A31515">'xyz'</span><span style="color: #000000">, </span><span style="color: #A31515">'2024-01-25'</span><span style="color: #000000">::</span><span style="color: #0000FF">timestamp</span><span style="color: #000000">, false)</span></span>
<span class="line"><span style="color: #000000">) t;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p>And only for this function, we don't want JSON, we want CSV. We can do this now:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">CommandCallbackAsync</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equals</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> , </span><span style="color: #CE9178">"get_csv_data"</span><span style="color: #E6E6E6">))</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Response</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">ContentType</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"text/csv"</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ExecuteReaderAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">while</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsync</span><span style="color: #E6E6E6">())</span></span>
<span class="line"><span style="color: #E6E6E6">            {</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">line</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">$"{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">[</span><span style="color: #B5CEA8">0</span><span style="color: #CE9178">]},{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">[</span><span style="color: #B5CEA8">1</span><span style="color: #CE9178">]},{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">.</span><span style="color: #DCDCAA">GetDateTime</span><span style="color: #CE9178">(</span><span style="color: #B5CEA8">2</span><span style="color: #CE9178">)</span><span style="color: #D4D4D4">:</span><span style="color: #9CDCFE">s</span><span style="color: #CE9178">},{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">.</span><span style="color: #DCDCAA">GetBoolean</span><span style="color: #CE9178">(</span><span style="color: #B5CEA8">3</span><span style="color: #CE9178">).</span><span style="color: #DCDCAA">ToString</span><span style="color: #CE9178">().</span><span style="color: #DCDCAA">ToLowerInvariant</span><span style="color: #CE9178">()}</span><span style="color: #D7BA7D">\n</span><span style="color: #CE9178">"</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Response</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">WriteAsync</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">line</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">            }</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">CommandCallbackAsync</span><span style="color: #000000"> = </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000"> =></span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #0000FF">string</span><span style="color: #000000">.</span><span style="color: #795E26">Equals</span><span style="color: #000000">(</span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">routine</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000"> , </span><span style="color: #A31515">"get_csv_data"</span><span style="color: #000000">))</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Response</span><span style="color: #000000">.</span><span style="color: #001080">ContentType</span><span style="color: #000000"> = </span><span style="color: #A31515">"text/csv"</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #795E26">ExecuteReaderAsync</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">while</span><span style="color: #000000"> (</span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsync</span><span style="color: #000000">())</span></span>
<span class="line"><span style="color: #000000">            {</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">line</span><span style="color: #000000"> = </span><span style="color: #A31515">$"{</span><span style="color: #001080">reader</span><span style="color: #A31515">[</span><span style="color: #098658">0</span><span style="color: #A31515">]},{</span><span style="color: #001080">reader</span><span style="color: #A31515">[</span><span style="color: #098658">1</span><span style="color: #A31515">]},{</span><span style="color: #001080">reader</span><span style="color: #A31515">.</span><span style="color: #795E26">GetDateTime</span><span style="color: #A31515">(</span><span style="color: #098658">2</span><span style="color: #A31515">)</span><span style="color: #000000">:</span><span style="color: #001080">s</span><span style="color: #A31515">},{</span><span style="color: #001080">reader</span><span style="color: #A31515">.</span><span style="color: #795E26">GetBoolean</span><span style="color: #A31515">(</span><span style="color: #098658">3</span><span style="color: #A31515">).</span><span style="color: #795E26">ToString</span><span style="color: #A31515">().</span><span style="color: #795E26">ToLowerInvariant</span><span style="color: #A31515">()}</span><span style="color: #EE0000">\n</span><span style="color: #A31515">"</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Response</span><span style="color: #000000">.</span><span style="color: #795E26">WriteAsync</span><span style="color: #000000">(</span><span style="color: #001080">line</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">            }</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><p>And, when we do the <code>GET {{!host!}}/api/get-csv-data</code>, the response will be:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color: #E6E6E6">Content-Type: text/csv</span></span>
<span class="line"><span style="color: #E6E6E6">Date: Sun, 28 Jan 2024 13:21:57 GMT</span></span>
<span class="line"><span style="color: #E6E6E6">Server: Kestrel</span></span>
<span class="line"><span style="color: #E6E6E6">Transfer-Encoding: chunked</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">1,foo,2024-01-31T00:00:00,true</span></span>
<span class="line"><span style="color: #E6E6E6">2,bar,2024-01-29T00:00:00,true</span></span>
<span class="line"><span style="color: #E6E6E6">3,xyz,2024-01-25T00:00:00,false</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">HTTP/1.1 200 OK</span></span>
<span class="line"><span style="color: #000000">Content-Type: text/csv</span></span>
<span class="line"><span style="color: #000000">Date: Sun, 28 Jan 2024 13:21:57 GMT</span></span>
<span class="line"><span style="color: #000000">Server: Kestrel</span></span>
<span class="line"><span style="color: #000000">Transfer-Encoding: chunked</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">1,foo,2024-01-31T00:00:00,true</span></span>
<span class="line"><span style="color: #000000">2,bar,2024-01-29T00:00:00,true</span></span>
<span class="line"><span style="color: #000000">3,xyz,2024-01-25T00:00:00,false</span></span></code></pre></div><p>This is a bit advanced feature, but a useful one.</p><hr><h2 id="version-151-2024-27-01">Version <a href="https://github.com/vb-consulting/NpgsqlRest/tree/1.5.1">1.5.1</a> (2024-27-01)<a class="anchor bookmark-target" href="#version-151-2024-27-01"><i class="bi bi-link-45deg"></i></a></h2><p><a href="https://github.com/vb-consulting/NpgsqlRest/compare/1.5.0...1.5.1">Full Changelog</a></p><p>Small fix for JSON returning time stamps in an array.</p><p>Previously, the JSON response didn't have T between date and time, which is required by the ISO 8601 standard.</p><pre><code>"{\"2024-01-24 00:00:00\",\"2024-01-20 00:00:00\",\"2024-01-21 00:00:00\"}"
</code></pre><p>Now it's fixed:</p><pre><code>"{\"2024-01-24T00:00:00\",\"2024-01-20T00:00:00\",\"2024-01-21T00:00:00\"}"
</code></pre><hr><h2 id="version-150-2024-27-01">Version <a href="https://github.com/vb-consulting/NpgsqlRest/tree/1.5.0">1.5.0</a> (2024-27-01)<a class="anchor bookmark-target" href="#version-150-2024-27-01"><i class="bi bi-link-45deg"></i></a></h2><p><a href="https://github.com/vb-consulting/NpgsqlRest/compare/1.4.0...1.5.0">Full Changelog</a></p><h3 id="1-new-feature-strict-function-support">1) New Feature: Strict Function Support<a class="anchor bookmark-target" href="#1-new-feature-strict-function-support"><i class="bi bi-link-45deg"></i></a></h3><p>Functions in strict mode are functions that are declared with the <code>STRICT</code> or with <code>RETURNS NULL ON NULL INPUT</code> keyword.</p><p>These functions are <strong>not executed</strong> at all if any of the parameters are NULL.</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">strict_function</span><span style="color: #E6E6E6">(_p1 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, _p2 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">strict</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    raise info </span><span style="color: #CE9178">'_p1 = %, _p2 = %'</span><span style="color: #E6E6E6">, _p1, _p2;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'strict'</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">returns_null_on_null_input_function</span><span style="color: #E6E6E6">(_p1 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, _p2 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> input</span></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    raise info </span><span style="color: #CE9178">'_p1 = %, _p2 = %'</span><span style="color: #E6E6E6">, _p1, _p2;</span></span>
<span class="line"><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'returns null on null input'</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">strict_function</span><span style="color: #000000">(_p1 </span><span style="color: #0000FF">int</span><span style="color: #000000">, _p2 </span><span style="color: #0000FF">int</span><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">strict</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    raise info </span><span style="color: #A31515">'_p1 = %, _p2 = %'</span><span style="color: #000000">, _p1, _p2;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">return</span><span style="color: #000000"> </span><span style="color: #A31515">'strict'</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">returns_null_on_null_input_function</span><span style="color: #000000">(_p1 </span><span style="color: #0000FF">int</span><span style="color: #000000">, _p2 </span><span style="color: #0000FF">int</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000"> </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000"> input</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    raise info </span><span style="color: #A31515">'_p1 = %, _p2 = %'</span><span style="color: #000000">, _p1, _p2;</span></span>
<span class="line"><span style="color: #0000FF">return</span><span style="color: #000000"> </span><span style="color: #A31515">'returns null on null input'</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p>If any of these functions were called with NULL:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> strict_function(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">,</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> strict_function(</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">,</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> strict_function(</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">,</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> returns_null_on_null_input_function(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">,</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> returns_null_on_null_input_function(</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">,</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> returns_null_on_null_input_function(</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">,</span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> strict_function(</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #0000FF">null</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> strict_function(</span><span style="color: #0000FF">null</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> strict_function(</span><span style="color: #0000FF">null</span><span style="color: #000000">,</span><span style="color: #0000FF">null</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> returns_null_on_null_input_function(</span><span style="color: #098658">1</span><span style="color: #000000">,</span><span style="color: #0000FF">null</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> returns_null_on_null_input_function(</span><span style="color: #0000FF">null</span><span style="color: #000000">,</span><span style="color: #098658">1</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> returns_null_on_null_input_function(</span><span style="color: #0000FF">null</span><span style="color: #000000">,</span><span style="color: #0000FF">null</span><span style="color: #000000">);</span></span></code></pre></div><p>Then function will not be executed at all no info will be emitted with <code>raise info</code> since nothing is executed.</p><p>In this version, NpgsqlRest will return <code>HTTP 204 NoContent</code> response if any of the parameters are NULL. and it will avoid calling database in the first place.</p><h3 id="2-other-improvements">2) Other Improvements<a class="anchor bookmark-target" href="#2-other-improvements"><i class="bi bi-link-45deg"></i></a></h3><p>This release features a lot of internal refactoring and code cleanup.</p><hr><h2 id="version-140-2024-26-01">Version <a href="https://github.com/vb-consulting/NpgsqlRest/tree/1.4.0">1.4.0</a> (2024-26-01)<a class="anchor bookmark-target" href="#version-140-2024-26-01"><i class="bi bi-link-45deg"></i></a></h2><p><a href="https://github.com/vb-consulting/NpgsqlRest/compare/1.3.0...1.4.0">Full Changelog</a></p><h3 id="1-improved-untyped-functions">1) Improved Untyped Functions<a class="anchor bookmark-target" href="#1-improved-untyped-functions"><i class="bi bi-link-45deg"></i></a></h3><p>In the previous version, untyped functions were returning a JSON array where each element was an entire raw record as returned from PostgreSQL encoded into JSON string:</p><p>Following raw output:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">(1,one)</span></span>
<span class="line"><span style="color: #E6E6E6">(2,two)</span></span>
<span class="line"><span style="color: #E6E6E6">(3,three)</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">(1,one)</span></span>
<span class="line"><span style="color: #000000">(2,two)</span></span>
<span class="line"><span style="color: #000000">(3,three)</span></span></code></pre></div><p>would produce this JSON response: <code>["1,one","2,two","3,three"]</code>.</p><p>However, this response is not very usable, because clients still need to process each record which can be pretty tricky for many reasons: For example, comma symbols are encoded into double-quoted strings: <code>foo,bar</code> -> <code>"foo,bar"</code>, which makes them very hard to split values by as CSV strings, and many other reasons.</p><p>In this version, each record is encoded into a JSON array and each element into its own JSON string. The example above now looks like (formatted):</p><div class="code json"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">[</span></span>
<span class="line"><span style="color: #E6E6E6">    [</span><span style="color: #CE9178">"1"</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"one"</span><span style="color: #E6E6E6">],</span></span>
<span class="line"><span style="color: #E6E6E6">    [</span><span style="color: #CE9178">"2"</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"two"</span><span style="color: #E6E6E6">],</span></span>
<span class="line"><span style="color: #E6E6E6">    [</span><span style="color: #CE9178">"3"</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"three"</span><span style="color: #E6E6E6">]</span></span>
<span class="line"><span style="color: #E6E6E6">]</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">[</span></span>
<span class="line"><span style="color: #000000">    [</span><span style="color: #A31515">"1"</span><span style="color: #000000">, </span><span style="color: #A31515">"one"</span><span style="color: #000000">],</span></span>
<span class="line"><span style="color: #000000">    [</span><span style="color: #A31515">"2"</span><span style="color: #000000">, </span><span style="color: #A31515">"two"</span><span style="color: #000000">],</span></span>
<span class="line"><span style="color: #000000">    [</span><span style="color: #A31515">"3"</span><span style="color: #000000">, </span><span style="color: #A31515">"three"</span><span style="color: #000000">]</span></span>
<span class="line"><span style="color: #000000">]</span></span></code></pre></div><p>Note that are all types now encoded as strings, regardless of the actual type. This is because, as far as I know, it is impossible to figure out actual types from the untyped function with the <code>Npgsql</code> data driver.</p><p>This may create awkward situations, because, for example, the raw output from PostgreSQL for the <code>boolean true</code> value and <code>text 't'</code> value are identical <code>t</code> and will be encoded also identical <code>"t"</code>. The assumption is that clients will know what types and values should they expect and act accordingly.</p><p>This makes the use of untyped functions a very powerful approach, because the actual result table definition, doesn't have to be explicitly defined every time:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">get_test_records</span><span style="color: #E6E6E6">() </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> setof record</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">values</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'one'</span><span style="color: #E6E6E6">), </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'two'</span><span style="color: #E6E6E6">), </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'three'</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">) v;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">get_test_records</span><span style="color: #000000">() </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> setof record</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> (</span><span style="color: #0000FF">values</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #A31515">'one'</span><span style="color: #000000">), </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #A31515">'two'</span><span style="color: #000000">), </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">3</span><span style="color: #000000">, </span><span style="color: #A31515">'three'</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">) v;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><h3 id="2-improved-logging">2) Improved Logging<a class="anchor bookmark-target" href="#2-improved-logging"><i class="bi bi-link-45deg"></i></a></h3><p>There are also some improvements in the logging mechanism and new logging options:</p><ul><li>When the endpoint attribute is set through the comment annotation, this event is now logged as an information-level log. Previously, it was hard to tell did we set the endpoint attribute or not, because, when an annotation is wrong, it is interpreted as plain comment and ignored. Now it's easy.</li><li>We can turn off or on this feature with the <code>LogAnnotationSetInfo</code> build option. The default is true.</li><li>There is also another new build option to control logging: <code>LogEndpointCreatedInfo</code>. Controls should we log the endpoint creation or not? The default is true.</li></ul><hr><h2 id="version-130-2024-23-01">Version <a href="https://github.com/vb-consulting/NpgsqlRest/tree/1.3.0">1.3.0</a> (2024-23-01)<a class="anchor bookmark-target" href="#version-130-2024-23-01"><i class="bi bi-link-45deg"></i></a></h2><h3 id="1-support-for-variadic-parameters">1) Support For Variadic Parameters<a class="anchor bookmark-target" href="#1-support-for-variadic-parameters"><i class="bi bi-link-45deg"></i></a></h3><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">variadic_param_plus_one</span><span style="color: #E6E6E6">(variadic v </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">[]) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">[] </span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> array_agg(n </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> unnest($</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">AS</span><span style="color: #E6E6E6"> n;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">variadic_param_plus_one</span><span style="color: #000000">(variadic v </span><span style="color: #0000FF">int</span><span style="color: #000000">[]) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000">[] </span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> array_agg(n + </span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">from</span><span style="color: #000000"> unnest($</span><span style="color: #098658">1</span><span style="color: #000000">) </span><span style="color: #0000FF">AS</span><span style="color: #000000"> n;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">Fact</span><span style="color: #E6E6E6">]</span></span>
<span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Task</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">Test_variadic_param_plus_one</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">body</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">StringContent</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"{</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">v</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">: [1,2,3,4]}"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">Encoding</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">UTF8</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">response</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">test</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Client</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">PostAsync</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/variadic-param-plus-one"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">body</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">content</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">response</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Content</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsStringAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">StatusCode</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">HttpStatusCode</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">OK</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">content</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"[2,3,4,5]"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">[</span><span style="color: #267F99">Fact</span><span style="color: #000000">]</span></span>
<span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #267F99">Task</span><span style="color: #000000"> </span><span style="color: #795E26">Test_variadic_param_plus_one</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">body</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">StringContent</span><span style="color: #000000">(</span><span style="color: #A31515">"{</span><span style="color: #EE0000">\"</span><span style="color: #A31515">v</span><span style="color: #EE0000">\"</span><span style="color: #A31515">: [1,2,3,4]}"</span><span style="color: #000000">, </span><span style="color: #001080">Encoding</span><span style="color: #000000">.</span><span style="color: #001080">UTF8</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">test</span><span style="color: #000000">.</span><span style="color: #001080">Client</span><span style="color: #000000">.</span><span style="color: #795E26">PostAsync</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/variadic-param-plus-one"</span><span style="color: #000000">, </span><span style="color: #001080">body</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">content</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000">.</span><span style="color: #001080">Content</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsStringAsync</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">response</span><span style="color: #000000">?.</span><span style="color: #001080">StatusCode</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #001080">HttpStatusCode</span><span style="color: #000000">.</span><span style="color: #001080">OK</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">content</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #A31515">"[2,3,4,5]"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><h3 id="2-support-for-table-valued-functions">2) Support For Table-Valued Functions<a class="anchor bookmark-target" href="#2-support-for-table-valued-functions"><i class="bi bi-link-45deg"></i></a></h3><p>It seems that support for functions returning existing tables (set of table, or table-valued functions) was accidentally missing. This is now fixed.</p><p>Example:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">test_table</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">insert into</span><span style="color: #E6E6E6"> test_table </span><span style="color: #569CD6">values</span><span style="color: #E6E6E6"> (</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'one'</span><span style="color: #E6E6E6">), (</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'two'</span><span style="color: #E6E6E6">), (</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'three'</span><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">get_test_table</span><span style="color: #E6E6E6">() </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> setof test_table</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> test_table;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">test_table</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">name</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">insert into</span><span style="color: #000000"> test_table </span><span style="color: #0000FF">values</span><span style="color: #000000"> (</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #A31515">'one'</span><span style="color: #000000">), (</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #A31515">'two'</span><span style="color: #000000">), (</span><span style="color: #098658">3</span><span style="color: #000000">, </span><span style="color: #A31515">'three'</span><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">get_test_table</span><span style="color: #000000">() </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> setof test_table</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> test_table;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">Fact</span><span style="color: #E6E6E6">]</span></span>
<span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Task</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">Test_get_test_table</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">response</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">test</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Client</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetAsync</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/get-test-table"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">content</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">response</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Content</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsStringAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">StatusCode</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">HttpStatusCode</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">OK</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Content</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Headers</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">ContentType</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">MediaType</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"application/json"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">content</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"[{</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">id</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">:1,</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">name</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">:</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">one</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">},{</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">id</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">:2,</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">name</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">:</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">two</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">},{</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">id</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">:3,</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">name</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">:</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">three</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">}]"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">[</span><span style="color: #267F99">Fact</span><span style="color: #000000">]</span></span>
<span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #267F99">Task</span><span style="color: #000000"> </span><span style="color: #795E26">Test_get_test_table</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">test</span><span style="color: #000000">.</span><span style="color: #001080">Client</span><span style="color: #000000">.</span><span style="color: #795E26">GetAsync</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/get-test-table"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">content</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000">.</span><span style="color: #001080">Content</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsStringAsync</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">response</span><span style="color: #000000">?.</span><span style="color: #001080">StatusCode</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #001080">HttpStatusCode</span><span style="color: #000000">.</span><span style="color: #001080">OK</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">response</span><span style="color: #000000">?.</span><span style="color: #001080">Content</span><span style="color: #000000">?.</span><span style="color: #001080">Headers</span><span style="color: #000000">?.</span><span style="color: #001080">ContentType</span><span style="color: #000000">?.</span><span style="color: #001080">MediaType</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #A31515">"application/json"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">content</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #A31515">"[{</span><span style="color: #EE0000">\"</span><span style="color: #A31515">id</span><span style="color: #EE0000">\"</span><span style="color: #A31515">:1,</span><span style="color: #EE0000">\"</span><span style="color: #A31515">name</span><span style="color: #EE0000">\"</span><span style="color: #A31515">:</span><span style="color: #EE0000">\"</span><span style="color: #A31515">one</span><span style="color: #EE0000">\"</span><span style="color: #A31515">},{</span><span style="color: #EE0000">\"</span><span style="color: #A31515">id</span><span style="color: #EE0000">\"</span><span style="color: #A31515">:2,</span><span style="color: #EE0000">\"</span><span style="color: #A31515">name</span><span style="color: #EE0000">\"</span><span style="color: #A31515">:</span><span style="color: #EE0000">\"</span><span style="color: #A31515">two</span><span style="color: #EE0000">\"</span><span style="color: #A31515">},{</span><span style="color: #EE0000">\"</span><span style="color: #A31515">id</span><span style="color: #EE0000">\"</span><span style="color: #A31515">:3,</span><span style="color: #EE0000">\"</span><span style="color: #A31515">name</span><span style="color: #EE0000">\"</span><span style="color: #A31515">:</span><span style="color: #EE0000">\"</span><span style="color: #A31515">three</span><span style="color: #EE0000">\"</span><span style="color: #A31515">}]"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><h3 id="2-support-for-untyped-functions">2) Support for Untyped Functions<a class="anchor bookmark-target" href="#2-support-for-untyped-functions"><i class="bi bi-link-45deg"></i></a></h3><p>Untyped functions are functions that return a set of records of the unknown type.</p><p>For example:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">get_test_records</span><span style="color: #E6E6E6">() </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> setof record</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">values</span><span style="color: #E6E6E6"> (</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'one'</span><span style="color: #E6E6E6">), (</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'two'</span><span style="color: #E6E6E6">), (</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'three'</span><span style="color: #E6E6E6">)) v;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">get_test_records</span><span style="color: #000000">() </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> setof record</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> (</span><span style="color: #0000FF">values</span><span style="color: #000000"> (</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #A31515">'one'</span><span style="color: #000000">), (</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #A31515">'two'</span><span style="color: #000000">), (</span><span style="color: #098658">3</span><span style="color: #000000">, </span><span style="color: #A31515">'three'</span><span style="color: #000000">)) v;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p>These cannot be called without the result column definition list:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> get_test_records()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">-- throws error:</span></span>
<span class="line"><span style="color: #6A9955">-- ERROR:  a column definition list is required for functions returning "record"</span></span>
<span class="line"><span style="color: #6A9955">-- LINE 1: select * from get_test_records()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> get_test_records() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> v(a </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, b </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #6A9955">-- returns result with columns a int, b text</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> get_test_records()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000">-- throws error:</span></span>
<span class="line"><span style="color: #008000">-- ERROR:  a column definition list is required for functions returning "record"</span></span>
<span class="line"><span style="color: #008000">-- LINE 1: select * from get_test_records()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> get_test_records() </span><span style="color: #0000FF">as</span><span style="color: #000000"> v(a </span><span style="color: #0000FF">int</span><span style="color: #000000">, b </span><span style="color: #0000FF">text</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #008000">-- returns result with columns a int, b text</span></span></code></pre></div><p>There is no way of knowing which results these functions will return (as far as I know) and the only way to return a workable set is to execute it as a scalar function:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> get_test_records() </span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">-- returns values:</span></span>
<span class="line"><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">,one)</span></span>
<span class="line"><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">,two)</span></span>
<span class="line"><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">,three)</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> get_test_records() </span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000">-- returns values:</span></span>
<span class="line"><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">,one)</span></span>
<span class="line"><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">,two)</span></span>
<span class="line"><span style="color: #000000">(</span><span style="color: #098658">3</span><span style="color: #000000">,three)</span></span></code></pre></div><p>These are raw record values as returned from PostgreSQL without any parsing (for example text is not quoted). When NpgsqlRest executes this type of function it will return a JSON array with raw values from the PostgreSQL server without left and right parenthesis:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">Fact</span><span style="color: #E6E6E6">]</span></span>
<span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Task</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">Test_get_test_records</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">response</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">test</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Client</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetAsync</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/get-test-records"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">content</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">response</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Content</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsStringAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">StatusCode</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">HttpStatusCode</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">OK</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">response</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Content</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Headers</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">ContentType</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">MediaType</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"application/json"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">content</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Should</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Be</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"[</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">1,one</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">,</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">2,two</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">,</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">3,three</span><span style="color: #D7BA7D">\"</span><span style="color: #CE9178">]"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">[</span><span style="color: #267F99">Fact</span><span style="color: #000000">]</span></span>
<span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #267F99">Task</span><span style="color: #000000"> </span><span style="color: #795E26">Test_get_test_records</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">test</span><span style="color: #000000">.</span><span style="color: #001080">Client</span><span style="color: #000000">.</span><span style="color: #795E26">GetAsync</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/get-test-records"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">content</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">response</span><span style="color: #000000">.</span><span style="color: #001080">Content</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsStringAsync</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">response</span><span style="color: #000000">?.</span><span style="color: #001080">StatusCode</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #001080">HttpStatusCode</span><span style="color: #000000">.</span><span style="color: #001080">OK</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">response</span><span style="color: #000000">?.</span><span style="color: #001080">Content</span><span style="color: #000000">?.</span><span style="color: #001080">Headers</span><span style="color: #000000">?.</span><span style="color: #001080">ContentType</span><span style="color: #000000">?.</span><span style="color: #001080">MediaType</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #A31515">"application/json"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">content</span><span style="color: #000000">.</span><span style="color: #795E26">Should</span><span style="color: #000000">().</span><span style="color: #795E26">Be</span><span style="color: #000000">(</span><span style="color: #A31515">"[</span><span style="color: #EE0000">\"</span><span style="color: #A31515">1,one</span><span style="color: #EE0000">\"</span><span style="color: #A31515">,</span><span style="color: #EE0000">\"</span><span style="color: #A31515">2,two</span><span style="color: #EE0000">\"</span><span style="color: #A31515">,</span><span style="color: #EE0000">\"</span><span style="color: #A31515">3,three</span><span style="color: #EE0000">\"</span><span style="color: #A31515">]"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><hr><h2 id="version-120-2024-22-01">Version 1.2.0 (2024-22-01)<a class="anchor bookmark-target" href="#version-120-2024-22-01"><i class="bi bi-link-45deg"></i></a></h2><h3 id="1-fix-aot-warnings">1) Fix AOT Warnings<a class="anchor bookmark-target" href="#1-fix-aot-warnings"><i class="bi bi-link-45deg"></i></a></h3><p>A couple of issues have caused AOT warnings, although AOT worked before. This is now fixed:</p><h4 id="1-jsonify-strings">1) JSONify Strings<a class="anchor bookmark-target" href="#1-jsonify-strings"><i class="bi bi-link-45deg"></i></a></h4><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">JsonSerializable</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">typeof</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">))]</span></span>
<span class="line"><span style="color: #569CD6">internal</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">partial</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlRestSerializerContext</span><span style="color: #E6E6E6"> : </span><span style="color: #4EC9B0">JsonSerializerContext</span><span style="color: #E6E6E6"> { }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">private</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">static</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">readonly</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">JsonSerializerOptions</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">plainTextSerializerOptions</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">Encoder</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">System</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Text</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Encodings</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Web</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">JavaScriptEncoder</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">UnsafeRelaxedJsonEscaping</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">TypeInfoResolver</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlRestSerializerContext</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">// </span></span>
<span class="line"><span style="color: #6A9955">// AOT works but still emmits warnings IL2026 and IL3050</span></span>
<span class="line"><span style="color: #6A9955">// </span></span>
<span class="line"><span style="color: #9CDCFE">JsonSerializer</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Serialize</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">str</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">plainTextSerializerOptions</span><span style="color: #E6E6E6">)</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">[</span><span style="color: #267F99">JsonSerializable</span><span style="color: #000000">(</span><span style="color: #0000FF">typeof</span><span style="color: #000000">(</span><span style="color: #0000FF">string</span><span style="color: #000000">))]</span></span>
<span class="line"><span style="color: #0000FF">internal</span><span style="color: #000000"> </span><span style="color: #0000FF">partial</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlRestSerializerContext</span><span style="color: #000000"> : </span><span style="color: #267F99">JsonSerializerContext</span><span style="color: #000000"> { }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">readonly</span><span style="color: #000000"> </span><span style="color: #267F99">JsonSerializerOptions</span><span style="color: #000000"> </span><span style="color: #001080">plainTextSerializerOptions</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">Encoder</span><span style="color: #000000"> = </span><span style="color: #001080">System</span><span style="color: #000000">.</span><span style="color: #001080">Text</span><span style="color: #000000">.</span><span style="color: #001080">Encodings</span><span style="color: #000000">.</span><span style="color: #001080">Web</span><span style="color: #000000">.</span><span style="color: #001080">JavaScriptEncoder</span><span style="color: #000000">.</span><span style="color: #001080">UnsafeRelaxedJsonEscaping</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">TypeInfoResolver</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlRestSerializerContext</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000">// </span></span>
<span class="line"><span style="color: #008000">// AOT works but still emmits warnings IL2026 and IL3050</span></span>
<span class="line"><span style="color: #008000">// </span></span>
<span class="line"><span style="color: #001080">JsonSerializer</span><span style="color: #000000">.</span><span style="color: #795E26">Serialize</span><span style="color: #000000">(</span><span style="color: #001080">str</span><span style="color: #000000">, </span><span style="color: #001080">plainTextSerializerOptions</span><span style="color: #000000">)</span></span></code></pre></div><p>This is fixed with suppression:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">UnconditionalSuppressMessage</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"Aot"</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"IL2026:RequiresUnreferencedCode"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">Justification</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"Serializes only string type that have AOT friendly TypeInfoResolver"</span><span style="color: #E6E6E6">)]</span></span>
<span class="line"><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">UnconditionalSuppressMessage</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"Aot"</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"IL3050:RequiresDynamic"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">Justification</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"Serializes only string type that have AOT friendly TypeInfoResolver"</span><span style="color: #E6E6E6">)]</span></span>
<span class="line"><span style="color: #569CD6">private</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">static</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">SerializeString</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">ref</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">value</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">JsonSerializer</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Serialize</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">value</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">plainTextSerializerOptions</span><span style="color: #E6E6E6">);</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">[</span><span style="color: #267F99">UnconditionalSuppressMessage</span><span style="color: #000000">(</span><span style="color: #A31515">"Aot"</span><span style="color: #000000">, </span><span style="color: #A31515">"IL2026:RequiresUnreferencedCode"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">Justification</span><span style="color: #000000"> = </span><span style="color: #A31515">"Serializes only string type that have AOT friendly TypeInfoResolver"</span><span style="color: #000000">)]</span></span>
<span class="line"><span style="color: #000000">[</span><span style="color: #267F99">UnconditionalSuppressMessage</span><span style="color: #000000">(</span><span style="color: #A31515">"Aot"</span><span style="color: #000000">, </span><span style="color: #A31515">"IL3050:RequiresDynamic"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">Justification</span><span style="color: #000000"> = </span><span style="color: #A31515">"Serializes only string type that have AOT friendly TypeInfoResolver"</span><span style="color: #000000">)]</span></span>
<span class="line"><span style="color: #0000FF">private</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #795E26">SerializeString</span><span style="color: #000000">(</span><span style="color: #0000FF">ref</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">value</span><span style="color: #000000">) => </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">JsonSerializer</span><span style="color: #000000">.</span><span style="color: #795E26">Serialize</span><span style="color: #000000">(</span><span style="color: #001080">value</span><span style="color: #000000">, </span><span style="color: #001080">plainTextSerializerOptions</span><span style="color: #000000">);</span></span></code></pre></div><h4 id="2-http-file-endpoint">2) HTTP file endpoint<a class="anchor bookmark-target" href="#2-http-file-endpoint"><i class="bi bi-link-45deg"></i></a></h4><p>HTTP file endpoint was mapped with <code>MapGet</code>, and although it worked fine with AOT it emitted AOT warnings.</p><p>This is replaced with a middleware interceptor:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Use</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">next</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> (</span><span style="color: #D4D4D4">!</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equals</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Request</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Method</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"GET"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">StringComparison</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">OrdinalIgnoreCase</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">&&</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equals</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Request</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Path</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">path</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">StringComparison</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">)))</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">next</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Response</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">StatusCode</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #B5CEA8">200</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Response</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">ContentType</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"text/plain"</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Response</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">WriteAsync</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">content</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ToString</span><span style="color: #E6E6E6">());</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #795E26">Use</span><span style="color: #000000">(</span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span><span style="color: #001080">context</span><span style="color: #000000">, </span><span style="color: #001080">next</span><span style="color: #000000">) =></span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (!(</span><span style="color: #0000FF">string</span><span style="color: #000000">.</span><span style="color: #795E26">Equals</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Request</span><span style="color: #000000">.</span><span style="color: #001080">Method</span><span style="color: #000000">, </span><span style="color: #A31515">"GET"</span><span style="color: #000000">, </span><span style="color: #001080">StringComparison</span><span style="color: #000000">.</span><span style="color: #001080">OrdinalIgnoreCase</span><span style="color: #000000">) && </span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">string</span><span style="color: #000000">.</span><span style="color: #795E26">Equals</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Request</span><span style="color: #000000">.</span><span style="color: #001080">Path</span><span style="color: #000000">, </span><span style="color: #001080">path</span><span style="color: #000000">, </span><span style="color: #001080">StringComparison</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000">)))</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #795E26">next</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Response</span><span style="color: #000000">.</span><span style="color: #001080">StatusCode</span><span style="color: #000000"> = </span><span style="color: #098658">200</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Response</span><span style="color: #000000">.</span><span style="color: #001080">ContentType</span><span style="color: #000000"> = </span><span style="color: #A31515">"text/plain"</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Response</span><span style="color: #000000">.</span><span style="color: #795E26">WriteAsync</span><span style="color: #000000">(</span><span style="color: #001080">content</span><span style="color: #000000">.</span><span style="color: #795E26">ToString</span><span style="color: #000000">());</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><p>This resolved the warning but also removed the need for a routing component, which can make AOT builds even leaner and smaller:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">WebApplication</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">CreateEmptyBuilder</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> ());</span></span>
<span class="line"><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Logging</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddConsole</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">WebHost</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseKestrelCore</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #6A9955">// not needed any more</span></span>
<span class="line"><span style="color: #6A9955">// builder.Services.AddRoutingCore();</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">builder</span><span style="color: #000000"> = </span><span style="color: #001080">WebApplication</span><span style="color: #000000">.</span><span style="color: #795E26">CreateEmptyBuilder</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> ());</span></span>
<span class="line"><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #001080">Logging</span><span style="color: #000000">.</span><span style="color: #795E26">AddConsole</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #001080">WebHost</span><span style="color: #000000">.</span><span style="color: #795E26">UseKestrelCore</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #008000">// not needed any more</span></span>
<span class="line"><span style="color: #008000">// builder.Services.AddRoutingCore();</span></span></code></pre></div><h4 id="3-configuration-get-value-from-string">3) Configuration Get Value From String<a class="anchor bookmark-target" href="#3-configuration-get-value-from-string"><i class="bi bi-link-45deg"></i></a></h4><p>Method <code>GetHost</code> used <code>app.Configuration.GetValue&lt;string>("ASPNETCORE_URLS")</code> configuration read which issued AOT warnings but it worked since it uses a string. This is suppressed with <code>[UnconditionalSuppressMessage("Aot", "IL2026:RequiresUnreferencedCode", Justification = "Configuration.GetValue only uses string type parameters")]</code>.</p><h3 id="2-fix-arrays-encodings-in-http-files">2) Fix Arrays Encodings In Http Files<a class="anchor bookmark-target" href="#2-fix-arrays-encodings-in-http-files"><i class="bi bi-link-45deg"></i></a></h3><p>Fixed arrays encoding in query string parameters of the generated HTTP file sample.</p><h3 id="3-changed-method-type-logic">3) Changed Method Type Logic<a class="anchor bookmark-target" href="#3-changed-method-type-logic"><i class="bi bi-link-45deg"></i></a></h3><p>Change in logic that determines the endpoint default method:</p><ul><li>Before: endpoint is GET if the routine name contains string <code>get</code>.</li><li>Now: it's complicated.</li></ul><p>The endpoint is now GET if the routine name either:</p><ul><li>Starts with <code>get_</code> (case insensitive).</li><li>Ends with <code>_get</code> (case insensitive).</li><li>Contains <code>_get_</code> (case insensitive).</li></ul><p>Otherwise, the endpoint is POST if the volatility option is VOLATILE. This assumes that the routine is changing some data, and that is also how PostgREST works and therefore endpoint is POST. Otherwise, it is GET.</p><p>You can see the source code here: <a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/NpgsqlRest/DefaultEndpoint.cs#L65">/DefaultEndpoint.cs</a></p><p>This change may be breaking change in some rare circumstances (all 88 tests are passing without a change), but luckily not too many people are using this library at this point.</p><h3 id="4-url-path-handling-changes">4) URL Path Handling Changes<a class="anchor bookmark-target" href="#4-url-path-handling-changes"><i class="bi bi-link-45deg"></i></a></h3><p>Generated URLs by the default <a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/NpgsqlRest/DefaultUrlBuilder.cs#L5">DefaultUrlBuilder</a> will no longer add a slash character (<code>/</code>) at the end of the line.</p><p>However, when middleware tries to match the requested path, both versions will be matched (with an ending slash and without an ending slash).</p><p>That means that function with the signature <code>public.</code>test_func()` will match successfully both of these paths:</p><ul><li><code>/api/test-func</code></li><li><code>/api/test-func/</code></li></ul><p>But only one will be generated in an HTTP file: <code>/api/test-func</code>.</p><h3 id="5-fix-sending-request-headers-with-parameter">5) Fix Sending Request Headers With Parameter<a class="anchor bookmark-target" href="#5-fix-sending-request-headers-with-parameter"><i class="bi bi-link-45deg"></i></a></h3><p>There was a bug with the endpoint option to send request headers JSON through a routine parameter. It seems that the parameter name was always the default. This is fixed and <a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/NpgsqlRestTests/RequestHeadersTests.cs#L115">tested</a>.</p><h3 id="6-sending-request-headers-parameter-defaults">6) Sending Request Headers Parameter Defaults<a class="anchor bookmark-target" href="#6-sending-request-headers-parameter-defaults"><i class="bi bi-link-45deg"></i></a></h3><p>Sending request headers with a routine parameter doesn't require that parameter to have a default value defined anymore.</p><h3 id="7-new-feature-body-parameter-name">7) New Feature: Body Parameter Name<a class="anchor bookmark-target" href="#7-new-feature-body-parameter-name"><i class="bi bi-link-45deg"></i></a></h3><p>There is a new feature that allows binding an entire body content to a particular routine parameter.</p><p>This is an endpoint-level value called <code>BodyParameterName</code>, which is NULL by default.</p><ul><li>When this value is NULL (default), no parameter is assigned from body content. The same rules apply as before, nothing is changed.</li><li>When this value is not NULL then:<ul><li>If the endpoint has <code>RequestParamType</code> set to <code>BodyJson</code> it will be changed automatically to <code>QueryString</code> and a warning log will be emitted.</li><li>A parameter named <code>BodyParameterName</code> (matches original and converted names) will be assigned from the entire request body content.</li><li>If body content is NULL (not set), the parameter value will be NULL, and it will be always assigned from a body.</li><li>All other parameters will be assigned from the query string values (<code>RequestParamType = RequestParamType.QueryString</code>).</li></ul></li></ul><p>Example:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example_function</span><span style="color: #E6E6E6">(_p1 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, _content </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> void </span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">-- do something with _p1, and _content parameters</span></span>
<span class="line"><span style="color: #E6E6E6">    raise info </span><span style="color: #CE9178">'received % from _p1 and % from content'</span><span style="color: #E6E6E6">, _p1, _content;</span></span>
<span class="line"><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">example_function</span><span style="color: #000000">(_p1 </span><span style="color: #0000FF">int</span><span style="color: #000000">, _content </span><span style="color: #0000FF">text</span><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> void </span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">-- do something with _p1, and _content parameters</span></span>
<span class="line"><span style="color: #000000">    raise info </span><span style="color: #A31515">'received % from _p1 and % from content'</span><span style="color: #000000">, _p1, _content;</span></span>
<span class="line"><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #6A9955">//</span></span>
<span class="line"><span style="color: #6A9955">// Configure endpoint from example_function function to bind parameter _content from request body</span></span>
<span class="line"><span style="color: #6A9955">//</span></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">EndpointCreated</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">endpoint</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">==</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"example_function"</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">endpoint</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> { </span><span style="color: #9CDCFE">BodyParameterName</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"_content"</span><span style="color: #E6E6E6"> };</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">endpoint</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #008000">//</span></span>
<span class="line"><span style="color: #008000">// Configure endpoint from example_function function to bind parameter _content from request body</span></span>
<span class="line"><span style="color: #008000">//</span></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">EndpointCreated</span><span style="color: #000000"> = (</span><span style="color: #001080">routine</span><span style="color: #000000">, </span><span style="color: #001080">endpoint</span><span style="color: #000000">) =></span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">routine</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000"> == </span><span style="color: #A31515">"example_function"</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">endpoint</span><span style="color: #000000"> </span><span style="color: #0000FF">with</span><span style="color: #000000"> { </span><span style="color: #001080">BodyParameterName</span><span style="color: #000000"> = </span><span style="color: #A31515">"_content"</span><span style="color: #000000"> };</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">endpoint</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><p>Note that this would also work if we used converted parameter name <code>content</code> (assuming we use the default converter that converts names to lower camel case).</p><p>This value is also configurable with comment annotations:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">comment on function example_function(int, text) is </span><span style="color: #CE9178">'</span></span>
<span class="line"><span style="color: #CE9178">HTTP</span></span>
<span class="line"><span style="color: #CE9178">body-param-name content</span></span>
<span class="line"><span style="color: #CE9178">'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">comment on function example_function(int, text) is </span><span style="color: #A31515">'</span></span>
<span class="line"><span style="color: #A31515">HTTP</span></span>
<span class="line"><span style="color: #A31515">body-param-name content</span></span>
<span class="line"><span style="color: #A31515">'</span><span style="color: #000000">;</span></span></code></pre></div><p>In this comment annotation a keyword that comes before the parameter name could be any of these: <code>BodyParameterMame</code>, <code>body-parameter-name</code>, <code>body_parameter_name</code>, <code>BodyParamMame</code>, <code>body-param-name</code> or <code>body_param_name</code>.</p><hr><h2 id="version-110-2024-19-01">Version 1.1.0 (2024-19-01)<a class="anchor bookmark-target" href="#version-110-2024-19-01"><i class="bi bi-link-45deg"></i></a></h2><h3 id="1-routineendpoint-type-change">1) RoutineEndpoint Type Change<a class="anchor bookmark-target" href="#1-routineendpoint-type-change"><i class="bi bi-link-45deg"></i></a></h3><p><code>RoutineEndpoint</code> type changed to <code>readonly record struct</code></p><p>This allows for the manipulation of the endpoint parameter in the <code>EndpointCreated</code> callback event.</p><p>This is useful to force certain endpoint configurations from the code, rather than through comment annotations.</p><p>Example:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">EndpointCreated</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">endpoint</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">SecurityType</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">==</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">SecurityType</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Definer</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #6A9955">            // filter out routines that can run as the definer user (this is usually superuser)</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equals</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"get_data"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">StringComparison</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ordinal</span><span style="color: #E6E6E6">))</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #6A9955">            // override the default response content type to be csv and don't rquire authorization </span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">endpoint</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">with</span></span>
<span class="line"><span style="color: #E6E6E6">            { </span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">RequiresAuthorization</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">false</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">ResponseContentType</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"text/csv"</span></span>
<span class="line"><span style="color: #E6E6E6">            };</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #6A9955">        // require authorization for all endpoints and force GET method</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">endpoint</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> { </span><span style="color: #9CDCFE">RequiresAuthorization</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">Method</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Method</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">GET</span><span style="color: #E6E6E6"> };</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">EndpointCreated</span><span style="color: #000000"> = (</span><span style="color: #001080">routine</span><span style="color: #000000">, </span><span style="color: #001080">endpoint</span><span style="color: #000000">) =></span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">routine</span><span style="color: #000000">.</span><span style="color: #001080">SecurityType</span><span style="color: #000000"> == </span><span style="color: #001080">SecurityType</span><span style="color: #000000">.</span><span style="color: #001080">Definer</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #008000">            // filter out routines that can run as the definer user (this is usually superuser)</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #0000FF">string</span><span style="color: #000000">.</span><span style="color: #795E26">Equals</span><span style="color: #000000">(</span><span style="color: #001080">routine</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000">, </span><span style="color: #A31515">"get_data"</span><span style="color: #000000">, </span><span style="color: #001080">StringComparison</span><span style="color: #000000">.</span><span style="color: #001080">Ordinal</span><span style="color: #000000">))</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #008000">            // override the default response content type to be csv and don't rquire authorization </span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">endpoint</span><span style="color: #000000"> </span><span style="color: #0000FF">with</span></span>
<span class="line"><span style="color: #000000">            { </span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">RequiresAuthorization</span><span style="color: #000000"> = </span><span style="color: #0000FF">false</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">ResponseContentType</span><span style="color: #000000"> = </span><span style="color: #A31515">"text/csv"</span></span>
<span class="line"><span style="color: #000000">            };</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #008000">        // require authorization for all endpoints and force GET method</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #001080">endpoint</span><span style="color: #000000"> </span><span style="color: #0000FF">with</span><span style="color: #000000"> { </span><span style="color: #001080">RequiresAuthorization</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000">, </span><span style="color: #001080">Method</span><span style="color: #000000"> = </span><span style="color: #001080">Method</span><span style="color: #000000">.</span><span style="color: #001080">GET</span><span style="color: #000000"> };</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><h3 id="2-new-event-option-endpointscreated">2) New Event Option EndpointsCreated<a class="anchor bookmark-target" href="#2-new-event-option-endpointscreated"><i class="bi bi-link-45deg"></i></a></h3><p><code>EndpointsCreated</code> option event:</p><ul><li><p>If defined (not null) - will be executed after all endpoints have been created and are ready for execution. This happens during the build phase.</p></li><li><p>Receives one immutable parameter array of routine and e+ndpioint tuples: <code>(Routine routine, RoutineEndpoint endpoint)[]</code>.</p></li><li><p>The option has the following signature: <code>public Action&lt;(Routine routine, RoutineEndpoint endpoint)[]>? EndpointsCreated { get; set; }</code>.</p></li><li><p>Example:</p></li></ul><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">EndpointsCreated</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">endpoints</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">foreach</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">endpoint</span><span style="color: #E6E6E6">) </span><span style="color: #C586C0">in</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">endpoints</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #9CDCFE">Console</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">WriteLine</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">$"{</span><span style="color: #9CDCFE">routine</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">Type</span><span style="color: #CE9178">} {</span><span style="color: #9CDCFE">routine</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">Schema</span><span style="color: #CE9178">}.{</span><span style="color: #9CDCFE">routine</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">Signature</span><span style="color: #CE9178">} is mapped to {</span><span style="color: #9CDCFE">endpoint</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">Method</span><span style="color: #CE9178">} {</span><span style="color: #9CDCFE">endpoint</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">Url</span><span style="color: #CE9178">}"</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">EndpointsCreated</span><span style="color: #000000"> = (</span><span style="color: #001080">endpoints</span><span style="color: #000000">) =></span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">foreach</span><span style="color: #000000"> (</span><span style="color: #0000FF">var</span><span style="color: #000000"> (</span><span style="color: #001080">routine</span><span style="color: #000000">, </span><span style="color: #001080">endpoint</span><span style="color: #000000">) </span><span style="color: #AF00DB">in</span><span style="color: #000000"> </span><span style="color: #001080">endpoints</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #001080">Console</span><span style="color: #000000">.</span><span style="color: #795E26">WriteLine</span><span style="color: #000000">(</span><span style="color: #A31515">$"{</span><span style="color: #001080">routine</span><span style="color: #A31515">.</span><span style="color: #001080">Type</span><span style="color: #A31515">} {</span><span style="color: #001080">routine</span><span style="color: #A31515">.</span><span style="color: #001080">Schema</span><span style="color: #A31515">}.{</span><span style="color: #001080">routine</span><span style="color: #A31515">.</span><span style="color: #001080">Signature</span><span style="color: #A31515">} is mapped to {</span><span style="color: #001080">endpoint</span><span style="color: #A31515">.</span><span style="color: #001080">Method</span><span style="color: #A31515">} {</span><span style="color: #001080">endpoint</span><span style="color: #A31515">.</span><span style="color: #001080">Url</span><span style="color: #A31515">}"</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><p>This is useful in situations when we want to generate and create source code files based on generated endpoints such as Typescript or C# interfaces for example. It enables further automatic code generation based on generated endpoints.</p><h3 id="3-new-custom-logger-option">3) New Custom Logger Option<a class="anchor bookmark-target" href="#3-new-custom-logger-option"><i class="bi bi-link-45deg"></i></a></h3><p>There is a new option called <code>Logger</code> with the following signature: <code>public ILogger? Logger { get; set; }</code></p><p>When provided (not null), this is the logger that will be used by default for all logging. You can use this to provide a custom logging implementation:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">Logger</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">EmptyLogger</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">EmptyLogger</span><span style="color: #E6E6E6"> : </span><span style="color: #4EC9B0">ILogger</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">IDisposable</span><span style="color: #E6E6E6">? </span><span style="color: #DCDCAA">BeginScope</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">TState</span><span style="color: #E6E6E6">>(</span><span style="color: #4EC9B0">TState</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">state</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">TState</span><span style="color: #E6E6E6"> : </span><span style="color: #4EC9B0">notnull</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">throw</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NotImplementedException</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">bool</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">IsEnabled</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">LogLevel</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">logLevel</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">void</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">Log</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">TState</span><span style="color: #E6E6E6">>(</span><span style="color: #4EC9B0">LogLevel</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">logLevel</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">EventId</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">eventId</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">TState</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">state</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">Exception</span><span style="color: #E6E6E6">? </span><span style="color: #9CDCFE">exception</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">Func</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">TState</span><span style="color: #E6E6E6">, </span><span style="color: #4EC9B0">Exception</span><span style="color: #E6E6E6">?, </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">> </span><span style="color: #9CDCFE">formatter</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #6A9955">        // empty</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">Logger</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">EmptyLogger</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">EmptyLogger</span><span style="color: #000000"> : </span><span style="color: #267F99">ILogger</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">IDisposable</span><span style="color: #000000">? </span><span style="color: #795E26">BeginScope</span><span style="color: #000000">&lt;</span><span style="color: #267F99">TState</span><span style="color: #000000">>(</span><span style="color: #267F99">TState</span><span style="color: #000000"> </span><span style="color: #001080">state</span><span style="color: #000000">) </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #267F99">TState</span><span style="color: #000000"> : </span><span style="color: #267F99">notnull</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">throw</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">NotImplementedException</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">bool</span><span style="color: #000000"> </span><span style="color: #795E26">IsEnabled</span><span style="color: #000000">(</span><span style="color: #267F99">LogLevel</span><span style="color: #000000"> </span><span style="color: #001080">logLevel</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">true</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">void</span><span style="color: #000000"> </span><span style="color: #795E26">Log</span><span style="color: #000000">&lt;</span><span style="color: #267F99">TState</span><span style="color: #000000">>(</span><span style="color: #267F99">LogLevel</span><span style="color: #000000"> </span><span style="color: #001080">logLevel</span><span style="color: #000000">, </span><span style="color: #267F99">EventId</span><span style="color: #000000"> </span><span style="color: #001080">eventId</span><span style="color: #000000">, </span><span style="color: #267F99">TState</span><span style="color: #000000"> </span><span style="color: #001080">state</span><span style="color: #000000">, </span><span style="color: #267F99">Exception</span><span style="color: #000000">? </span><span style="color: #001080">exception</span><span style="color: #000000">, </span><span style="color: #267F99">Func</span><span style="color: #000000">&lt;</span><span style="color: #267F99">TState</span><span style="color: #000000">, </span><span style="color: #267F99">Exception</span><span style="color: #000000">?, </span><span style="color: #0000FF">string</span><span style="color: #000000">> </span><span style="color: #001080">formatter</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #008000">        // empty</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><hr></div></div><div class="rightside svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">on this page</span><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="changelog" title="Changelog"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#changelog">Changelog</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="version-162-2024-02-03" title="Version 1.6.2 (2024-02-03)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-162-2024-02-03">Version 1.6.2 (2024-02-03)</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="version-161-2024-02-02" title="Version 1.6.1 (2024-02-02)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-161-2024-02-02">Version 1.6.1 (2024-02-02)</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="1-smaller-options-tweaks" title="1) Smaller Options Tweaks"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-smaller-options-tweaks">1) Smaller Options Tweaks</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="2-logging-improvements" title="2) Logging Improvements"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-logging-improvements">2) Logging Improvements</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="3-logcommands-includes-request-info" title="3) LogCommands Includes Request Info"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-logcommands-includes-request-info">3) LogCommands Includes Request Info</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="3-fix-using-identifiers" title="3) Fix Using Identifiers"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-fix-using-identifiers">3) Fix Using Identifiers</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="4-other-changes" title="4) Other Changes"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#4-other-changes">4) Other Changes</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="version-160-2024-28-01" title="Version 1.6.0 (2024-28-01)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-160-2024-28-01">Version 1.6.0 (2024-28-01)</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="1-http-file-improvements" title="1) HTTP File Improvements"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-http-file-improvements">1) HTTP File Improvements</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="2-comment-annotation-breaking-change" title="2) Comment Annotation Breaking Change"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-comment-annotation-breaking-change">2) Comment Annotation Breaking Change</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="3-logging-commands" title="3) Logging Commands"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-logging-commands">3) Logging Commands</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="3-command-callback" title="3) Command Callback"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-command-callback">3) Command Callback</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="version-151-2024-27-01" title="Version 1.5.1 (2024-27-01)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-151-2024-27-01">Version 1.5.1 (2024-27-01)</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="version-150-2024-27-01" title="Version 1.5.0 (2024-27-01)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-150-2024-27-01">Version 1.5.0 (2024-27-01)</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="1-new-feature-strict-function-support" title="1) New Feature: Strict Function Support"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-new-feature-strict-function-support">1) New Feature: Strict Function Support</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="2-other-improvements" title="2) Other Improvements"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-other-improvements">2) Other Improvements</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="version-140-2024-26-01" title="Version 1.4.0 (2024-26-01)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-140-2024-26-01">Version 1.4.0 (2024-26-01)</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="1-improved-untyped-functions" title="1) Improved Untyped Functions"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-improved-untyped-functions">1) Improved Untyped Functions</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="2-improved-logging" title="2) Improved Logging"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-improved-logging">2) Improved Logging</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="version-130-2024-23-01" title="Version 1.3.0 (2024-23-01)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-130-2024-23-01">Version 1.3.0 (2024-23-01)</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="1-support-for-variadic-parameters" title="1) Support For Variadic Parameters"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-support-for-variadic-parameters">1) Support For Variadic Parameters</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="2-support-for-table-valued-functions" title="2) Support For Table-Valued Functions"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-support-for-table-valued-functions">2) Support For Table-Valued Functions</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="2-support-for-untyped-functions" title="2) Support for Untyped Functions"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-support-for-untyped-functions">2) Support for Untyped Functions</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="version-120-2024-22-01" title="Version 1.2.0 (2024-22-01)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-120-2024-22-01">Version 1.2.0 (2024-22-01)</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="1-fix-aot-warnings" title="1) Fix AOT Warnings"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-fix-aot-warnings">1) Fix AOT Warnings</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="1-jsonify-strings" title="1) JSONify Strings"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-jsonify-strings">1) JSONify Strings</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="2-http-file-endpoint" title="2) HTTP file endpoint"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-http-file-endpoint">2) HTTP file endpoint</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="3-configuration-get-value-from-string" title="3) Configuration Get Value From String"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-configuration-get-value-from-string">3) Configuration Get Value From String</a></li><li class="nav-item toc3 mt-2 right svelte-9zwk14 bookmark-nav" data-id="2-fix-arrays-encodings-in-http-files" title="2) Fix Arrays Encodings In Http Files"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-fix-arrays-encodings-in-http-files">2) Fix Arrays Encodings In Http Files</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="3-changed-method-type-logic" title="3) Changed Method Type Logic"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-changed-method-type-logic">3) Changed Method Type Logic</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="4-url-path-handling-changes" title="4) URL Path Handling Changes"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#4-url-path-handling-changes">4) URL Path Handling Changes</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="5-fix-sending-request-headers-with-parameter" title="5) Fix Sending Request Headers With Parameter"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#5-fix-sending-request-headers-with-parameter">5) Fix Sending Request Headers With Parameter</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="6-sending-request-headers-parameter-defaults" title="6) Sending Request Headers Parameter Defaults"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#6-sending-request-headers-parameter-defaults">6) Sending Request Headers Parameter Defaults</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="7-new-feature-body-parameter-name" title="7) New Feature: Body Parameter Name"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#7-new-feature-body-parameter-name">7) New Feature: Body Parameter Name</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="version-110-2024-19-01" title="Version 1.1.0 (2024-19-01)"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#version-110-2024-19-01">Version 1.1.0 (2024-19-01)</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="1-routineendpoint-type-change" title="1) RoutineEndpoint Type Change"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-routineendpoint-type-change">1) RoutineEndpoint Type Change</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="2-new-event-option-endpointscreated" title="2) New Event Option EndpointsCreated"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-new-event-option-endpointscreated">2) New Event Option EndpointsCreated</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="3-new-custom-logger-option" title="3) New Custom Logger Option"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-new-custom-logger-option">3) New Custom Logger Option</a></li></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],o=document.querySelectorAll("div.code"),k=i.querySelector(".home");function E(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n])}function T(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n]);E(e,t),e.classList.add(t)}function t(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",o=0;o<n.classList.length;o++)if(n.classList[o].startsWith("bi-")){i=n.classList[o];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}"/"==document.location.pathname&&T(k,"d-none");var e=document.querySelector(".post-share > .copy-url"),n=(e&&e.addEventListener("click",function(e){t(e,function(e,t){navigator.clipboard.writeText(document.location.origin+document.location.pathname),t()})}),document.getElementsByTagName("html")[0]),a=i.querySelector("#theme-btn"),s="theme";function l(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<o.length;n++){var i=o[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e){t(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function c(e){t(e,function(e,t){var n=localStorage.getItem(s);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(s)?"light":"dark";localStorage.setItem(s,e),l(n.dataset.bsTheme=e)}),l(localStorage.getItem(s)),a.children[0].classList.remove("hidden");for(var d=0;d<o.length;d++)o[d].getElementsByClassName("copy-code")[0].addEventListener("click",r),o[d].getElementsByClassName("photo-code")[0].addEventListener("click",c);for(var S=function(){var a,o,s;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.querySelector(".main-content").querySelectorAll("[id]"),o=void 0,this.initNavs=function(e){s=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,o=0;o<s.length;o++)if(s[o].dataset.id==n){i=s[o];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(l(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),r()},f.children[1].addEventListener("scroll",r),this;function l(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function r(){if(s&&s.length){for(var e=0;e<s.length;e++)s[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=l(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),o&&clearTimeout(o),void(o=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),o=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),o&&clearTimeout(o),o=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),o=void 0},250))}}}(),m=function(){var l,r=i.querySelector("#nav-btn"),c=480,d="200px",m="0.25fr",h=730,v=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],t="sidebar-pinned",p=null==localStorage.getItem(t)||"true"==localStorage.getItem(t),y=!1,b=!1;function n(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?y?"100%":"0":p?""+d:"0",i=`grid-template-columns: ${n} 1fr`,o=t&&y?"width: 100%":"0"!=n?"":"display: none",a=t&&y?"display: none":"",s=t?y?"sidebar-show":"sidebar-hide":p?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(m&&h&&v&&(n&&e<v||!n&&e<h?b||(u.innerHTML=l+g.innerHTML,S.initNavs(u),b=!0):b&&(u.innerHTML=l,S.initNavs(g),b=!1)),!m||t||b?(i+=";",f.children[2].style.display="none"):(i+=` ${m};`,f.children[2].style.display="")),T(r,!t&&p||t&&y?"rotate":"rotate-back","rotate","rotate-back"),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),f.style=L?i:"display: grid;",L&&T(L,s,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=o),w.style=a,t&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),t&&y&&T(k,"d-none")}function e(){var e=window.outerWidth<c;e?y=!y:p=!p,localStorage.setItem(t,p.toString()),n(),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),e&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),e&&y&&T(k,"d-none")}return m&&h&&v&&g&&(l=u.innerHTML,S.initNavs(g)),r.addEventListener("click",e),(window.onresize=n)(),this.closeSidebar=function(){window.outerWidth<c&&y&&e()},this}(),h=document.getElementsByClassName("auto-close"),v=0;v<h.length;v++)h[v].addEventListener("click",function(e){m.closeSidebar()});location.hash&&(e=document.getElementById(location.hash.replace("#","")))&&e.scrollIntoView()}();</script><script src="/bootstrap.bundle.min.js"></script><script>!function(){for(var e=document.querySelectorAll('[data-bs-toggle="tooltip"]'),t=0;t<e.length;t++)new bootstrap.Tooltip(e[t]);var n=document.getElementsByClassName("accordion-item");if(n.length){for(t=0;t<n.length;t++){var o=n[t];o.querySelectorAll("[href='"+document.location.pathname+"']").length&&o.firstChild.click()}var l=document.querySelector("nav.navbar").querySelector(".home"),a=document.getElementsByClassName("accordion");"/"==document.location.pathname&&l.classList.add("d-none");for(t=0;t<n.length;t++){var s=a[t];s&&s.firstChild&&"VB-Consulting"==s.firstChild.title&&(null!=s.firstChild.querySelector(".collapse")&&l.classList.contains("d-none")&&"/"!=document.location.pathname&&l.classList.remove("d-none"),s.addEventListener("show.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none"),l.classList.add("d-none")}),s.addEventListener("hide.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none")}))}}}();</script><script src="/html2canvas.min.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script></body><script async data-id="101435862" src="//static.getclicky.com/js"></script></html>