<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NpgsqlRest Performances - Automatic REST API for PostgreSQL Database as .NET8 Middleware</title><meta name="description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><meta name="keywords" content="api, api-rest, restful-api, http, postgres, dotnet, net8, c#, aot, database, rest, server, postgresql, npgsqlrest, pgsql, pg, automatic"><link href="https://vb-consulting.github.io//npgsqlrest/performances/" rel="canonical"><link rel="stylesheet" href="/_elderjs/assets/svelte-e0e6468f.css" media="all"><style></style><link href="/style.css?1719994161960" rel="stylesheet"><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script></head><body class="d-flex flex-column h-100"><header id="header"><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-30jr7w"><div class="container-fluid flex-nowrap svelte-30jr7w"><div class="d-flex svelte-30jr7w"><button id="nav-btn" type="button" class="d-flex btn btn-sm logo animate-rotate svelte-30jr7w"><i class="material-icons-outlined">menu</i></button> <a class="nav-link my-auto ms-2 fw-semibold home svelte-30jr7w" href="/"><i class="bi-chevron-double-left"></i> VB Home</a></div><div class="d-flex right svelte-30jr7w"><a class="nav-link my-auto svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="Become a Patreon" href="https://www.patreon.com/vbconsulting" target="_blank"><div class="patreon"></div></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><a class="nav-link my-auto svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="Buy Me a Coffee" href="https://www.buymeacoffee.com/vbilopavu" target="_blank"><div class="bmc"></div></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><a class="nav-link my-auto me-2 svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="readme.md on GitHub" href="https://github.com/vb-consulting/NpgsqlRest/blob/master/PerfomanceTests/readme.md"><i class="bi-github"></i></a> <a class="github-button svelte-30jr7w" href="https://github.com/vb-consulting/NpgsqlRest/blob/master/PerfomanceTests/readme.md" data-bs-toggle="tooltip" data-bs-html="true" title="Star readme.md on GitHub" data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;" data-icon="octicon-star" data-show-count="true" aria-label="Star readme.md on GitHub"></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><button id="theme-btn" type="button" aria-pressed="true" aria-label="theme" class="svelte-30jr7w"><span class="check hidden svelte-30jr7w"><span class="icon svelte-30jr7w"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><path fill="currentColor" d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M0 0h24v24H0z"></path><path fill="currentColor" d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class="svelte-9zwk14"><div class="sidebar sidebar-hide svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav accordion svelte-9zwk14"><li class="accordion-item svelte-9zwk14" title="VB-Consulting"><button class="accordion-header accordion-button collapsed svelte-9zwk14 text-uppercase" href="/" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-vb-consulting" aria-expanded="false" aria-controls="accordion-vb-consulting">VB-Consulting</button><div id="accordion-vb-consulting" class="accordion-collapse collapse"><div class="accordion-body svelte-9zwk14"><ul class="navbar-nav"><li class="nav-item svelte-9zwk14" data-id="" title="Home"><a class="nav-link svelte-9zwk14 text-uppercase" href="/">Home</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="Norm.Net"><a class="nav-link svelte-9zwk14 text-uppercase" href="/norm.net/">Norm.Net</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="RazorSvelte"><a class="nav-link svelte-9zwk14 text-uppercase" href="/razorsvelte/">RazorSvelte</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PgRoutiner"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pgroutiner/">PgRoutiner</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="XUnit.Npgsql"><a class="nav-link svelte-9zwk14 text-uppercase" href="/xunit.npgsql/">XUnit.Npgsql</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="pgmigrations"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pgmigrations/">pgmigrations</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PostrgeSQL Schema Tools"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pg_schema_tools/">PostrgeSQL Schema Tools</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">blogs</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="<span class='btn-link'>ALL BLOGS</span>"><a class="nav-link btn btn-sm w-fit px-3 mx-auto svelte-9zwk14 lr-arrow text-uppercase" href="/blogs/"><i class="bi bi-arrow-right-circle svelte-9zwk14"></i> <span class="btn-link">ALL BLOGS</span></a></li><li class="nav-item svelte-9zwk14" data-id="" title="Unit Testing and TDD With PostgreSQL is Easy"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/unit-testing-postgresql/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Unit Testing and TDD With PostgreSQL is Easy</a></li><li class="nav-item svelte-9zwk14" data-id="" title="From Transaction Scripts and Domain Model to SQL"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/domain-model-transaction-script/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>From Transaction Scripts and Domain Model to SQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Transaction Script DDD vs SQL"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/transaction-script/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Transaction Script DDD vs SQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Common Sense Software Design"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/common-sense-design/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Common Sense Software Design</a></li><li class="nav-item svelte-9zwk14" data-id="" title="NpgsqlRest v2 Update üêòüî•"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-v2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest v2 Update üêòüî•</a></li><li class="nav-item svelte-9zwk14" data-id="" title="NpgsqlRest Update 1.6.2"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-update1.6.2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest Update 1.6.2</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL Arrays üêò"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-array/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PostgreSQL Arrays üêò</a></li><li class="nav-item svelte-9zwk14" data-id="" title="How DDD is screwing up your SQL"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/sql-vs-ddd/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>How DDD is screwing up your SQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL Paging Benchmarks"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-paging/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PostgreSQL Paging Benchmarks</a></li><li class="nav-item svelte-9zwk14" data-id="" title="NpgsqlRest NuGet Library"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest NuGet Library</a></li></ul></div></div></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">NpgsqlRest</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/">NpgsqlRest</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="options"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/options/">options</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="annotations"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/annotations/">annotations</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="login endpoints"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/login-endpoints/">login endpoints</a></li><li class="nav-item toc2 svelte-9zwk14 active" data-id="" title="performances"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/performances/">performances</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="changelog"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/changelog/">changelog</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">client app</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="client"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/client/">client</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="client npm package"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/client-npm/">client npm package</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="client default config"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/config/">client default config</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">plugins</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest CrudSource"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/crudsource/">NpgsqlRest CrudSource</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest HttpFiles"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/httpfiles/">NpgsqlRest HttpFiles</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest TsClient"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/tsclient/">NpgsqlRest TsClient</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">articles</span><hr class="svelte-9zwk14"></li><li class="nav-item svelte-9zwk14" data-id="" title="NpgsqlRest NuGet Library"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest NuGet Library</a></li><li class="nav-item svelte-9zwk14" data-id="" title="NpgsqlRest v2 Update üêòüî•"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-v2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest v2 Update üêòüî•</a></li><li class="nav-item svelte-9zwk14" data-id="" title="NpgsqlRest Update 1.6.2"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-update1.6.2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest Update 1.6.2</a></li></ul></div></div><div class="content svelte-9zwk14"><div class="container-sm main-content gh-content"><h1 id="performance-tests">Performance Tests<a class="anchor bookmark-target" href="#performance-tests"><i class="bi bi-link-45deg"></i></a></h1><a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/PerfomanceTests/readme.md" class="github-edit"><i class="bi bi-github"></i>Edit this page on GitHub</a><p>This directory contains files required for performance tests with the <a href="https://k6.io/">Grafana K6</a> REST API load and performance testing tool.</p><p>Used API's are from:</p><ul><li>Latest version 2.0.0 <a href="https://github.com/vb-consulting/NpgsqlRest/tree/master/AotBuildTemplate">NpgsqlRest AOT build</a>.</li><li><a href="https://github.com/PostgREST/postgrest/releases/tag/v12.0.2">PostgREST 12.0.2</a></li></ul><h2 id="files">Files<a class="anchor bookmark-target" href="#files"><i class="bi bi-link-45deg"></i></a></h2><ul><li><code>appsettings.json</code> - configuration for NpgsqlRest used in testing.</li><li><code>k6-api-tests.js</code> - K6 testing script.</li><li><code>perf_tests_script.sql</code> - database script that creates functions that are tested.</li><li><code>perf_tests.http</code> - HTTP file for smoke tests for both systems.</li><li><code>postgrest.conf</code> - PostgREST configuration file used in testing.</li><li><code>readme.md</code> - this file.</li><li><code>test-script.sh</code> - shell script that orchestrates and runs all tests.</li><li><code>results</code> - directory with the raw dump of text files from the testing session.</li></ul><h2 id="results">Results<a class="anchor bookmark-target" href="#results"><i class="bi bi-link-45deg"></i></a></h2><p>The number of successful requests executed by the K6 (see the <code>k6-api-tests.js</code> file in this dir):</p><ul><li>Duration of 60 seconds.</li><li>100 simultaneous virtual users.</li><li>Retrieval of 10 and 100 records.</li></ul><p>Numbers represent an overall number of successful requests (higher is better).</p><table class="table table-hover table-sm table-responsive-sm table-striped table-bordered"><thead><tr><th align="right">Records</th><th align="right">Function</th><th align="right">AOT <a href="#1-aot">1</a></th><th align="right">JIT <a href="#2-jit">2</a></th><th align="right">PostgREST</th><th align="right">Ratio (AOT / PostgREST)</th><th align="right">Ratio (JIT / PostgREST)</th></tr></thead><tbody class="table-group-divider"><tr><td align="right">10</td><td align="right"><code>perf_test</code></td><td align="right">781,803</td><td align="right">562,304</td><td align="right">72,305</td><td align="right">10.81</td><td align="right">7.78</td></tr><tr><td align="right">100</td><td align="right"><code>perf_test</code></td><td align="right">307,427</td><td align="right">303,692</td><td align="right">40,456</td><td align="right">7.60</td><td align="right">7.51</td></tr><tr><td align="right">10</td><td align="right"><code>perf_test_arrays</code></td><td align="right">495,190</td><td align="right">384,090</td><td align="right">55,331</td><td align="right">8.95</td><td align="right">6.94</td></tr><tr><td align="right">100</td><td align="right"><code>perf_test_arrays</code></td><td align="right">124,912</td><td align="right">127,707</td><td align="right">32,418</td><td align="right">3.85</td><td align="right">3.94</td></tr><tr><td align="right">10</td><td align="right"><code>perf_test_record</code></td><td align="right">642,772</td><td align="right">561,855</td><td align="right">61,825</td><td align="right">10.40</td><td align="right">9.09</td></tr><tr><td align="right">100</td><td align="right"><code>perf_test_record</code></td><td align="right">216,775</td><td align="right">227,297</td><td align="right">36,642</td><td align="right">5.92</td><td align="right">6.20</td></tr><tr><td align="right">10</td><td align="right"><code>perf_test_record_arrays</code></td><td align="right">448,273</td><td align="right">403,900</td><td align="right">50,579</td><td align="right">8.86</td><td align="right">7.99</td></tr><tr><td align="right">100</td><td align="right"><code>perf_test_record_arrays</code></td><td align="right">100,485</td><td align="right">112,989</td><td align="right">32,619</td><td align="right">3.08</td><td align="right">3.46</td></tr></tbody></table><h3 id="other-platforms">Other Platforms<a class="anchor bookmark-target" href="#other-platforms"><i class="bi bi-link-45deg"></i></a></h3><table class="table table-hover table-sm table-responsive-sm table-striped table-bordered"><thead><tr><th align="right">Records</th><th align="right">Function</th><th align="right">AOT <a href="#1-aot">1</a></th><th align="right">JIT <a href="#2-jit">2</a></th><th align="right">EF <a href="#3-ef">3</a></th><th align="right">ADO <a href="#4-ado">4</a></th><th align="right">Django <a href="#5-django">5</a></th><th align="right">Express <a href="#6-express">6</a></th><th align="right">GO <a href="#7-go">7</a></th><th align="right">FastAPI <a href="#8-fastapi">8</a></th></tr></thead><tbody class="table-group-divider"><tr><td align="right">10</td><td align="right"><code>perf_test</code></td><td align="right">781,803</td><td align="right">562,304</td><td align="right">337,612</td><td align="right">440,896</td><td align="right">21,193</td><td align="right">160,241</td><td align="right">78,530</td><td align="right">13,650</td></tr><tr><td align="right">100</td><td align="right"><code>perf_test</code></td><td align="right">307,427</td><td align="right">303,692</td><td align="right">235,331</td><td align="right">314,198</td><td align="right">18,345</td><td align="right">58,130</td><td align="right">55,119</td><td align="right">9,666</td></tr><tr><td align="right">10</td><td align="right"><code>perf_test_arrays</code></td><td align="right">495,190</td><td align="right">384,090</td><td align="right">254,787</td><td align="right">309,059</td><td align="right">19,011</td><td align="right">91,987</td><td align="right">N/A</td><td align="right">11,881</td></tr><tr><td align="right">100</td><td align="right"><code>perf_test_arrays</code></td><td align="right">124,912</td><td align="right">127,707</td><td align="right">113,663</td><td align="right">130,471</td><td align="right">11,452</td><td align="right">17,896</td><td align="right">N/A</td><td align="right">6,192</td></tr></tbody></table><h3 id="consolidated-results">Consolidated Results<a class="anchor bookmark-target" href="#consolidated-results"><i class="bi bi-link-45deg"></i></a></h3><table class="table table-hover table-sm table-responsive-sm table-striped table-bordered"><thead><tr><th>Platform</th><th align="right">10 Records</th><th align="right">100 Records</th></tr></thead><tbody class="table-group-divider"><tr><td><strong>AOT</strong> is an ahead-of-time native compilation of <code>NpgsqlRest</code>. <code>NpgsqlRest</code> compiled to the native binary.</td><td align="right"><strong>781,803</strong></td><td align="right"><strong>307,427</strong></td></tr><tr><td><strong>JIT</strong> is a just-in-time compilation of <code>NpgsqlRest</code> to NET8 CLR (Common Language Runtime) on NET8 runtime.</td><td align="right"><strong>562,304</strong></td><td align="right"><strong>303,692</strong></td></tr><tr><td><strong>ADO</strong> is NET8 Raw ADO Data Reader approach. <a href="#4-ado">Source</a></td><td align="right">440,896</td><td align="right">314,198</td></tr><tr><td><strong>EF</strong> is Entity Framework Core 8 on NET8 runtime. <a href="#3-ef">Source</a></td><td align="right">337,612</td><td align="right">235,331</td></tr><tr><td><strong>PostgREST</strong> version 12.0.2</td><td align="right">72,305</td><td align="right">40,456</td></tr><tr><td><strong>Django</strong> REST Framework 4.2.10 on Python 3.8 <a href="5-django">Source Link</a></td><td align="right">21,193</td><td align="right">18,345</td></tr><tr><td><strong>Express</strong> on NodeJS v20.11.1, express v4.18.3, pg 8.11.3 <a href="#6-express">Source Link</a></td><td align="right">160,241</td><td align="right">55,119</td></tr><tr><td><strong>GO</strong> version go1.13.8 <a href="#7-go">Source Link</a></td><td align="right">78,530</td><td align="right">55,119</td></tr><tr><td><strong>FastAPI</strong> version 0.110.0 on Python 3.8 <a href="#8-fastapi">Source Link</a></td><td align="right">13,650</td><td align="right">9,666</td></tr></tbody></table><h4 id="1-aot">1) AOT<a class="anchor bookmark-target" href="#1-aot"><i class="bi bi-link-45deg"></i></a></h4><p>NpgsqlRest .NET8 AOT build is ahead-of-time (AOT) compiled to native code. AOT has an average <strong>startup time of between 180 to 200 milliseconds.</strong></p><h4 id="2-jit">2) JIT<a class="anchor bookmark-target" href="#2-jit"><i class="bi bi-link-45deg"></i></a></h4><p>NpgsqlRest JIT build is a Just-In-Time (JIT) compilation of Common Intermediate Language (CIL). JIT has an average <strong>startup time of between 360 to 400 milliseconds.</strong></p><h4 id="3-ef">3) EF<a class="anchor bookmark-target" href="#3-ef"><i class="bi bi-link-45deg"></i></a></h4><p>.NET8 Npgsql.EntityFrameworkCore.PostgreSQL 8.0.2</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">WebApplication</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">CreateBuilder</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">args</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #9CDCFE">AppContext</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">SetSwitch</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"Npgsql.EnableLegacyTimestampBehavior"</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Services</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddDbContext</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">DbContext</span><span style="color: #E6E6E6">>(</span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">options</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsql</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Build</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">MapPost</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/perf_test"</span><span style="color: #E6E6E6">, (</span><span style="color: #4EC9B0">DbContext</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">dbContext</span><span style="color: #E6E6E6">, [</span><span style="color: #9CDCFE">FromBody</span><span style="color: #E6E6E6">]</span><span style="color: #4EC9B0">Params</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">dbContext</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Database</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">SqlQuery</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Table</span><span style="color: #E6E6E6">>(</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(_records => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_records</span><span style="color: #CE9178">}, _text_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_text_param</span><span style="color: #CE9178">}, _int_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_int_param</span><span style="color: #CE9178">}, _ts_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_ts_param</span><span style="color: #CE9178">}, _bool_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_bool_param</span><span style="color: #CE9178">})"</span><span style="color: #E6E6E6">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">MapPost</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/perf_test_arrays"</span><span style="color: #E6E6E6">, (</span><span style="color: #4EC9B0">DbContext</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">dbContext</span><span style="color: #E6E6E6">, [</span><span style="color: #9CDCFE">FromBody</span><span style="color: #E6E6E6">]</span><span style="color: #4EC9B0">Params</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">dbContext</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Database</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">SqlQuery</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">TableWithArrays</span><span style="color: #E6E6E6">>(</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(_records => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_records</span><span style="color: #CE9178">}, _text_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_text_param</span><span style="color: #CE9178">}, _int_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_int_param</span><span style="color: #CE9178">}, _ts_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_ts_param</span><span style="color: #CE9178">}, _bool_param => {</span><span style="color: #9CDCFE">p</span><span style="color: #CE9178">.</span><span style="color: #9CDCFE">_bool_param</span><span style="color: #CE9178">})"</span><span style="color: #E6E6E6">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Run</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">builder</span><span style="color: #000000"> = </span><span style="color: #001080">WebApplication</span><span style="color: #000000">.</span><span style="color: #795E26">CreateBuilder</span><span style="color: #000000">(</span><span style="color: #001080">args</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #001080">AppContext</span><span style="color: #000000">.</span><span style="color: #795E26">SetSwitch</span><span style="color: #000000">(</span><span style="color: #A31515">"Npgsql.EnableLegacyTimestampBehavior"</span><span style="color: #000000">, </span><span style="color: #0000FF">true</span><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #001080">Services</span><span style="color: #000000">.</span><span style="color: #795E26">AddDbContext</span><span style="color: #000000">&lt;</span><span style="color: #267F99">DbContext</span><span style="color: #000000">>(</span><span style="color: #001080">options</span><span style="color: #000000"> => </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">options</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsql</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">app</span><span style="color: #000000"> = </span><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #795E26">Build</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">MapPost</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/perf_test"</span><span style="color: #000000">, (</span><span style="color: #267F99">DbContext</span><span style="color: #000000"> </span><span style="color: #001080">dbContext</span><span style="color: #000000">, [</span><span style="color: #001080">FromBody</span><span style="color: #000000">]</span><span style="color: #267F99">Params</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">) => </span><span style="color: #001080">dbContext</span><span style="color: #000000">.</span><span style="color: #001080">Database</span><span style="color: #000000">.</span><span style="color: #795E26">SqlQuery</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Table</span><span style="color: #000000">>(</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(_records => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_records</span><span style="color: #A31515">}, _text_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_text_param</span><span style="color: #A31515">}, _int_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_int_param</span><span style="color: #A31515">}, _ts_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_ts_param</span><span style="color: #A31515">}, _bool_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_bool_param</span><span style="color: #A31515">})"</span><span style="color: #000000">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">MapPost</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/perf_test_arrays"</span><span style="color: #000000">, (</span><span style="color: #267F99">DbContext</span><span style="color: #000000"> </span><span style="color: #001080">dbContext</span><span style="color: #000000">, [</span><span style="color: #001080">FromBody</span><span style="color: #000000">]</span><span style="color: #267F99">Params</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">) => </span><span style="color: #001080">dbContext</span><span style="color: #000000">.</span><span style="color: #001080">Database</span><span style="color: #000000">.</span><span style="color: #795E26">SqlQuery</span><span style="color: #000000">&lt;</span><span style="color: #267F99">TableWithArrays</span><span style="color: #000000">>(</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(_records => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_records</span><span style="color: #A31515">}, _text_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_text_param</span><span style="color: #A31515">}, _int_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_int_param</span><span style="color: #A31515">}, _ts_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_ts_param</span><span style="color: #A31515">}, _bool_param => {</span><span style="color: #001080">p</span><span style="color: #A31515">.</span><span style="color: #001080">_bool_param</span><span style="color: #A31515">})"</span><span style="color: #000000">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">Run</span><span style="color: #000000">();</span></span></code></pre></div><h4 id="4-ado">4) ADO<a class="anchor bookmark-target" href="#4-ado"><i class="bi bi-link-45deg"></i></a></h4><p>.NET8 Raw Data ADO Reader:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">WebApplication</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">CreateBuilder</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">args</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #9CDCFE">AppContext</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">SetSwitch</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"Npgsql.EnableLegacyTimestampBehavior"</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Build</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">MapPost</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/perf_test"</span><span style="color: #E6E6E6">, (</span><span style="color: #4EC9B0">DbContext</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">dbContext</span><span style="color: #E6E6E6">, [</span><span style="color: #9CDCFE">FromBody</span><span style="color: #E6E6E6">]</span><span style="color: #4EC9B0">Params</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Data</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetTableData</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">));</span></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">MapPost</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/perf_test_arrays"</span><span style="color: #E6E6E6">, (</span><span style="color: #4EC9B0">DbContext</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">dbContext</span><span style="color: #E6E6E6">, [</span><span style="color: #9CDCFE">FromBody</span><span style="color: #E6E6E6">]</span><span style="color: #4EC9B0">Params</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">=></span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Data</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetTableArrayData</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Run</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">static</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Data</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">static</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">IAsyncEnumerable</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Table</span><span style="color: #E6E6E6">> </span><span style="color: #DCDCAA">GetTableData</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">Params</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlConnection</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">OpenAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">CreateCommand</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">CommandText</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(@_records, @_text_param, @_int_param, @_ts_param, @_bool_param)"</span><span style="color: #E6E6E6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_records"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_records</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_text_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_text_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_int_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_int_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_ts_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_ts_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_bool_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_bool_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ExecuteReaderAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">while</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsync</span><span style="color: #E6E6E6">())</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">yield</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Table</span></span>
<span class="line"><span style="color: #E6E6E6">            {</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">id1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetInt32</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">foo1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetString</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">bar1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetString</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">datetime1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetDateTime</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">id2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetInt32</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">4</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">foo2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">5</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetString</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">5</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">bar2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">6</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetString</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">6</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">datetime2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetDateTime</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">7</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">long_foo_bar</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">8</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetString</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">8</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">is_foobar</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetBoolean</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">9</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">            };</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">static</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">IAsyncEnumerable</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">TableWithArrays</span><span style="color: #E6E6E6">> </span><span style="color: #DCDCAA">GetTableArrayData</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">Params</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlConnection</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">OpenAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">connection</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">CreateCommand</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">CommandText</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(@_records, @_text_param, @_int_param, @_ts_param, @_bool_param)"</span><span style="color: #E6E6E6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_records"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_records</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_text_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_text_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_int_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_int_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_ts_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_ts_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameters</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">AddWithValue</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"_bool_param"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">_bool_param</span><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ExecuteReaderAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">List</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">TableWithArrays</span><span style="color: #E6E6E6">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">while</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsync</span><span style="color: #E6E6E6">())</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">yield</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">TableWithArrays</span></span>
<span class="line"><span style="color: #E6E6E6">            {</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">id1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">foo1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">bar1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">datetime1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #4EC9B0">DateTime</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">id2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">4</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">4</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">foo2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">5</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">5</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">bar2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">6</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">6</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">datetime2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">7</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #4EC9B0">DateTime</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">7</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">long_foo_bar</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">8</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">8</span><span style="color: #E6E6E6">),</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #9CDCFE">is_foobar</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">IsDBNull</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">9</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">bool</span><span style="color: #E6E6E6">[])</span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">GetValue</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">9</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">            };</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">builder</span><span style="color: #000000"> = </span><span style="color: #001080">WebApplication</span><span style="color: #000000">.</span><span style="color: #795E26">CreateBuilder</span><span style="color: #000000">(</span><span style="color: #001080">args</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #001080">AppContext</span><span style="color: #000000">.</span><span style="color: #795E26">SetSwitch</span><span style="color: #000000">(</span><span style="color: #A31515">"Npgsql.EnableLegacyTimestampBehavior"</span><span style="color: #000000">, </span><span style="color: #0000FF">true</span><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">app</span><span style="color: #000000"> = </span><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #795E26">Build</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">MapPost</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/perf_test"</span><span style="color: #000000">, (</span><span style="color: #267F99">DbContext</span><span style="color: #000000"> </span><span style="color: #001080">dbContext</span><span style="color: #000000">, [</span><span style="color: #001080">FromBody</span><span style="color: #000000">]</span><span style="color: #267F99">Params</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">) => </span><span style="color: #001080">Data</span><span style="color: #000000">.</span><span style="color: #795E26">GetTableData</span><span style="color: #000000">(</span><span style="color: #001080">p</span><span style="color: #000000">));</span></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">MapPost</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/perf_test_arrays"</span><span style="color: #000000">, (</span><span style="color: #267F99">DbContext</span><span style="color: #000000"> </span><span style="color: #001080">dbContext</span><span style="color: #000000">, [</span><span style="color: #001080">FromBody</span><span style="color: #000000">]</span><span style="color: #267F99">Params</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">) => </span><span style="color: #001080">Data</span><span style="color: #000000">.</span><span style="color: #795E26">GetTableArrayData</span><span style="color: #000000">(</span><span style="color: #001080">p</span><span style="color: #000000">));</span></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">Run</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Data</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #267F99">IAsyncEnumerable</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Table</span><span style="color: #000000">> </span><span style="color: #795E26">GetTableData</span><span style="color: #000000">(</span><span style="color: #267F99">Params</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">connection</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlConnection</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">OpenAsync</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">command</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">CreateCommand</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">CommandText</span><span style="color: #000000"> = </span><span style="color: #A31515">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(@_records, @_text_param, @_int_param, @_ts_param, @_bool_param)"</span><span style="color: #000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_records"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_records</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_text_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_text_param</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_int_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_int_param</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_ts_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_ts_param</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_bool_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_bool_param</span><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #795E26">ExecuteReaderAsync</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">while</span><span style="color: #000000"> (</span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsync</span><span style="color: #000000">())</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">yield</span><span style="color: #000000"> </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">Table</span></span>
<span class="line"><span style="color: #000000">            {</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">id1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetInt32</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">foo1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetString</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">bar1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetString</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">datetime1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetDateTime</span><span style="color: #000000">(</span><span style="color: #098658">3</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">id2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetInt32</span><span style="color: #000000">(</span><span style="color: #098658">4</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">foo2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">5</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetString</span><span style="color: #000000">(</span><span style="color: #098658">5</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">bar2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">6</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetString</span><span style="color: #000000">(</span><span style="color: #098658">6</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">datetime2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetDateTime</span><span style="color: #000000">(</span><span style="color: #098658">7</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">long_foo_bar</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">8</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetString</span><span style="color: #000000">(</span><span style="color: #098658">8</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">is_foobar</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetBoolean</span><span style="color: #000000">(</span><span style="color: #098658">9</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">            };</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #267F99">IAsyncEnumerable</span><span style="color: #000000">&lt;</span><span style="color: #267F99">TableWithArrays</span><span style="color: #000000">> </span><span style="color: #795E26">GetTableArrayData</span><span style="color: #000000">(</span><span style="color: #267F99">Params</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">connection</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlConnection</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">OpenAsync</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">command</span><span style="color: #000000"> = </span><span style="color: #001080">connection</span><span style="color: #000000">.</span><span style="color: #795E26">CreateCommand</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">CommandText</span><span style="color: #000000"> = </span><span style="color: #A31515">$"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(@_records, @_text_param, @_int_param, @_ts_param, @_bool_param)"</span><span style="color: #000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_records"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_records</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_text_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_text_param</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_int_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_int_param</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_ts_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_ts_param</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #001080">Parameters</span><span style="color: #000000">.</span><span style="color: #795E26">AddWithValue</span><span style="color: #000000">(</span><span style="color: #A31515">"_bool_param"</span><span style="color: #000000">, </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">_bool_param</span><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #795E26">ExecuteReaderAsync</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">List</span><span style="color: #000000">&lt;</span><span style="color: #267F99">TableWithArrays</span><span style="color: #000000">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">while</span><span style="color: #000000"> (</span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsync</span><span style="color: #000000">())</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">yield</span><span style="color: #000000"> </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #267F99">TableWithArrays</span></span>
<span class="line"><span style="color: #000000">            {</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">id1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">int</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">0</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">foo1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">string</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">bar1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">string</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">2</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">datetime1</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">3</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #267F99">DateTime</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">3</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">id2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">4</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">int</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">4</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">foo2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">5</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">string</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">5</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">bar2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">6</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">string</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">6</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">datetime2</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">7</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #267F99">DateTime</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">7</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">long_foo_bar</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">8</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">string</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">8</span><span style="color: #000000">),</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #001080">is_foobar</span><span style="color: #000000"> = </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">IsDBNull</span><span style="color: #000000">(</span><span style="color: #098658">9</span><span style="color: #000000">) ? </span><span style="color: #0000FF">null</span><span style="color: #000000"> : (</span><span style="color: #0000FF">bool</span><span style="color: #000000">[])</span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">GetValue</span><span style="color: #000000">(</span><span style="color: #098658">9</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">            };</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><h4 id="5-django">5) Django<a class="anchor bookmark-target" href="#5-django"><i class="bi bi-link-45deg"></i></a></h4><p>Django REST Framework 4.2.10 on Python 3.8</p><div class="code python"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #C586C0">from</span><span style="color: #E6E6E6"> rest_framework.views </span><span style="color: #C586C0">import</span><span style="color: #E6E6E6"> APIView</span></span>
<span class="line"><span style="color: #C586C0">from</span><span style="color: #E6E6E6"> rest_framework.response </span><span style="color: #C586C0">import</span><span style="color: #E6E6E6"> Response</span></span>
<span class="line"><span style="color: #C586C0">from</span><span style="color: #E6E6E6"> django.db </span><span style="color: #C586C0">import</span><span style="color: #E6E6E6"> connection</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">PerfTestView</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">APIView</span><span style="color: #E6E6E6">):</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">def</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">post</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">self</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">request</span><span style="color: #E6E6E6">):</span></span>
<span class="line"><span style="color: #E6E6E6">        records </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_records'</span><span style="color: #E6E6E6">, </span><span style="color: #B5CEA8">10</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        text_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_text_param'</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'abcxyz'</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        int_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_int_param'</span><span style="color: #E6E6E6">, </span><span style="color: #B5CEA8">999</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        ts_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_ts_param'</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'2024-01-01'</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        bool_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_bool_param'</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">True</span><span style="color: #E6E6E6">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">with</span><span style="color: #E6E6E6"> connection.cursor() </span><span style="color: #C586C0">as</span><span style="color: #E6E6E6"> cursor:</span></span>
<span class="line"><span style="color: #E6E6E6">            cursor.execute(</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #CE9178">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(_records => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _text_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _int_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _ts_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _bool_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">)"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">                [records, text_param, int_param, ts_param, bool_param])</span></span>
<span class="line"><span style="color: #E6E6E6">            data </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> cursor.fetchall()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        columns </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> [col[</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">] </span><span style="color: #C586C0">for</span><span style="color: #E6E6E6"> col </span><span style="color: #C586C0">in</span><span style="color: #E6E6E6"> cursor.description]</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> Response([</span><span style="color: #4EC9B0">dict</span><span style="color: #E6E6E6">(</span><span style="color: #DCDCAA">zip</span><span style="color: #E6E6E6">(columns, row)) </span><span style="color: #C586C0">for</span><span style="color: #E6E6E6"> row </span><span style="color: #C586C0">in</span><span style="color: #E6E6E6"> data])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">PerfTestArrays</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">APIView</span><span style="color: #E6E6E6">):</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">def</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">post</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">self</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">request</span><span style="color: #E6E6E6">):</span></span>
<span class="line"><span style="color: #E6E6E6">        records </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_records'</span><span style="color: #E6E6E6">, </span><span style="color: #B5CEA8">10</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        text_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_text_param'</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'abcxyz'</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        int_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_int_param'</span><span style="color: #E6E6E6">, </span><span style="color: #B5CEA8">999</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        ts_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_ts_param'</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'2024-01-01'</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">        bool_param </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> request.data.get(</span><span style="color: #CE9178">'_bool_param'</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">True</span><span style="color: #E6E6E6">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">with</span><span style="color: #E6E6E6"> connection.cursor() </span><span style="color: #C586C0">as</span><span style="color: #E6E6E6"> cursor:</span></span>
<span class="line"><span style="color: #E6E6E6">            cursor.execute(</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #CE9178">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(_records => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _text_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _int_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _ts_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _bool_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">)"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">                [records, text_param, int_param, ts_param, bool_param])</span></span>
<span class="line"><span style="color: #E6E6E6">            data </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> cursor.fetchall()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">        columns </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> [col[</span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">] </span><span style="color: #C586C0">for</span><span style="color: #E6E6E6"> col </span><span style="color: #C586C0">in</span><span style="color: #E6E6E6"> cursor.description]</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> Response([</span><span style="color: #4EC9B0">dict</span><span style="color: #E6E6E6">(</span><span style="color: #DCDCAA">zip</span><span style="color: #E6E6E6">(columns, row)) </span><span style="color: #C586C0">for</span><span style="color: #E6E6E6"> row </span><span style="color: #C586C0">in</span><span style="color: #E6E6E6"> data])</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #AF00DB">from</span><span style="color: #000000"> rest_framework.views </span><span style="color: #AF00DB">import</span><span style="color: #000000"> APIView</span></span>
<span class="line"><span style="color: #AF00DB">from</span><span style="color: #000000"> rest_framework.response </span><span style="color: #AF00DB">import</span><span style="color: #000000"> Response</span></span>
<span class="line"><span style="color: #AF00DB">from</span><span style="color: #000000"> django.db </span><span style="color: #AF00DB">import</span><span style="color: #000000"> connection</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">PerfTestView</span><span style="color: #000000">(</span><span style="color: #267F99">APIView</span><span style="color: #000000">):</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">def</span><span style="color: #000000"> </span><span style="color: #795E26">post</span><span style="color: #000000">(</span><span style="color: #001080">self</span><span style="color: #000000">, </span><span style="color: #001080">request</span><span style="color: #000000">):</span></span>
<span class="line"><span style="color: #000000">        records = request.data.get(</span><span style="color: #A31515">'_records'</span><span style="color: #000000">, </span><span style="color: #098658">10</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        text_param = request.data.get(</span><span style="color: #A31515">'_text_param'</span><span style="color: #000000">, </span><span style="color: #A31515">'abcxyz'</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        int_param = request.data.get(</span><span style="color: #A31515">'_int_param'</span><span style="color: #000000">, </span><span style="color: #098658">999</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        ts_param = request.data.get(</span><span style="color: #A31515">'_ts_param'</span><span style="color: #000000">, </span><span style="color: #A31515">'2024-01-01'</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        bool_param = request.data.get(</span><span style="color: #A31515">'_bool_param'</span><span style="color: #000000">, </span><span style="color: #0000FF">True</span><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">with</span><span style="color: #000000"> connection.cursor() </span><span style="color: #AF00DB">as</span><span style="color: #000000"> cursor:</span></span>
<span class="line"><span style="color: #000000">            cursor.execute(</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #A31515">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(_records => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _text_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _int_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _ts_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _bool_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">)"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">                [records, text_param, int_param, ts_param, bool_param])</span></span>
<span class="line"><span style="color: #000000">            data = cursor.fetchall()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        columns = [col[</span><span style="color: #098658">0</span><span style="color: #000000">] </span><span style="color: #AF00DB">for</span><span style="color: #000000"> col </span><span style="color: #AF00DB">in</span><span style="color: #000000"> cursor.description]</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> Response([</span><span style="color: #267F99">dict</span><span style="color: #000000">(</span><span style="color: #795E26">zip</span><span style="color: #000000">(columns, row)) </span><span style="color: #AF00DB">for</span><span style="color: #000000"> row </span><span style="color: #AF00DB">in</span><span style="color: #000000"> data])</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">PerfTestArrays</span><span style="color: #000000">(</span><span style="color: #267F99">APIView</span><span style="color: #000000">):</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">def</span><span style="color: #000000"> </span><span style="color: #795E26">post</span><span style="color: #000000">(</span><span style="color: #001080">self</span><span style="color: #000000">, </span><span style="color: #001080">request</span><span style="color: #000000">):</span></span>
<span class="line"><span style="color: #000000">        records = request.data.get(</span><span style="color: #A31515">'_records'</span><span style="color: #000000">, </span><span style="color: #098658">10</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        text_param = request.data.get(</span><span style="color: #A31515">'_text_param'</span><span style="color: #000000">, </span><span style="color: #A31515">'abcxyz'</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        int_param = request.data.get(</span><span style="color: #A31515">'_int_param'</span><span style="color: #000000">, </span><span style="color: #098658">999</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        ts_param = request.data.get(</span><span style="color: #A31515">'_ts_param'</span><span style="color: #000000">, </span><span style="color: #A31515">'2024-01-01'</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">        bool_param = request.data.get(</span><span style="color: #A31515">'_bool_param'</span><span style="color: #000000">, </span><span style="color: #0000FF">True</span><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">with</span><span style="color: #000000"> connection.cursor() </span><span style="color: #AF00DB">as</span><span style="color: #000000"> cursor:</span></span>
<span class="line"><span style="color: #000000">            cursor.execute(</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #A31515">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(_records => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _text_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _int_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _ts_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _bool_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">)"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">                [records, text_param, int_param, ts_param, bool_param])</span></span>
<span class="line"><span style="color: #000000">            data = cursor.fetchall()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">        columns = [col[</span><span style="color: #098658">0</span><span style="color: #000000">] </span><span style="color: #AF00DB">for</span><span style="color: #000000"> col </span><span style="color: #AF00DB">in</span><span style="color: #000000"> cursor.description]</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> Response([</span><span style="color: #267F99">dict</span><span style="color: #000000">(</span><span style="color: #795E26">zip</span><span style="color: #000000">(columns, row)) </span><span style="color: #AF00DB">for</span><span style="color: #000000"> row </span><span style="color: #AF00DB">in</span><span style="color: #000000"> data])</span></span></code></pre></div><h4 id="6-express">6) Express<a class="anchor bookmark-target" href="#6-express"><i class="bi bi-link-45deg"></i></a></h4><p>NodeJS v20.11.1, express v4.18.3, pg 8.11.3</p><div class="code js"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">post</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">'/api/perf_test'</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">req</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">res</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">=></span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #C586C0">try</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">const</span><span style="color: #E6E6E6"> { </span><span style="color: #9CDCFE">_records</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_text_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_int_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_ts_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_bool_param</span><span style="color: #E6E6E6"> } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">req</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">body</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">const</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">queryResult</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">pool</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">query</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">      </span><span style="color: #CE9178">'select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test($1, $2, $3, $4, $5)'</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">      [</span><span style="color: #9CDCFE">_records</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_text_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_int_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_ts_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_bool_param</span><span style="color: #E6E6E6">]);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">res</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">json</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">queryResult</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">rows</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">  } </span><span style="color: #C586C0">catch</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">error</span><span style="color: #E6E6E6">) {</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">res</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">status</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">500</span><span style="color: #E6E6E6">).</span><span style="color: #DCDCAA">json</span><span style="color: #E6E6E6">({ </span><span style="color: #9CDCFE">error:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">error</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">message</span><span style="color: #E6E6E6"> });</span></span>
<span class="line"><span style="color: #E6E6E6">  }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">post</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">'/api/perf_test_arrays'</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">req</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">res</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">=></span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #C586C0">try</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">const</span><span style="color: #E6E6E6"> { </span><span style="color: #9CDCFE">_records</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_text_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_int_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_ts_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_bool_param</span><span style="color: #E6E6E6"> } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">req</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">body</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">const</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">queryResult</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">pool</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">query</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">      </span><span style="color: #CE9178">'select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays($1, $2, $3, $4, $5)'</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">      [</span><span style="color: #9CDCFE">_records</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_text_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_int_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_ts_param</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">_bool_param</span><span style="color: #E6E6E6">]);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">res</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">json</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">queryResult</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">rows</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">  } </span><span style="color: #C586C0">catch</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">error</span><span style="color: #E6E6E6">) {</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">res</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">status</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">500</span><span style="color: #E6E6E6">).</span><span style="color: #DCDCAA">json</span><span style="color: #E6E6E6">({ </span><span style="color: #9CDCFE">error:</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">error</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">message</span><span style="color: #E6E6E6"> });</span></span>
<span class="line"><span style="color: #E6E6E6">  }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">post</span><span style="color: #000000">(</span><span style="color: #A31515">'/api/perf_test'</span><span style="color: #000000">, </span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span><span style="color: #001080">req</span><span style="color: #000000">, </span><span style="color: #001080">res</span><span style="color: #000000">) </span><span style="color: #0000FF">=></span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">try</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">_records</span><span style="color: #000000">, </span><span style="color: #0070C1">_text_param</span><span style="color: #000000">, </span><span style="color: #0070C1">_int_param</span><span style="color: #000000">, </span><span style="color: #0070C1">_ts_param</span><span style="color: #000000">, </span><span style="color: #0070C1">_bool_param</span><span style="color: #000000"> } = </span><span style="color: #001080">req</span><span style="color: #000000">.</span><span style="color: #001080">body</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">queryResult</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">pool</span><span style="color: #000000">.</span><span style="color: #795E26">query</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">'select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test($1, $2, $3, $4, $5)'</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">      [</span><span style="color: #001080">_records</span><span style="color: #000000">, </span><span style="color: #001080">_text_param</span><span style="color: #000000">, </span><span style="color: #001080">_int_param</span><span style="color: #000000">, </span><span style="color: #001080">_ts_param</span><span style="color: #000000">, </span><span style="color: #001080">_bool_param</span><span style="color: #000000">]);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">json</span><span style="color: #000000">(</span><span style="color: #001080">queryResult</span><span style="color: #000000">.</span><span style="color: #001080">rows</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">  } </span><span style="color: #AF00DB">catch</span><span style="color: #000000"> (</span><span style="color: #001080">error</span><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">status</span><span style="color: #000000">(</span><span style="color: #098658">500</span><span style="color: #000000">).</span><span style="color: #795E26">json</span><span style="color: #000000">({ </span><span style="color: #001080">error:</span><span style="color: #000000"> </span><span style="color: #001080">error</span><span style="color: #000000">.</span><span style="color: #001080">message</span><span style="color: #000000"> });</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">post</span><span style="color: #000000">(</span><span style="color: #A31515">'/api/perf_test_arrays'</span><span style="color: #000000">, </span><span style="color: #0000FF">async</span><span style="color: #000000"> (</span><span style="color: #001080">req</span><span style="color: #000000">, </span><span style="color: #001080">res</span><span style="color: #000000">) </span><span style="color: #0000FF">=></span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #AF00DB">try</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> { </span><span style="color: #0070C1">_records</span><span style="color: #000000">, </span><span style="color: #0070C1">_text_param</span><span style="color: #000000">, </span><span style="color: #0070C1">_int_param</span><span style="color: #000000">, </span><span style="color: #0070C1">_ts_param</span><span style="color: #000000">, </span><span style="color: #0070C1">_bool_param</span><span style="color: #000000"> } = </span><span style="color: #001080">req</span><span style="color: #000000">.</span><span style="color: #001080">body</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">queryResult</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">pool</span><span style="color: #000000">.</span><span style="color: #795E26">query</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">      </span><span style="color: #A31515">'select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays($1, $2, $3, $4, $5)'</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">      [</span><span style="color: #001080">_records</span><span style="color: #000000">, </span><span style="color: #001080">_text_param</span><span style="color: #000000">, </span><span style="color: #001080">_int_param</span><span style="color: #000000">, </span><span style="color: #001080">_ts_param</span><span style="color: #000000">, </span><span style="color: #001080">_bool_param</span><span style="color: #000000">]);</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">json</span><span style="color: #000000">(</span><span style="color: #001080">queryResult</span><span style="color: #000000">.</span><span style="color: #001080">rows</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">  } </span><span style="color: #AF00DB">catch</span><span style="color: #000000"> (</span><span style="color: #001080">error</span><span style="color: #000000">) {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">res</span><span style="color: #000000">.</span><span style="color: #795E26">status</span><span style="color: #000000">(</span><span style="color: #098658">500</span><span style="color: #000000">).</span><span style="color: #795E26">json</span><span style="color: #000000">({ </span><span style="color: #001080">error:</span><span style="color: #000000"> </span><span style="color: #001080">error</span><span style="color: #000000">.</span><span style="color: #001080">message</span><span style="color: #000000"> });</span></span>
<span class="line"><span style="color: #000000">  }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><h4 id="7-go">7) GO<a class="anchor bookmark-target" href="#7-go"><i class="bi bi-link-45deg"></i></a></h4><p>go version go1.13.8</p><p>Note: array function endpoint tests are skipped.</p><div class="code go"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">package</span><span style="color: #E6E6E6"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">import</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"database/sql"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"encoding/json"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"log"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"net/http"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">"github.com/gorilla/mux"</span></span>
<span class="line"><span style="color: #E6E6E6">    _ </span><span style="color: #CE9178">"github.com/lib/pq"</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">const</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">host</span><span style="color: #E6E6E6">     </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"127.0.0.1"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">port</span><span style="color: #E6E6E6">     </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"5432"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">user</span><span style="color: #E6E6E6">     </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"postgres"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">password</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"postgres"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">dbname</span><span style="color: #E6E6E6">   </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"perf_tests"</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">type</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">PerfTestResult</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">struct</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">    ID1           </span><span style="color: #4EC9B0">int</span><span style="color: #E6E6E6">     </span><span style="color: #CE9178">`json:"id1"`</span></span>
<span class="line"><span style="color: #E6E6E6">    Foo1          </span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">  </span><span style="color: #CE9178">`json:"foo1"`</span></span>
<span class="line"><span style="color: #E6E6E6">    Bar1          </span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">  </span><span style="color: #CE9178">`json:"bar1"`</span></span>
<span class="line"><span style="color: #E6E6E6">    Datetime1     </span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">  </span><span style="color: #CE9178">`json:"datetime1"`</span></span>
<span class="line"><span style="color: #E6E6E6">    ID2           </span><span style="color: #4EC9B0">int</span><span style="color: #E6E6E6">     </span><span style="color: #CE9178">`json:"id2"`</span></span>
<span class="line"><span style="color: #E6E6E6">    Foo2          </span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">  </span><span style="color: #CE9178">`json:"foo2"`</span></span>
<span class="line"><span style="color: #E6E6E6">    Bar2          </span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">  </span><span style="color: #CE9178">`json:"bar2"`</span></span>
<span class="line"><span style="color: #E6E6E6">    Datetime2     </span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">  </span><span style="color: #CE9178">`json:"datetime2"`</span></span>
<span class="line"><span style="color: #E6E6E6">    LongFooBar    </span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">  </span><span style="color: #CE9178">`json:"long_foo_bar"`</span></span>
<span class="line"><span style="color: #E6E6E6">    IsFooBar      </span><span style="color: #4EC9B0">bool</span><span style="color: #E6E6E6">    </span><span style="color: #CE9178">`json:"is_foobar"`</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">func</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">main</span><span style="color: #E6E6E6">() {</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Initialize a new router</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">router</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> mux.</span><span style="color: #DCDCAA">NewRouter</span><span style="color: #E6E6E6">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Define your endpoint</span></span>
<span class="line"><span style="color: #E6E6E6">    router.</span><span style="color: #DCDCAA">HandleFunc</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/perf_test"</span><span style="color: #E6E6E6">, PerfTestFunction).</span><span style="color: #DCDCAA">Methods</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"POST"</span><span style="color: #E6E6E6">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Start the server</span></span>
<span class="line"><span style="color: #E6E6E6">    log.</span><span style="color: #DCDCAA">Fatal</span><span style="color: #E6E6E6">(http.</span><span style="color: #DCDCAA">ListenAndServe</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">":8080"</span><span style="color: #E6E6E6">, router))</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">func</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">PerfTestFunction</span><span style="color: #E6E6E6">(w http.ResponseWriter, r </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">http.Request) {</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Parse JSON parameters from request body</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">params</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">map</span><span style="color: #E6E6E6">[</span><span style="color: #4EC9B0">string</span><span style="color: #E6E6E6">]</span><span style="color: #569CD6">interface</span><span style="color: #E6E6E6">{}</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">err</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> json.</span><span style="color: #DCDCAA">NewDecoder</span><span style="color: #E6E6E6">(r.Body).</span><span style="color: #DCDCAA">Decode</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">params); err </span><span style="color: #D4D4D4">!=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">nil</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">        http.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(w, err.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Connect to PostgreSQL database</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">connStr</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"host="</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> host </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">" port="</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> port </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">" user="</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> user </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">" password="</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> password </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">" dbname="</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> dbname </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">" sslmode=disable"</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">db</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">err</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> sql.</span><span style="color: #DCDCAA">Open</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"postgres"</span><span style="color: #E6E6E6">, connStr)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> err </span><span style="color: #D4D4D4">!=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">nil</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">        http.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(w, err.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">defer</span><span style="color: #E6E6E6"> db.</span><span style="color: #DCDCAA">Close</span><span style="color: #E6E6E6">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Call PostgreSQL function</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">rows</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">err</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> db.</span><span style="color: #DCDCAA">Query</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"SELECT id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test($1, $2, $3, $4, $5)"</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">        params[</span><span style="color: #CE9178">"_records"</span><span style="color: #E6E6E6">], params[</span><span style="color: #CE9178">"_text_param"</span><span style="color: #E6E6E6">], params[</span><span style="color: #CE9178">"_int_param"</span><span style="color: #E6E6E6">], params[</span><span style="color: #CE9178">"_ts_param"</span><span style="color: #E6E6E6">], params[</span><span style="color: #CE9178">"_bool_param"</span><span style="color: #E6E6E6">])</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> err </span><span style="color: #D4D4D4">!=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">nil</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">        http.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(w, err.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">defer</span><span style="color: #E6E6E6"> rows.</span><span style="color: #DCDCAA">Close</span><span style="color: #E6E6E6">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Prepare the result slice</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">results</span><span style="color: #E6E6E6"> []PerfTestResult</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Iterate over the rows returned by the query</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">for</span><span style="color: #E6E6E6"> rows.</span><span style="color: #DCDCAA">Next</span><span style="color: #E6E6E6">() {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">result</span><span style="color: #E6E6E6"> PerfTestResult</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">err</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> rows.</span><span style="color: #DCDCAA">Scan</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.ID1, </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.Foo1, </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.Bar1, </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.Datetime1,</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.ID2, </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.Foo2, </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.Bar2, </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.Datetime2,</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.LongFooBar, </span><span style="color: #D4D4D4">&</span><span style="color: #E6E6E6">result.IsFooBar,</span></span>
<span class="line"><span style="color: #E6E6E6">        ); err </span><span style="color: #D4D4D4">!=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">nil</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">            http.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(w, err.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">return</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #9CDCFE">results</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">append</span><span style="color: #E6E6E6">(results, result)</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Check for errors during row iteration</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">err</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> rows.</span><span style="color: #DCDCAA">Err</span><span style="color: #E6E6E6">(); err </span><span style="color: #D4D4D4">!=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">nil</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">        http.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(w, err.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Convert the result slice to JSON</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">jsonResponse</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">err</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">:=</span><span style="color: #E6E6E6"> json.</span><span style="color: #DCDCAA">Marshal</span><span style="color: #E6E6E6">(results)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> err </span><span style="color: #D4D4D4">!=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">nil</span><span style="color: #E6E6E6"> {</span></span>
<span class="line"><span style="color: #E6E6E6">        http.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(w, err.</span><span style="color: #DCDCAA">Error</span><span style="color: #E6E6E6">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #6A9955">// Set Content-Type header and write response</span></span>
<span class="line"><span style="color: #E6E6E6">    w.</span><span style="color: #DCDCAA">Header</span><span style="color: #E6E6E6">().</span><span style="color: #DCDCAA">Set</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"Content-Type"</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"application/json"</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    w.</span><span style="color: #DCDCAA">Write</span><span style="color: #E6E6E6">(jsonResponse)</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">package</span><span style="color: #000000"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">import</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">"database/sql"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">"encoding/json"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">"log"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">"net/http"</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">"github.com/gorilla/mux"</span></span>
<span class="line"><span style="color: #000000">    _ </span><span style="color: #A31515">"github.com/lib/pq"</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">const</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">host</span><span style="color: #000000">     = </span><span style="color: #A31515">"127.0.0.1"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">port</span><span style="color: #000000">     = </span><span style="color: #A31515">"5432"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">user</span><span style="color: #000000">     = </span><span style="color: #A31515">"postgres"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">password</span><span style="color: #000000"> = </span><span style="color: #A31515">"postgres"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">dbname</span><span style="color: #000000">   = </span><span style="color: #A31515">"perf_tests"</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">type</span><span style="color: #000000"> </span><span style="color: #267F99">PerfTestResult</span><span style="color: #000000"> </span><span style="color: #0000FF">struct</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">    ID1           </span><span style="color: #267F99">int</span><span style="color: #000000">     </span><span style="color: #A31515">`json:"id1"`</span></span>
<span class="line"><span style="color: #000000">    Foo1          </span><span style="color: #267F99">string</span><span style="color: #000000">  </span><span style="color: #A31515">`json:"foo1"`</span></span>
<span class="line"><span style="color: #000000">    Bar1          </span><span style="color: #267F99">string</span><span style="color: #000000">  </span><span style="color: #A31515">`json:"bar1"`</span></span>
<span class="line"><span style="color: #000000">    Datetime1     </span><span style="color: #267F99">string</span><span style="color: #000000">  </span><span style="color: #A31515">`json:"datetime1"`</span></span>
<span class="line"><span style="color: #000000">    ID2           </span><span style="color: #267F99">int</span><span style="color: #000000">     </span><span style="color: #A31515">`json:"id2"`</span></span>
<span class="line"><span style="color: #000000">    Foo2          </span><span style="color: #267F99">string</span><span style="color: #000000">  </span><span style="color: #A31515">`json:"foo2"`</span></span>
<span class="line"><span style="color: #000000">    Bar2          </span><span style="color: #267F99">string</span><span style="color: #000000">  </span><span style="color: #A31515">`json:"bar2"`</span></span>
<span class="line"><span style="color: #000000">    Datetime2     </span><span style="color: #267F99">string</span><span style="color: #000000">  </span><span style="color: #A31515">`json:"datetime2"`</span></span>
<span class="line"><span style="color: #000000">    LongFooBar    </span><span style="color: #267F99">string</span><span style="color: #000000">  </span><span style="color: #A31515">`json:"long_foo_bar"`</span></span>
<span class="line"><span style="color: #000000">    IsFooBar      </span><span style="color: #267F99">bool</span><span style="color: #000000">    </span><span style="color: #A31515">`json:"is_foobar"`</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">func</span><span style="color: #000000"> </span><span style="color: #795E26">main</span><span style="color: #000000">() {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Initialize a new router</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">router</span><span style="color: #000000"> := mux.</span><span style="color: #795E26">NewRouter</span><span style="color: #000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Define your endpoint</span></span>
<span class="line"><span style="color: #000000">    router.</span><span style="color: #795E26">HandleFunc</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/perf_test"</span><span style="color: #000000">, PerfTestFunction).</span><span style="color: #795E26">Methods</span><span style="color: #000000">(</span><span style="color: #A31515">"POST"</span><span style="color: #000000">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Start the server</span></span>
<span class="line"><span style="color: #000000">    log.</span><span style="color: #795E26">Fatal</span><span style="color: #000000">(http.</span><span style="color: #795E26">ListenAndServe</span><span style="color: #000000">(</span><span style="color: #A31515">":8080"</span><span style="color: #000000">, router))</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">func</span><span style="color: #000000"> </span><span style="color: #795E26">PerfTestFunction</span><span style="color: #000000">(w http.ResponseWriter, r *http.Request) {</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Parse JSON parameters from request body</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">params</span><span style="color: #000000"> </span><span style="color: #0000FF">map</span><span style="color: #000000">[</span><span style="color: #267F99">string</span><span style="color: #000000">]</span><span style="color: #0000FF">interface</span><span style="color: #000000">{}</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> </span><span style="color: #001080">err</span><span style="color: #000000"> := json.</span><span style="color: #795E26">NewDecoder</span><span style="color: #000000">(r.Body).</span><span style="color: #795E26">Decode</span><span style="color: #000000">(&ampparams); err != </span><span style="color: #0000FF">nil</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">        http.</span><span style="color: #795E26">Error</span><span style="color: #000000">(w, err.</span><span style="color: #795E26">Error</span><span style="color: #000000">(), http.StatusBadRequest)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Connect to PostgreSQL database</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">connStr</span><span style="color: #000000"> := </span><span style="color: #A31515">"host="</span><span style="color: #000000"> + host + </span><span style="color: #A31515">" port="</span><span style="color: #000000"> + port + </span><span style="color: #A31515">" user="</span><span style="color: #000000"> + user + </span><span style="color: #A31515">" password="</span><span style="color: #000000"> + password + </span><span style="color: #A31515">" dbname="</span><span style="color: #000000"> + dbname + </span><span style="color: #A31515">" sslmode=disable"</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">db</span><span style="color: #000000">, </span><span style="color: #001080">err</span><span style="color: #000000"> := sql.</span><span style="color: #795E26">Open</span><span style="color: #000000">(</span><span style="color: #A31515">"postgres"</span><span style="color: #000000">, connStr)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> err != </span><span style="color: #0000FF">nil</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">        http.</span><span style="color: #795E26">Error</span><span style="color: #000000">(w, err.</span><span style="color: #795E26">Error</span><span style="color: #000000">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">defer</span><span style="color: #000000"> db.</span><span style="color: #795E26">Close</span><span style="color: #000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Call PostgreSQL function</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">rows</span><span style="color: #000000">, </span><span style="color: #001080">err</span><span style="color: #000000"> := db.</span><span style="color: #795E26">Query</span><span style="color: #000000">(</span><span style="color: #A31515">"SELECT id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test($1, $2, $3, $4, $5)"</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">        params[</span><span style="color: #A31515">"_records"</span><span style="color: #000000">], params[</span><span style="color: #A31515">"_text_param"</span><span style="color: #000000">], params[</span><span style="color: #A31515">"_int_param"</span><span style="color: #000000">], params[</span><span style="color: #A31515">"_ts_param"</span><span style="color: #000000">], params[</span><span style="color: #A31515">"_bool_param"</span><span style="color: #000000">])</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> err != </span><span style="color: #0000FF">nil</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">        http.</span><span style="color: #795E26">Error</span><span style="color: #000000">(w, err.</span><span style="color: #795E26">Error</span><span style="color: #000000">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">defer</span><span style="color: #000000"> rows.</span><span style="color: #795E26">Close</span><span style="color: #000000">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Prepare the result slice</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">results</span><span style="color: #000000"> []PerfTestResult</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Iterate over the rows returned by the query</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">for</span><span style="color: #000000"> rows.</span><span style="color: #795E26">Next</span><span style="color: #000000">() {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">result</span><span style="color: #000000"> PerfTestResult</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> </span><span style="color: #001080">err</span><span style="color: #000000"> := rows.</span><span style="color: #795E26">Scan</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">            &result.ID1, &result.Foo1, &result.Bar1, &result.Datetime1,</span></span>
<span class="line"><span style="color: #000000">            &result.ID2, &result.Foo2, &result.Bar2, &result.Datetime2,</span></span>
<span class="line"><span style="color: #000000">            &result.LongFooBar, &result.IsFooBar,</span></span>
<span class="line"><span style="color: #000000">        ); err != </span><span style="color: #0000FF">nil</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">            http.</span><span style="color: #795E26">Error</span><span style="color: #000000">(w, err.</span><span style="color: #795E26">Error</span><span style="color: #000000">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">return</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #001080">results</span><span style="color: #000000"> = </span><span style="color: #795E26">append</span><span style="color: #000000">(results, result)</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Check for errors during row iteration</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> </span><span style="color: #001080">err</span><span style="color: #000000"> := rows.</span><span style="color: #795E26">Err</span><span style="color: #000000">(); err != </span><span style="color: #0000FF">nil</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">        http.</span><span style="color: #795E26">Error</span><span style="color: #000000">(w, err.</span><span style="color: #795E26">Error</span><span style="color: #000000">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Convert the result slice to JSON</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">jsonResponse</span><span style="color: #000000">, </span><span style="color: #001080">err</span><span style="color: #000000"> := json.</span><span style="color: #795E26">Marshal</span><span style="color: #000000">(results)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> err != </span><span style="color: #0000FF">nil</span><span style="color: #000000"> {</span></span>
<span class="line"><span style="color: #000000">        http.</span><span style="color: #795E26">Error</span><span style="color: #000000">(w, err.</span><span style="color: #795E26">Error</span><span style="color: #000000">(), http.StatusInternalServerError)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #008000">// Set Content-Type header and write response</span></span>
<span class="line"><span style="color: #000000">    w.</span><span style="color: #795E26">Header</span><span style="color: #000000">().</span><span style="color: #795E26">Set</span><span style="color: #000000">(</span><span style="color: #A31515">"Content-Type"</span><span style="color: #000000">, </span><span style="color: #A31515">"application/json"</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    w.</span><span style="color: #795E26">Write</span><span style="color: #000000">(jsonResponse)</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><h4 id="8-fastapi">8) FastAPI<a class="anchor bookmark-target" href="#8-fastapi"><i class="bi bi-link-45deg"></i></a></h4><p>FastAPI 0.110.0 on Python 3.8</p><div class="code python"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #DCDCAA">@app.post</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/perf_test"</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">def</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">perf_test</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">request</span><span style="color: #E6E6E6">: Request):</span></span>
<span class="line"><span style="color: #E6E6E6">    conn </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> get_db_connection()</span></span>
<span class="line"><span style="color: #E6E6E6">    cursor </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> conn.cursor()</span></span>
<span class="line"><span style="color: #E6E6E6">    json </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">await</span><span style="color: #E6E6E6"> request.json()</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">with</span><span style="color: #E6E6E6"> conn.cursor() </span><span style="color: #C586C0">as</span><span style="color: #E6E6E6"> cursor:</span></span>
<span class="line"><span style="color: #E6E6E6">        cursor.execute(</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #CE9178">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(_records => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _text_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _int_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _ts_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _bool_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">)"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">            [json[</span><span style="color: #CE9178">"_records"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_text_param"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_int_param"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_ts_param"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_bool_param"</span><span style="color: #E6E6E6">]])</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> cursor.fetchall()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #DCDCAA">@app.post</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"/api/perf_test_arrays"</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">def</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">perf_test</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">request</span><span style="color: #E6E6E6">: Request):</span></span>
<span class="line"><span style="color: #E6E6E6">    conn </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> get_db_connection()</span></span>
<span class="line"><span style="color: #E6E6E6">    cursor </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> conn.cursor()</span></span>
<span class="line"><span style="color: #E6E6E6">    json </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">await</span><span style="color: #E6E6E6"> request.json()</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #C586C0">with</span><span style="color: #E6E6E6"> conn.cursor() </span><span style="color: #C586C0">as</span><span style="color: #E6E6E6"> cursor:</span></span>
<span class="line"><span style="color: #E6E6E6">        cursor.execute(</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #CE9178">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(_records => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _text_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _int_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _ts_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">, _bool_param => </span><span style="color: #569CD6">%s</span><span style="color: #CE9178">)"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">            [json[</span><span style="color: #CE9178">"_records"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_text_param"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_int_param"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_ts_param"</span><span style="color: #E6E6E6">], json[</span><span style="color: #CE9178">"_bool_param"</span><span style="color: #E6E6E6">]])</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">return</span><span style="color: #E6E6E6"> cursor.fetchall()</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #795E26">@app.post</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/perf_test"</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">def</span><span style="color: #000000"> </span><span style="color: #795E26">perf_test</span><span style="color: #000000">(</span><span style="color: #001080">request</span><span style="color: #000000">: Request):</span></span>
<span class="line"><span style="color: #000000">    conn = get_db_connection()</span></span>
<span class="line"><span style="color: #000000">    cursor = conn.cursor()</span></span>
<span class="line"><span style="color: #000000">    json = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> request.json()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">with</span><span style="color: #000000"> conn.cursor() </span><span style="color: #AF00DB">as</span><span style="color: #000000"> cursor:</span></span>
<span class="line"><span style="color: #000000">        cursor.execute(</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #A31515">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test(_records => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _text_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _int_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _ts_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _bool_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">)"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            [json[</span><span style="color: #A31515">"_records"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_text_param"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_int_param"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_ts_param"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_bool_param"</span><span style="color: #000000">]])</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> cursor.fetchall()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #795E26">@app.post</span><span style="color: #000000">(</span><span style="color: #A31515">"/api/perf_test_arrays"</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #0000FF">def</span><span style="color: #000000"> </span><span style="color: #795E26">perf_test</span><span style="color: #000000">(</span><span style="color: #001080">request</span><span style="color: #000000">: Request):</span></span>
<span class="line"><span style="color: #000000">    conn = get_db_connection()</span></span>
<span class="line"><span style="color: #000000">    cursor = conn.cursor()</span></span>
<span class="line"><span style="color: #000000">    json = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> request.json()</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #AF00DB">with</span><span style="color: #000000"> conn.cursor() </span><span style="color: #AF00DB">as</span><span style="color: #000000"> cursor:</span></span>
<span class="line"><span style="color: #000000">        cursor.execute(</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #A31515">"select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from perf_test_arrays(_records => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _text_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _int_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _ts_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">, _bool_param => </span><span style="color: #0000FF">%s</span><span style="color: #A31515">)"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">            [json[</span><span style="color: #A31515">"_records"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_text_param"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_int_param"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_ts_param"</span><span style="color: #000000">], json[</span><span style="color: #A31515">"_bool_param"</span><span style="color: #000000">]])</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">return</span><span style="color: #000000"> cursor.fetchall()</span></span></code></pre></div><h2 id="tests-functions">Tests Functions<a class="anchor bookmark-target" href="#tests-functions"><i class="bi bi-link-45deg"></i></a></h2><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">perf_test</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    _records </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _text_param </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _int_param </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _ts_param </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _bool_param bool</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    id1 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    foo1 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    bar1 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    datetime1 </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    id2 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    foo2 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    bar2 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    long_foo_bar </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    is_foobar bool</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span></span>
<span class="line"><span style="color: #E6E6E6">    i </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> _int_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id1,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'foo'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo1,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'bar'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar1,</span></span>
<span class="line"><span style="color: #E6E6E6">        (_ts_param::</span><span style="color: #569CD6">date</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> (i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">' days'</span><span style="color: #E6E6E6">)::interval </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> datetime1,</span></span>
<span class="line"><span style="color: #E6E6E6">        i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> _int_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id2,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'foo'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo2,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'bar'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar2,</span></span>
<span class="line"><span style="color: #E6E6E6">        (_ts_param::</span><span style="color: #569CD6">date</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> ((i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">' days'</span><span style="color: #E6E6E6">)::interval </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'long_foo_bar_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> long_foo_bar, </span></span>
<span class="line"><span style="color: #E6E6E6">    (i % </span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">boolean</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> _bool_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> is_foobar</span></span>
<span class="line"><span style="color: #569CD6">from</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">generate_series</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, _records) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> i</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">perf_test</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    _records </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _text_param </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _int_param </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _ts_param </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _bool_param bool</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    id1 </span><span style="color: #0000FF">int</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    foo1 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    bar1 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    datetime1 </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    id2 </span><span style="color: #0000FF">int</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    foo2 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    bar2 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">datetime2</span><span style="color: #000000"> </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    long_foo_bar </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    is_foobar bool</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span></span>
<span class="line"><span style="color: #000000">    i + _int_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> id1,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'foo'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo1,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'bar'</span><span style="color: #000000"> || i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar1,</span></span>
<span class="line"><span style="color: #000000">        (_ts_param::</span><span style="color: #0000FF">date</span><span style="color: #000000">) + (i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> || </span><span style="color: #A31515">' days'</span><span style="color: #000000">)::interval </span><span style="color: #0000FF">as</span><span style="color: #000000"> datetime1,</span></span>
<span class="line"><span style="color: #000000">        i+</span><span style="color: #098658">1</span><span style="color: #000000"> + _int_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> id2,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'foo'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo2,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'bar'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar2,</span></span>
<span class="line"><span style="color: #000000">        (_ts_param::</span><span style="color: #0000FF">date</span><span style="color: #000000">) + ((i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> || </span><span style="color: #A31515">' days'</span><span style="color: #000000">)::interval </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">datetime2</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'long_foo_bar_'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">2</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> long_foo_bar, </span></span>
<span class="line"><span style="color: #000000">    (i % </span><span style="color: #098658">2</span><span style="color: #000000">)::</span><span style="color: #0000FF">boolean</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> _bool_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> is_foobar</span></span>
<span class="line"><span style="color: #0000FF">from</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">generate_series</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, _records) </span><span style="color: #0000FF">as</span><span style="color: #000000"> i</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">perf_test_arrays</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    _records </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _text_param </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _int_param </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _ts_param </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _bool_param bool</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    id1 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    foo1 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    bar1 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    datetime1 </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    id2 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    foo2 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    bar2 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">[],</span></span>
<span class="line"><span style="color: #E6E6E6">    long_foo_bar </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">[], </span></span>
<span class="line"><span style="color: #E6E6E6">    is_foobar bool[]</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[i + _int_param, i + _int_param + 1, i + _int_param + 2] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['foo' || '_' || _text_param || '_' || i::text, 'foo2', 'foo3'] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['bar' || i::text, 'bar2', 'bar3'] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[(_ts_param::date) + (i::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> datetime1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[i+1 + _int_param, i+2 + _int_param, i+3 + _int_param] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['foo' || '_' || _text_param || '_' || (i+1)::text, 'foo' || '_' || _text_param || '_' || (i+2)::text, 'foo' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['bar' || '_' || _text_param || '_' || (i+1)::text, 'bar' || '_' || _text_param || '_' || (i+2)::text, 'bar' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[(_ts_param::date) + ((i+1)::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['long_foo_bar_' || '_' || _text_param || '_' || (i+2)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+3)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+4)::text] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> long_foo_bar, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[(i % 2)::boolean and _bool_param, ((i+1) % 2)::boolean and _bool_param, ((i+2) % 2)::boolean and _bool_param] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> is_foobar</span></span>
<span class="line"><span style="color: #569CD6">from</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">generate_series</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, _records) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> i</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">perf_test_arrays</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    _records </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _text_param </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _int_param </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _ts_param </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _bool_param bool</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    id1 </span><span style="color: #0000FF">int</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    foo1 </span><span style="color: #0000FF">text</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    bar1 </span><span style="color: #0000FF">text</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    datetime1 </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    id2 </span><span style="color: #0000FF">int</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    foo2 </span><span style="color: #0000FF">text</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    bar2 </span><span style="color: #0000FF">text</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">datetime2</span><span style="color: #000000"> </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">[],</span></span>
<span class="line"><span style="color: #000000">    long_foo_bar </span><span style="color: #0000FF">text</span><span style="color: #000000">[], </span></span>
<span class="line"><span style="color: #000000">    is_foobar bool[]</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[i + _int_param, i + _int_param + 1, i + _int_param + 2] </span><span style="color: #0000FF">as</span><span style="color: #000000"> id1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['foo' || '_' || _text_param || '_' || i::text, 'foo2', 'foo3'] </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['bar' || i::text, 'bar2', 'bar3'] </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[(_ts_param::date) + (i::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #0000FF">as</span><span style="color: #000000"> datetime1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[i+1 + _int_param, i+2 + _int_param, i+3 + _int_param] </span><span style="color: #0000FF">as</span><span style="color: #000000"> id2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['foo' || '_' || _text_param || '_' || (i+1)::text, 'foo' || '_' || _text_param || '_' || (i+2)::text, 'foo' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['bar' || '_' || _text_param || '_' || (i+1)::text, 'bar' || '_' || _text_param || '_' || (i+2)::text, 'bar' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[(_ts_param::date) + ((i+1)::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">datetime2</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['long_foo_bar_' || '_' || _text_param || '_' || (i+2)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+3)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+4)::text] </span><span style="color: #0000FF">as</span><span style="color: #000000"> long_foo_bar, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[(i % 2)::boolean and _bool_param, ((i+1) % 2)::boolean and _bool_param, ((i+2) % 2)::boolean and _bool_param] </span><span style="color: #0000FF">as</span><span style="color: #000000"> is_foobar</span></span>
<span class="line"><span style="color: #0000FF">from</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">generate_series</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, _records) </span><span style="color: #0000FF">as</span><span style="color: #000000"> i</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">perf_test_record</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    _records </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _text_param </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _int_param </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _ts_param </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _bool_param bool</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> setof record</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span></span>
<span class="line"><span style="color: #E6E6E6">    i </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> _int_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id1,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'foo'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo1,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'bar'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar1,</span></span>
<span class="line"><span style="color: #E6E6E6">        (_ts_param::</span><span style="color: #569CD6">date</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> (i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">' days'</span><span style="color: #E6E6E6">)::interval </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> datetime1,</span></span>
<span class="line"><span style="color: #E6E6E6">        i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> _int_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id2,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'foo'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo2,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'bar'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar2,</span></span>
<span class="line"><span style="color: #E6E6E6">        (_ts_param::</span><span style="color: #569CD6">date</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> ((i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">' days'</span><span style="color: #E6E6E6">)::interval </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'long_foo_bar_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> long_foo_bar, </span></span>
<span class="line"><span style="color: #E6E6E6">    (i % </span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">boolean</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> _bool_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> is_foobar</span></span>
<span class="line"><span style="color: #569CD6">from</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">generate_series</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, _records) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> i</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">perf_test_record</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    _records </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _text_param </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _int_param </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _ts_param </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _bool_param bool</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> setof record</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span></span>
<span class="line"><span style="color: #000000">    i + _int_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> id1,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'foo'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo1,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'bar'</span><span style="color: #000000"> || i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar1,</span></span>
<span class="line"><span style="color: #000000">        (_ts_param::</span><span style="color: #0000FF">date</span><span style="color: #000000">) + (i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> || </span><span style="color: #A31515">' days'</span><span style="color: #000000">)::interval </span><span style="color: #0000FF">as</span><span style="color: #000000"> datetime1,</span></span>
<span class="line"><span style="color: #000000">        i+</span><span style="color: #098658">1</span><span style="color: #000000"> + _int_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> id2,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'foo'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo2,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'bar'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar2,</span></span>
<span class="line"><span style="color: #000000">        (_ts_param::</span><span style="color: #0000FF">date</span><span style="color: #000000">) + ((i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> || </span><span style="color: #A31515">' days'</span><span style="color: #000000">)::interval </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">datetime2</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'long_foo_bar_'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">2</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> long_foo_bar, </span></span>
<span class="line"><span style="color: #000000">    (i % </span><span style="color: #098658">2</span><span style="color: #000000">)::</span><span style="color: #0000FF">boolean</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> _bool_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> is_foobar</span></span>
<span class="line"><span style="color: #0000FF">from</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">generate_series</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, _records) </span><span style="color: #0000FF">as</span><span style="color: #000000"> i</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">perf_test_record_arrays</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    _records </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _text_param </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _int_param </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _ts_param </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _bool_param bool</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> setof record</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[i + _int_param, i + _int_param + 1, i + _int_param + 2] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['foo' || '_' || _text_param || '_' || i::text, 'foo2', 'foo3'] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['bar' || i::text, 'bar2', 'bar3'] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[(_ts_param::date) + (i::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> datetime1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[i+1 + _int_param, i+2 + _int_param, i+3 + _int_param] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['foo' || '_' || _text_param || '_' || (i+1)::text, 'foo' || '_' || _text_param || '_' || (i+2)::text, 'foo' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['bar' || '_' || _text_param || '_' || (i+1)::text, 'bar' || '_' || _text_param || '_' || (i+2)::text, 'bar' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[(_ts_param::date) + ((i+1)::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">['long_foo_bar_' || '_' || _text_param || '_' || (i+2)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+3)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+4)::text] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> long_foo_bar, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">array</span><span style="color: #E6E6E6">[(i % 2)::boolean and _bool_param, ((i+1) % 2)::boolean and _bool_param, ((i+2) % 2)::boolean and _bool_param] </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> is_foobar</span></span>
<span class="line"><span style="color: #569CD6">from</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">generate_series</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, _records) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> i</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">perf_test_record_arrays</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    _records </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _text_param </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _int_param </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _ts_param </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _bool_param bool</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> setof record</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[i + _int_param, i + _int_param + 1, i + _int_param + 2] </span><span style="color: #0000FF">as</span><span style="color: #000000"> id1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['foo' || '_' || _text_param || '_' || i::text, 'foo2', 'foo3'] </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['bar' || i::text, 'bar2', 'bar3'] </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[(_ts_param::date) + (i::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #0000FF">as</span><span style="color: #000000"> datetime1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[i+1 + _int_param, i+2 + _int_param, i+3 + _int_param] </span><span style="color: #0000FF">as</span><span style="color: #000000"> id2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['foo' || '_' || _text_param || '_' || (i+1)::text, 'foo' || '_' || _text_param || '_' || (i+2)::text, 'foo' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['bar' || '_' || _text_param || '_' || (i+1)::text, 'bar' || '_' || _text_param || '_' || (i+2)::text, 'bar' || '_' || _text_param || '_' || (i+3)::text] </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[(_ts_param::date) + ((i+1)::text || ' days')::interval, _ts_param::date + '1 days'::interval, _ts_param::date + '2 days'::interval] </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">datetime2</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">['long_foo_bar_' || '_' || _text_param || '_' || (i+2)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+3)::text, 'long_foo_bar_' || '_' || _text_param || '_' || (i+4)::text] </span><span style="color: #0000FF">as</span><span style="color: #000000"> long_foo_bar, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">array</span><span style="color: #000000">[(i % 2)::boolean and _bool_param, ((i+1) % 2)::boolean and _bool_param, ((i+2) % 2)::boolean and _bool_param] </span><span style="color: #0000FF">as</span><span style="color: #000000"> is_foobar</span></span>
<span class="line"><span style="color: #0000FF">from</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">generate_series</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, _records) </span><span style="color: #0000FF">as</span><span style="color: #000000"> i</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><div class="pt-5 border-top"><div id="comments-section" class="h5">Comments</div><script defer src="https://cdn.commento.io/js/commento.js" data-no-fonts="true" data-css-override="https://vb-consulting.github.io/style.css"></script><div id="commento"></div></div><footer class="mt-3 py-5"><div class="w-fit mx-auto mb-3 border-top border-bottom"><div class="alert text-center fs-smaller text-muted"><div class="alert text-center fs-smaller text-muted mb-1">If you like my content, use my software, or otherwise benefit from my work, consider supporting me by buying me a coffee. The software runs on coffee after all.</div><a class="btn rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="Click Here to Buy Me a Coffee Or Scan the Code" href="https://www.buymeacoffee.com/vbilopavu" style="display: inline-grid;">Buy me a Coffee <img class="m-auto svelte-byttq0" alt="Scan Here To Buy Me a Cofee" src="/bmc_qr.png"></a></div></div><div class="d-flex justify-content-center"><a class="btn rl-arrow me-1" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="readme.md on GitHub" href="https://github.com/vb-consulting/NpgsqlRest/blob/master/PerfomanceTests/readme.md" style="display: inline-grid;">readme.md on GitHub <i class="bi bi-github"></i></a> <a class="btn rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="I Post Software Development Content Daily" href="https://www.linkedin.com/in/vb-software/" style="display: inline-grid;">Follow me on LinkedIn <i class="bi bi-linkedin"></i></a></div><div class="text-center"><div class="mt-5 mb-5 background-floki svelte-byttq0" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog."></div></div></footer></div></div><div class="rightside svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">on this page</span><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="performance-tests" title="Performance Tests"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#performance-tests">Performance Tests</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="files" title="Files"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#files">Files</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="results" title="Results"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#results">Results</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="other-platforms" title="Other Platforms"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#other-platforms">Other Platforms</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="consolidated-results" title="Consolidated Results"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#consolidated-results">Consolidated Results</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="1-aot" title="1) AOT"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-aot">1) AOT</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="2-jit" title="2) JIT"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-jit">2) JIT</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="3-ef" title="3) EF"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-ef">3) EF</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="4-ado" title="4) ADO"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#4-ado">4) ADO</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="5-django" title="5) Django"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#5-django">5) Django</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="6-express" title="6) Express"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#6-express">6) Express</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="7-go" title="7) GO"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#7-go">7) GO</a></li><li class="nav-item toc4 right svelte-9zwk14 bookmark-nav" data-id="8-fastapi" title="8) FastAPI"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#8-fastapi">8) FastAPI</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="tests-functions" title="Tests Functions"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#tests-functions">Tests Functions</a></li></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],o=document.querySelectorAll("div.code"),k=i.querySelector(".home");function E(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n])}function T(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n]);E(e,t),e.classList.add(t)}function t(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",o=0;o<n.classList.length;o++)if(n.classList[o].startsWith("bi-")){i=n.classList[o];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}"/"==document.location.pathname&&T(k,"d-none");var e=document.querySelector(".post-share > .copy-url"),n=(e&&e.addEventListener("click",function(e){t(e,function(e,t){navigator.clipboard.writeText(document.location.origin+document.location.pathname),t()})}),document.getElementsByTagName("html")[0]),a=i.querySelector("#theme-btn"),s="theme";function l(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<o.length;n++){var i=o[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e){t(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function c(e){t(e,function(e,t){var n=localStorage.getItem(s);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(s)?"light":"dark";localStorage.setItem(s,e),l(n.dataset.bsTheme=e)}),l(localStorage.getItem(s)),a.children[0].classList.remove("hidden");for(var d=0;d<o.length;d++){o[d].getElementsByClassName("copy-code")[0].addEventListener("click",r);var m=o[d].getElementsByClassName("photo-code");m.length&&m[0].addEventListener("click",c)}for(var S=function(){var a,o,s;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.querySelector(".main-content").querySelectorAll("[id]"),o=void 0,this.initNavs=function(e){s=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,o=0;o<s.length;o++)if(s[o].dataset.id==n){i=s[o];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(l(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),r()},f.children[1].addEventListener("scroll",r),this;function l(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function r(){if(s&&s.length){for(var e=0;e<s.length;e++)s[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=l(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),o&&clearTimeout(o),void(o=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),o=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),o&&clearTimeout(o),o=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),o=void 0},250))}}}(),h=function(){var l,r=i.querySelector("#nav-btn"),c=480,d="200px",m="0.25fr",h=730,v=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],t="sidebar-pinned",p=null==localStorage.getItem(t)||"true"==localStorage.getItem(t),y=!1,b=!1;function n(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?y?"100%":"0":p?""+d:"0",i=`grid-template-columns: ${n} 1fr`,o=t&&y?"width: 100%":"0"!=n?"":"display: none",a=t&&y?"display: none":"",s=t?y?"sidebar-show":"sidebar-hide":p?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(m&&h&&v&&(n&&e<v||!n&&e<h?b||(u.innerHTML=l+g.innerHTML,S.initNavs(u),b=!0):b&&(u.innerHTML=l,S.initNavs(g),b=!1)),!m||t||b?(i+=";",f.children[2].style.display="none"):(i+=` ${m};`,f.children[2].style.display="")),T(r,!t&&p||t&&y?"rotate":"rotate-back","rotate","rotate-back"),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),f.style=L?i:"display: grid;",L&&T(L,s,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=o),w.style=a,t&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),t&&y&&T(k,"d-none")}function e(){var e=window.outerWidth<c;e?y=!y:p=!p,localStorage.setItem(t,p.toString()),n(),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),e&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),e&&y&&T(k,"d-none")}return m&&h&&v&&g&&(l=u.innerHTML,S.initNavs(g)),r.addEventListener("click",e),(window.onresize=n)(),this.closeSidebar=function(){window.outerWidth<c&&y&&e()},this}(),v=document.getElementsByClassName("auto-close"),u=0;u<v.length;u++)v[u].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(e=document.getElementById(location.hash.replace("#","")))&&e.scrollIntoView()}();</script><script src="/bootstrap.bundle.min.js"></script><script>!function(){for(var e=document.querySelectorAll('[data-bs-toggle="tooltip"]'),t=0;t<e.length;t++)new bootstrap.Tooltip(e[t]);var n=document.getElementsByClassName("accordion-item");if(n.length){for(t=0;t<n.length;t++){var o=n[t];o.querySelectorAll("[href='"+document.location.pathname+"']").length&&o.firstChild.click()}var l=document.querySelector("nav.navbar").querySelector(".home"),a=document.getElementsByClassName("accordion");"/"==document.location.pathname&&l.classList.add("d-none");for(t=0;t<n.length;t++){var s=a[t];s&&s.firstChild&&"VB-Consulting"==s.firstChild.title&&(null!=s.firstChild.querySelector(".collapse")&&l.classList.contains("d-none")&&"/"!=document.location.pathname&&l.classList.remove("d-none"),s.addEventListener("show.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none"),l.classList.add("d-none")}),s.addEventListener("hide.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none")}))}}}();</script><script src="/html2canvas.min.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script></body><script async data-id="101435862" src="//static.getclicky.com/js"></script></html>