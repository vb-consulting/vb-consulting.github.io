<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>What have the STORED PROCEDURES ever done for us?</title><meta name=description content="What have the STORED PROCEDURES ever done for us?"><link href=https://vb-consulting.github.io//blog/what-have-stored-procedures-ever-done/ rel=canonical><meta name=keywords content="database, sql, stored procedure, procedure"><link rel=stylesheet href=/_elderjs/assets/svelte-ddc99041.css media=all><style></style><link href=/style.css?1702300711834 rel=stylesheet><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script><body class="d-flex flex-column h-100"><header id=header><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-13wa5zp"><div class="container-fluid flex-nowrap svelte-13wa5zp"><div class="d-flex svelte-13wa5zp"><button id=nav-btn type=button class="d-flex btn btn-sm logo animate-rotate svelte-13wa5zp"><i class=material-icons-outlined>menu</i></button></div><div class="d-flex right svelte-13wa5zp"><a class="nav-link my-auto me-2 svelte-13wa5zp"href=https://github.com/vb-consulting/blog/ ><i class=bi-github></i></a> <a class="github-button svelte-13wa5zp"href=https://github.com/vb-consulting/blog/ data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;"data-icon=octicon-star data-show-count=true aria-label="Star vb-consulting/blog/ on GitHub"></a><div class="vr text-white my-auto svelte-13wa5zp"></div><button id=theme-btn type=button aria-pressed=true aria-label=theme class=svelte-13wa5zp><span class="check hidden svelte-13wa5zp"><span class="icon svelte-13wa5zp"><svg xmlns=http://www.w3.org/2000/svg width=32 height=32 viewBox="0 0 24 24"class=svelte-13wa5zp><path fill=currentColor d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns=http://www.w3.org/2000/svg width=32 height=32 viewBox="0 0 24 24"class=svelte-13wa5zp><g fill=none stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M0 0h24v24H0z"></path><path fill=currentColor d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class=svelte-2kl70j><div class="sidebar sidebar-hide svelte-2kl70j"><div class=svelte-2kl70j><ul class="navbar-nav sidenav svelte-2kl70j"><li class="nav-item svelte-2kl70j"data-id=""title=VB-Consulting><a class="nav-link svelte-2kl70j text-uppercase"href=/ >VB-Consulting</a><li class="nav-divider svelte-2kl70j"><hr class=svelte-2kl70j><li class="nav-item toc2 svelte-2kl70j"data-id=""title=Norm.Net><a class="nav-link svelte-2kl70j text-uppercase"href=/norm.net/ >Norm.Net</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=RazorSvelte><a class="nav-link svelte-2kl70j text-uppercase"href=/razorsvelte/ >RazorSvelte</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=PgRoutiner><a class="nav-link svelte-2kl70j text-uppercase"href=/pgroutiner/ >PgRoutiner</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=XUnit.Npgsql><a class="nav-link svelte-2kl70j text-uppercase"href=/xunit.npgsql/ >XUnit.Npgsql</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title="PostrgeSQL Schema Tools"><a class="nav-link svelte-2kl70j text-uppercase"href=/pg_schema_tools/ >PostrgeSQL Schema Tools</a><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>latest blogs</span><hr class=svelte-2kl70j><li class="nav-item svelte-2kl70j"data-id=""title="Haters Build Software"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/haters-build-software/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Haters Build Software</a><li class="nav-item svelte-2kl70j"data-id=""title="What is Micro ORM?"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/micro-orm/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> What is Micro ORM?</a><li class="nav-item svelte-2kl70j"data-id=""title="Execute Custom Function For Each Record"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/postgresql-record-type/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Execute Custom Function For Each Record</a><li class="nav-item svelte-2kl70j"data-id=""title="Custom Temporal Tables in PostgreSQL"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/postgresql-temporal-tables/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Custom Temporal Tables in PostgreSQL</a><li class="nav-item svelte-2kl70j active"data-id=""title="What have the STORED PROCEDURES ever done for us?"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/what-have-stored-procedures-ever-done/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> What have the STORED PROCEDURES ever done for us?</a><li class="nav-item svelte-2kl70j"data-id=""title="Which Way .NET Developer?"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/where-to/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Which Way .NET Developer?</a></ul></div></div><div class="content svelte-2kl70j"><div class="banner svelte-j81bvh"style="background-image: url(/sp/sp1.jpeg); background-position: top;"></div><div class="container-sm main-content blog svelte-j81bvh bannered"><div class="blog-head svelte-j81bvh"><span class="badge rounded-pill text-bg-secondary">database</span><span class="badge rounded-pill text-bg-secondary">sql</span><span class="badge rounded-pill text-bg-secondary">stored procedure</span> <a href=https://github.com/vb-consulting/blog/blob/master/LICENSE class=svelte-j81bvh>CC0-1.0 license</a></div><h1 class=text-shadow id=what-have-the-stored-procedures-ever-done-for-us>What have the STORED PROCEDURES ever done for us?</h1><div class="post-meta text-shadow"><div class=post-pic data-bs-toggle=tooltip data-bs-html=true title="Floki is a developer dog."style="background-image: url(/floki.jpeg)"></div><div><div class=post-author>floki</div><div class=post-date>Feb 7, 2020</div></div></div><p>So, in all seriousness - what have the <strong>STORED PROCEDURES</strong> ever done for us?<p><img src=/sp/sp1.jpeg alt=""><h2 id=security>Security?</h2><p>You can very <strong>easily set up</strong> any database that has support for SP in a way that:<ul><li><p>Your application is only aware of that one database account that can only execute the SP required by your application <strong>and nothing more.</strong><li><p>That application account <strong>can't access data at all directly.</strong><li><p>That application account is created and managed by another database account with a higher level of privileges and that is stored and protected <strong>much more securely.</strong></ul><p>That system is usually called the least-privilege principle and it can help you to:<ul><li><p>Protect your data from theft way more securely because the account exposed to the application doesn't have direct access to data.<li><p>Guard your system against SQL injection attacks. The SQL injection is an impossibility (unless you decide to use dynamic SQL).<li><p>Prevents well-meaning junior developers from writing horribly inefficient queries. Well, that's not security per se, but it is a very useful side-effect.</ul><p>Militaries around the world use this principle also called - "<strong>need-to-know-basis</strong>".<p>And the military takes security very, very seriously.<p>Do you?<p><img src=/sp/sp2.jpeg alt=""><h2 id=performances>Performances?</h2><p>Well, this one is easy, everyone knows that at least - STORED PROCEDURES will give you performance gain.<p>Database code needs to be closer to the actual data and usually, there is much less network utilization between database and application.<p>Besides that, STORED PROCEDURE can be heavily optimized by the database engine and execution plans cached and ready.<p><img src=/sp/sp3.jpeg alt=""><h2 id=maintainability>Maintainability?</h2><p>Imagine this scenario:<p>Users are seeing data on their screens that shouldn't be there. So, it's a bug, it needs a bit of maintenance obviously.<p>What do you do?<p>You can, of course, just create a Jira ticket ... or, or you can do something like this:<p>Connect to the database server with the query tool Execute the STORED PROCEDURE that serves that screen and examine the data. If data contains the bug, then you know that the problem is within the STORED PROCEDURE, if it doesn't then the bug is somewhere within the application layer. Now, within seconds you narrowed a search for a bug to at least half of the system.<p>If it is in your database layer, you can fix it immediately with one ALTER PROCEDURE (or REPLACE FUNCTION) call ... and it's fixed within minutes or even less - with zero downtime.<p>If it is not, then at least you know that it doesn't have anything to do with the database layer, and you can focus your investigation on your classes, designed domain models with patterns, abstract factories, reducers API controllers, injected services and whatnot you name it. Good luck with that, it will take some time for sure, and the application needs to be patched, redeployed, and all that jazz.<p>Does your user care about that?<p>Or, do they usually want to see bugs fixed right here and right now?<p>But that is not the only factor in this story that affects maintainability.<p>Your <strong>database is a system</strong> of course, and if you surround your database with STORED PROCEDURES, which is essentially an API layer - you got yourself a <strong>black box.</strong><p>A black box is a system with <strong>known inputs</strong> and <strong>known outputs</strong> - without any knowledge of inner workings.<p>Your database may serve dozens and dozens of applications, services, micro-services, reporting systems, integrations, etc, etc, and, by having a black box concept you can change the schema and inner workings while respecting known outputs for know inputs with supreme confidence and efficiency.<p>How's that for maintainability?<p><img src=/sp/sp4.jpeg alt=""><h2 id=availability>Availability?</h2><p>You want to have a system with maximum availability, don't you? I mean, downtimes are bad for business. Very bad.<p>I may have already mentioned above that you can patch a bug in STORED PROCEDURE without having to stop anything. <strong>Hence, availability.</strong><p>No downtime.<p>Simply run "ALTER PROCEDURE" or "REPLACE FUNCTION" and there you go.<p>But it gets better. Imagine this. You have a huge table with a gazillion records. And for some reason, you have to change the data type of one field in that table. What do you do? Well, of course, you rush to create a migration that alters the table and alters the field type and then you deploy your update and ... nothing happens. For hours. The table is locked, and the entire system is unresponsive because everybody has to wait for your alter to finish and that may take hours. Many, many expensive hours of downtime.<p>But not if you use STORED PROCEDURES!<p>You could also write a script that will do this.<p>Create an auxiliary table from your main table without relations Alter procedures to insert data in that auxiliary table Alter the main table to change the data type in your field, and wait to finish After it finishes, insert data from the auxiliary table and revert procedure to original version No downtime.<p>Availability.<p><img src=/sp/sp4.jpeg alt=""><p>Apart from security, performance, maintainability, and availability, what STORED PROCEDURES have ever really done for us?<p>I really don't know.</div></div><div class="rightside svelte-2kl70j"><div class=svelte-2kl70j><ul class="navbar-nav sidenav svelte-2kl70j"><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>on this page</span><hr class=svelte-2kl70j><li class="nav-item toc1 right svelte-2kl70j bookmark-nav"data-id=what-have-the-stored-procedures-ever-done-for-us title="What have the STORED PROCEDURES ever done for us?"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#what-have-the-stored-procedures-ever-done-for-us>What have the STORED PROCEDURES ever done for us?</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=security title=Security?><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#security>Security?</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=performances title=Performances?><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#performances>Performances?</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=maintainability title=Maintainability?><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#maintainability>Maintainability?</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=availability title=Availability?><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#availability>Availability?</a></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],s=document.querySelectorAll("div.code");function k(e,t){for(var n=2;n<arguments.length;n++)e.classList.remove(arguments[n]);e.classList.add(t)}var t=document.getElementsByTagName("html")[0],a=i.querySelector("#theme-btn"),o="theme";function n(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<s.length;n++){var i=s[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",s=0;s<n.classList.length;s++)if(n.classList[s].startsWith("bi-")){i=n.classList[s];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}function e(e){r(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function l(e){r(e,function(e,t){var n=localStorage.getItem(o);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(o)?"light":"dark";localStorage.setItem(o,e),n(t.dataset.bsTheme=e)}),n(localStorage.getItem(o)),a.children[0].classList.remove("hidden");for(var c=0;c<s.length;c++)s[c].getElementsByClassName("copy-code")[0].addEventListener("click",e),s[c].getElementsByClassName("photo-code")[0].addEventListener("click",l);for(var d,E=function(){var a,s,o;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.children[1].children[0].querySelectorAll("[id]"),s=void 0,this.initNavs=function(e){o=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,s=0;s<o.length;s++)if(o[s].dataset.id==n){i=o[s];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(r(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),l()},f.children[1].addEventListener("scroll",l),this;function r(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function l(){if(o&&o.length){for(var e=0;e<o.length;e++)o[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=r(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),s&&clearTimeout(s),void(s=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),s=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),s&&clearTimeout(s),s=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),s=void 0},250))}}}(),h=function(){var r,l=i.querySelector("#nav-btn"),c=480,d="200px",h="0.25fr",v=730,m=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],e="sidebar-pinned",b=null==localStorage.getItem(e)||"true"==localStorage.getItem(e),p=!1,y=!1;function t(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?p?"100%":"0":b?""+d:"0",i=`grid-template-columns: ${n} 1fr`,s=t&&p?"width: 100%":"0"!=n?"":"display: none",a=t&&p?"display: none":"",o=t?p?"sidebar-show":"sidebar-hide":b?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(h&&v&&m&&(n&&e<m||!n&&e<v?y||(u.innerHTML=r+g.innerHTML,E.initNavs(u),y=!0):y&&(u.innerHTML=r,E.initNavs(g),y=!1)),!h||t||y?(i+=";",f.children[2].style.display="none"):(i+=` ${h};`,f.children[2].style.display="")),k(l,!t&&b||t&&p?"rotate":"rotate-back","rotate","rotate-back"),b?l.classList.add("text-shadow"):l.classList.remove("text-shadow"),f.style=L?i:"display: grid;",L&&k(L,o,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=s),w.style=a}function n(){window.outerWidth<c?p=!p:b=!b,localStorage.setItem(e,b.toString()),t(),b?l.classList.add("text-shadow"):l.classList.remove("text-shadow")}return h&&v&&m&&g&&(r=u.innerHTML,E.initNavs(g)),l.addEventListener("click",n),(window.onresize=t)(),this.closeSidebar=function(){window.outerWidth<c&&p&&n()},this}(),v=document.getElementsByClassName("auto-close"),m=0;m<v.length;m++)v[m].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(d=document.getElementById(location.hash.replace("#","")))&&d.scrollIntoView()}();</script><script src=/bootstrap.bundle.min.js></script><script>!function(){for(var t=document.querySelectorAll('[data-bs-toggle="tooltip"]'),e=0;e<t.length;e++)new bootstrap.Tooltip(t[e]);var o=document.getElementsByClassName("accordion-item");if(o.length)for(e=0;e<o.length;e++){var l=o[e];l.querySelectorAll("[href='"+document.location.pathname+"']").length&&l.firstChild.click()}}();</script><script src=/html2canvas.min.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script async data-id=101435862 src=//static.getclicky.com/js></script>