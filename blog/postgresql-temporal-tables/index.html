<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Custom Temporal Tables in PostgreSQL</title><meta name=description content="Custom Temporal Tables in PostgreSQL"><link href=https://vb-consulting.github.io//blog/postgresql-temporal-tables/ rel=canonical><meta name=keywords content="postgresql, sql, plpgsql, temporal, history, table, tables"><link rel=stylesheet href=/_elderjs/assets/svelte-ddc99041.css media=all><style></style><link href=/style.css?1702300709778 rel=stylesheet><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script><body class="d-flex flex-column h-100"><header id=header><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-13wa5zp"><div class="container-fluid flex-nowrap svelte-13wa5zp"><div class="d-flex svelte-13wa5zp"><button id=nav-btn type=button class="d-flex btn btn-sm logo animate-rotate svelte-13wa5zp"><i class=material-icons-outlined>menu</i></button></div><div class="d-flex right svelte-13wa5zp"><a class="nav-link my-auto me-2 svelte-13wa5zp"href=https://github.com/vb-consulting/blog/ ><i class=bi-github></i></a> <a class="github-button svelte-13wa5zp"href=https://github.com/vb-consulting/blog/ data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;"data-icon=octicon-star data-show-count=true aria-label="Star vb-consulting/blog/ on GitHub"></a><div class="vr text-white my-auto svelte-13wa5zp"></div><button id=theme-btn type=button aria-pressed=true aria-label=theme class=svelte-13wa5zp><span class="check hidden svelte-13wa5zp"><span class="icon svelte-13wa5zp"><svg xmlns=http://www.w3.org/2000/svg width=32 height=32 viewBox="0 0 24 24"class=svelte-13wa5zp><path fill=currentColor d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns=http://www.w3.org/2000/svg width=32 height=32 viewBox="0 0 24 24"class=svelte-13wa5zp><g fill=none stroke-linecap=round stroke-linejoin=round stroke-width=2><path d="M0 0h24v24H0z"></path><path fill=currentColor d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class=svelte-2kl70j><div class="sidebar sidebar-hide svelte-2kl70j"><div class=svelte-2kl70j><ul class="navbar-nav sidenav svelte-2kl70j"><li class="nav-item svelte-2kl70j"data-id=""title=VB-Consulting><a class="nav-link svelte-2kl70j text-uppercase"href=/ >VB-Consulting</a><li class="nav-divider svelte-2kl70j"><hr class=svelte-2kl70j><li class="nav-item toc2 svelte-2kl70j"data-id=""title=Norm.Net><a class="nav-link svelte-2kl70j text-uppercase"href=/norm.net/ >Norm.Net</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=RazorSvelte><a class="nav-link svelte-2kl70j text-uppercase"href=/razorsvelte/ >RazorSvelte</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=PgRoutiner><a class="nav-link svelte-2kl70j text-uppercase"href=/pgroutiner/ >PgRoutiner</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title=XUnit.Npgsql><a class="nav-link svelte-2kl70j text-uppercase"href=/xunit.npgsql/ >XUnit.Npgsql</a><li class="nav-item toc2 svelte-2kl70j"data-id=""title="PostrgeSQL Schema Tools"><a class="nav-link svelte-2kl70j text-uppercase"href=/pg_schema_tools/ >PostrgeSQL Schema Tools</a><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>latest blogs</span><hr class=svelte-2kl70j><li class="nav-item svelte-2kl70j"data-id=""title="Haters Build Software"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/haters-build-software/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Haters Build Software</a><li class="nav-item svelte-2kl70j"data-id=""title="What is Micro ORM?"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/micro-orm/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> What is Micro ORM?</a><li class="nav-item svelte-2kl70j"data-id=""title="Execute Custom Function For Each Record"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/postgresql-record-type/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Execute Custom Function For Each Record</a><li class="nav-item svelte-2kl70j active"data-id=""title="Custom Temporal Tables in PostgreSQL"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/postgresql-temporal-tables/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Custom Temporal Tables in PostgreSQL</a><li class="nav-item svelte-2kl70j"data-id=""title="What have the STORED PROCEDURES ever done for us?"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/what-have-stored-procedures-ever-done/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> What have the STORED PROCEDURES ever done for us?</a><li class="nav-item svelte-2kl70j"data-id=""title="Which Way .NET Developer?"><a class="nav-link svelte-2kl70j lr-arrow text-uppercase"href=/blog/where-to/ ><i class="bi bi-chat-left-text svelte-2kl70j"></i> Which Way .NET Developer?</a></ul></div></div><div class="content svelte-2kl70j"><div class="banner svelte-j81bvh"style="background-image: url(/vrata-banner.jpg); background-position: center;"></div><div class="container-sm main-content blog svelte-j81bvh bannered"><div class="blog-head svelte-j81bvh"><span class="badge rounded-pill text-bg-secondary">postgresql</span><span class="badge rounded-pill text-bg-secondary">plpgsql</span><span class="badge rounded-pill text-bg-secondary">sql</span> <a href=https://github.com/vb-consulting/blog/blob/master/LICENSE class=svelte-j81bvh>CC0-1.0 license</a></div><h1 class=text-shadow id=custom-temporal-tables-in-postgresql>Custom Temporal Tables in PostgreSQL</h1><div class="post-meta text-shadow"><div class=post-pic data-bs-toggle=tooltip data-bs-html=true title="Floki is a developer dog."style="background-image: url(/floki.jpeg)"></div><div><div class=post-author>floki</div><div class=post-date>Oct 10, 2023</div></div></div><p>The following script will add support for temporal tables in PostgreSQL.<h2 id=description>Description</h2><p>It will add two new functions in the <code>public</code> schema:<h3 id=1-function-temporal_table_trigger>1) function temporal_table_trigger</h3><p>Trigger function that inserts temporal data.<p>This function will create a new schema (source schema plus <code>__history</code>) and a new table with temporal data in it.<p>The new table will have the exact same schema without keys and constraints with one extra field - <code>data_valid_to timestamptz not null default now();</code><h3 id=2-function-init_temporal_tables>2) function init_temporal_tables</h3><p>This function initiates the entire temporal tables system by creating trigger <code>temporal_table_trigger</code> on each tables It accepts an array of schema names we want to have temporal tables.<p>To call this function for the public schema:<div class=one-liner><div class="code sql"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> init_temporal_tables(array['public']);</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">select</span><span style="color: #000000"> init_temporal_tables(array['public']);</span></span></code></pre></div></div><h2 id=script>Script</h2><div class="code sql"><div class=toolbar><div class="copy-code bi-clipboard"data-bs-toggle=tooltip data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera"data-bs-toggle=tooltip data-bs-title="Copy code image to clipboard"></div></div><pre class=shiki style="background-color: #222222"><code class=code-highlight><span class=line><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">or</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> temporal_table_trigger()</span></span>
<span class=line><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> trigger</span></span>
<span class=line><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql</span></span>
<span class=line><span style="color: #569CD6">as</span></span>
<span class=line><span style="color: #E6E6E6">$$</span></span>
<span class=line><span style="color: #569CD6">declare</span></span>
<span class=line><span style="color: #E6E6E6">    _schema </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    _table </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #569CD6">begin</span><span style="color: #E6E6E6">   </span></span>
<span class=line><span style="color: #E6E6E6">    _schema </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> TG_TABLE_SCHEMA::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'__history'</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    _table </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> TG_TABLE_NAME::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">if</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">exists</span><span style="color: #E6E6E6">(  </span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> information_schema.tables </span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> table_schema </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> _schema </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> table_name </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> _table</span></span>
<span class=line><span style="color: #E6E6E6">    ) </span><span style="color: #569CD6">then</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">execute</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">format</span><span style="color: #E6E6E6">(</span></span>
<span class=line><span style="color: #E6E6E6">            $</span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6">$</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">schema</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">if</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">exists</span><span style="color: #E6E6E6"> %</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">$I;</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> %</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">$I.%</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">$I </span><span style="color: #569CD6">as</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> %</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">$I.%</span><span style="color: #B5CEA8">4</span><span style="color: #E6E6E6">$I </span><span style="color: #569CD6">limit</span><span style="color: #E6E6E6"> </span><span style="color: #B5CEA8">0</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">alter</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> %</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">$I.%</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">$I </span><span style="color: #569CD6">add</span><span style="color: #E6E6E6"> column data_valid_to </span><span style="color: #569CD6">timestamptz</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">now</span><span style="color: #E6E6E6">();</span></span>
<span class=line><span style="color: #E6E6E6">            $</span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6">$, </span></span>
<span class=line><span style="color: #E6E6E6">            _schema, _table, TG_TABLE_SCHEMA::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, TG_TABLE_NAME::</span><span style="color: #569CD6">text</span></span>
<span class=line><span style="color: #E6E6E6">        );</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">end</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">if</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    </span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">execute</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">format</span><span style="color: #E6E6E6">(</span></span>
<span class=line><span style="color: #E6E6E6">        $</span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6">$</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">insert</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">into</span><span style="color: #E6E6E6"> %</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">$I.%</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">$I</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">.</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">        $</span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6">$, </span></span>
<span class=line><span style="color: #E6E6E6">        _schema, _table</span></span>
<span class=line><span style="color: #E6E6E6">    ) </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> old;</span></span>
<span class=line><span style="color: #E6E6E6">        </span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> old;</span></span>
<span class=line><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">$$;</span></span>
<span class=line></span>
<span class=line><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">or</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> init_temporal_tables(</span></span>
<span class=line><span style="color: #E6E6E6">    _schemas </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">[],</span></span>
<span class=line><span style="color: #E6E6E6">    _dry_run </span><span style="color: #569CD6">boolean</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> false</span></span>
<span class=line><span style="color: #E6E6E6">)</span></span>
<span class=line><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> void</span></span>
<span class=line><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql</span></span>
<span class=line><span style="color: #569CD6">as</span></span>
<span class=line><span style="color: #E6E6E6">$$</span></span>
<span class=line><span style="color: #569CD6">declare</span></span>
<span class=line><span style="color: #E6E6E6">    _schema </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    _table </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    _cmd </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">    _trigger </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'temporal_table_trigger'</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #569CD6">begin</span><span style="color: #E6E6E6">   </span></span>
<span class=line><span style="color: #E6E6E6">    for _schema, _table </span><span style="color: #569CD6">in</span><span style="color: #E6E6E6"> (</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> tbl.table_schema, tbl.table_name </span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class=line><span style="color: #E6E6E6">            information_schema.tables tbl</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">left join</span><span style="color: #E6E6E6"> information_schema.triggers tr </span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> tbl.table_schema </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> tr.event_object_schema </span></span>
<span class=line><span style="color: #E6E6E6">                </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> tbl.table_name </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> tr.event_object_table</span></span>
<span class=line><span style="color: #E6E6E6">                </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> tr.trigger_name </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> _trigger</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span></span>
<span class=line><span style="color: #E6E6E6">            tr.event_object_table </span><span style="color: #569CD6">is</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">null</span><span style="color: #E6E6E6"> </span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> table_schema </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> any(_schemas) </span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> table_type </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'BASE TABLE'</span></span>
<span class=line><span style="color: #E6E6E6">    )</span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">loop</span></span>
<span class=line><span style="color: #E6E6E6">        </span></span>
<span class=line><span style="color: #E6E6E6">        _cmd </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">format</span><span style="color: #E6E6E6">(</span></span>
<span class=line><span style="color: #E6E6E6">            $</span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6">$</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">or</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">replace</span><span style="color: #E6E6E6"> trigger %</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">$I </span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">after</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">delete</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">or</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">update</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> %</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">$I.%</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">$I </span></span>
<span class=line><span style="color: #E6E6E6">            for each </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">execute</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">procedure</span><span style="color: #E6E6E6"> %</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">$I();</span></span>
<span class=line><span style="color: #E6E6E6">            $</span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6">$, </span></span>
<span class=line><span style="color: #E6E6E6">            _trigger, _schema, _table</span></span>
<span class=line><span style="color: #E6E6E6">        );</span></span>
<span class=line><span style="color: #E6E6E6">        </span></span>
<span class=line><span style="color: #E6E6E6">        raise info </span><span style="color: #CE9178">'%'</span><span style="color: #E6E6E6">, </span><span style="color: #DCDCAA">replace</span><span style="color: #E6E6E6">(_cmd, </span><span style="color: #CE9178">'    '</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">''</span><span style="color: #E6E6E6">);</span></span>
<span class=line><span style="color: #E6E6E6">        </span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">if</span><span style="color: #E6E6E6"> _dry_run </span><span style="color: #569CD6">is</span><span style="color: #E6E6E6"> false </span><span style="color: #569CD6">then</span></span>
<span class=line><span style="color: #E6E6E6">            </span><span style="color: #569CD6">execute</span><span style="color: #E6E6E6"> _cmd;</span></span>
<span class=line><span style="color: #E6E6E6">        </span><span style="color: #569CD6">end</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">if</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">        </span></span>
<span class=line><span style="color: #E6E6E6">    </span><span style="color: #569CD6">end</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">loop</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span>
<span class=line><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class=shiki style="background-color: #FFFFFF"><code class=code-highlight><span class=line><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">or</span><span style="color: #000000"> </span><span style="color: #795E26">replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> temporal_table_trigger()</span></span>
<span class=line><span style="color: #0000FF">returns</span><span style="color: #000000"> trigger</span></span>
<span class=line><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql</span></span>
<span class=line><span style="color: #0000FF">as</span></span>
<span class=line><span style="color: #000000">$$</span></span>
<span class=line><span style="color: #0000FF">declare</span></span>
<span class=line><span style="color: #000000">    _schema </span><span style="color: #0000FF">text</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    _table </span><span style="color: #0000FF">text</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #0000FF">begin</span><span style="color: #000000">   </span></span>
<span class=line><span style="color: #000000">    _schema = TG_TABLE_SCHEMA::</span><span style="color: #0000FF">text</span><span style="color: #000000"> || </span><span style="color: #A31515">'__history'</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    _table = TG_TABLE_NAME::</span><span style="color: #0000FF">text</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">if</span><span style="color: #000000"> </span><span style="color: #0000FF">not</span><span style="color: #000000"> </span><span style="color: #0000FF">exists</span><span style="color: #000000">(  </span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #098658">1</span><span style="color: #000000"> </span><span style="color: #0000FF">from</span><span style="color: #000000"> information_schema.tables </span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">where</span><span style="color: #000000"> table_schema = _schema </span><span style="color: #0000FF">and</span><span style="color: #000000"> table_name = _table</span></span>
<span class=line><span style="color: #000000">    ) </span><span style="color: #0000FF">then</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">execute</span><span style="color: #000000"> </span><span style="color: #795E26">format</span><span style="color: #000000">(</span></span>
<span class=line><span style="color: #000000">            $</span><span style="color: #0000FF">sql</span><span style="color: #000000">$</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">schema</span><span style="color: #000000"> </span><span style="color: #795E26">if</span><span style="color: #000000"> </span><span style="color: #0000FF">not</span><span style="color: #000000"> </span><span style="color: #0000FF">exists</span><span style="color: #000000"> %</span><span style="color: #098658">1</span><span style="color: #000000">$I;</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> %</span><span style="color: #098658">1</span><span style="color: #000000">$I.%</span><span style="color: #098658">2</span><span style="color: #000000">$I </span><span style="color: #0000FF">as</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> %</span><span style="color: #098658">3</span><span style="color: #000000">$I.%</span><span style="color: #098658">4</span><span style="color: #000000">$I </span><span style="color: #0000FF">limit</span><span style="color: #000000"> </span><span style="color: #098658">0</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">alter</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> %</span><span style="color: #098658">1</span><span style="color: #000000">$I.%</span><span style="color: #098658">2</span><span style="color: #000000">$I </span><span style="color: #0000FF">add</span><span style="color: #000000"> column data_valid_to </span><span style="color: #0000FF">timestamptz</span><span style="color: #000000"> </span><span style="color: #0000FF">not</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000"> </span><span style="color: #0000FF">default</span><span style="color: #000000"> </span><span style="color: #0000FF">now</span><span style="color: #000000">();</span></span>
<span class=line><span style="color: #000000">            $</span><span style="color: #0000FF">sql</span><span style="color: #000000">$, </span></span>
<span class=line><span style="color: #000000">            _schema, _table, TG_TABLE_SCHEMA::</span><span style="color: #0000FF">text</span><span style="color: #000000">, TG_TABLE_NAME::</span><span style="color: #0000FF">text</span></span>
<span class=line><span style="color: #000000">        );</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">end</span><span style="color: #000000"> </span><span style="color: #0000FF">if</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    </span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">execute</span><span style="color: #000000"> </span><span style="color: #795E26">format</span><span style="color: #000000">(</span></span>
<span class=line><span style="color: #000000">        $</span><span style="color: #0000FF">sql</span><span style="color: #000000">$</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">insert</span><span style="color: #000000"> </span><span style="color: #0000FF">into</span><span style="color: #000000"> %</span><span style="color: #098658">1</span><span style="color: #000000">$I.%</span><span style="color: #098658">2</span><span style="color: #000000">$I</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">select</span><span style="color: #000000"> $</span><span style="color: #098658">1</span><span style="color: #000000">.*;</span></span>
<span class=line><span style="color: #000000">        $</span><span style="color: #0000FF">sql</span><span style="color: #000000">$, </span></span>
<span class=line><span style="color: #000000">        _schema, _table</span></span>
<span class=line><span style="color: #000000">    ) </span><span style="color: #0000FF">using</span><span style="color: #000000"> old;</span></span>
<span class=line><span style="color: #000000">        </span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">return</span><span style="color: #000000"> old;</span></span>
<span class=line><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">$$;</span></span>
<span class=line></span>
<span class=line><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">or</span><span style="color: #000000"> </span><span style="color: #795E26">replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> init_temporal_tables(</span></span>
<span class=line><span style="color: #000000">    _schemas </span><span style="color: #0000FF">text</span><span style="color: #000000">[],</span></span>
<span class=line><span style="color: #000000">    _dry_run </span><span style="color: #0000FF">boolean</span><span style="color: #000000"> = false</span></span>
<span class=line><span style="color: #000000">)</span></span>
<span class=line><span style="color: #0000FF">returns</span><span style="color: #000000"> void</span></span>
<span class=line><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql</span></span>
<span class=line><span style="color: #0000FF">as</span></span>
<span class=line><span style="color: #000000">$$</span></span>
<span class=line><span style="color: #0000FF">declare</span></span>
<span class=line><span style="color: #000000">    _schema </span><span style="color: #0000FF">text</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    _table </span><span style="color: #0000FF">text</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    _cmd </span><span style="color: #0000FF">text</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">    _trigger </span><span style="color: #0000FF">text</span><span style="color: #000000"> = </span><span style="color: #A31515">'temporal_table_trigger'</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #0000FF">begin</span><span style="color: #000000">   </span></span>
<span class=line><span style="color: #000000">    for _schema, _table </span><span style="color: #0000FF">in</span><span style="color: #000000"> (</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">select</span><span style="color: #000000"> tbl.table_schema, tbl.table_name </span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class=line><span style="color: #000000">            information_schema.tables tbl</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">left join</span><span style="color: #000000"> information_schema.triggers tr </span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">on</span><span style="color: #000000"> tbl.table_schema = tr.event_object_schema </span></span>
<span class=line><span style="color: #000000">                </span><span style="color: #0000FF">and</span><span style="color: #000000"> tbl.table_name = tr.event_object_table</span></span>
<span class=line><span style="color: #000000">                </span><span style="color: #0000FF">and</span><span style="color: #000000"> tr.trigger_name = _trigger</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span></span>
<span class=line><span style="color: #000000">            tr.event_object_table </span><span style="color: #0000FF">is</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000"> </span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">and</span><span style="color: #000000"> table_schema = any(_schemas) </span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">and</span><span style="color: #000000"> table_type = </span><span style="color: #A31515">'BASE TABLE'</span></span>
<span class=line><span style="color: #000000">    )</span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">loop</span></span>
<span class=line><span style="color: #000000">        </span></span>
<span class=line><span style="color: #000000">        _cmd = </span><span style="color: #795E26">format</span><span style="color: #000000">(</span></span>
<span class=line><span style="color: #000000">            $</span><span style="color: #0000FF">sql</span><span style="color: #000000">$</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">or</span><span style="color: #000000"> </span><span style="color: #795E26">replace</span><span style="color: #000000"> trigger %</span><span style="color: #098658">1</span><span style="color: #000000">$I </span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">after</span><span style="color: #000000"> </span><span style="color: #0000FF">delete</span><span style="color: #000000"> </span><span style="color: #0000FF">or</span><span style="color: #000000"> </span><span style="color: #0000FF">update</span><span style="color: #000000"> </span><span style="color: #0000FF">on</span><span style="color: #000000"> %</span><span style="color: #098658">2</span><span style="color: #000000">$I.%</span><span style="color: #098658">3</span><span style="color: #000000">$I </span></span>
<span class=line><span style="color: #000000">            for each </span><span style="color: #0000FF">row</span><span style="color: #000000"> </span><span style="color: #0000FF">execute</span><span style="color: #000000"> </span><span style="color: #0000FF">procedure</span><span style="color: #000000"> %</span><span style="color: #098658">1</span><span style="color: #000000">$I();</span></span>
<span class=line><span style="color: #000000">            $</span><span style="color: #0000FF">sql</span><span style="color: #000000">$, </span></span>
<span class=line><span style="color: #000000">            _trigger, _schema, _table</span></span>
<span class=line><span style="color: #000000">        );</span></span>
<span class=line><span style="color: #000000">        </span></span>
<span class=line><span style="color: #000000">        raise info </span><span style="color: #A31515">'%'</span><span style="color: #000000">, </span><span style="color: #795E26">replace</span><span style="color: #000000">(_cmd, </span><span style="color: #A31515">'    '</span><span style="color: #000000">, </span><span style="color: #A31515">''</span><span style="color: #000000">);</span></span>
<span class=line><span style="color: #000000">        </span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">if</span><span style="color: #000000"> _dry_run </span><span style="color: #0000FF">is</span><span style="color: #000000"> false </span><span style="color: #0000FF">then</span></span>
<span class=line><span style="color: #000000">            </span><span style="color: #0000FF">execute</span><span style="color: #000000"> _cmd;</span></span>
<span class=line><span style="color: #000000">        </span><span style="color: #0000FF">end</span><span style="color: #000000"> </span><span style="color: #0000FF">if</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">        </span></span>
<span class=line><span style="color: #000000">    </span><span style="color: #0000FF">end</span><span style="color: #000000"> </span><span style="color: #0000FF">loop</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span>
<span class=line><span style="color: #000000">$$;</span></span></code></pre></div></div></div><div class="rightside svelte-2kl70j"><div class=svelte-2kl70j><ul class="navbar-nav sidenav svelte-2kl70j"><li class="nav-txt-divider text-muted svelte-2kl70j"><hr class=svelte-2kl70j><span class=svelte-2kl70j>on this page</span><hr class=svelte-2kl70j><li class="nav-item toc1 right svelte-2kl70j bookmark-nav"data-id=custom-temporal-tables-in-postgresql title="Custom Temporal Tables in PostgreSQL"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#custom-temporal-tables-in-postgresql>Custom Temporal Tables in PostgreSQL</a><li class="nav-item toc2 right svelte-2kl70j bookmark-nav"data-id=description title=Description><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#description>Description</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=1-function-temporal_table_trigger title="1) function temporal_table_trigger"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#1-function-temporal_table_trigger>1) function temporal_table_trigger</a><li class="nav-item toc3 right svelte-2kl70j bookmark-nav"data-id=2-function-init_temporal_tables title="2) function init_temporal_tables"><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#2-function-init_temporal_tables>2) function init_temporal_tables</a><li class="nav-item toc2 mt-2 right svelte-2kl70j bookmark-nav"data-id=script title=Script><a class="nav-link auto-close svelte-2kl70j bookmark-link"href=#script>Script</a></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],s=document.querySelectorAll("div.code");function k(e,t){for(var n=2;n<arguments.length;n++)e.classList.remove(arguments[n]);e.classList.add(t)}var t=document.getElementsByTagName("html")[0],a=i.querySelector("#theme-btn"),o="theme";function n(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<s.length;n++){var i=s[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",s=0;s<n.classList.length;s++)if(n.classList[s].startsWith("bi-")){i=n.classList[s];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}function e(e){r(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function l(e){r(e,function(e,t){var n=localStorage.getItem(o);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(o)?"light":"dark";localStorage.setItem(o,e),n(t.dataset.bsTheme=e)}),n(localStorage.getItem(o)),a.children[0].classList.remove("hidden");for(var c=0;c<s.length;c++)s[c].getElementsByClassName("copy-code")[0].addEventListener("click",e),s[c].getElementsByClassName("photo-code")[0].addEventListener("click",l);for(var d,E=function(){var a,s,o;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.children[1].children[0].querySelectorAll("[id]"),s=void 0,this.initNavs=function(e){o=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,s=0;s<o.length;s++)if(o[s].dataset.id==n){i=o[s];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(r(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),l()},f.children[1].addEventListener("scroll",l),this;function r(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function l(){if(o&&o.length){for(var e=0;e<o.length;e++)o[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=r(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),s&&clearTimeout(s),void(s=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),s=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),s&&clearTimeout(s),s=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),s=void 0},250))}}}(),h=function(){var r,l=i.querySelector("#nav-btn"),c=480,d="200px",h="0.25fr",v=730,m=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],e="sidebar-pinned",b=null==localStorage.getItem(e)||"true"==localStorage.getItem(e),p=!1,y=!1;function t(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?p?"100%":"0":b?""+d:"0",i=`grid-template-columns: ${n} 1fr`,s=t&&p?"width: 100%":"0"!=n?"":"display: none",a=t&&p?"display: none":"",o=t?p?"sidebar-show":"sidebar-hide":b?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(h&&v&&m&&(n&&e<m||!n&&e<v?y||(u.innerHTML=r+g.innerHTML,E.initNavs(u),y=!0):y&&(u.innerHTML=r,E.initNavs(g),y=!1)),!h||t||y?(i+=";",f.children[2].style.display="none"):(i+=` ${h};`,f.children[2].style.display="")),k(l,!t&&b||t&&p?"rotate":"rotate-back","rotate","rotate-back"),b?l.classList.add("text-shadow"):l.classList.remove("text-shadow"),f.style=L?i:"display: grid;",L&&k(L,o,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=s),w.style=a}function n(){window.outerWidth<c?p=!p:b=!b,localStorage.setItem(e,b.toString()),t(),b?l.classList.add("text-shadow"):l.classList.remove("text-shadow")}return h&&v&&m&&g&&(r=u.innerHTML,E.initNavs(g)),l.addEventListener("click",n),(window.onresize=t)(),this.closeSidebar=function(){window.outerWidth<c&&p&&n()},this}(),v=document.getElementsByClassName("auto-close"),m=0;m<v.length;m++)v[m].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(d=document.getElementById(location.hash.replace("#","")))&&d.scrollIntoView()}();</script><script src=/bootstrap.bundle.min.js></script><script>!function(){for(var t=document.querySelectorAll('[data-bs-toggle="tooltip"]'),e=0;e<t.length;e++)new bootstrap.Tooltip(t[e]);var o=document.getElementsByClassName("accordion-item");if(o.length)for(e=0;e<o.length;e++){var l=o[e];l.querySelectorAll("[href='"+document.location.pathname+"']").length&&l.firstChild.click()}}();</script><script src=/html2canvas.min.js></script><script async defer src=https://buttons.github.io/buttons.js></script><script async data-id=101435862 src=//static.getclicky.com/js></script>