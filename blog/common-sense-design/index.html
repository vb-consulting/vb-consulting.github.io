<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Common Sense Software Design</title><meta name="description" content="Common Sense Software Design Approach for RDBMS-backed Type of Software"><link href="https://vb-consulting.github.io/blog/common-sense-design/" rel="canonical"><meta name="keywords" content="software, development, software-development, software-architecture, architecture"><meta name="author" content="floki"><meta prefix="og: http://ogp.me/ns#" property="og:title" content="Common Sense Software Design"><meta prefix="og: http://ogp.me/ns#" property="og:description" content="Common Sense Software Design Approach for RDBMS-backed Type of Software"><meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://vb-consulting.github.io/arch-trans.png"><meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"><meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="VB-Consulting"><meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://vb-consulting.github.io/blog/common-sense-design/"><meta name="twitter:image" content="https://vb-consulting.github.io/arch-trans.png"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="Common Sense Software Design Approach for RDBMS-backed Type of Software"><link rel="stylesheet" href="/_elderjs/assets/svelte-360a39d4.css" media="all"><style></style><link href="/style.css?1712068377369" rel="stylesheet"><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script></head><body class="d-flex flex-column h-100"><header id="header"><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-30jr7w"><div class="container-fluid flex-nowrap svelte-30jr7w"><div class="d-flex svelte-30jr7w"><button id="nav-btn" type="button" class="d-flex btn btn-sm logo animate-rotate svelte-30jr7w"><i class="material-icons-outlined">menu</i></button> <a class="nav-link my-auto ms-2 fw-semibold home svelte-30jr7w" href="/"><i class="bi-chevron-double-left"></i> VB Home</a></div><div class="d-flex right svelte-30jr7w"><a class="nav-link my-auto svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="Become a Patreon" href="https://www.patreon.com/vbconsulting" target="_blank"><div class="patreon"></div></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><a class="nav-link my-auto svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="Buy Me a Coffee" href="https://www.buymeacoffee.com/vbilopavu" target="_blank"><div class="bmc"></div></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><a class="nav-link my-auto me-2 svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="vb-consulting on GitHub" href="https://github.com/vb-consulting"><i class="bi-github"></i></a> <a class="github-button svelte-30jr7w" href="https://github.com/vb-consulting" data-bs-toggle="tooltip" data-bs-html="true" title="Star vb-consulting on GitHub" data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;" data-icon="octicon-star" data-show-count="true" aria-label="Star vb-consulting on GitHub"></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><button id="theme-btn" type="button" aria-pressed="true" aria-label="theme" class="svelte-30jr7w"><span class="check hidden svelte-30jr7w"><span class="icon svelte-30jr7w"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><path fill="currentColor" d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M0 0h24v24H0z"></path><path fill="currentColor" d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class="svelte-9zwk14"><div class="sidebar sidebar-hide svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-item svelte-9zwk14" data-id="" title="VB-Consulting"><a class="nav-link svelte-9zwk14 text-uppercase" href="/">VB-Consulting</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/">NpgsqlRest</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="Norm.Net"><a class="nav-link svelte-9zwk14 text-uppercase" href="/norm.net/">Norm.Net</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="RazorSvelte"><a class="nav-link svelte-9zwk14 text-uppercase" href="/razorsvelte/">RazorSvelte</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PgRoutiner"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pgroutiner/">PgRoutiner</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="XUnit.Npgsql"><a class="nav-link svelte-9zwk14 text-uppercase" href="/xunit.npgsql/">XUnit.Npgsql</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PostrgeSQL Schema Tools"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pg_schema_tools/">PostrgeSQL Schema Tools</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">blogs</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="See all blogs..."><a class="nav-link btn btn-sm w-fit px-3 mx-auto svelte-9zwk14 lr-arrow text-uppercase" href="/blogs/"><i class="bi bi-arrow-right-circle svelte-9zwk14"></i> <span class="btn-link">ALL BLOGS</span></a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL Array Example"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-array/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PostgreSQL Arrays üêò</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-update1.6.2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest Update 1.6.2</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-v2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest v2 Update üêòüî•</a></li><li class="nav-item svelte-9zwk14" data-id="" title="How DDD is screwing up your SQL"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/sql-vs-ddd/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>How DDD is screwing up your SQL</a></li><li class="nav-item svelte-9zwk14 active" data-id="" title="Common Sense Software Design Approach for RDBMS-backed Type of Software"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/common-sense-design/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Common Sense Software Design</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL Paging Benchmarks"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-paging/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PostgreSQL Paging Benchmarks</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest NuGet Library</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL crazy experiment with the record type."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-record-type/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Execute Custom Function For Each Record</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL script that implements temporal tables without extension."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-temporal-tables/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Custom Temporal Tables in PostgreSQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Exploring a different approach to recursion with PostgreSQL by using recursive plpgsql function instead of recursive CTE query."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part1-different-type-of-recursion/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 1 - A Different Type of Recursion</a></li></ul></div></div><div class="content svelte-9zwk14"><div class="banner svelte-1bxfgrx" style="background-image: url(/arch-trans.png); background-position: center; background-blend-mode: luminosity;"></div><div class="container-sm main-content blog svelte-1bxfgrx bannered"><div class="blog-head svelte-1bxfgrx"><a href="https://github.com/vb-consulting/blog/blob/master/LICENSE" class="text-shadow svelte-1bxfgrx" style="color: white">CC0-1.0 license</a></div><div class="categories svelte-1bxfgrx"><a href="/blogs/general" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># general</span> </a><a href="/blogs/software-development" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># software development</span> </a><a href="/blogs/software-architecture" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># software architecture</span> </a><a href="/blogs/software-design" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># software design</span></a></div><h1 class="text-shadow" id="common-sense-software-design">Common Sense Software Design</h1><div class="post-meta text-shadow"><div></div><div class="post-details"><div class="post-pic" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog." style="background-image: url(/floki2.jpg)"></div><div class="post-details-right"><div class="post-share"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fcommon-sense-design%2F" class="me-1 bi-linkedin" data-bs-toggle="tooltip" data-bs-html="true" title="Share on LinkedIn"><i class=""></i></a> <a href="http://twitter.com/share?text=Common%20Sense%20Software%20Design%0ACommon%20Sense%20Software%20Design%20Approach%20for%20RDBMS-backed%20Type%20of%20Software%0A&url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fcommon-sense-design%2F&hashtags=software%20development%2Csoftware%20architecture%2Csoftware%20design" class="me-1 bi-twitter-x" data-bs-toggle="tooltip" data-bs-html="true" title="Share on X"><i class=""></i></a> <a href="#" class="copy-url bi-clipboard" data-bs-toggle="tooltip" data-bs-html="true" title="Copy URL"><i class=""></i></a></div><div class="post-author">floki</div><div class="post-date">Feb 20, 2024</div></div></div></div><p>This diagram is a representation of a design approach I refer to as the Common Sense Software Design for RDBMS-backed type of software.</p><p style="text-align: center; width: 100%"><img class="img" src="/arch-trans.png"></p><h2 id="1-service-class">1) Service Class</h2><p>Service class does stuff.</p><p>It is the complete feature implementation that fulfills functional requirements:</p><ul><li>Use parameters or requests to:<ul><li>Create database queries, either with SQL or ORM, and execute and retrieve the data.</li><li>Call stored procedures or database functions, and retrieve the data.</li></ul></li><li>Process the database results and form results or responses.</li></ul><p>Pseudo example:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">MyFeature</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">Database</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">db</span><span style="color: #E6E6E6"> </span><span style="color: #6A9955">/*, other dependencies*/</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">ServiceMethod1</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p1</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p2</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #6A9955">        // do stuff with p1 and p2</span></span>
<span class="line"><span style="color: #6A9955">        // create query with sql or orm</span></span>
<span class="line"><span style="color: #6A9955">        // call database</span></span>
<span class="line"><span style="color: #6A9955">        // retrive results</span></span>
<span class="line"><span style="color: #6A9955">        // return results</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #4EC9B0">Method2Response</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">ServiceMethod2</span><span style="color: #E6E6E6">(</span><span style="color: #4EC9B0">Method2Request</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">request</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #6A9955">        // result values are complicated (more values) so we return a response structure (class or record or named tuple) </span></span>
<span class="line"><span style="color: #6A9955">        // parameters are complicated (more then three values usually) so we accept a request structure (class or record or named tuple) </span></span>
<span class="line"><span style="color: #6A9955">        // everything else is the same as ServiceMethod1 pseudo example</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">MyFeature</span><span style="color: #000000">(</span><span style="color: #267F99">Database</span><span style="color: #000000"> </span><span style="color: #001080">db</span><span style="color: #000000"> </span><span style="color: #008000">/*, other dependencies*/</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #795E26">ServiceMethod1</span><span style="color: #000000">(</span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">p1</span><span style="color: #000000">, </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">p2</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #008000">        // do stuff with p1 and p2</span></span>
<span class="line"><span style="color: #008000">        // create query with sql or orm</span></span>
<span class="line"><span style="color: #008000">        // call database</span></span>
<span class="line"><span style="color: #008000">        // retrive results</span></span>
<span class="line"><span style="color: #008000">        // return results</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #267F99">Method2Response</span><span style="color: #000000"> </span><span style="color: #795E26">ServiceMethod2</span><span style="color: #000000">(</span><span style="color: #267F99">Method2Request</span><span style="color: #000000"> </span><span style="color: #001080">request</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #008000">        // result values are complicated (more values) so we return a response structure (class or record or named tuple) </span></span>
<span class="line"><span style="color: #008000">        // parameters are complicated (more then three values usually) so we accept a request structure (class or record or named tuple) </span></span>
<span class="line"><span style="color: #008000">        // everything else is the same as ServiceMethod1 pseudo example</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><p>There are no:</p><ul><li>Repository patterns.</li><li>Unit Of Work patterns.</li><li>No generic patterns.</li><li>No domain model, no domain model, no value object, no aggregate roots, none of that.</li><li>No needless mapping or useless abstractions.</li></ul><p>Most of the logic is executed in the RDBMS, closer to actual data, either with raw SQL or crafted with ORM, or ideally via Stored Procedures/Functions.</p><p>Logic may be executed on the RDBMS client (service classes) as needed and if needed, while service public interfaces remain the same and unchanged.</p><h2 id="2-rest-api--grpc--ui">2) REST API / gRPC / UI</h2><p>This layer is a concrete implementation that calls the service <code>MyFeature</code> methods.</p><p>Sometimes this is just a REST API that returns a value from a service or entire service response (as is, no mapping).</p><p>Sometimes this layer facilitates server-side rendering and uses a service response (as is, no mapping) to render some UI template on the server.</p><p>Sometimes we want to be able to use some different type of service like gRPC.</p><p>It's common sense to keep those layers separated.</p><h2 id="3-rdbms">3) RDBMS</h2><p>RDBMS holds the physical implementation of the logical data model in relational form. For example:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">begin</span><span style="color: #E6E6E6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">addresses</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">generated</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">always</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">identity</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">primary key</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    street </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    city </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">customers</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    customer_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">generated</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">always</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">identity</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">primary key</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> addresses</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">customer_addresses</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    customer_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> customers,</span></span>
<span class="line"><span style="color: #E6E6E6">    address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> addresses,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">primary key</span><span style="color: #E6E6E6"> (customer_id, address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">alter</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> customers </span><span style="color: #569CD6">add</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">constraint</span><span style="color: #E6E6E6"> fk_customer_addresses</span></span>
<span class="line"><span style="color: #569CD6">foreign key</span><span style="color: #E6E6E6"> (customer_id, address_id) </span></span>
<span class="line"><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> customer_addresses;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">begin</span><span style="color: #000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">addresses</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    address_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">generated</span><span style="color: #000000"> </span><span style="color: #0000FF">always</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">identity</span><span style="color: #000000"> </span><span style="color: #0000FF">primary key</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    street </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    city </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">customers</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    customer_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">generated</span><span style="color: #000000"> </span><span style="color: #0000FF">always</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">identity</span><span style="color: #000000"> </span><span style="color: #0000FF">primary key</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">name</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    address_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">references</span><span style="color: #000000"> addresses</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">customer_addresses</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    customer_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">references</span><span style="color: #000000"> customers,</span></span>
<span class="line"><span style="color: #000000">    address_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">references</span><span style="color: #000000"> addresses,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">primary key</span><span style="color: #000000"> (customer_id, address_id)</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">alter</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> customers </span><span style="color: #0000FF">add</span><span style="color: #000000"> </span><span style="color: #0000FF">constraint</span><span style="color: #000000"> fk_customer_addresses</span></span>
<span class="line"><span style="color: #0000FF">foreign key</span><span style="color: #000000"> (customer_id, address_id) </span></span>
<span class="line"><span style="color: #0000FF">references</span><span style="color: #000000"> customer_addresses;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span></code></pre></div><p>This is a general-purpose data model that uses relational notation to implement a conceptual model of reality in a database.</p><p>Use appropriate tools and techniques to maintain this data model such as:</p><ul><li>Handcrafted migrations, written with SQL.</li><li>ORM migration tools.</li><li>External tools such as Flyway, and other (schema sync tools, etc).</li></ul><h2 id="4-unit-tests">4) Unit Tests</h2><p>A set of unit tests that test and assert features implemented in the service classes.</p><p>These tests will use a test database that is created on every test session, for example:</p><ul><li>Using Docker containers.</li><li>Using local database server instance.</li></ul><p>As needed, tests will either clone the test database as a template or create an empty database and run all migrations from zero</p><p>Also, to ensure test isolation as needed every test may or may not be in a separate transaction that is rolled back after the test.</p><p>There are many different approaches to this type of testing and it may depend on the system requirements. One of the possible approaches when using the PostgreSQL database can be the <a href="https://vb-consulting.github.io/xunit.npgsql/"><code>XUnit.Npgsql</code></a> unit test utility library but there are many others, the common one is to use Docker containers.</p><p>The point is that the RDBMS should not be mocked or faked ever.</p><p><strong>If you are not testing stuff in the RDBMS, what are you testing then?</strong></p><p>Other than that, mocks and fakes for other external systems such as file systems or external services are a normal part of the testing process, and they can be injected through the constructor injection.</p><h2 id="5-integration-tests">5) Integration Tests</h2><p>These can be anything from simple REST API tests to complicated automated UI testing systems such as Puppeteer, Playwright, Selenium or others.</p><div class="w-fit mx-auto mt-5 mb-3 border-top"><div class="alert text-center fs-smaller text-muted">To receive notifications about new posts and updates, consider subscribing to my LinkdIn page:<br><a class="btn btn-sm" href="https://www.linkedin.com/in/vb-software/"><i class="bi-linkedin"></i> <span class="text-primary">vb-software linkedin</span></a><br><br>You will receive notifications about new posts on your LinkedIn feed.</div></div><div class="pt-5 border-top"><div id="comments-section" class="h5">Comments</div><script defer src="https://cdn.commento.io/js/commento.js" data-no-fonts="true" data-css-override="https://vb-consulting.github.io/style.css"></script><div id="commento"></div></div><footer class="mt-3 py-5"><div class="w-fit mx-auto mb-3 border-top border-bottom"><div class="alert text-center fs-smaller text-muted"><div class="alert text-center fs-smaller text-muted mb-1">If you like my content, use my software, or otherwise benefit from my work, consider supporting me by buying me a coffee. The software runs on coffee after all.</div><a class="btn rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="Click Here to Buy Me a Coffee Or Scan the Code" href="https://www.buymeacoffee.com/vbilopavu" style="display: inline-grid;">Buy me a Coffee <img class="m-auto svelte-byttq0" alt="Scan Here To Buy Me a Cofee" src="/bmc_qr.png"></a></div></div><div class="d-flex justify-content-center"><a class="btn rl-arrow me-1" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="vb-consulting on GitHub" href="https://github.com/vb-consulting" style="display: inline-grid;">vb-consulting on GitHub <i class="bi bi-github"></i></a> <a class="btn rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="I Post Software Development Content Daily" href="https://www.linkedin.com/in/vb-software/" style="display: inline-grid;">Follow me on LinkedIn <i class="bi bi-linkedin"></i></a></div><div class="text-center"><div class="mt-5 mb-5 background-floki svelte-byttq0" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog."></div></div></footer><div class="mb-5"></div></div></div><div class="rightside svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">on this page</span><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="common-sense-software-design" title="Common Sense Software Design"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#common-sense-software-design">Common Sense Software Design</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="1-service-class" title="1) Service Class"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#1-service-class">1) Service Class</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="2-rest-api--grpc--ui" title="2) REST API / gRPC / UI"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#2-rest-api--grpc--ui">2) REST API / gRPC / UI</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="3-rdbms" title="3) RDBMS"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#3-rdbms">3) RDBMS</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="4-unit-tests" title="4) Unit Tests"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#4-unit-tests">4) Unit Tests</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="5-integration-tests" title="5) Integration Tests"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#5-integration-tests">5) Integration Tests</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="comments-section" title="Comments"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#comments-section">Comments</a></li></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],o=document.querySelectorAll("div.code"),k=i.querySelector(".home");function E(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n])}function T(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n]);E(e,t),e.classList.add(t)}function t(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",o=0;o<n.classList.length;o++)if(n.classList[o].startsWith("bi-")){i=n.classList[o];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}"/"==document.location.pathname&&T(k,"d-none");var e=document.querySelector(".post-share > .copy-url"),n=(e&&e.addEventListener("click",function(e){t(e,function(e,t){navigator.clipboard.writeText(document.location.origin+document.location.pathname),t()})}),document.getElementsByTagName("html")[0]),a=i.querySelector("#theme-btn"),s="theme";function l(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<o.length;n++){var i=o[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e){t(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function c(e){t(e,function(e,t){var n=localStorage.getItem(s);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(s)?"light":"dark";localStorage.setItem(s,e),l(n.dataset.bsTheme=e)}),l(localStorage.getItem(s)),a.children[0].classList.remove("hidden");for(var d=0;d<o.length;d++){o[d].getElementsByClassName("copy-code")[0].addEventListener("click",r);var m=o[d].getElementsByClassName("photo-code");m.length&&m[0].addEventListener("click",c)}for(var S=function(){var a,o,s;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.querySelector(".main-content").querySelectorAll("[id]"),o=void 0,this.initNavs=function(e){s=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,o=0;o<s.length;o++)if(s[o].dataset.id==n){i=s[o];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(l(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),r()},f.children[1].addEventListener("scroll",r),this;function l(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function r(){if(s&&s.length){for(var e=0;e<s.length;e++)s[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=l(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),o&&clearTimeout(o),void(o=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),o=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),o&&clearTimeout(o),o=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),o=void 0},250))}}}(),h=function(){var l,r=i.querySelector("#nav-btn"),c=480,d="200px",m="0.25fr",h=730,v=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],t="sidebar-pinned",p=null==localStorage.getItem(t)||"true"==localStorage.getItem(t),y=!1,b=!1;function n(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?y?"100%":"0":p?""+d:"0",i=`grid-template-columns: ${n} 1fr`,o=t&&y?"width: 100%":"0"!=n?"":"display: none",a=t&&y?"display: none":"",s=t?y?"sidebar-show":"sidebar-hide":p?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(m&&h&&v&&(n&&e<v||!n&&e<h?b||(u.innerHTML=l+g.innerHTML,S.initNavs(u),b=!0):b&&(u.innerHTML=l,S.initNavs(g),b=!1)),!m||t||b?(i+=";",f.children[2].style.display="none"):(i+=` ${m};`,f.children[2].style.display="")),T(r,!t&&p||t&&y?"rotate":"rotate-back","rotate","rotate-back"),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),f.style=L?i:"display: grid;",L&&T(L,s,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=o),w.style=a,t&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),t&&y&&T(k,"d-none")}function e(){var e=window.outerWidth<c;e?y=!y:p=!p,localStorage.setItem(t,p.toString()),n(),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),e&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),e&&y&&T(k,"d-none")}return m&&h&&v&&g&&(l=u.innerHTML,S.initNavs(g)),r.addEventListener("click",e),(window.onresize=n)(),this.closeSidebar=function(){window.outerWidth<c&&y&&e()},this}(),v=document.getElementsByClassName("auto-close"),u=0;u<v.length;u++)v[u].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(e=document.getElementById(location.hash.replace("#","")))&&e.scrollIntoView()}();</script><script src="/bootstrap.bundle.min.js"></script><script>!function(){for(var e=document.querySelectorAll('[data-bs-toggle="tooltip"]'),t=0;t<e.length;t++)new bootstrap.Tooltip(e[t]);var n=document.getElementsByClassName("accordion-item");if(n.length){for(t=0;t<n.length;t++){var o=n[t];o.querySelectorAll("[href='"+document.location.pathname+"']").length&&o.firstChild.click()}var l=document.querySelector("nav.navbar").querySelector(".home"),a=document.getElementsByClassName("accordion");"/"==document.location.pathname&&l.classList.add("d-none");for(t=0;t<n.length;t++){var s=a[t];s&&s.firstChild&&"VB-Consulting"==s.firstChild.title&&(null!=s.firstChild.querySelector(".collapse")&&l.classList.contains("d-none")&&"/"!=document.location.pathname&&l.classList.remove("d-none"),s.addEventListener("show.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none"),l.classList.add("d-none")}),s.addEventListener("hide.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none")}))}}}();</script><script src="/html2canvas.min.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script></body><script async data-id="101435862" src="//static.getclicky.com/js"></script></html>