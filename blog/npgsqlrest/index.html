<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NpgsqlRest NuGet Library</title><meta name="description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><link href="https://vb-consulting.github.io/blog/npgsqlrest/" rel="canonical"><meta name="keywords" content="api, api-rest, restful-api, http, postgres, dotnet, net8, c#, aot, database, rest, server, postgresql, npgsqlrest, pgsql, pg, automatic"><meta name="author" content="floki"><meta prefix="og: http://ogp.me/ns#" property="og:title" content="NpgsqlRest NuGet Library"><meta prefix="og: http://ogp.me/ns#" property="og:description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://vb-consulting.github.io/eleph1.jpg"><meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"><meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="VB-Consulting"><meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://vb-consulting.github.io/blog/npgsqlrest/"><meta name="twitter:image" content="https://vb-consulting.github.io/eleph1.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><link rel="stylesheet" href="/_elderjs/assets/svelte-d06e95d0.css" media="all"><style></style><link href="/style.css?1707564472015" rel="stylesheet"><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script></head><body class="d-flex flex-column h-100"><header id="header"><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-30jr7w"><div class="container-fluid flex-nowrap svelte-30jr7w"><div class="d-flex svelte-30jr7w"><button id="nav-btn" type="button" class="d-flex btn btn-sm logo animate-rotate svelte-30jr7w"><i class="material-icons-outlined">menu</i></button> <a class="nav-link my-auto ms-2 fw-semibold home svelte-30jr7w" href="/"><i class="bi-chevron-double-left"></i> VB Home</a></div><div class="d-flex right svelte-30jr7w"><a class="nav-link my-auto svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="Buy Me a Coffee" href="https://www.buymeacoffee.com/vbilopavu"><div class="bmc"></div></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><a class="nav-link my-auto me-2 svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="NpgsqlRest on GitHub" href="https://github.com/vb-consulting/NpgsqlRest"><i class="bi-github"></i></a> <a class="github-button svelte-30jr7w" href="https://github.com/vb-consulting/NpgsqlRest" data-bs-toggle="tooltip" data-bs-html="true" title="Star NpgsqlRest on GitHub" data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;" data-icon="octicon-star" data-show-count="true" aria-label="Star NpgsqlRest on GitHub"></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><button id="theme-btn" type="button" aria-pressed="true" aria-label="theme" class="svelte-30jr7w"><span class="check hidden svelte-30jr7w"><span class="icon svelte-30jr7w"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><path fill="currentColor" d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M0 0h24v24H0z"></path><path fill="currentColor" d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class="svelte-9zwk14"><div class="sidebar sidebar-hide svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-item svelte-9zwk14" data-id="" title="VB-Consulting"><a class="nav-link svelte-9zwk14 text-uppercase" href="/">VB-Consulting</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/">NpgsqlRest</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="Norm.Net"><a class="nav-link svelte-9zwk14 text-uppercase" href="/norm.net/">Norm.Net</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="RazorSvelte"><a class="nav-link svelte-9zwk14 text-uppercase" href="/razorsvelte/">RazorSvelte</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PgRoutiner"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pgroutiner/">PgRoutiner</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="XUnit.Npgsql"><a class="nav-link svelte-9zwk14 text-uppercase" href="/xunit.npgsql/">XUnit.Npgsql</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PostrgeSQL Schema Tools"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pg_schema_tools/">PostrgeSQL Schema Tools</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">blogs</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="See all blogs..."><a class="nav-link btn btn-sm w-fit px-3 mx-auto svelte-9zwk14 lr-arrow text-uppercase" href="/blogs/"><i class="bi bi-arrow-right-circle svelte-9zwk14"></i> <span class="btn-link">ALL BLOGS</span></a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-update1.6.2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest Update 1.6.2</a></li><li class="nav-item svelte-9zwk14 active" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest NuGet Library</a></li><li class="nav-item svelte-9zwk14" data-id="" title="What are the Micro ORM libraries, why do they even exist, what are their purpose, what are they used for, and what are the alternatives?"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/micro-orm/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>What is Micro ORM?</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PgRoutinerConcept"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/pgroutiner/concept/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PgRoutiner Concept</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Database-First Tool for Development With .NET And PostgreSQL Native Build"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/pgroutiner/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PgRoutiner Blog</a></li><li class="nav-item svelte-9zwk14" data-id="" title="The world's tiniest, smallest ORM for .NET"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/piko-orm/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Piko ORM</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL crazy experiment with the record type."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-record-type/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Execute Custom Function For Each Record</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL script that implements temporal tables without extension."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-temporal-tables/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Custom Temporal Tables in PostgreSQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Exploring a different approach to recursion with PostgreSQL by using recursive plpgsql function instead of recursive CTE query."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part1-different-type-of-recursion/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 1 - A Different Type of Recursion</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Follow-Up 1 on PostgreSQL recursive function. Some performance optimizations."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part2-performances/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 2 - Performances</a></li></ul></div></div><div class="content svelte-9zwk14"><div class="banner svelte-1jzqpn5" style="background-image: url(/eleph1.jpg); background-position: center; background-blend-mode: luminosity;"></div><div class="container-sm main-content blog svelte-1jzqpn5 bannered"><div class="blog-head svelte-1jzqpn5"><a href="https://github.com/vb-consulting/blog/blob/master/LICENSE" class="text-shadow svelte-1jzqpn5" style="color: white">CC0-1.0 license</a></div><div class="categories svelte-1jzqpn5"><a href="/blogs/npgsqlrest" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># npgsqlrest</span> </a><a href="/blogs/rest" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># rest</span> </a><a href="/blogs/postgres" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># postgres</span> </a><a href="/blogs/postgresql" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># postgresql</span> </a><a href="/blogs/dotnet" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># dotnet</span> </a><a href="/blogs/net8" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># net8</span> </a><a href="/blogs/c#" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># c#</span> </a><a href="/blogs/aot" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># aot</span></a></div><h1 class="text-shadow" id="npgsqlrest-nuget-library">NpgsqlRest NuGet Library</h1><div class="post-meta text-shadow"><div class="post-share"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fnpgsqlrest%2F" class="me-1 bi-linkedin" data-bs-toggle="tooltip" data-bs-html="true" title="Share on LinkedIn"><i class=""></i></a> <a href="http://twitter.com/share?text=NpgsqlRest%20NuGet%20Library%0AAutomatic%20REST%20API%20for%20PostgreSQL%20Database%20as%20.NET8%20Middleware%0A&url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fnpgsqlrest%2F&hashtags=npgsqlrest%2Crest%2Cpostgres%2Cpostgresql%2Cdotnet%2Cnet8%2Cc%23%2Caot" class="me-1 bi-twitter-x" data-bs-toggle="tooltip" data-bs-html="true" title="Share on X"><i class=""></i></a> <a href="#" class="copy-url bi-clipboard" data-bs-toggle="tooltip" data-bs-html="true" title="Copy URL"><i class=""></i></a></div><div class="post-details"><div class="post-pic" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog." style="background-image: url(/floki.jpeg)"></div><div class="post-details-right"><div class="post-author">floki</div><div class="post-date">Jan 23, 2024</div></div></div></div><p><a href="https://github.com/vb-consulting/NpgsqlRest"><code>NpgsqlRest</code></a> is a .NET8 NuGet library that can build a RESTful API from the existing PostgreSQL routines (functions or procedures) with a single extension on a web application builder.</p><p>You can think of it as <a href="https://postgrest.org/en/stable/references/api/stored_procedures.html"><code>PostgREST</code></a>, but only for routines (functions or procedures), since <code>PostgREST</code> is doing a lot more. It is implemented as .NET8 middleware so you can create custom builds, or integrate with your .NET8 projects, and it is highly customizable, with some unique features.</p><p>The library is AOT-ready, which means it can utilize <a href="https://learn.microsoft.com/en-us/dotnet/core/deploying/native-aot/">.NET AOT feature</a> to create self-contained, native binary executables, but more on that later.</p><h2 id="motivation">Motivation</h2><p>This is built to be a crucial part of the future low-code data platform based on PostgreSQL. And, as such it was built to satisfy very specific requirements (as opposed to catering to a wider audience). For example, it has two dependencies 1) the latest <code>Microsoft.NET.Sdk.Web</code> that targets <code>net8.0</code> framework. 2) the latest <code>Npgsql</code> ADO.NET Data Provider for PostgreSQL (current version 8.0.1). Those dependencies will be updated with each new release. If you need to work with older versions, you need to either 1) update them in your project - or - 2) clone the <code>NpgsqlRest</code> repository and make a custom build with downgraded dependencies.</p><p>Furthermore, future developments such as new features highly depend on the main project that will be using this library, but with the right sponsorship, anything is possible.</p><h2 id="features-and-usage">Features and Usage</h2><p>Most basic usage in a standard .NET8 web application looks like this:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlRest</span><span style="color: #E6E6E6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">WebApplication</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">CreateBuilder</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">args</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Build</span><span style="color: #E6E6E6">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">ConnectionString</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"Host=localhost;Port=5432;Database=my_db;Username=postgres;Password=postgres"</span></span>
<span class="line"><span style="color: #6A9955">    //</span></span>
<span class="line"><span style="color: #6A9955">    // the rest of the options goes here</span></span>
<span class="line"><span style="color: #6A9955">    //</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Run</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlRest</span><span style="color: #000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">builder</span><span style="color: #000000"> = </span><span style="color: #001080">WebApplication</span><span style="color: #000000">.</span><span style="color: #795E26">CreateBuilder</span><span style="color: #000000">(</span><span style="color: #001080">args</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">app</span><span style="color: #000000"> = </span><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #795E26">Build</span><span style="color: #000000">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">ConnectionString</span><span style="color: #000000"> = </span><span style="color: #A31515">"Host=localhost;Port=5432;Database=my_db;Username=postgres;Password=postgres"</span></span>
<span class="line"><span style="color: #008000">    //</span></span>
<span class="line"><span style="color: #008000">    // the rest of the options goes here</span></span>
<span class="line"><span style="color: #008000">    //</span></span>
<span class="line"><span style="color: #000000">});</span></span>
<span class="line"></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">Run</span><span style="color: #000000">();</span></span></code></pre></div><p>So, all you need to do is call <code>UseNpgsqlRest</code> extension for your web application builder and provide a valid <code>Npgsql</code> connection string for the PostgreSQL database. Of course, there are many available options that you can use to configure all endpoints are specific endpoints. The best way to explore available options is to check out the source code for the <a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/NpgsqlRest/NpgsqlRestOptions.cs#L41"><code>NpgsqlRestOptions</code></a> class.</p><p>And now, if you happen to have some PostgreSQL functions, like for example this hello world functions:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">hello_world</span><span style="color: #E6E6E6">()         </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> $$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'Hello World'</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">hello_world</span><span style="color: #000000">()         </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> $$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #A31515">'Hello World'</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p>You will have a new RESTful endpoint exposed in your .NET application.</p><p>This endpoint will be a POST, currently implemented rules are:</p><p>The endpoint is GET if the routine name either:</p><ul><li>Starts with <code>get_</code> (case insensitive).</li><li>Ends with <code>_get</code> (case insensitive).</li><li>Contains <code>_get_</code> (case insensitive).</li></ul><p>Otherwise, the endpoint is POST if the volatility option is VOLATILE (PostgreSQL default). These types of functions are assumed to be changing some data. Of course, all of that is highly configurable either through code options or through comment annotations which we will see later.</p><p>And now, in order to enable endpoint discovery and to facilitate testing and debugging, <code>NpgsqlRest</code> can build an HTTP file for testing. HTTP files are not enabled by default, so they have to be enabled in the builder options:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">()</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">ConnectionString</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"Host=localhost;Port=5432;Database=my_db;Username=postgres;Password=postgres"</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">HttpFileOptions</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">() { </span><span style="color: #9CDCFE">FileOverwrite</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6"> }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">()</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">ConnectionString</span><span style="color: #000000"> = </span><span style="color: #A31515">"Host=localhost;Port=5432;Database=my_db;Username=postgres;Password=postgres"</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">HttpFileOptions</span><span style="color: #000000"> = </span><span style="color: #0000FF">new</span><span style="color: #000000">() { </span><span style="color: #001080">FileOverwrite</span><span style="color: #000000"> = </span><span style="color: #0000FF">true</span><span style="color: #000000"> }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><p>This will produce the following HTTP file, which we can use for further testing and debugging with Visual Studio or VS Code (with REST Clint extensions):</p><div class="code http"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">@</span><span style="color: #9CDCFE">host</span><span style="color: #E6E6E6">=</span><span style="color: #CE9178">http://localhost:5000</span><span style="color: #E6E6E6">        </span></span>
<span class="line"></span>
<span class="line"><span style="color: #6A9955">// function public.hello_world()</span></span>
<span class="line"><span style="color: #6A9955">// returns text</span></span>
<span class="line"><span style="color: #C586C0">POST</span><span style="color: #E6E6E6"> {{!host!}}/api/hello-world</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">@</span><span style="color: #001080">host</span><span style="color: #000000">=</span><span style="color: #A31515">http://localhost:5000</span><span style="color: #000000">        </span></span>
<span class="line"></span>
<span class="line"><span style="color: #008000">// function public.hello_world()</span></span>
<span class="line"><span style="color: #008000">// returns text</span></span>
<span class="line"><span style="color: #AF00DB">POST</span><span style="color: #000000"> {{!host!}}/api/hello-world</span></span></code></pre></div><ul><li><em>Note that <code>!host!</code> is, actually, just <code>host</code>, my template parser for this website is just screwing with me.</em></li></ul><p>Anyway, you can notice that the HTTP file also contains a nicely formatted comment header with a basic function signature, to be clear about what exactly function will be executed. You can include even the entire function definition in this file if you want. Also, if you happen to have some parameters, the HTTP file will contain test parameters populated so that the endpoint is ready to be executed immediately.</p><p>And, when this endpoint is executed, the results are as expected:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">HTTP/1.1 200 OK                       </span></span>
<span class="line"><span style="color: #E6E6E6">Connection: close</span></span>
<span class="line"><span style="color: #E6E6E6">Content-Type: text/plain</span></span>
<span class="line"><span style="color: #E6E6E6">Date: Tue, 09 Jan 2024 14:25:26 GMT</span></span>
<span class="line"><span style="color: #E6E6E6">Server: Kestrel</span></span>
<span class="line"><span style="color: #E6E6E6">Transfer-Encoding: chunked</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">Hello World</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">HTTP/1.1 200 OK                       </span></span>
<span class="line"><span style="color: #000000">Connection: close</span></span>
<span class="line"><span style="color: #000000">Content-Type: text/plain</span></span>
<span class="line"><span style="color: #000000">Date: Tue, 09 Jan 2024 14:25:26 GMT</span></span>
<span class="line"><span style="color: #000000">Server: Kestrel</span></span>
<span class="line"><span style="color: #000000">Transfer-Encoding: chunked</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">Hello World</span></span></code></pre></div><p>That would be a basic usage (with HTTP file generation enabled). Other features may include (incomplete list):</p><ul><li>Array parameters in query strings or JSON body and array type serialization in responses.</li><li>Entire body content to single parameter assignment.</li><li>Comment annotation endpoint configuration.</li><li>Default parameters support.</li><li>Schema control (different paths, HTTP files).</li><li>Parameter overloading.</li><li>Sending request headers as context, or as a parameter (or neither).</li><li>Returning set of primitive types.</li><li>Returning tables.</li><li>Returning set of existing tables (table-valued functions).</li><li>Returning set of record types (untyped functions).</li><li>Unnamed parameters support.</li><li>Variadic parameters support.</li><li>Custom naming conventions for URLs, request parameters or response JSON fields.</li><li>Custom validation events and custom parameter values.</li></ul><p>Untyped functions have shown to be a very useful feature because underlying function doesn't require resulting table definition at all:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">get_test_records</span><span style="color: #E6E6E6">() </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> setof record </span><span style="color: #6A9955">-- see, no table defintion</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">values</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'one'</span><span style="color: #E6E6E6">), </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'two'</span><span style="color: #E6E6E6">), </span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #B5CEA8">3</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">'three'</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">) v;</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">get_test_records</span><span style="color: #000000">() </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> setof record </span><span style="color: #008000">-- see, no table defintion</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> * </span><span style="color: #0000FF">from</span><span style="color: #000000"> (</span><span style="color: #0000FF">values</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">1</span><span style="color: #000000">, </span><span style="color: #A31515">'one'</span><span style="color: #000000">), </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">2</span><span style="color: #000000">, </span><span style="color: #A31515">'two'</span><span style="color: #000000">), </span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #098658">3</span><span style="color: #000000">, </span><span style="color: #A31515">'three'</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">) v;</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p>But, on the other hand, calling clients have to know which types to expect, because the resulting response will be a JSON array where every element is an array of raw PostgreSQL values encoded as JSON string.</p><p>Another interesting feature is the custom validation events. When, for example, you want to supply some custom value from your code to some parameters, The common example is sending <code>Context.User.Identity.Name</code> value as a function parameter:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">ValidateParameters</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #6A9955">        //</span></span>
<span class="line"><span style="color: #6A9955">        // If user is authenticated and parameter name is "user", always send Context.User.Identity.Name</span></span>
<span class="line"><span style="color: #6A9955">        //</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> (</span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">User</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Identity</span><span style="color: #D4D4D4">?</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">IsAuthenticated</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">==</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">true</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&&</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equals</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">ParamName</span><span style="color: #E6E6E6">, </span><span style="color: #CE9178">"user"</span><span style="color: #E6E6E6">, </span><span style="color: #9CDCFE">StringComparison</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">OrdinalIgnoreCase</span><span style="color: #E6E6E6">))</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Parameter</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Value</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">User</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Identity</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">    } </span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">ValidateParameters</span><span style="color: #000000"> = </span><span style="color: #001080">p</span><span style="color: #000000"> =></span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #008000">        //</span></span>
<span class="line"><span style="color: #008000">        // If user is authenticated and parameter name is "user", always send Context.User.Identity.Name</span></span>
<span class="line"><span style="color: #008000">        //</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">Context</span><span style="color: #000000">.</span><span style="color: #001080">User</span><span style="color: #000000">.</span><span style="color: #001080">Identity</span><span style="color: #000000">?.</span><span style="color: #001080">IsAuthenticated</span><span style="color: #000000"> == </span><span style="color: #0000FF">true</span><span style="color: #000000"> && </span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">string</span><span style="color: #000000">.</span><span style="color: #795E26">Equals</span><span style="color: #000000">(</span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">ParamName</span><span style="color: #000000">, </span><span style="color: #A31515">"user"</span><span style="color: #000000">, </span><span style="color: #001080">StringComparison</span><span style="color: #000000">.</span><span style="color: #001080">OrdinalIgnoreCase</span><span style="color: #000000">))</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">Parameter</span><span style="color: #000000">.</span><span style="color: #001080">Value</span><span style="color: #000000"> = </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">Context</span><span style="color: #000000">.</span><span style="color: #001080">User</span><span style="color: #000000">.</span><span style="color: #001080">Identity</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">    } </span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><p>There are also events when an endpoint is created and all endpoints are created which are very useful in the scenario where we want to generate some interfaces, like typescript interfaces for the frontend or even the entire fetch scripts, all required data is passed to these events.</p><p>For more usage examples for usage of these features, the best place is to check out the <a href="https://github.com/vb-consulting/NpgsqlRest/tree/master/NpgsqlRestTests">test project</a>.</p><p>Now, there are to very unique features, that I'd like to discuss a little bit deeper:</p><ol><li>Comment annotations.</li><li>AOT support.</li></ol><h5 id="comment-annotations">Comment Annotations</h5><p>The basic idea is that we can add text annotations to routine comments that can alter endpoint behavior and properties.</p><p>PostgreSQL supports adding custom comments to all objects since version, well, since forever. See the <a href="https://www.postgresql.org/docs/current/sql-comment.html">comment documentation</a>. You can add any text to your functions or procedures:</p><div class="code plsql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">COMMENT</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">ON</span><span style="color: #E6E6E6"> FUNCTION my_function (</span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">IS</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'Returns Roman Numeral'</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">COMMENT</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">ON</span><span style="color: #E6E6E6"> PROCEDURE my_proc (</span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">, </span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">IS</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'Runs a report'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">COMMENT</span><span style="color: #000000"> </span><span style="color: #0000FF">ON</span><span style="color: #000000"> FUNCTION my_function (</span><span style="color: #0000FF">timestamp</span><span style="color: #000000">) </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #A31515">'Returns Roman Numeral'</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">COMMENT</span><span style="color: #000000"> </span><span style="color: #0000FF">ON</span><span style="color: #000000"> PROCEDURE my_proc (</span><span style="color: #0000FF">integer</span><span style="color: #000000">, </span><span style="color: #0000FF">integer</span><span style="color: #000000">) </span><span style="color: #0000FF">IS</span><span style="color: #000000"> </span><span style="color: #A31515">'Runs a report'</span><span style="color: #000000">;</span></span></code></pre></div><p>In the example above <code>function hello_world()</code> generates HTTP endpoint <code>POST http://localhost:5000/api/hello-world</code>. We can change this to a GET endpoint with the following comment:</p><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #CE9178">'HTTP GET'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #A31515">'HTTP GET'</span><span style="color: #000000">;</span></span></code></pre></div></div><p>We can change the generated path to something else too:</p><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #CE9178">'HTTP GET /say-hello-world'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #A31515">'HTTP GET /say-hello-world'</span><span style="color: #000000">;</span></span></code></pre></div></div><p>Our endpoint is now <code>GET http://localhost:5000/say-hello-world</code>. This approach doesn't stop us from adding custom comments. If the comment line is not a recognizable annotation, it is simply ignored, since it is, well, just a comment. For example, the following comment has the same effect:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #CE9178">'Simple hello world example.</span></span>
<span class="line"><span style="color: #CE9178">HTTP GET /say-hello-world</span></span>
<span class="line"><span style="color: #CE9178">Another comment line...'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #A31515">'Simple hello world example.</span></span>
<span class="line"><span style="color: #A31515">HTTP GET /say-hello-world</span></span>
<span class="line"><span style="color: #A31515">Another comment line...'</span><span style="color: #000000">;</span></span></code></pre></div><p>Valid comment annotation has to be in line that starts with the HTTP and the next two optional words are the method verb and the URL. All additional annotations are below this HTTP line. For example, if we add a line that contains a colon (<code>:</code>) character below this HTTP line - that would be interpreted as a new request header where the left side of the colon is a key and the right side is the header value:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #CE9178">'HTTP GET /say-hello-world</span></span>
<span class="line"><span style="color: #CE9178">Content-Type: text/html</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #A31515">'HTTP GET /say-hello-world</span></span>
<span class="line"><span style="color: #A31515">Content-Type: text/html</span></span></code></pre></div><p>This forces content returned from the <code>GET /say-hello-world</code> to have a header <code>Content-Type: text/html</code>.</p><p>Note that these comments don't have to be controlled through code like this. For some people, it is much easier to do through administrator GUI such as provided with tools like pgAdmin or DBeaver, just click on function properties and you can fill the comment box in your GUI tool. But you do have to do it with a database user with elevated permissions (superuser or admin).</p><p>You can control lots of other cool stuff like this:</p><ul><li>Request parameters type (query string or JSON body). For example, <code>param-type query</code> line forces parameters in a query string.</li><li>Authorization control: Just adding <code>requires-authorization</code> or <code>authorize</code> will make the endpoint return not authorized if the user is not, well, authorized.</li><li>Command timeout: Add <code>timeout &lt;number></code> to set the command timeout to the number of seconds in the second parameter.</li><li>Request headers mode: Use <code>request-headers &lt;option></code> to set the mode to <code>ignore</code>, <code>context</code> (request headers are set to context) or <code>parameter</code> (request headers are set to parameter).</li><li>Request headers parameter name: Use <code>request-headers-param-name &lt;name></code> to set the name of the parameter where request headers are sent if the option <code>request-headers parameter</code> is set. The default is `header``, but you can change it here.</li><li>Body parameter name. You can bind an entire request body content to a single parameter with the <code>body-param-name &lt;name></code> annotation.</li></ul><p>More info on this can be found in a default endpoint parser code <a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/NpgsqlRest/DefaultEndpoint.cs">DefaultEndpoint.cs</a> and usage examples are also in a <a href="https://github.com/vb-consulting/NpgsqlRest/tree/master/NpgsqlRestTests">test project</a>.</p><p>By default, all comments will be parsed for annotations. This behavior can be changed in a builder options configuration:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #6A9955">// ignore comment annotations</span></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">) { </span><span style="color: #9CDCFE">CommentsMode</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">CommentsMode</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Ignore</span><span style="color: #E6E6E6"> });</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #008000">// ignore comment annotations</span></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">) { </span><span style="color: #001080">CommentsMode</span><span style="color: #000000"> = </span><span style="color: #001080">CommentsMode</span><span style="color: #000000">.</span><span style="color: #001080">Ignore</span><span style="color: #000000"> });</span></span></code></pre></div><p>If we set this mode to <code>OnlyWithHttpTag</code> value:</p><div class="one-liner"><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">) { </span><span style="color: #9CDCFE">CommentsMode</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">CommentsMode</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">OnlyWithHttpTag</span><span style="color: #E6E6E6"> });</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">) { </span><span style="color: #001080">CommentsMode</span><span style="color: #000000"> = </span><span style="color: #001080">CommentsMode</span><span style="color: #000000">.</span><span style="color: #001080">OnlyWithHttpTag</span><span style="color: #000000"> });</span></span></code></pre></div></div><p>Then, we can control is endpoint created at all. That means, that the comment must have at least an <code>HTTP</code> tag:</p><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #CE9178">'HTTP'</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">COMMENT ON FUNCTION hello_world () IS </span><span style="color: #A31515">'HTTP'</span><span style="color: #000000">;</span></span></code></pre></div></div><p>For the endpoint to be enabled at all. This way, we (or DB admin) can control the creation of the endpoint and choose what exactly functions and procedures are exposed as the HTTP endpoints.</p><h5 id="aot-support">AOT Support</h5><p>This was a design goal from the beginning. The idea is to create a native executable for the target platform (usually Linux) and just simply copy it on a server and run it as any other program. There is no need for any runtime, the executable is self-contained and it has a very fast startup time.</p><p>This, of course, is optional, AOT builds are not for every environment, and some requirements need to be satisfied (like no reflection code). But if you do choose to have AOT build, this is the minimal configuration.</p><p>First, you'll need an <code>&lt;PublishAot>true&lt;/PublishAot></code> tag in the property group of your project file. It can look like this:</p><div class="code xml"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #808080">&lt;</span><span style="color: #569CD6">Project</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Sdk</span><span style="color: #E6E6E6">=</span><span style="color: #CE9178">"Microsoft.NET.Sdk.Web"</span><span style="color: #808080">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">PropertyGroup</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">TargetFramework</span><span style="color: #808080">></span><span style="color: #E6E6E6">net8.0</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">TargetFramework</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">Nullable</span><span style="color: #808080">></span><span style="color: #E6E6E6">enable</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">Nullable</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">ImplicitUsings</span><span style="color: #808080">></span><span style="color: #E6E6E6">enable</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">ImplicitUsings</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">InvariantGlobalization</span><span style="color: #808080">></span><span style="color: #E6E6E6">true</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">InvariantGlobalization</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">PublishAot</span><span style="color: #808080">></span><span style="color: #E6E6E6">true</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">PublishAot</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">NoDefaultLaunchSettingsFile</span><span style="color: #808080">></span><span style="color: #E6E6E6">true</span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">NoDefaultLaunchSettingsFile</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">PropertyGroup</span><span style="color: #808080">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">ItemGroup</span><span style="color: #808080">></span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #808080">&lt;</span><span style="color: #569CD6">PackageReference</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Include</span><span style="color: #E6E6E6">=</span><span style="color: #CE9178">"NpgsqlRest"</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Version</span><span style="color: #E6E6E6">=</span><span style="color: #CE9178">"1.3.0"</span><span style="color: #E6E6E6"> </span><span style="color: #808080">/></span></span>
<span class="line"><span style="color: #E6E6E6">  </span><span style="color: #808080">&lt;/</span><span style="color: #569CD6">ItemGroup</span><span style="color: #808080">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #808080">&lt;/</span><span style="color: #569CD6">Project</span><span style="color: #808080">></span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #800000">&lt;Project</span><span style="color: #000000"> </span><span style="color: #E50000">Sdk</span><span style="color: #000000">=</span><span style="color: #0000FF">"Microsoft.NET.Sdk.Web"</span><span style="color: #800000">></span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">&lt;PropertyGroup></span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">&lt;TargetFramework></span><span style="color: #000000">net8.0</span><span style="color: #800000">&lt;/TargetFramework></span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">&lt;Nullable></span><span style="color: #000000">enable</span><span style="color: #800000">&lt;/Nullable></span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">&lt;ImplicitUsings></span><span style="color: #000000">enable</span><span style="color: #800000">&lt;/ImplicitUsings></span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">&lt;InvariantGlobalization></span><span style="color: #000000">true</span><span style="color: #800000">&lt;/InvariantGlobalization></span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">&lt;PublishAot></span><span style="color: #000000">true</span><span style="color: #800000">&lt;/PublishAot></span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">&lt;NoDefaultLaunchSettingsFile></span><span style="color: #000000">true</span><span style="color: #800000">&lt;/NoDefaultLaunchSettingsFile></span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">&lt;/PropertyGroup></span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">&lt;ItemGroup></span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #800000">&lt;PackageReference</span><span style="color: #000000"> </span><span style="color: #E50000">Include</span><span style="color: #000000">=</span><span style="color: #0000FF">"NpgsqlRest"</span><span style="color: #000000"> </span><span style="color: #E50000">Version</span><span style="color: #000000">=</span><span style="color: #0000FF">"1.3.0"</span><span style="color: #000000"> </span><span style="color: #800000">/></span></span>
<span class="line"><span style="color: #000000">  </span><span style="color: #800000">&lt;/ItemGroup></span></span>
<span class="line"></span>
<span class="line"><span style="color: #800000">&lt;/Project></span></span></code></pre></div><p>And then, the minimal build in the main program looks like this:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">NpgsqlRest</span><span style="color: #E6E6E6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">WebApplication</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">CreateEmptyBuilder</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6"> ());</span></span>
<span class="line"><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">WebHost</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseKestrelCore</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">builder</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Build</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #CE9178">"Host=127.0.0.1;Port=5432;Database=database_name;Username=postgres;Password=postgres"</span><span style="color: #E6E6E6">));</span></span>
<span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Run</span><span style="color: #E6E6E6">();</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #267F99">NpgsqlRest</span><span style="color: #000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">builder</span><span style="color: #000000"> = </span><span style="color: #001080">WebApplication</span><span style="color: #000000">.</span><span style="color: #795E26">CreateEmptyBuilder</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000"> ());</span></span>
<span class="line"><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #001080">WebHost</span><span style="color: #000000">.</span><span style="color: #795E26">UseKestrelCore</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">app</span><span style="color: #000000"> = </span><span style="color: #001080">builder</span><span style="color: #000000">.</span><span style="color: #795E26">Build</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #A31515">"Host=127.0.0.1;Port=5432;Database=database_name;Username=postgres;Password=postgres"</span><span style="color: #000000">));</span></span>
<span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">Run</span><span style="color: #000000">();</span></span></code></pre></div><p>This is just the minimal build, naturally, you can add things like logging and configuration and customize endpoints to your needs.</p><p>The next step is to launch a build process with <code>dotnet publish -r linux-x64 -c Release</code>. This step has to be performed in a Linux environment since we are targeting a Linux build, and, at this point, the cross-OS native compilation is not supported yet. This will produce a runnable, self-contained executable that is large exactly 20041896 bytes or approximately 20MB.</p><p>There, you don't need a Docker.</p><h2 id="performances">Performances</h2><p>I was excited to see some performance benchmarks since I already know how well is .NET8 optimized for performances. The only thing I could compare those benchmarks to is the performance of the same operations of the <code>PostgREST</code> instance.</p><p>First, some numbers:</p><ul><li><code>NpgsqlRest</code> AOT Linux executable is 20050120 bytes or approximately 20MB.</li><li><code>PostgREST</code> version 12.0.2 Linux executable is 17398464 bytes or approximately 17.3MB.</li></ul><p>As far as memory usage goes, it does seem that <code>NpgsqlRest</code> is a bit better, but, again it is far less feature-rich than <code>PostgREST</code>. Here is the output from the <code>ps aux</code>:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span></span>
<span class="line"><span style="color: #E6E6E6">vbilopav  1613  605  0.5 274961008 91656 pts/5 Sl+  13:44   7:22 ./NpgsqlRestPerfTest</span></span>
<span class="line"><span style="color: #E6E6E6">vbilopav   693  311  0.6 1073782668 102964 pts/0 Sl+ 13:41  10:28 ./postgrest postgrest.conf</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span></span>
<span class="line"><span style="color: #000000">vbilopav  1613  605  0.5 274961008 91656 pts/5 Sl+  13:44   7:22 ./NpgsqlRestPerfTest</span></span>
<span class="line"><span style="color: #000000">vbilopav   693  311  0.6 1073782668 102964 pts/0 Sl+ 13:41  10:28 ./postgrest postgrest.conf</span></span></code></pre></div><p>For a testing scenario, I've created a <a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/NpgsqlRestPerfTest/test_function.sql">single PostgreSQL</a> function that has 5 parameters of a different type and returns a 10-field table with the number of records from the first parameter:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">perf_test</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    _records </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _text_param </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _int_param </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _ts_param </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _bool_param bool</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6">(</span></span>
<span class="line"><span style="color: #E6E6E6">    id1 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    foo1 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    bar1 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    datetime1 </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    id2 </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    foo2 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    bar2 </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">timestamp</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    long_foo_bar </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    is_foobar bool</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span></span>
<span class="line"><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">$$</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    i </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> _int_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'foo'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo1, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'bar'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar1, </span></span>
<span class="line"><span style="color: #E6E6E6">    (_ts_param::</span><span style="color: #569CD6">date</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> (i::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">' days'</span><span style="color: #E6E6E6">)::interval </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> datetime1, </span></span>
<span class="line"><span style="color: #E6E6E6">    i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> _int_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'foo'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> foo2, </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'bar'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> bar2, </span></span>
<span class="line"><span style="color: #E6E6E6">    (_ts_param::</span><span style="color: #569CD6">date</span><span style="color: #E6E6E6">) </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> ((i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">' days'</span><span style="color: #E6E6E6">)::interval </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">datetime2</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #CE9178">'long_foo_bar_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> _text_param </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">'_'</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">||</span><span style="color: #E6E6E6"> (i</span><span style="color: #D4D4D4">+</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> long_foo_bar, </span></span>
<span class="line"><span style="color: #E6E6E6">    (i % </span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6">)::</span><span style="color: #569CD6">boolean</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> _bool_param </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> is_foobar</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">generate_series</span><span style="color: #E6E6E6">(</span><span style="color: #B5CEA8">1</span><span style="color: #E6E6E6">, _records) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> i</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">perf_test</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    _records </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _text_param </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _int_param </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _ts_param </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _bool_param bool</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000">(</span></span>
<span class="line"><span style="color: #000000">    id1 </span><span style="color: #0000FF">int</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    foo1 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    bar1 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    datetime1 </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    id2 </span><span style="color: #0000FF">int</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    foo2 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    bar2 </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">datetime2</span><span style="color: #000000"> </span><span style="color: #0000FF">timestamp</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    long_foo_bar </span><span style="color: #0000FF">text</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    is_foobar bool</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span></span>
<span class="line"><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">$$</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    i + _int_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> id1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'foo'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo1, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'bar'</span><span style="color: #000000"> || i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar1, </span></span>
<span class="line"><span style="color: #000000">    (_ts_param::</span><span style="color: #0000FF">date</span><span style="color: #000000">) + (i::</span><span style="color: #0000FF">text</span><span style="color: #000000"> || </span><span style="color: #A31515">' days'</span><span style="color: #000000">)::interval </span><span style="color: #0000FF">as</span><span style="color: #000000"> datetime1, </span></span>
<span class="line"><span style="color: #000000">    i+</span><span style="color: #098658">1</span><span style="color: #000000"> + _int_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> id2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'foo'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> foo2, </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'bar'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> bar2, </span></span>
<span class="line"><span style="color: #000000">    (_ts_param::</span><span style="color: #0000FF">date</span><span style="color: #000000">) + ((i+</span><span style="color: #098658">1</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> || </span><span style="color: #A31515">' days'</span><span style="color: #000000">)::interval </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">datetime2</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #A31515">'long_foo_bar_'</span><span style="color: #000000"> || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || _text_param || </span><span style="color: #A31515">'_'</span><span style="color: #000000"> || (i+</span><span style="color: #098658">2</span><span style="color: #000000">)::</span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> long_foo_bar, </span></span>
<span class="line"><span style="color: #000000">    (i % </span><span style="color: #098658">2</span><span style="color: #000000">)::</span><span style="color: #0000FF">boolean</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> _bool_param </span><span style="color: #0000FF">as</span><span style="color: #000000"> is_foobar</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">generate_series</span><span style="color: #000000">(</span><span style="color: #098658">1</span><span style="color: #000000">, _records) </span><span style="color: #0000FF">as</span><span style="color: #000000"> i</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p>The testing suite is the <a href="https://k6.io/">K6</a> load testing system from Grafana Labs and there are three different testing scenarios prepared:</p><ol><li>The 60-second performance tests with 100 simulated virtual users retrieving 1 record from the endpoint.</li><li>The 60-second performance tests with 100 simulated virtual users retrieving 5 records from the endpoint.</li><li>The 60-second performance tests with 100 simulated virtual users retrieving 50 records from the endpoint.</li><li>The 60-second performance tests with 100 simulated virtual users retrieving 100 records from the endpoint.</li></ol><p>Let's see the results for the first scenario.</p><h5 id="results">Results</h5><ul><li><code>PostgREST</code>:</li></ul><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">vbilopav@DESKTOP-O3A6QK2:~/k6$ k6 run api-test.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">          /\      || //   //</span></span>
<span class="line"><span style="color: #E6E6E6">     /\  /  \     |  |/  /   /  /</span></span>
<span class="line"><span style="color: #E6E6E6">    /  \/    \    |     (   /   \</span></span>
<span class="line"><span style="color: #E6E6E6">   /          \   |  |\  \ |  ()  |</span></span>
<span class="line"><span style="color: #E6E6E6">  / __________ \  |__| \__\ \_____/ .io</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">  execution: local</span></span>
<span class="line"><span style="color: #E6E6E6">     script: api-test.js</span></span>
<span class="line"><span style="color: #E6E6E6">     output: -</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">  scenarios: (100.00%) 1 scenario, 100 max VUs, 1m30s max duration (incl. graceful stop):</span></span>
<span class="line"><span style="color: #E6E6E6">           * breaking: Up to 100 looping VUs for 1m0s over 1 stages (gracefulRampDown: 30s, gracefulStop: 30s)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">      response code was 200</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">     checks.........................: 100.00%  60875        0</span></span>
<span class="line"><span style="color: #E6E6E6">     data_received..................: 26 MB   425 kB/s</span></span>
<span class="line"><span style="color: #E6E6E6">     data_sent......................: 15 MB   246 kB/s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_blocked...............: avg=3.95s  min=459ns    med=2.9s   max=6.3ms   p(90)=4.66s   p(95)=5.31s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_connecting............: avg=441ns   min=0s       med=0s      max=1.82ms  p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #E6E6E6">    http_req_duration..............: avg=49.34ms min=569.91s med=3.29ms  max=1.31s   p(90)=168.6ms  p(95)=220.51ms</span></span>
<span class="line"><span style="color: #E6E6E6">       { expected_response:true }...: avg=49.34ms min=569.91s med=3.29ms  max=1.31s   p(90)=168.6ms  p(95)=220.51ms</span></span>
<span class="line"><span style="color: #E6E6E6">    http_req_failed................: 0.00%    0            60875</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_receiving.............: avg=64.33s min=6.74s   med=48.28s max=19.57ms p(90)=104.87s p(95)=134.31s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_sending...............: avg=20.88s min=2.75s   med=16.35s max=19.35ms p(90)=26.44s  p(95)=36.55s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_tls_handshaking.......: avg=0s      min=0s       med=0s      max=0s      p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_waiting...............: avg=49.26ms min=540.39s med=3.19ms  max=1.31s   p(90)=168.47ms p(95)=220.43ms</span></span>
<span class="line"><span style="color: #E6E6E6">     http_reqs......................: 60875   1010.718619/s</span></span>
<span class="line"><span style="color: #E6E6E6">     iteration_duration.............: avg=49.49ms min=621.83s med=3.47ms  max=1.31s   p(90)=168.77ms p(95)=220.69ms</span></span>
<span class="line"><span style="color: #E6E6E6">     iterations.....................: 60875   1010.718619/s</span></span>
<span class="line"><span style="color: #E6E6E6">     vus............................: 99      min=2         max=99</span></span>
<span class="line"><span style="color: #E6E6E6">     vus_max........................: 100     min=100       max=100</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">running (1m00.2s), 000/100 VUs, 60875 complete and 0 interrupted iterations</span></span>
<span class="line"><span style="color: #E6E6E6">breaking  [======================================] 000/100 VUs  1m0s</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">vbilopav@DESKTOP-O3A6QK2:~/k6$ k6 run api-test.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">          /\      || //   //</span></span>
<span class="line"><span style="color: #000000">     /\  /  \     |  |/  /   /  /</span></span>
<span class="line"><span style="color: #000000">    /  \/    \    |     (   /   \</span></span>
<span class="line"><span style="color: #000000">   /          \   |  |\  \ |  ()  |</span></span>
<span class="line"><span style="color: #000000">  / __________ \  |__| \__\ \_____/ .io</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  execution: local</span></span>
<span class="line"><span style="color: #000000">     script: api-test.js</span></span>
<span class="line"><span style="color: #000000">     output: -</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  scenarios: (100.00%) 1 scenario, 100 max VUs, 1m30s max duration (incl. graceful stop):</span></span>
<span class="line"><span style="color: #000000">           * breaking: Up to 100 looping VUs for 1m0s over 1 stages (gracefulRampDown: 30s, gracefulStop: 30s)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">      response code was 200</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">     checks.........................: 100.00%  60875        0</span></span>
<span class="line"><span style="color: #000000">     data_received..................: 26 MB   425 kB/s</span></span>
<span class="line"><span style="color: #000000">     data_sent......................: 15 MB   246 kB/s</span></span>
<span class="line"><span style="color: #000000">     http_req_blocked...............: avg=3.95s  min=459ns    med=2.9s   max=6.3ms   p(90)=4.66s   p(95)=5.31s</span></span>
<span class="line"><span style="color: #000000">     http_req_connecting............: avg=441ns   min=0s       med=0s      max=1.82ms  p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #000000">    http_req_duration..............: avg=49.34ms min=569.91s med=3.29ms  max=1.31s   p(90)=168.6ms  p(95)=220.51ms</span></span>
<span class="line"><span style="color: #000000">       { expected_response:true }...: avg=49.34ms min=569.91s med=3.29ms  max=1.31s   p(90)=168.6ms  p(95)=220.51ms</span></span>
<span class="line"><span style="color: #000000">    http_req_failed................: 0.00%    0            60875</span></span>
<span class="line"><span style="color: #000000">     http_req_receiving.............: avg=64.33s min=6.74s   med=48.28s max=19.57ms p(90)=104.87s p(95)=134.31s</span></span>
<span class="line"><span style="color: #000000">     http_req_sending...............: avg=20.88s min=2.75s   med=16.35s max=19.35ms p(90)=26.44s  p(95)=36.55s</span></span>
<span class="line"><span style="color: #000000">     http_req_tls_handshaking.......: avg=0s      min=0s       med=0s      max=0s      p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #000000">     http_req_waiting...............: avg=49.26ms min=540.39s med=3.19ms  max=1.31s   p(90)=168.47ms p(95)=220.43ms</span></span>
<span class="line"><span style="color: #000000">     http_reqs......................: 60875   1010.718619/s</span></span>
<span class="line"><span style="color: #000000">     iteration_duration.............: avg=49.49ms min=621.83s med=3.47ms  max=1.31s   p(90)=168.77ms p(95)=220.69ms</span></span>
<span class="line"><span style="color: #000000">     iterations.....................: 60875   1010.718619/s</span></span>
<span class="line"><span style="color: #000000">     vus............................: 99      min=2         max=99</span></span>
<span class="line"><span style="color: #000000">     vus_max........................: 100     min=100       max=100</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">running (1m00.2s), 000/100 VUs, 60875 complete and 0 interrupted iterations</span></span>
<span class="line"><span style="color: #000000">breaking  [======================================] 000/100 VUs  1m0s</span></span></code></pre></div><ul><li><code>NpgsqlRest</code>:</li></ul><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">vbilopav@DESKTOP-O3A6QK2:~/k6$ k6 run api-test.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">          /\      || //   //</span></span>
<span class="line"><span style="color: #E6E6E6">     /\  /  \     |  |/  /   /  /</span></span>
<span class="line"><span style="color: #E6E6E6">    /  \/    \    |     (   /   \</span></span>
<span class="line"><span style="color: #E6E6E6">   /          \   |  |\  \ |  ()  |</span></span>
<span class="line"><span style="color: #E6E6E6">  / __________ \  |__| \__\ \_____/ .io</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">  execution: local</span></span>
<span class="line"><span style="color: #E6E6E6">     script: api-test.js</span></span>
<span class="line"><span style="color: #E6E6E6">     output: -</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">  scenarios: (100.00%) 1 scenario, 100 max VUs, 1m30s max duration (incl. graceful stop):</span></span>
<span class="line"><span style="color: #E6E6E6">           * breaking: Up to 100 looping VUs for 1m0s over 1 stages (gracefulRampDown: 30s, gracefulStop: 30s)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">      response code was 200</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">     checks.........................: 100.00%  280845       0</span></span>
<span class="line"><span style="color: #E6E6E6">     data_received..................: 150 MB  2.5 MB/s</span></span>
<span class="line"><span style="color: #E6E6E6">     data_sent......................: 68 MB   1.1 MB/s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_blocked...............: avg=4.85s   min=569ns    med=3.26s  max=10.01ms  p(90)=4.96s   p(95)=5.7s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_connecting............: avg=248ns    min=0s       med=0s      max=6.03ms   p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #E6E6E6">    http_req_duration..............: avg=10.45ms  min=480.9s  med=8.38ms  max=314.61ms p(90)=19.13ms  p(95)=25.41ms</span></span>
<span class="line"><span style="color: #E6E6E6">       { expected_response:true }...: avg=10.45ms  min=480.9s  med=8.38ms  max=314.61ms p(90)=19.13ms  p(95)=25.41ms</span></span>
<span class="line"><span style="color: #E6E6E6">    http_req_failed................: 0.00%    0            280845</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_receiving.............: avg=117.62s min=11.2s   med=49.11s max=97.22ms  p(90)=116.38s p(95)=227.97s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_sending...............: avg=28.84s  min=3.66s   med=17.55s max=41.27ms  p(90)=26.57s  p(95)=40.01s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_tls_handshaking.......: avg=0s       min=0s       med=0s      max=0s       p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #E6E6E6">     http_req_waiting...............: avg=10.3ms   min=439.3s  med=8.26ms  max=314.55ms p(90)=18.95ms  p(95)=25.17ms</span></span>
<span class="line"><span style="color: #E6E6E6">     http_reqs......................: 280845  4679.187115/s</span></span>
<span class="line"><span style="color: #E6E6E6">     iteration_duration.............: avg=10.66ms  min=525.77s med=8.58ms  max=314.74ms p(90)=19.4ms   p(95)=25.7ms</span></span>
<span class="line"><span style="color: #E6E6E6">     iterations.....................: 280845  4679.187115/s</span></span>
<span class="line"><span style="color: #E6E6E6">     vus............................: 99      min=2         max=99</span></span>
<span class="line"><span style="color: #E6E6E6">     vus_max........................: 100     min=100       max=100</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">running (1m00.0s), 000/100 VUs, 280845 complete and 0 interrupted iterations</span></span>
<span class="line"><span style="color: #E6E6E6">breaking  [======================================] 000/100 VUs  1m0s</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">vbilopav@DESKTOP-O3A6QK2:~/k6$ k6 run api-test.js</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">          /\      || //   //</span></span>
<span class="line"><span style="color: #000000">     /\  /  \     |  |/  /   /  /</span></span>
<span class="line"><span style="color: #000000">    /  \/    \    |     (   /   \</span></span>
<span class="line"><span style="color: #000000">   /          \   |  |\  \ |  ()  |</span></span>
<span class="line"><span style="color: #000000">  / __________ \  |__| \__\ \_____/ .io</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  execution: local</span></span>
<span class="line"><span style="color: #000000">     script: api-test.js</span></span>
<span class="line"><span style="color: #000000">     output: -</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">  scenarios: (100.00%) 1 scenario, 100 max VUs, 1m30s max duration (incl. graceful stop):</span></span>
<span class="line"><span style="color: #000000">           * breaking: Up to 100 looping VUs for 1m0s over 1 stages (gracefulRampDown: 30s, gracefulStop: 30s)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">      response code was 200</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">     checks.........................: 100.00%  280845       0</span></span>
<span class="line"><span style="color: #000000">     data_received..................: 150 MB  2.5 MB/s</span></span>
<span class="line"><span style="color: #000000">     data_sent......................: 68 MB   1.1 MB/s</span></span>
<span class="line"><span style="color: #000000">     http_req_blocked...............: avg=4.85s   min=569ns    med=3.26s  max=10.01ms  p(90)=4.96s   p(95)=5.7s</span></span>
<span class="line"><span style="color: #000000">     http_req_connecting............: avg=248ns    min=0s       med=0s      max=6.03ms   p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #000000">    http_req_duration..............: avg=10.45ms  min=480.9s  med=8.38ms  max=314.61ms p(90)=19.13ms  p(95)=25.41ms</span></span>
<span class="line"><span style="color: #000000">       { expected_response:true }...: avg=10.45ms  min=480.9s  med=8.38ms  max=314.61ms p(90)=19.13ms  p(95)=25.41ms</span></span>
<span class="line"><span style="color: #000000">    http_req_failed................: 0.00%    0            280845</span></span>
<span class="line"><span style="color: #000000">     http_req_receiving.............: avg=117.62s min=11.2s   med=49.11s max=97.22ms  p(90)=116.38s p(95)=227.97s</span></span>
<span class="line"><span style="color: #000000">     http_req_sending...............: avg=28.84s  min=3.66s   med=17.55s max=41.27ms  p(90)=26.57s  p(95)=40.01s</span></span>
<span class="line"><span style="color: #000000">     http_req_tls_handshaking.......: avg=0s       min=0s       med=0s      max=0s       p(90)=0s       p(95)=0s</span></span>
<span class="line"><span style="color: #000000">     http_req_waiting...............: avg=10.3ms   min=439.3s  med=8.26ms  max=314.55ms p(90)=18.95ms  p(95)=25.17ms</span></span>
<span class="line"><span style="color: #000000">     http_reqs......................: 280845  4679.187115/s</span></span>
<span class="line"><span style="color: #000000">     iteration_duration.............: avg=10.66ms  min=525.77s med=8.58ms  max=314.74ms p(90)=19.4ms   p(95)=25.7ms</span></span>
<span class="line"><span style="color: #000000">     iterations.....................: 280845  4679.187115/s</span></span>
<span class="line"><span style="color: #000000">     vus............................: 99      min=2         max=99</span></span>
<span class="line"><span style="color: #000000">     vus_max........................: 100     min=100       max=100</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">running (1m00.0s), 000/100 VUs, 280845 complete and 0 interrupted iterations</span></span>
<span class="line"><span style="color: #000000">breaking  [======================================] 000/100 VUs  1m0s</span></span></code></pre></div><p>In short, running 60 seconds for 100 simulated virtual users, <code>PostgREST</code> has processed <strong>60.875</strong> successful requests and <code>NpgsqlRest</code> has processed <strong>280.845</strong> successful requests! <code>NpgsqlRest</code> is <strong>4,61</strong> times faster and can handle that many more requests!</p><p>I knew that .NET8 is very well optimized but I didn't expect that much. Being able to process 280K requests, instead of 60K is very much significant and a money saver.</p><p>Next, I wanted to see how results would change if I started returning more than 1 record. When a PostgreSQL call returns a record, it needs to be converted from a raw format returned from the server into JSON which requires a fair amount of string manipulation. So in that case performance of the built-in web server would be less important. I ran performance tests again for 5, 50 and 100 returned records. Here is the table with condensed results:</p><table class="table table-sm table-hover table-bordered" style="width: initial;"><thead><tr><th align="right">Records</th><th align="right">NpgsqlRest requests</th><th align="right">PostgREST requests</th><th align="right">Ratio</th></tr></thead><tbody class="table-group-divider"><tr><td align="right">1</td><td align="right"><strong>280.845</strong></td><td align="right"><strong>60.875</strong></td><td align="right">4,61</td></tr><tr><td align="right">5</td><td align="right"><strong>310.123</strong></td><td align="right"><strong>56.188</strong></td><td align="right">5,51</td></tr><tr><td align="right">50</td><td align="right"><strong>164.208</strong></td><td align="right"><strong>71.430</strong></td><td align="right">2,29</td></tr><tr><td align="right">100</td><td align="right"><strong>143.110</strong></td><td align="right"><strong>57.217</strong></td><td align="right">2,50</td></tr></tbody></table><p>Note that you can see all test files and complete detailed results output in a <a href="https://github.com/vb-consulting/NpgsqlRest/tree/master/PerfomanceTests">performance test source code</a>. All tests were conducted on my poor little laptop. If someone has the time and will, they can be repeated in some more isolated environment.</p><p>Now, we can see that the ratio is getting lower with a higher number of returned records. I'm not sure what exactly to make of it.</p><p>Yes, well, .NET8 is faster, that much is clear for now. Somewhere between 2,5 and 5,5 times approximately. It depends as developers like to say.</p><h2 id="roadmap">Roadmap</h2><p>As I said before, <code>NpgsqlRest</code> will be a crucial part of the future data platform, and as such the active development will continue. However, I cannot guarantee that all new features (or even fixes) will be published and open-sourced. That might change if enough interest is generated and perhaps with the right sponsorship because I don't have much of it as it stands.</p><p>However, that is not the reason not to discuss and consider possible features:</p><h5 id="live-reload-feature">Live Reload Feature</h5><p>The idea behind this feature would be the ability to recreate endpoints without having to restart the application. You could simply turn it on or off (or change the URL or something else) - by using comment annotations and do the live refresh without restarting.</p><p>First of all, this would require some serious refactoring. And I'm not entirely convinced that is needed, since a lot of accompanying code is going to be generated on endpoint creation events.</p><h5 id="tables-and-views-support">Tables And Views Support</h5><p>PostgREST supports endpoints from tables and views, why shouldn't the NpgsqlRest as well?</p><p>I don't know about this. I can expose a view for example as an endpoint, but could be dangerous because the view can return an insane amount of data that would crash your application. Same as tables.</p><p>It would be interesting to have the ability to enable CRUD endpoints for certain tables, possibly with conflict resolution and all. But that approach feels to me very much like a giant can of worms that I don't wish to open. A sort of HTTP ORM!? Yikes.</p><p>Besides, my design philosophy is to encapsulate everything into SQL functions and procedures. It isn't that hard to write a function that returns your table or your view, is it?</p><h5 id="other-service-types">Other Service Types</h5><p>Like gRPC services for example? Or SignalR socket streaming?</p><p>Certainly, but I cannot guarantee that it will be open-sourced, maybe it will, I don't know. Or even that I would make something like that. However, from this standpoint, it shouldn't be too hard (if not even trivial). Luckily this library is open source and you can try it yourself.</p><hr><p>That is it.</p><p>The library is already a bit mature in version <code>1.4.0</code> and is being used actively on one of my projects. If you find it useful and interesting visit a <a href="https://github.com/vb-consulting/NpgsqlRest">GitHub repository</a> and give it a star.</p><p>I would also like to hear in comments what other people think. Especially about those performance tests above, because I don't know what to say, that goes beyond my expertise. I'm just a guy who likes to write SQL. So, leave a comment below in a comment section and you can ask me anything.</p><div class="my-5 px-5 border-top links svelte-1jzqpn5"><div><div class="link-title text-start svelte-1jzqpn5 text-muted">PREVIOUS</div></div><div><div class="link-title text-end svelte-1jzqpn5">NEXT</div><a class="btn btn-link text-end" href="/blog/npgsqlrest-update1.6.2/">NpgsqlRest Update 1.6.2</a></div></div><div class="w-fit mx-auto mt-5 mb-3 border-top"><div class="alert text-center fs-smaller text-muted">To receive notifications about new posts and updates, consider subscribing to my LinkdIn page:<br><a class="btn btn-sm" href="https://www.linkedin.com/in/vb-software/"><i class="bi-linkedin"></i> <span class="text-primary">vb-software linkedin</span></a><br><br>You will receive notifications about new posts on your LinkedIn feed.</div></div><div class="pt-5 border-top"><div id="comments-section" class="h5">Comments</div><script defer src="https://cdn.commento.io/js/commento.js" data-no-fonts="true" data-css-override="https://vb-consulting.github.io/style.css"></script><div id="commento"></div></div><footer class="mt-3 py-5"><div class="w-fit mx-auto mb-3 border-top border-bottom"><div class="alert text-center fs-smaller text-muted"><div class="alert text-center fs-smaller text-muted mb-1">If you like my content, or using my software or otherwise benefitign from my work, consider supporting me by buying me a coffee. Software runs on coffe.</div><a class="btn btn-link rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="Click Here to Buy Me a Coffee Or Scan the Code" href="https://www.buymeacoffee.com/vbilopavu" style="display: inline-grid;">Buy me a Coffee <img class="m-auto svelte-w557lf" alt="Scan Here To Buy Me a Cofee" src="/bmc_qr.png"></a></div></div><div class="d-flex justify-content-center"><a class="btn btn-link rl-arrow me-1" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="NpgsqlRest on GitHub" href="https://github.com/vb-consulting/NpgsqlRest" style="display: inline-grid;">NpgsqlRest on GitHub <i class="bi bi-github"></i></a> <a class="btn btn-link rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="I Post Software Development Content Daily" href="https://www.linkedin.com/in/vb-software/" style="display: inline-grid;">Follow me on LinkedIn <i class="bi bi-linkedin"></i></a></div><div class="text-center"><div class="mt-5 mb-5 background-floki svelte-w557lf" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog."></div></div></footer><div class="mb-5"></div></div></div><div class="rightside svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">on this page</span><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="npgsqlrest-nuget-library" title="NpgsqlRest NuGet Library"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#npgsqlrest-nuget-library">NpgsqlRest NuGet Library</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="motivation" title="Motivation"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#motivation">Motivation</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="features-and-usage" title="Features and Usage"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#features-and-usage">Features and Usage</a></li><li class="nav-item toc5 right svelte-9zwk14 bookmark-nav" data-id="comment-annotations" title="Comment Annotations"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#comment-annotations">Comment Annotations</a></li><li class="nav-item toc5 right svelte-9zwk14 bookmark-nav" data-id="aot-support" title="AOT Support"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#aot-support">AOT Support</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="performances" title="Performances"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#performances">Performances</a></li><li class="nav-item toc5 right svelte-9zwk14 bookmark-nav" data-id="results" title="Results"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#results">Results</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="roadmap" title="Roadmap"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#roadmap">Roadmap</a></li><li class="nav-item toc5 right svelte-9zwk14 bookmark-nav" data-id="live-reload-feature" title="Live Reload Feature"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#live-reload-feature">Live Reload Feature</a></li><li class="nav-item toc5 right svelte-9zwk14 bookmark-nav" data-id="tables-and-views-support" title="Tables And Views Support"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#tables-and-views-support">Tables And Views Support</a></li><li class="nav-item toc5 right svelte-9zwk14 bookmark-nav" data-id="other-service-types" title="Other Service Types"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#other-service-types">Other Service Types</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="comments-section" title="Comments"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#comments-section">Comments</a></li><li><hr class="svelte-9zwk14"><div class="navbar-nav sidenav"><div class="text-muted fs-_7rem mx-2">NEXT</div><a class="btn btn-link btn-sm text-start sidebar-link" href="/blog/npgsqlrest-update1.6.2/">NpgsqlRest Update 1.6.2</a></div></li></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],o=document.querySelectorAll("div.code"),k=i.querySelector(".home");function E(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n])}function T(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n]);E(e,t),e.classList.add(t)}function t(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",o=0;o<n.classList.length;o++)if(n.classList[o].startsWith("bi-")){i=n.classList[o];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}"/"==document.location.pathname&&T(k,"d-none");var e=document.querySelector(".post-share > .copy-url"),n=(e&&e.addEventListener("click",function(e){t(e,function(e,t){navigator.clipboard.writeText(document.location.origin+document.location.pathname),t()})}),document.getElementsByTagName("html")[0]),a=i.querySelector("#theme-btn"),s="theme";function l(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<o.length;n++){var i=o[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e){t(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function c(e){t(e,function(e,t){var n=localStorage.getItem(s);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(s)?"light":"dark";localStorage.setItem(s,e),l(n.dataset.bsTheme=e)}),l(localStorage.getItem(s)),a.children[0].classList.remove("hidden");for(var d=0;d<o.length;d++){o[d].getElementsByClassName("copy-code")[0].addEventListener("click",r);var m=o[d].getElementsByClassName("photo-code");m.length&&m.addEventListener("click",c)}for(var S=function(){var a,o,s;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.querySelector(".main-content").querySelectorAll("[id]"),o=void 0,this.initNavs=function(e){s=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,o=0;o<s.length;o++)if(s[o].dataset.id==n){i=s[o];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(l(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),r()},f.children[1].addEventListener("scroll",r),this;function l(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function r(){if(s&&s.length){for(var e=0;e<s.length;e++)s[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=l(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),o&&clearTimeout(o),void(o=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),o=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),o&&clearTimeout(o),o=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),o=void 0},250))}}}(),h=function(){var l,r=i.querySelector("#nav-btn"),c=480,d="200px",m="0.25fr",h=730,v=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],t="sidebar-pinned",p=null==localStorage.getItem(t)||"true"==localStorage.getItem(t),y=!1,b=!1;function n(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?y?"100%":"0":p?""+d:"0",i=`grid-template-columns: ${n} 1fr`,o=t&&y?"width: 100%":"0"!=n?"":"display: none",a=t&&y?"display: none":"",s=t?y?"sidebar-show":"sidebar-hide":p?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(m&&h&&v&&(n&&e<v||!n&&e<h?b||(u.innerHTML=l+g.innerHTML,S.initNavs(u),b=!0):b&&(u.innerHTML=l,S.initNavs(g),b=!1)),!m||t||b?(i+=";",f.children[2].style.display="none"):(i+=` ${m};`,f.children[2].style.display="")),T(r,!t&&p||t&&y?"rotate":"rotate-back","rotate","rotate-back"),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),f.style=L?i:"display: grid;",L&&T(L,s,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=o),w.style=a,t&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),t&&y&&T(k,"d-none")}function e(){var e=window.outerWidth<c;e?y=!y:p=!p,localStorage.setItem(t,p.toString()),n(),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),e&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),e&&y&&T(k,"d-none")}return m&&h&&v&&g&&(l=u.innerHTML,S.initNavs(g)),r.addEventListener("click",e),(window.onresize=n)(),this.closeSidebar=function(){window.outerWidth<c&&y&&e()},this}(),v=document.getElementsByClassName("auto-close"),u=0;u<v.length;u++)v[u].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(e=document.getElementById(location.hash.replace("#","")))&&e.scrollIntoView()}();</script><script src="/bootstrap.bundle.min.js"></script><script>!function(){for(var e=document.querySelectorAll('[data-bs-toggle="tooltip"]'),t=0;t<e.length;t++)new bootstrap.Tooltip(e[t]);var n=document.getElementsByClassName("accordion-item");if(n.length){for(t=0;t<n.length;t++){var o=n[t];o.querySelectorAll("[href='"+document.location.pathname+"']").length&&o.firstChild.click()}var l=document.querySelector("nav.navbar").querySelector(".home"),a=document.getElementsByClassName("accordion");"/"==document.location.pathname&&l.classList.add("d-none");for(t=0;t<n.length;t++){var s=a[t];s&&s.firstChild&&"VB-Consulting"==s.firstChild.title&&(null!=s.firstChild.querySelector(".collapse")&&l.classList.contains("d-none")&&"/"!=document.location.pathname&&l.classList.remove("d-none"),s.addEventListener("show.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none"),l.classList.add("d-none")}),s.addEventListener("hide.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none")}))}}}();</script><script src="/html2canvas.min.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script></body><script async data-id="101435862" src="//static.getclicky.com/js"></script></html>