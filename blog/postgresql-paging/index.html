<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>PostgreSQL Paging Benchmarks</title><meta name="description" content="PostgreSQL Paging Benchmarks"><link href="https://vb-consulting.github.io/blog/postgresql-paging/" rel="canonical"><meta name="keywords" content="postgresql, sql, benchmarks"><meta name="author" content="floki"><meta prefix="og: http://ogp.me/ns#" property="og:title" content="PostgreSQL Paging Benchmarks"><meta prefix="og: http://ogp.me/ns#" property="og:description" content="PostgreSQL Paging Benchmarks"><meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://vb-consulting.github.io/neretva.jpg"><meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"><meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="VB-Consulting"><meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://vb-consulting.github.io/blog/postgresql-paging/"><meta name="twitter:image" content="https://vb-consulting.github.io/neretva.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="PostgreSQL Paging Benchmarks"><link rel="stylesheet" href="/_elderjs/assets/svelte-47fe4101.css" media="all"><style></style><link href="/style.css?1711888865339" rel="stylesheet"><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script></head><body class="d-flex flex-column h-100"><header id="header"><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-30jr7w"><div class="container-fluid flex-nowrap svelte-30jr7w"><div class="d-flex svelte-30jr7w"><button id="nav-btn" type="button" class="d-flex btn btn-sm logo animate-rotate svelte-30jr7w"><i class="material-icons-outlined">menu</i></button> <a class="nav-link my-auto ms-2 fw-semibold home svelte-30jr7w" href="/"><i class="bi-chevron-double-left"></i> VB Home</a></div><div class="d-flex right svelte-30jr7w"><a class="nav-link my-auto svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="Become a Patreon" href="https://www.patreon.com/vbconsulting" target="_blank"><div class="patreon"></div></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><a class="nav-link my-auto svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="Buy Me a Coffee" href="https://www.buymeacoffee.com/vbilopavu" target="_blank"><div class="bmc"></div></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><a class="nav-link my-auto me-2 svelte-30jr7w" data-bs-toggle="tooltip" data-bs-html="true" title="PgPagingBenchmarks on GitHub" href="https://github.com/vb-consulting/PgPagingBenchmarks"><i class="bi-github"></i></a> <a class="github-button svelte-30jr7w" href="https://github.com/vb-consulting/PgPagingBenchmarks" data-bs-toggle="tooltip" data-bs-html="true" title="Star PgPagingBenchmarks on GitHub" data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;" data-icon="octicon-star" data-show-count="true" aria-label="Star PgPagingBenchmarks on GitHub"></a><div class="vr1 text-muted my-auto svelte-30jr7w"></div><button id="theme-btn" type="button" aria-pressed="true" aria-label="theme" class="svelte-30jr7w"><span class="check hidden svelte-30jr7w"><span class="icon svelte-30jr7w"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><path fill="currentColor" d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-30jr7w"><g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M0 0h24v24H0z"></path><path fill="currentColor" d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class="svelte-9zwk14"><div class="sidebar sidebar-hide svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-item svelte-9zwk14" data-id="" title="VB-Consulting"><a class="nav-link svelte-9zwk14 text-uppercase" href="/">VB-Consulting</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/">NpgsqlRest</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="Norm.Net"><a class="nav-link svelte-9zwk14 text-uppercase" href="/norm.net/">Norm.Net</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="RazorSvelte"><a class="nav-link svelte-9zwk14 text-uppercase" href="/razorsvelte/">RazorSvelte</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PgRoutiner"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pgroutiner/">PgRoutiner</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="XUnit.Npgsql"><a class="nav-link svelte-9zwk14 text-uppercase" href="/xunit.npgsql/">XUnit.Npgsql</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PostrgeSQL Schema Tools"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pg_schema_tools/">PostrgeSQL Schema Tools</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">blogs</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="See all blogs..."><a class="nav-link btn btn-sm w-fit px-3 mx-auto svelte-9zwk14 lr-arrow text-uppercase" href="/blogs/"><i class="bi bi-arrow-right-circle svelte-9zwk14"></i> <span class="btn-link">ALL BLOGS</span></a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL Array Example"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-array/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PostgreSQL Arrays üêò</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-update1.6.2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest Update 1.6.2</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-v2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest v2 Update üêòüî•</a></li><li class="nav-item svelte-9zwk14" data-id="" title="How DDD is screwing up your SQL"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/sql-vs-ddd/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>How DDD is screwing up your SQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Common Sense Software Design Approach for RDBMS-backed Type of Software"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/common-sense-design/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Common Sense Software Design</a></li><li class="nav-item svelte-9zwk14 active" data-id="" title="PostgreSQL Paging Benchmarks"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-paging/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>PostgreSQL Paging Benchmarks</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest NuGet Library</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL crazy experiment with the record type."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-record-type/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Execute Custom Function For Each Record</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL script that implements temporal tables without extension."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-temporal-tables/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Custom Temporal Tables in PostgreSQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Exploring a different approach to recursion with PostgreSQL by using recursive plpgsql function instead of recursive CTE query."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part1-different-type-of-recursion/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 1 - A Different Type of Recursion</a></li></ul></div></div><div class="content svelte-9zwk14"><div class="banner svelte-1bxfgrx" style="background-image: url(/neretva.jpg); background-position: center; background-blend-mode: luminosity;"></div><div class="container-sm main-content blog svelte-1bxfgrx bannered"><div class="blog-head svelte-1bxfgrx"><a href="https://github.com/vb-consulting/blog/blob/master/LICENSE" class="text-shadow svelte-1bxfgrx" style="color: white">CC0-1.0 license</a></div><div class="categories svelte-1bxfgrx"><a href="/blogs/general" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># general</span> </a><a href="/blogs/software-development" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># software development</span> </a><a href="/blogs/postgresql" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># postgresql</span> </a><a href="/blogs/sql" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># sql</span> </a><a href="/blogs/benchmarks" class="btn btn-sm text-shadow svelte-1bxfgrx"><span class="cat"># benchmarks</span></a></div><h1 class="text-shadow" id="postgresql-paging-benchmarks">PostgreSQL Paging Benchmarks</h1><div class="post-meta text-shadow"><div></div><div class="post-details"><div class="post-pic" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog." style="background-image: url(/floki2.jpg)"></div><div class="post-details-right"><div class="post-share"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fpostgresql-paging%2F" class="me-1 bi-linkedin" data-bs-toggle="tooltip" data-bs-html="true" title="Share on LinkedIn"><i class=""></i></a> <a href="http://twitter.com/share?text=PostgreSQL%20Paging%20Benchmarks%0APostgreSQL%20Paging%20Benchmarks%0A&url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fpostgresql-paging%2F&hashtags=software%20development%2Cpostgresql%2Csql%2Cbenchmarks" class="me-1 bi-twitter-x" data-bs-toggle="tooltip" data-bs-html="true" title="Share on X"><i class=""></i></a> <a href="#" class="copy-url bi-clipboard" data-bs-toggle="tooltip" data-bs-html="true" title="Copy URL"><i class=""></i></a></div><div class="post-author">floki</div><div class="post-date">Feb 16, 2024</div></div></div></div><p>This is a performance benchmark project that tests different data paging approaches in PostgreSQL. You can find the source code in the <a href="https://github.com/vb-consulting/PgPagingBenchmarks">PgPagingBenchmarks</a> repository.</p><h2 id="setup">Setup</h2><p>PostgreSQL 16 instance on my laptop:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">select version();</span></span>
<span class="line"><span style="color: #E6E6E6">PostgreSQL 16.0 (Ubuntu 16.0-1.pgdg20.04+1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0, 64-bit</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">select version();</span></span>
<span class="line"><span style="color: #000000">PostgreSQL 16.0 (Ubuntu 16.0-1.pgdg20.04+1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0, 64-bit</span></span></code></pre></div><p>Initial schema (<a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/Db/script.sql">source</a>):</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">begin</span><span style="color: #E6E6E6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">schema</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">if</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">exists</span><span style="color: #E6E6E6"> example cascade;</span></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">schema</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.cities (</span></span>
<span class="line"><span style="color: #E6E6E6">    city_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">generated</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">always</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">identity</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">primary key</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">unique</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.addresses (</span></span>
<span class="line"><span style="color: #E6E6E6">    address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">generated</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">always</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">identity</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">primary key</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    street </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    city_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> example.cities deferrable,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">unique</span><span style="color: #E6E6E6"> (street, city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.customers (</span></span>
<span class="line"><span style="color: #E6E6E6">    customer_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">generated</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">always</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">identity</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">primary key</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> example.addresses deferrable,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">unique</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">name</span><span style="color: #E6E6E6">, address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.customer_addresses (</span></span>
<span class="line"><span style="color: #E6E6E6">    customer_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> example.customers deferrable,</span></span>
<span class="line"><span style="color: #E6E6E6">    address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">not null</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> example.addresses deferrable,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">primary key</span><span style="color: #E6E6E6"> (customer_id, address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">alter</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #569CD6">add</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">constraint</span><span style="color: #E6E6E6"> fk_customer_addresses</span></span>
<span class="line"><span style="color: #569CD6">foreign key</span><span style="color: #E6E6E6"> (customer_id, address_id) </span></span>
<span class="line"><span style="color: #569CD6">references</span><span style="color: #E6E6E6"> example.customer_addresses deferrable;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">end</span><span style="color: #E6E6E6">;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">begin</span><span style="color: #000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">schema</span><span style="color: #000000"> </span><span style="color: #0000FF">if</span><span style="color: #000000"> </span><span style="color: #0000FF">exists</span><span style="color: #000000"> example cascade;</span></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">schema</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.cities (</span></span>
<span class="line"><span style="color: #000000">    city_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">generated</span><span style="color: #000000"> </span><span style="color: #0000FF">always</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">identity</span><span style="color: #000000"> </span><span style="color: #0000FF">primary key</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">name</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">unique</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.addresses (</span></span>
<span class="line"><span style="color: #000000">    address_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">generated</span><span style="color: #000000"> </span><span style="color: #0000FF">always</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">identity</span><span style="color: #000000"> </span><span style="color: #0000FF">primary key</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    street </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    city_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">references</span><span style="color: #000000"> example.cities deferrable,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">unique</span><span style="color: #000000"> (street, city_id)</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.customers (</span></span>
<span class="line"><span style="color: #000000">    customer_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">generated</span><span style="color: #000000"> </span><span style="color: #0000FF">always</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">identity</span><span style="color: #000000"> </span><span style="color: #0000FF">primary key</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">name</span><span style="color: #000000"> </span><span style="color: #0000FF">text</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    address_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">references</span><span style="color: #000000"> example.addresses deferrable,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">unique</span><span style="color: #000000"> (</span><span style="color: #0000FF">name</span><span style="color: #000000">, address_id)</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.customer_addresses (</span></span>
<span class="line"><span style="color: #000000">    customer_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">references</span><span style="color: #000000"> example.customers deferrable,</span></span>
<span class="line"><span style="color: #000000">    address_id </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #0000FF">not null</span><span style="color: #000000"> </span><span style="color: #0000FF">references</span><span style="color: #000000"> example.addresses deferrable,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">primary key</span><span style="color: #000000"> (customer_id, address_id)</span></span>
<span class="line"><span style="color: #000000">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">alter</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #0000FF">add</span><span style="color: #000000"> </span><span style="color: #0000FF">constraint</span><span style="color: #000000"> fk_customer_addresses</span></span>
<span class="line"><span style="color: #0000FF">foreign key</span><span style="color: #000000"> (customer_id, address_id) </span></span>
<span class="line"><span style="color: #0000FF">references</span><span style="color: #000000"> example.customer_addresses deferrable;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">end</span><span style="color: #000000">;</span></span></code></pre></div><p>Tables were seeded with initial data using the Faker Bogus library (<a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/Db/Program.cs">source script</a>).</p><h2 id="requirements">Requirements</h2><p>The query that was tested is this:</p><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    example.customers</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> customers.name ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    example.customers</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> customers.name ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name</span></span></code></pre></div><ul><li>The query needs to return customer data along with the default address.</li><li>The query also needs to return a total count of customer addresses.</li><li>The query needs to return the last page with a length of 10 rows. In this case, this is the page 625.</li><li>Query needs to be filtered by customer name pattern. In this case this <code>%john%</code> pattern.</li><li>Total rows unpaged count is also required.</li><li>Pages data needs to be sorted by the customer name.</li></ul><p>And finally, results need to be serialized into the following structure:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">City</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #D4D4D4">!</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Address</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Street</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #D4D4D4">!</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">City</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">City</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #D4D4D4">!</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Customer</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Id</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">string</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #D4D4D4">!</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">Address</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Address</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #D4D4D4">!</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">long</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">AddressCount</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">class</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">DataPage</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">long</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">Count</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; }</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">public</span><span style="color: #E6E6E6"> </span><span style="color: #4EC9B0">List</span><span style="color: #E6E6E6">&lt;</span><span style="color: #4EC9B0">Customer</span><span style="color: #E6E6E6">> </span><span style="color: #9CDCFE">Customers</span><span style="color: #E6E6E6"> { </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6">; </span><span style="color: #569CD6">set</span><span style="color: #E6E6E6">; } </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">default</span><span style="color: #D4D4D4">!</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">}</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">City</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Id</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; } = </span><span style="color: #0000FF">default</span><span style="color: #000000">!;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Address</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Id</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Street</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; } = </span><span style="color: #0000FF">default</span><span style="color: #000000">!;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">City</span><span style="color: #000000"> </span><span style="color: #001080">City</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; } = </span><span style="color: #0000FF">default</span><span style="color: #000000">!;</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">Customer</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> </span><span style="color: #001080">Id</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> </span><span style="color: #001080">Name</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; } = </span><span style="color: #0000FF">default</span><span style="color: #000000">!;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">Address</span><span style="color: #000000"> </span><span style="color: #001080">Address</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; } = </span><span style="color: #0000FF">default</span><span style="color: #000000">!;</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">long</span><span style="color: #000000"> </span><span style="color: #001080">AddressCount</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class="line"><span style="color: #000000">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> </span><span style="color: #267F99">DataPage</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">long</span><span style="color: #000000"> </span><span style="color: #001080">Count</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #267F99">List</span><span style="color: #000000">&lt;</span><span style="color: #267F99">Customer</span><span style="color: #000000">> </span><span style="color: #001080">Customers</span><span style="color: #000000"> { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; } = </span><span style="color: #0000FF">default</span><span style="color: #000000">!;</span></span>
<span class="line"><span style="color: #000000">}</span></span></code></pre></div><p>As we can see, keyset paging is not possible. However, there are a few other possibilities we can test and explore.</p><h2 id="test-methods">Test methods</h2><h3 id="method-1">Method 1</h3><p>SQL scripts in two steps:</p><ul><li>The first step: get the total count from the filtered table.</li><li>The second step: use limit and offset on a query to get the page.</li><li>Map results by position from the reader fields.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method1.cs">Source Code</a></li></ul><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">)  </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(*)  </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span></code></pre></div></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    example.customers</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> customers.name ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name </span></span>
<span class="line"><span style="color: #E6E6E6">offset $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">limit</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    example.customers</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> customers.name ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name </span></span>
<span class="line"><span style="color: #000000">offset $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">limit</span><span style="color: #000000"> $</span><span style="color: #098658">3</span></span></code></pre></div><h3 id="method-2">Method 2</h3><p>Single SQL query:</p><ul><li>The table is filtered in materialized CTE.</li><li>Joins CTE with the main query.</li><li>Use limit and offset on a query to get the page.</li><li>The count is in additional subquery: <code>(select count(*) from cte) as count</code></li><li>Map results by position from the reader fields.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method2.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> cte </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> materialized (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count,</span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> cte) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    cte</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id) </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name </span></span>
<span class="line"><span style="color: #E6E6E6">offset $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">limit</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">with</span><span style="color: #000000"> cte </span><span style="color: #0000FF">as</span><span style="color: #000000"> materialized (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">from</span><span style="color: #000000"> cte) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    cte</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id) </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name </span></span>
<span class="line"><span style="color: #000000">offset $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">limit</span><span style="color: #000000"> $</span><span style="color: #098658">3</span></span></code></pre></div><h3 id="method-3">Method 3</h3><p>Single SQL query:</p><ul><li>The table is filtered in materialized CTE that includes the row number.</li><li>Joins CTE with the main query.</li><li>Filter by the row number to get the page.</li><li>Order by the customer is in the materialized CTE.</li><li>The count is in the additional subquery that finds the max row number: <code>(select max(row) from cte) as count</code></li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method3.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> cte </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> materialized (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count,</span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">max</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> cte) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    cte</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id) </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">with</span><span style="color: #000000"> cte </span><span style="color: #0000FF">as</span><span style="color: #000000"> materialized (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">max</span><span style="color: #000000">(</span><span style="color: #0000FF">row</span><span style="color: #000000">) </span><span style="color: #0000FF">from</span><span style="color: #000000"> cte) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    cte</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id) </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= $</span><span style="color: #098658">2</span><span style="color: #000000"> + $</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span></span></code></pre></div><h3 id="method-4">Method 4</h3><p>SQL script that creates the TEMP table within a transaction:</p><ul><li>Create transaction.</li><li>Create the TEMP table from filtered data.</li><li>Return count from the TEMP table.</li><li>Join the TEMP table with the main query and use the offset and limit to page the data.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method4.cs">Source Code</a></li></ul><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">begin</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">begin</span></span></code></pre></div></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> temp </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">commit</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> customer_id </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> temp </span><span style="color: #0000FF">table</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">commit</span><span style="color: #000000"> </span><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> customer_id </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span></code></pre></div><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> _temp_customers</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">from</span><span style="color: #000000"> _temp_customers</span></span></code></pre></div></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    _temp_customers</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name </span></span>
<span class="line"><span style="color: #E6E6E6">offset $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">limit</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    _temp_customers</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name </span></span>
<span class="line"><span style="color: #000000">offset $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">limit</span><span style="color: #000000"> $</span><span style="color: #098658">3</span></span></code></pre></div><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">end</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">end</span></span></code></pre></div></div><h3 id="method-5">Method 5</h3><p>SQL script that creates the TEMP table with row number within a transaction:</p><ul><li>Create transaction.</li><li>Create the TEMP table with the row number from filtered data and order by customer.</li><li>Return the max row from the TEMP table.</li><li>Join the TEMP table with the main query and use the row number to page the data.</li><li>Order by row number.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method5.cs">Source Code</a></li></ul><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">begin</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">begin</span></span></code></pre></div></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> temp </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">commit</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> temp </span><span style="color: #0000FF">table</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">commit</span><span style="color: #000000"> </span><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name</span></span></code></pre></div><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">max</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> _temp_customers</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">max</span><span style="color: #000000">(</span><span style="color: #0000FF">row</span><span style="color: #000000">) </span><span style="color: #0000FF">from</span><span style="color: #000000"> _temp_customers</span></span></code></pre></div></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    _temp_customers</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    _temp_customers</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= $</span><span style="color: #098658">2</span><span style="color: #000000"> + $</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span></span></code></pre></div><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">end</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">end</span></span></code></pre></div></div><h3 id="method-6">Method 6</h3><p>SQL script that creates the indexed TEMP table with row number within a transaction:</p><ul><li>Create transaction.</li><li>Create the TEMP table with the row number from filtered data and order by customer.</li><li>Create the BTREE index on the TEMP table.</li><li>Return the max row from the TEMP table.</li><li>Join the TEMP table with the main query and use the row number to page the data.</li><li>Order by row number.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method6.cs">Source Code</a></li></ul><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">begin</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">begin</span></span></code></pre></div></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> temp </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">commit</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> temp </span><span style="color: #0000FF">table</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">commit</span><span style="color: #000000"> </span><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name</span></span></code></pre></div><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">index</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">on</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> btree (</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">)</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">index</span><span style="color: #000000"> </span><span style="color: #795E26">on</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> btree (</span><span style="color: #0000FF">row</span><span style="color: #000000">)</span></span></code></pre></div></div><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">max</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> _temp_customers</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">max</span><span style="color: #000000">(</span><span style="color: #0000FF">row</span><span style="color: #000000">) </span><span style="color: #0000FF">from</span><span style="color: #000000"> _temp_customers</span></span></code></pre></div></div><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    _temp_customers</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    _temp_customers</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= $</span><span style="color: #098658">2</span><span style="color: #000000"> + $</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span></span></code></pre></div><div class="one-liner"><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">end</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">end</span></span></code></pre></div></div><h3 id="method-7">Method 7</h3><p>PLPGSQL function that returns JSON:</p><ul><li>Create the TEMP table from filtered data.</li><li>Get the count from the inserted diagnostics.</li><li>Join the TEMP table with the main query and use thelimt and offset to page the data.</li><li>Build a JSON response and deserialize it on the client.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method7.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.method7(</span></span>
<span class="line"><span style="color: #E6E6E6">    _search </span><span style="color: #569CD6">varchar</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _skip </span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _take </span><span style="color: #569CD6">integer</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">json</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql </span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> $$</span></span>
<span class="line"><span style="color: #569CD6">declare</span></span>
<span class="line"><span style="color: #E6E6E6">    _count </span><span style="color: #569CD6">bigint</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> temp </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">commit</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike _search;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6"> diagnostics _count </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> row_count;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'count'</span><span style="color: #E6E6E6">, _count,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'customers'</span><span style="color: #E6E6E6">, (</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> json_agg(sub)</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> ( </span></span>
<span class="line"><span style="color: #E6E6E6">            </span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.customer_id </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">                    json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'id'</span><span style="color: #E6E6E6">, customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'street'</span><span style="color: #E6E6E6">, street,</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'city'</span><span style="color: #E6E6E6">, json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">                            </span><span style="color: #CE9178">'id'</span><span style="color: #E6E6E6">, cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                            </span><span style="color: #CE9178">'name'</span><span style="color: #E6E6E6">, cities.name</span></span>
<span class="line"><span style="color: #E6E6E6">                        )</span></span>
<span class="line"><span style="color: #E6E6E6">                    ) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">address</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> AddressCount</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">                    _temp_customers</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> customers.name ilike </span><span style="color: #CE9178">'%john%'</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    street,</span></span>
<span class="line"><span style="color: #E6E6E6">                    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    cities.name</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name </span></span>
<span class="line"><span style="color: #E6E6E6">                offset _skip </span><span style="color: #569CD6">limit</span><span style="color: #E6E6E6"> _take</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">            ) sub</span></span>
<span class="line"><span style="color: #E6E6E6">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    );</span></span>
<span class="line"><span style="color: #569CD6">end</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.method7(</span></span>
<span class="line"><span style="color: #000000">    _search </span><span style="color: #0000FF">varchar</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _skip </span><span style="color: #0000FF">integer</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _take </span><span style="color: #0000FF">integer</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">json</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql </span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> $$</span></span>
<span class="line"><span style="color: #0000FF">declare</span></span>
<span class="line"><span style="color: #000000">    _count </span><span style="color: #0000FF">bigint</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">create</span><span style="color: #000000"> temp </span><span style="color: #0000FF">table</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">commit</span><span style="color: #000000"> </span><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike _search;</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">get</span><span style="color: #000000"> diagnostics _count = row_count;</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">return</span><span style="color: #000000"> json_build_object(</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'count'</span><span style="color: #000000">, _count,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'customers'</span><span style="color: #000000">, (</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">select</span><span style="color: #000000"> json_agg(sub)</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">from</span><span style="color: #000000"> ( </span></span>
<span class="line"><span style="color: #000000">            </span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">                    customers.customer_id </span><span style="color: #0000FF">as</span><span style="color: #000000"> id,</span></span>
<span class="line"><span style="color: #000000">                    customers.name,</span></span>
<span class="line"><span style="color: #000000">                    json_build_object(</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'id'</span><span style="color: #000000">, customers.address_id,</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'street'</span><span style="color: #000000">, street,</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'city'</span><span style="color: #000000">, json_build_object(</span></span>
<span class="line"><span style="color: #000000">                            </span><span style="color: #A31515">'id'</span><span style="color: #000000">, cities.city_id,</span></span>
<span class="line"><span style="color: #000000">                            </span><span style="color: #A31515">'name'</span><span style="color: #000000">, cities.name</span></span>
<span class="line"><span style="color: #000000">                        )</span></span>
<span class="line"><span style="color: #000000">                    ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">address</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> AddressCount</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">                    _temp_customers</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">where</span><span style="color: #000000"> customers.name ilike </span><span style="color: #A31515">'%john%'</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">                    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">                    customers.name,</span></span>
<span class="line"><span style="color: #000000">                    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">                    street,</span></span>
<span class="line"><span style="color: #000000">                    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">                    cities.name</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name </span></span>
<span class="line"><span style="color: #000000">                offset _skip </span><span style="color: #0000FF">limit</span><span style="color: #000000"> _take</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">            ) sub</span></span>
<span class="line"><span style="color: #000000">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    );</span></span>
<span class="line"><span style="color: #0000FF">end</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><p><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method7.cs">source</a></p><h3 id="method-8">Method 8</h3><p>PLPGSQL function that returns JSON:</p><ul><li>Create the TEMP table with the row number from filtered data and order by customer.</li><li>Get the count from the inserted diagnostics.</li><li>Join the TEMP table with the main query and use the row number to page the data.</li><li>Build a JSON response and deserialize it on the client.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method8.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.method8(</span></span>
<span class="line"><span style="color: #E6E6E6">    _search </span><span style="color: #569CD6">varchar</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _skip </span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _take </span><span style="color: #569CD6">integer</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">json</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql </span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> $$</span></span>
<span class="line"><span style="color: #569CD6">declare</span></span>
<span class="line"><span style="color: #E6E6E6">    _count </span><span style="color: #569CD6">bigint</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> temp </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">commit</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike _search</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6"> diagnostics _count </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> row_count;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'count'</span><span style="color: #E6E6E6">, _count,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'customers'</span><span style="color: #E6E6E6">, (</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> json_agg(sub)</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> ( </span></span>
<span class="line"><span style="color: #E6E6E6">            </span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.customer_id </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">                    json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'id'</span><span style="color: #E6E6E6">, customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'street'</span><span style="color: #E6E6E6">, street,</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'city'</span><span style="color: #E6E6E6">, json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">                            </span><span style="color: #CE9178">'id'</span><span style="color: #E6E6E6">, cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                            </span><span style="color: #CE9178">'name'</span><span style="color: #E6E6E6">, cities.name</span></span>
<span class="line"><span style="color: #E6E6E6">                        )</span></span>
<span class="line"><span style="color: #E6E6E6">                    ) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">address</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> AddressCount</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">                    _temp_customers</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    street,</span></span>
<span class="line"><span style="color: #E6E6E6">                    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    cities.name</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">            ) sub</span></span>
<span class="line"><span style="color: #E6E6E6">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    );</span></span>
<span class="line"><span style="color: #569CD6">end</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.method8(</span></span>
<span class="line"><span style="color: #000000">    _search </span><span style="color: #0000FF">varchar</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _skip </span><span style="color: #0000FF">integer</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _take </span><span style="color: #0000FF">integer</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">json</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql </span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> $$</span></span>
<span class="line"><span style="color: #0000FF">declare</span></span>
<span class="line"><span style="color: #000000">    _count </span><span style="color: #0000FF">bigint</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">create</span><span style="color: #000000"> temp </span><span style="color: #0000FF">table</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">commit</span><span style="color: #000000"> </span><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike _search</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name;</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">get</span><span style="color: #000000"> diagnostics _count = row_count;</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">return</span><span style="color: #000000"> json_build_object(</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'count'</span><span style="color: #000000">, _count,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'customers'</span><span style="color: #000000">, (</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">select</span><span style="color: #000000"> json_agg(sub)</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">from</span><span style="color: #000000"> ( </span></span>
<span class="line"><span style="color: #000000">            </span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">                    customers.customer_id </span><span style="color: #0000FF">as</span><span style="color: #000000"> id,</span></span>
<span class="line"><span style="color: #000000">                    customers.name,</span></span>
<span class="line"><span style="color: #000000">                    json_build_object(</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'id'</span><span style="color: #000000">, customers.address_id,</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'street'</span><span style="color: #000000">, street,</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'city'</span><span style="color: #000000">, json_build_object(</span></span>
<span class="line"><span style="color: #000000">                            </span><span style="color: #A31515">'id'</span><span style="color: #000000">, cities.city_id,</span></span>
<span class="line"><span style="color: #000000">                            </span><span style="color: #A31515">'name'</span><span style="color: #000000">, cities.name</span></span>
<span class="line"><span style="color: #000000">                        )</span></span>
<span class="line"><span style="color: #000000">                    ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">address</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> AddressCount</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">                    _temp_customers</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= $</span><span style="color: #098658">2</span><span style="color: #000000"> + $</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">                    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">                    customers.name,</span></span>
<span class="line"><span style="color: #000000">                    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">                    street,</span></span>
<span class="line"><span style="color: #000000">                    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">                    cities.name</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">            ) sub</span></span>
<span class="line"><span style="color: #000000">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    );</span></span>
<span class="line"><span style="color: #0000FF">end</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><h3 id="method-9">Method 9</h3><p>PLPGSQL function that returns JSON:</p><ul><li>Create the indexed TEMP table with the row number from filtered data and order by customer.</li><li>Get the count from the inserted diagnostics.</li><li>Create the BTREE index on the TEMP table.</li><li>Join the TEMP table with the main query and use the row number to page the data.</li><li>Build a JSON response and deserialize it on the client.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method9.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.method9(</span></span>
<span class="line"><span style="color: #E6E6E6">    _search </span><span style="color: #569CD6">varchar</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _skip </span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _take </span><span style="color: #569CD6">integer</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">json</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql </span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> $$</span></span>
<span class="line"><span style="color: #569CD6">declare</span></span>
<span class="line"><span style="color: #E6E6E6">    _count </span><span style="color: #569CD6">bigint</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> temp </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">commit</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike _search</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6"> diagnostics _count </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> row_count;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">index</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">on</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> btree (</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'count'</span><span style="color: #E6E6E6">, _count,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #CE9178">'customers'</span><span style="color: #E6E6E6">, (</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> json_agg(sub)</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> ( </span></span>
<span class="line"><span style="color: #E6E6E6">            </span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.customer_id </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">                    json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'id'</span><span style="color: #E6E6E6">, customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'street'</span><span style="color: #E6E6E6">, street,</span></span>
<span class="line"><span style="color: #E6E6E6">                        </span><span style="color: #CE9178">'city'</span><span style="color: #E6E6E6">, json_build_object(</span></span>
<span class="line"><span style="color: #E6E6E6">                            </span><span style="color: #CE9178">'id'</span><span style="color: #E6E6E6">, cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                            </span><span style="color: #CE9178">'name'</span><span style="color: #E6E6E6">, cities.name</span></span>
<span class="line"><span style="color: #E6E6E6">                        )</span></span>
<span class="line"><span style="color: #E6E6E6">                    ) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">address</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> AddressCount</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">                    _temp_customers</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">                    </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">                    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    street,</span></span>
<span class="line"><span style="color: #E6E6E6">                    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">                    cities.name</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">            ) sub</span></span>
<span class="line"><span style="color: #E6E6E6">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    );</span></span>
<span class="line"><span style="color: #569CD6">end</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.method9(</span></span>
<span class="line"><span style="color: #000000">    _search </span><span style="color: #0000FF">varchar</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _skip </span><span style="color: #0000FF">integer</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _take </span><span style="color: #0000FF">integer</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">json</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql </span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> $$</span></span>
<span class="line"><span style="color: #0000FF">declare</span></span>
<span class="line"><span style="color: #000000">    _count </span><span style="color: #0000FF">bigint</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">create</span><span style="color: #000000"> temp </span><span style="color: #0000FF">table</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">commit</span><span style="color: #000000"> </span><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike _search</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name;</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">get</span><span style="color: #000000"> diagnostics _count = row_count;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">index</span><span style="color: #000000"> </span><span style="color: #795E26">on</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> btree (</span><span style="color: #0000FF">row</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">return</span><span style="color: #000000"> json_build_object(</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'count'</span><span style="color: #000000">, _count,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #A31515">'customers'</span><span style="color: #000000">, (</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">select</span><span style="color: #000000"> json_agg(sub)</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">from</span><span style="color: #000000"> ( </span></span>
<span class="line"><span style="color: #000000">            </span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">                    customers.customer_id </span><span style="color: #0000FF">as</span><span style="color: #000000"> id,</span></span>
<span class="line"><span style="color: #000000">                    customers.name,</span></span>
<span class="line"><span style="color: #000000">                    json_build_object(</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'id'</span><span style="color: #000000">, customers.address_id,</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'street'</span><span style="color: #000000">, street,</span></span>
<span class="line"><span style="color: #000000">                        </span><span style="color: #A31515">'city'</span><span style="color: #000000">, json_build_object(</span></span>
<span class="line"><span style="color: #000000">                            </span><span style="color: #A31515">'id'</span><span style="color: #000000">, cities.city_id,</span></span>
<span class="line"><span style="color: #000000">                            </span><span style="color: #A31515">'name'</span><span style="color: #000000">, cities.name</span></span>
<span class="line"><span style="color: #000000">                        )</span></span>
<span class="line"><span style="color: #000000">                    ) </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">address</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> AddressCount</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">                    _temp_customers</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= $</span><span style="color: #098658">2</span><span style="color: #000000"> + $</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">                    </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">                    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">                    customers.name,</span></span>
<span class="line"><span style="color: #000000">                    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">                    street,</span></span>
<span class="line"><span style="color: #000000">                    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">                    cities.name</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">            ) sub</span></span>
<span class="line"><span style="color: #000000">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    );</span></span>
<span class="line"><span style="color: #0000FF">end</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><h3 id="method-10">Method 10</h3><p>PLPGSQL function that returns TABLE:</p><ul><li>Create the indexed TEMP table with the row number from filtered data and order by customer.</li><li>Get the count from the inserted diagnostics.</li><li>Create the BTREE index on the TEMP table.</li><li>Join the TEMP table with the main query and use the row number to page the data.</li><li>Return the table and map by position on the client.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method10.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.method10(</span></span>
<span class="line"><span style="color: #E6E6E6">    _search </span><span style="color: #569CD6">varchar</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _skip </span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _take </span><span style="color: #569CD6">integer</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    _customer_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _name </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _street </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _city_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _city_name </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _address_count </span><span style="color: #569CD6">bigint</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _count </span><span style="color: #569CD6">bigint</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> plpgsql </span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> $$</span></span>
<span class="line"><span style="color: #569CD6">declare</span></span>
<span class="line"><span style="color: #E6E6E6">    _count </span><span style="color: #569CD6">bigint</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">begin</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> temp </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">on</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">commit</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">drop</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">as</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike _search</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name;</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">get</span><span style="color: #E6E6E6"> diagnostics _count </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> row_count;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">create</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">index</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">on</span><span style="color: #E6E6E6"> _temp_customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> btree (</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">    </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">return</span><span style="color: #E6E6E6"> query</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">        customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">        customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">        customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">        street,</span></span>
<span class="line"><span style="color: #E6E6E6">        cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">        cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count,</span></span>
<span class="line"><span style="color: #E6E6E6">        _count</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">        _temp_customers</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id)</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">        customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">        customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">        customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">        street,</span></span>
<span class="line"><span style="color: #E6E6E6">        cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">        cities.name</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #569CD6">end</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.method10(</span></span>
<span class="line"><span style="color: #000000">    _search </span><span style="color: #0000FF">varchar</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _skip </span><span style="color: #0000FF">integer</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _take </span><span style="color: #0000FF">integer</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    _customer_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _name </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _address_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _street </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _city_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _city_name </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _address_count </span><span style="color: #0000FF">bigint</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _count </span><span style="color: #0000FF">bigint</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> plpgsql </span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> $$</span></span>
<span class="line"><span style="color: #0000FF">declare</span></span>
<span class="line"><span style="color: #000000">    _count </span><span style="color: #0000FF">bigint</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">begin</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">create</span><span style="color: #000000"> temp </span><span style="color: #0000FF">table</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">on</span><span style="color: #000000"> </span><span style="color: #0000FF">commit</span><span style="color: #000000"> </span><span style="color: #0000FF">drop</span><span style="color: #000000"> </span><span style="color: #0000FF">as</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike _search</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name;</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">get</span><span style="color: #000000"> diagnostics _count = row_count;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">create</span><span style="color: #000000"> </span><span style="color: #0000FF">index</span><span style="color: #000000"> </span><span style="color: #795E26">on</span><span style="color: #000000"> _temp_customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> btree (</span><span style="color: #0000FF">row</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">    </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">return</span><span style="color: #000000"> query</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">        customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">        customers.name,</span></span>
<span class="line"><span style="color: #000000">        customers.address_id,</span></span>
<span class="line"><span style="color: #000000">        street,</span></span>
<span class="line"><span style="color: #000000">        cities.city_id,</span></span>
<span class="line"><span style="color: #000000">        cities.name,</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count,</span></span>
<span class="line"><span style="color: #000000">        _count</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">        _temp_customers</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id)</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= $</span><span style="color: #098658">2</span><span style="color: #000000"> + $</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">        customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">        customers.name,</span></span>
<span class="line"><span style="color: #000000">        customers.address_id,</span></span>
<span class="line"><span style="color: #000000">        street,</span></span>
<span class="line"><span style="color: #000000">        cities.city_id,</span></span>
<span class="line"><span style="color: #000000">        cities.name</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #0000FF">end</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><h3 id="method-11">Method 11</h3><p>SQL function that returns TABLE:</p><ul><li>Use un-materialized CTE without ROW numbers.</li><li>Same as <a href="#method-2">method 2</a>, only in SQL function.</li><li>Notes: labeling function as STABLE or CTE as MATERIALIZED degrades performances.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method11.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.method11(</span></span>
<span class="line"><span style="color: #E6E6E6">    _search </span><span style="color: #569CD6">varchar</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _skip </span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _take </span><span style="color: #569CD6">integer</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    _customer_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _name </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _street </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _city_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _city_name </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _address_count </span><span style="color: #569CD6">bigint</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _count </span><span style="color: #569CD6">bigint</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #6A9955">/*stable*/</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> $$</span></span>
<span class="line"><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> cte </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #6A9955">/*materialized*/</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike _search</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count,</span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> cte) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    cte</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id) </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name </span></span>
<span class="line"><span style="color: #E6E6E6">offset _skip </span><span style="color: #569CD6">limit</span><span style="color: #E6E6E6"> _take</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.method11(</span></span>
<span class="line"><span style="color: #000000">    _search </span><span style="color: #0000FF">varchar</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _skip </span><span style="color: #0000FF">integer</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _take </span><span style="color: #0000FF">integer</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    _customer_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _name </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _address_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _street </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _city_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _city_name </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _address_count </span><span style="color: #0000FF">bigint</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _count </span><span style="color: #0000FF">bigint</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #008000">/*stable*/</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> $$</span></span>
<span class="line"><span style="color: #0000FF">with</span><span style="color: #000000"> cte </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #008000">/*materialized*/</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike _search</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">from</span><span style="color: #000000"> cte) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    cte</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id) </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name </span></span>
<span class="line"><span style="color: #000000">offset _skip </span><span style="color: #0000FF">limit</span><span style="color: #000000"> _take</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><h3 id="method-12">Method 12</h3><p>SQL function that returns TABLE:</p><ul><li>Use un-materialized CTE with ROW numbers.</li><li>Same as <a href="#method-3">method 3</a>, only in SQL function.</li><li>Notes: labeling function as STABLE or CTE as MATERIALIZED degrades performances.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method12.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">create or replace</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">function</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">example</span><span style="color: #E6E6E6">.method12(</span></span>
<span class="line"><span style="color: #E6E6E6">    _search </span><span style="color: #569CD6">varchar</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _skip </span><span style="color: #569CD6">integer</span><span style="color: #E6E6E6">, </span></span>
<span class="line"><span style="color: #E6E6E6">    _take </span><span style="color: #569CD6">integer</span></span>
<span class="line"><span style="color: #E6E6E6">) </span></span>
<span class="line"><span style="color: #569CD6">returns</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">table</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    _customer_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _name </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _address_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _street </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _city_id </span><span style="color: #569CD6">int</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _city_name </span><span style="color: #569CD6">text</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _address_count </span><span style="color: #569CD6">bigint</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    _count </span><span style="color: #569CD6">bigint</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">language</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">sql</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #6A9955">/*stable*/</span></span>
<span class="line"><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> $$</span></span>
<span class="line"><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> cte </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #6A9955">/*materialized*/</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike _search</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count,</span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">max</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> cte) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    cte</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id) </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> _skip </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> _skip </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> _take</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span></span>
<span class="line"><span style="color: #E6E6E6">$$;</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">create or replace</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> </span><span style="color: #795E26">example</span><span style="color: #000000">.method12(</span></span>
<span class="line"><span style="color: #000000">    _search </span><span style="color: #0000FF">varchar</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _skip </span><span style="color: #0000FF">integer</span><span style="color: #000000">, </span></span>
<span class="line"><span style="color: #000000">    _take </span><span style="color: #0000FF">integer</span></span>
<span class="line"><span style="color: #000000">) </span></span>
<span class="line"><span style="color: #0000FF">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">table</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    _customer_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _name </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _address_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _street </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _city_id </span><span style="color: #0000FF">int</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _city_name </span><span style="color: #0000FF">text</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _address_count </span><span style="color: #0000FF">bigint</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    _count </span><span style="color: #0000FF">bigint</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">language</span><span style="color: #000000"> </span><span style="color: #0000FF">sql</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #008000">/*stable*/</span></span>
<span class="line"><span style="color: #0000FF">as</span><span style="color: #000000"> $$</span></span>
<span class="line"><span style="color: #0000FF">with</span><span style="color: #000000"> cte </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #008000">/*materialized*/</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike _search</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">max</span><span style="color: #000000">(</span><span style="color: #0000FF">row</span><span style="color: #000000">) </span><span style="color: #0000FF">from</span><span style="color: #000000"> cte) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    cte</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id) </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > _skip </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= _skip + _take</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span></span>
<span class="line"><span style="color: #000000">$$;</span></span></code></pre></div><h3 id="method-13">Method 13</h3><p>SQL query:</p><ul><li>Use un-materialized CTE without ROW numbers.</li><li>Same as <a href="#method-3">method 2</a>, only without materialization.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method13.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> cte </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count,</span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> cte) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    cte</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id) </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name </span></span>
<span class="line"><span style="color: #E6E6E6">offset $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">limit</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">with</span><span style="color: #000000"> cte </span><span style="color: #0000FF">as</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">from</span><span style="color: #000000"> cte) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    cte</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id) </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name </span></span>
<span class="line"><span style="color: #000000">offset $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">limit</span><span style="color: #000000"> $</span><span style="color: #098658">3</span></span></code></pre></div><h3 id="method-14">Method 14</h3><p>SQL query:</p><ul><li>Use un-materialized CTE with ROW numbers.</li><li>Same as <a href="#method-3">method 3</a>, only without materialization.</li><li><a href="https://github.com/vb-consulting/PgPagingBenchmarks/blob/master/PageBenchmarks/Method14.cs">Source Code</a></li></ul><div class="code sql"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div><div class="photo-code bi-camera" data-bs-toggle="tooltip" data-bs-title="Copy code image to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #569CD6">with</span><span style="color: #E6E6E6"> cte </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> (</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">row_number</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">over</span><span style="color: #E6E6E6">() </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">, customer_id </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> example.customers </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">name</span><span style="color: #E6E6E6"> ilike $</span><span style="color: #B5CEA8">1</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> customers.name</span></span>
<span class="line"><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #DCDCAA">count</span><span style="color: #E6E6E6">(</span><span style="color: #D4D4D4">*</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> address_count,</span></span>
<span class="line"><span style="color: #E6E6E6">    (</span><span style="color: #569CD6">select</span><span style="color: #E6E6E6"> </span><span style="color: #DCDCAA">max</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">) </span><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> cte) </span><span style="color: #569CD6">as</span><span style="color: #E6E6E6"> count</span></span>
<span class="line"><span style="color: #569CD6">from</span><span style="color: #E6E6E6"> </span></span>
<span class="line"><span style="color: #E6E6E6">    cte</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customers </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (address_id)</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.cities </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (city_id) </span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">join</span><span style="color: #E6E6E6"> example.customer_addresses </span><span style="color: #569CD6">using</span><span style="color: #E6E6E6"> (customer_id)</span></span>
<span class="line"><span style="color: #569CD6">where</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">></span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">and</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">&lt;=</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">2</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">+</span><span style="color: #E6E6E6"> $</span><span style="color: #B5CEA8">3</span></span>
<span class="line"><span style="color: #569CD6">group by</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #569CD6">row</span><span style="color: #E6E6E6">,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.customer_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.name,</span></span>
<span class="line"><span style="color: #E6E6E6">    customers.address_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    street,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.city_id,</span></span>
<span class="line"><span style="color: #E6E6E6">    cities.name</span></span>
<span class="line"><span style="color: #569CD6">order by</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">row</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #0000FF">with</span><span style="color: #000000"> cte </span><span style="color: #0000FF">as</span><span style="color: #000000"> (</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">row_number</span><span style="color: #000000">() </span><span style="color: #0000FF">over</span><span style="color: #000000">() </span><span style="color: #0000FF">as</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000">, customer_id </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">from</span><span style="color: #000000"> example.customers </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">name</span><span style="color: #000000"> ilike $</span><span style="color: #098658">1</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">order by</span><span style="color: #000000"> customers.name</span></span>
<span class="line"><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #0000FF">select</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name,</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #795E26">count</span><span style="color: #000000">(*) </span><span style="color: #0000FF">as</span><span style="color: #000000"> address_count,</span></span>
<span class="line"><span style="color: #000000">    (</span><span style="color: #0000FF">select</span><span style="color: #000000"> </span><span style="color: #795E26">max</span><span style="color: #000000">(</span><span style="color: #0000FF">row</span><span style="color: #000000">) </span><span style="color: #0000FF">from</span><span style="color: #000000"> cte) </span><span style="color: #0000FF">as</span><span style="color: #000000"> count</span></span>
<span class="line"><span style="color: #0000FF">from</span><span style="color: #000000"> </span></span>
<span class="line"><span style="color: #000000">    cte</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customers </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (address_id)</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.cities </span><span style="color: #0000FF">using</span><span style="color: #000000"> (city_id) </span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">join</span><span style="color: #000000"> example.customer_addresses </span><span style="color: #0000FF">using</span><span style="color: #000000"> (customer_id)</span></span>
<span class="line"><span style="color: #0000FF">where</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> > $</span><span style="color: #098658">2</span><span style="color: #000000"> </span><span style="color: #0000FF">and</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span><span style="color: #000000"> &lt;= $</span><span style="color: #098658">2</span><span style="color: #000000"> + $</span><span style="color: #098658">3</span></span>
<span class="line"><span style="color: #0000FF">group by</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #0000FF">row</span><span style="color: #000000">,</span></span>
<span class="line"><span style="color: #000000">    customers.customer_id,</span></span>
<span class="line"><span style="color: #000000">    customers.name,</span></span>
<span class="line"><span style="color: #000000">    customers.address_id,</span></span>
<span class="line"><span style="color: #000000">    street,</span></span>
<span class="line"><span style="color: #000000">    cities.city_id,</span></span>
<span class="line"><span style="color: #000000">    cities.name</span></span>
<span class="line"><span style="color: #0000FF">order by</span><span style="color: #000000"> </span><span style="color: #0000FF">row</span></span></code></pre></div><h2 id="results">Results</h2><h3 id="round1">Round1</h3><table class="table table-sm table-hover table-bordered" style="width: initial;"><thead><tr><th>Table</th><th align="right">Count</th></tr></thead><tbody class="table-group-divider"><tr><td><code>example.cities</code></td><td align="right">432,166</td></tr><tr><td><code>example.addresses</code></td><td align="right">3,996,491</td></tr><tr><td><code>example.customers</code></td><td align="right">500,000</td></tr><tr><td><code>example.customer_addresses</code></td><td align="right">3,996,491</td></tr></tbody></table><table class="table table-sm table-hover table-bordered" style="width: initial;"><thead><tr><th>Method</th><th align="right">Mean</th><th align="right">Error</th><th align="right">StdDev</th><th align="right">Ratio</th></tr></thead><tbody class="table-group-divider"><tr><td><a href="#method-1">Method1</a></td><td align="right">2.239 s</td><td align="right">0.0204 s</td><td align="right">0.0190 s</td><td align="right">1.00</td></tr><tr><td><a href="#method-2">Method2</a></td><td align="right">2.267 s</td><td align="right">0.0168 s</td><td align="right">0.0157 s</td><td align="right">1.01</td></tr><tr><td><a href="#method-3">Method3</a></td><td align="right">2.133 s</td><td align="right">0.0139 s</td><td align="right">0.0130 s</td><td align="right">0.95</td></tr><tr><td><a href="#method-4">Method4</a></td><td align="right">2.273 s</td><td align="right">0.0120 s</td><td align="right">0.0113 s</td><td align="right">1.02</td></tr><tr><td><a href="#method-5">Method5</a></td><td align="right">2.154 s</td><td align="right">0.0235 s</td><td align="right">0.0220 s</td><td align="right">0.96</td></tr><tr><td><a href="#method-6">Method6</a></td><td align="right">2.137 s</td><td align="right">0.0157 s</td><td align="right">0.0147 s</td><td align="right">0.95</td></tr><tr><td><a href="#method-7">Method7</a></td><td align="right">2.316 s</td><td align="right">0.0144 s</td><td align="right">0.0135 s</td><td align="right">1.03</td></tr><tr><td><a href="#method-8">Method8</a></td><td align="right">2.136 s</td><td align="right">0.0178 s</td><td align="right">0.0167 s</td><td align="right">0.95</td></tr><tr><td><del><a href="#method-9">Method9</a></del></td><td align="right"><del>2.147 s</del></td><td align="right"><del>0.0153 s</del></td><td align="right"><del>0.0143 s</del></td><td align="right"><del>0.96</del></td></tr></tbody></table><ul><li>Method 9 mistakenly was executing method 8, that result is not valid.</li></ul><h3 id="round2">Round2</h3><table class="table table-sm table-hover table-bordered" style="width: initial;"><thead><tr><th>Table</th><th align="right">Count</th></tr></thead><tbody class="table-group-divider"><tr><td><code>example.cities</code></td><td align="right">450,762</td></tr><tr><td><code>example.addresses</code></td><td align="right">5,596,217</td></tr><tr><td><code>example.customers</code></td><td align="right">700,000</td></tr><tr><td><code>example.customer_addresses</code></td><td align="right">5,596,218</td></tr></tbody></table><table class="table table-sm table-hover table-bordered" style="width: initial;"><thead><tr><th>Method</th><th align="right">Mean</th><th align="right">Error</th><th align="right">StdDev</th><th align="right">Ratio</th><th align="right">RatioSD</th></tr></thead><tbody class="table-group-divider"><tr><td><a href="#method-1">Method1</a></td><td align="right">2.317 s</td><td align="right">0.0157 s</td><td align="right">0.0147 s</td><td align="right">1.00</td><td align="right">0.00</td></tr><tr><td><a href="#method-2">Method2</a></td><td align="right">2.339 s</td><td align="right">0.0128 s</td><td align="right">0.0113 s</td><td align="right">1.01</td><td align="right">0.01</td></tr><tr><td><a href="#method-3">Method3</a></td><td align="right">2.153 s</td><td align="right">0.0159 s</td><td align="right">0.0149 s</td><td align="right">0.93</td><td align="right">0.01</td></tr><tr><td><a href="#method-4">Method4</a></td><td align="right">2.387 s</td><td align="right">0.0456 s</td><td align="right">0.0593 s</td><td align="right">1.03</td><td align="right">0.03</td></tr><tr><td><a href="#method-5">Method5</a></td><td align="right">2.163 s</td><td align="right">0.0156 s</td><td align="right">0.0146 s</td><td align="right">0.93</td><td align="right">0.01</td></tr><tr><td><a href="#method-6">Method6</a></td><td align="right">2.167 s</td><td align="right">0.0105 s</td><td align="right">0.0093 s</td><td align="right">0.94</td><td align="right">0.01</td></tr><tr><td><a href="#method-7">Method7</a></td><td align="right">2.402 s</td><td align="right">0.0177 s</td><td align="right">0.0165 s</td><td align="right">1.04</td><td align="right">0.01</td></tr><tr><td><a href="#method-8">Method8</a></td><td align="right">2.159 s</td><td align="right">0.0147 s</td><td align="right">0.0137 s</td><td align="right">0.93</td><td align="right">0.01</td></tr><tr><td><a href="#method-9">Method9</a></td><td align="right">2.167 s</td><td align="right">0.0168 s</td><td align="right">0.0157 s</td><td align="right">0.94</td><td align="right">0.01</td></tr><tr><td><a href="#method-10">Method10</a></td><td align="right">2.160 s</td><td align="right">0.0146 s</td><td align="right">0.0130 s</td><td align="right">0.93</td><td align="right">0.01</td></tr><tr><td><a href="#method-11">Method11</a></td><td align="right">2.231 s</td><td align="right">0.0178 s</td><td align="right">0.0167 s</td><td align="right">0.96</td><td align="right">0.01</td></tr><tr><td><a href="#method-12">Method12</a></td><td align="right">2.176 s</td><td align="right">0.0422 s</td><td align="right">0.0414 s</td><td align="right">0.94</td><td align="right">0.02</td></tr><tr><td><a href="#method-13">Method13</a></td><td align="right">2.338 s</td><td align="right">0.0195 s</td><td align="right">0.0173 s</td><td align="right">1.01</td><td align="right">0.01</td></tr><tr><td><a href="#method-14">Method14</a></td><td align="right">2.156 s</td><td align="right">0.0121 s</td><td align="right">0.0113 s</td><td align="right">0.93</td><td align="right">0.01</td></tr></tbody></table><h2 id="conclusion">Conclusion</h2><p>PostgreSQL 16 is incredibly optimized. I'm Gonna Need a Bigger Boat, I mean the dataset.</p><p>Edit, round2:</p><ul><li>With a slightly bigger set difference is slightly bigger, but still in the milliseconds range and not worth optimizing further.</li><li>Surprisingly CTE methods are a bit slower when not materialized. Probably because they fit into memory, on bigger result sets this should not be the case.</li><li>Even more surprisingly, functions labeled as STABLE will experience a serious degradation in performance, which was unexpected.</li><li>SQL function in <a href="#method-12">method 12</a> was even returning a wrong page when labeled as STABLE and was using MATERIALIZED CTE.</li></ul><blockquote><p>If anyone has a different method, let me know, I'd like to include that in tests too.</p></blockquote><div class="w-fit mx-auto mt-5 mb-3 border-top"><div class="alert text-center fs-smaller text-muted">To receive notifications about new posts and updates, consider subscribing to my LinkdIn page:<br><a class="btn btn-sm" href="https://www.linkedin.com/in/vb-software/"><i class="bi-linkedin"></i> <span class="text-primary">vb-software linkedin</span></a><br><br>You will receive notifications about new posts on your LinkedIn feed.</div></div><div class="pt-5 border-top"><div id="comments-section" class="h5">Comments</div><script defer src="https://cdn.commento.io/js/commento.js" data-no-fonts="true" data-css-override="https://vb-consulting.github.io/style.css"></script><div id="commento"></div></div><footer class="mt-3 py-5"><div class="w-fit mx-auto mb-3 border-top border-bottom"><div class="alert text-center fs-smaller text-muted"><div class="alert text-center fs-smaller text-muted mb-1">If you like my content, use my software, or otherwise benefit from my work, consider supporting me by buying me a coffee. The software runs on coffee after all.</div><a class="btn rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="Click Here to Buy Me a Coffee Or Scan the Code" href="https://www.buymeacoffee.com/vbilopavu" style="display: inline-grid;">Buy me a Coffee <img class="m-auto svelte-byttq0" alt="Scan Here To Buy Me a Cofee" src="/bmc_qr.png"></a></div></div><div class="d-flex justify-content-center"><a class="btn rl-arrow me-1" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="PgPagingBenchmarks on GitHub" href="https://github.com/vb-consulting/PgPagingBenchmarks" style="display: inline-grid;">PgPagingBenchmarks on GitHub <i class="bi bi-github"></i></a> <a class="btn rl-arrow" target="_blank" data-bs-toggle="tooltip" data-bs-html="true" title="I Post Software Development Content Daily" href="https://www.linkedin.com/in/vb-software/" style="display: inline-grid;">Follow me on LinkedIn <i class="bi bi-linkedin"></i></a></div><div class="text-center"><div class="mt-5 mb-5 background-floki svelte-byttq0" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog."></div></div></footer><div class="mb-5"></div></div></div><div class="rightside svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">on this page</span><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="postgresql-paging-benchmarks" title="PostgreSQL Paging Benchmarks"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#postgresql-paging-benchmarks">PostgreSQL Paging Benchmarks</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="setup" title="Setup"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#setup">Setup</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="requirements" title="Requirements"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#requirements">Requirements</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="test-methods" title="Test methods"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#test-methods">Test methods</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-1" title="Method 1"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-1">Method 1</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-2" title="Method 2"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-2">Method 2</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-3" title="Method 3"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-3">Method 3</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-4" title="Method 4"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-4">Method 4</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-5" title="Method 5"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-5">Method 5</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-6" title="Method 6"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-6">Method 6</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-7" title="Method 7"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-7">Method 7</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-8" title="Method 8"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-8">Method 8</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-9" title="Method 9"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-9">Method 9</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-10" title="Method 10"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-10">Method 10</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-11" title="Method 11"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-11">Method 11</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-12" title="Method 12"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-12">Method 12</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-13" title="Method 13"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-13">Method 13</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="method-14" title="Method 14"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#method-14">Method 14</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="results" title="Results"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#results">Results</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="round1" title="Round1"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#round1">Round1</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="round2" title="Round2"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#round2">Round2</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="conclusion" title="Conclusion"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#conclusion">Conclusion</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="comments-section" title="Comments"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#comments-section">Comments</a></li></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],o=document.querySelectorAll("div.code"),k=i.querySelector(".home");function E(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n])}function T(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n]);E(e,t),e.classList.add(t)}function t(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",o=0;o<n.classList.length;o++)if(n.classList[o].startsWith("bi-")){i=n.classList[o];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}"/"==document.location.pathname&&T(k,"d-none");var e=document.querySelector(".post-share > .copy-url"),n=(e&&e.addEventListener("click",function(e){t(e,function(e,t){navigator.clipboard.writeText(document.location.origin+document.location.pathname),t()})}),document.getElementsByTagName("html")[0]),a=i.querySelector("#theme-btn"),s="theme";function l(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<o.length;n++){var i=o[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e){t(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function c(e){t(e,function(e,t){var n=localStorage.getItem(s);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(s)?"light":"dark";localStorage.setItem(s,e),l(n.dataset.bsTheme=e)}),l(localStorage.getItem(s)),a.children[0].classList.remove("hidden");for(var d=0;d<o.length;d++){o[d].getElementsByClassName("copy-code")[0].addEventListener("click",r);var m=o[d].getElementsByClassName("photo-code");m.length&&m[0].addEventListener("click",c)}for(var S=function(){var a,o,s;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.querySelector(".main-content").querySelectorAll("[id]"),o=void 0,this.initNavs=function(e){s=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,o=0;o<s.length;o++)if(s[o].dataset.id==n){i=s[o];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(l(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),r()},f.children[1].addEventListener("scroll",r),this;function l(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function r(){if(s&&s.length){for(var e=0;e<s.length;e++)s[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=l(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),o&&clearTimeout(o),void(o=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),o=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),o&&clearTimeout(o),o=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),o=void 0},250))}}}(),h=function(){var l,r=i.querySelector("#nav-btn"),c=480,d="200px",m="0.25fr",h=730,v=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],t="sidebar-pinned",p=null==localStorage.getItem(t)||"true"==localStorage.getItem(t),y=!1,b=!1;function n(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?y?"100%":"0":p?""+d:"0",i=`grid-template-columns: ${n} 1fr`,o=t&&y?"width: 100%":"0"!=n?"":"display: none",a=t&&y?"display: none":"",s=t?y?"sidebar-show":"sidebar-hide":p?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(m&&h&&v&&(n&&e<v||!n&&e<h?b||(u.innerHTML=l+g.innerHTML,S.initNavs(u),b=!0):b&&(u.innerHTML=l,S.initNavs(g),b=!1)),!m||t||b?(i+=";",f.children[2].style.display="none"):(i+=` ${m};`,f.children[2].style.display="")),T(r,!t&&p||t&&y?"rotate":"rotate-back","rotate","rotate-back"),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),f.style=L?i:"display: grid;",L&&T(L,s,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=o),w.style=a,t&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),t&&y&&T(k,"d-none")}function e(){var e=window.outerWidth<c;e?y=!y:p=!p,localStorage.setItem(t,p.toString()),n(),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),e&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),e&&y&&T(k,"d-none")}return m&&h&&v&&g&&(l=u.innerHTML,S.initNavs(g)),r.addEventListener("click",e),(window.onresize=n)(),this.closeSidebar=function(){window.outerWidth<c&&y&&e()},this}(),v=document.getElementsByClassName("auto-close"),u=0;u<v.length;u++)v[u].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(e=document.getElementById(location.hash.replace("#","")))&&e.scrollIntoView()}();</script><script src="/bootstrap.bundle.min.js"></script><script>!function(){for(var e=document.querySelectorAll('[data-bs-toggle="tooltip"]'),t=0;t<e.length;t++)new bootstrap.Tooltip(e[t]);var n=document.getElementsByClassName("accordion-item");if(n.length){for(t=0;t<n.length;t++){var o=n[t];o.querySelectorAll("[href='"+document.location.pathname+"']").length&&o.firstChild.click()}var l=document.querySelector("nav.navbar").querySelector(".home"),a=document.getElementsByClassName("accordion");"/"==document.location.pathname&&l.classList.add("d-none");for(t=0;t<n.length;t++){var s=a[t];s&&s.firstChild&&"VB-Consulting"==s.firstChild.title&&(null!=s.firstChild.querySelector(".collapse")&&l.classList.contains("d-none")&&"/"!=document.location.pathname&&l.classList.remove("d-none"),s.addEventListener("show.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none"),l.classList.add("d-none")}),s.addEventListener("hide.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none")}))}}}();</script><script src="/html2canvas.min.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script></body><script async data-id="101435862" src="//static.getclicky.com/js"></script></html>