<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>NpgsqlRest Update 1.6.2</title><meta name="description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><link href="https://vb-consulting.github.io/blog/npgsqlrest-update1.6.2/" rel="canonical"><meta name="keywords" content="api, api-rest, restful-api, http, postgres, dotnet, net8, c#, aot, database, rest, server, postgresql, npgsqlrest, pgsql, pg, automatic"><meta name="author" content="floki"><meta prefix="og: http://ogp.me/ns#" property="og:title" content="NpgsqlRest Update 1.6.2"><meta prefix="og: http://ogp.me/ns#" property="og:description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><meta prefix="og: http://ogp.me/ns#" property="og:image" content="https://vb-consulting.github.io/eleph1.jpg"><meta prefix="og: http://ogp.me/ns#" property="og:type" content="article"><meta prefix="og: http://ogp.me/ns#" property="og:site_name" content="VB-Consulting"><meta prefix="og: http://ogp.me/ns#" property="og:url" content="https://vb-consulting.github.io/blog/npgsqlrest-update1.6.2/"><meta name="twitter:image" content="https://vb-consulting.github.io/eleph1.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><link rel="stylesheet" href="/_elderjs/assets/svelte-1c4aeede.css" media="all"><style></style><link href="/style.css?1707216916935" rel="stylesheet"><script>!function(){var e="theme",t=localStorage.getItem(e);t||(t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",localStorage.setItem(e,t)),document.getElementsByTagName("html")[0].dataset.bsTheme=t}();</script></head><body class="d-flex flex-column h-100"><header id="header"><nav class="navbar navbar-expand-md navbar-dark fixed-top py-0 py-md-0 svelte-13wa5zp"><div class="container-fluid flex-nowrap svelte-13wa5zp"><div class="d-flex svelte-13wa5zp"><button id="nav-btn" type="button" class="d-flex btn btn-sm logo animate-rotate svelte-13wa5zp"><i class="material-icons-outlined">menu</i></button> <a class="nav-link my-auto ms-2 fw-semibold home svelte-13wa5zp" href="/"><i class="bi-chevron-double-left"></i> VB Home</a></div><div class="d-flex right svelte-13wa5zp"><a class="nav-link my-auto me-2 svelte-13wa5zp" href="https://github.com/vb-consulting/blog/"><i class="bi-github"></i></a> <a class="github-button svelte-13wa5zp" href="https://github.com/vb-consulting/blog/" data-color-scheme="no-preference: light_high_contrast; light: light_high_contrast; dark: light_high_contrast;" data-icon="octicon-star" data-show-count="true" aria-label="Star vb-consulting/blog/ on GitHub"></a><div class="vr text-white my-auto svelte-13wa5zp"></div><button id="theme-btn" type="button" aria-pressed="true" aria-label="theme" class="svelte-13wa5zp"><span class="check hidden svelte-13wa5zp"><span class="icon svelte-13wa5zp"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-13wa5zp"><path fill="currentColor" d="M12 21q-3.775 0-6.388-2.613T3 12q0-3.45 2.25-5.988T11 3.05q.625-.075.975.45t-.025 1.1q-.425.65-.638 1.375T11.1 7.5q0 2.25 1.575 3.825T16.5 12.9q.775 0 1.538-.225t1.362-.625q.525-.35 1.075-.037t.475.987q-.35 3.45-2.937 5.725T12 21Zm0-2q2.2 0 3.95-1.213t2.55-3.162q-.5.125-1 .2t-1 .075q-3.075 0-5.238-2.163T9.1 7.5q0-.5.075-1t.2-1q-1.95.8-3.163 2.55T5 12q0 2.9 2.05 4.95T12 19Zm-.25-6.75Z"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" class="svelte-13wa5zp"><g fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M0 0h24v24H0z"></path><path fill="currentColor" d="M12 19a1 1 0 0 1 .993.883L13 20v1a1 1 0 0 1-1.993.117L11 21v-1a1 1 0 0 1 1-1zm6.313-2.09l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7a1 1 0 0 1 1.218-1.567l.102.07zm-11.306.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM4 11a1 1 0 0 1 .117 1.993L4 13H3a1 1 0 0 1-.117-1.993L3 11h1zm17 0a1 1 0 0 1 .117 1.993L21 13h-1a1 1 0 0 1-.117-1.993L20 11h1zM6.213 4.81l.094.083l.7.7a1 1 0 0 1-1.32 1.497l-.094-.083l-.7-.7A1 1 0 0 1 6.11 4.74l.102.07zm12.894.083a1 1 0 0 1 .083 1.32l-.083.094l-.7.7a1 1 0 0 1-1.497-1.32l.083-.094l.7-.7a1 1 0 0 1 1.414 0zM12 2a1 1 0 0 1 .993.883L13 3v1a1 1 0 0 1-1.993.117L11 4V3a1 1 0 0 1 1-1zm0 5a5 5 0 1 1-4.995 5.217L7 12l.005-.217A5 5 0 0 1 12 7z"></path></g></svg></span></span></button></div></div></nav></header><main class="svelte-9zwk14"><div class="sidebar sidebar-hide svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-item svelte-9zwk14" data-id="" title="VB-Consulting"><a class="nav-link svelte-9zwk14 text-uppercase" href="/">VB-Consulting</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="NpgsqlRest"><a class="nav-link svelte-9zwk14 text-uppercase" href="/npgsqlrest/">NpgsqlRest</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="Norm.Net"><a class="nav-link svelte-9zwk14 text-uppercase" href="/norm.net/">Norm.Net</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="RazorSvelte"><a class="nav-link svelte-9zwk14 text-uppercase" href="/razorsvelte/">RazorSvelte</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PgRoutiner"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pgroutiner/">PgRoutiner</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="XUnit.Npgsql"><a class="nav-link svelte-9zwk14 text-uppercase" href="/xunit.npgsql/">XUnit.Npgsql</a></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="PostrgeSQL Schema Tools"><a class="nav-link svelte-9zwk14 text-uppercase" href="/pg_schema_tools/">PostrgeSQL Schema Tools</a></li><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">blogs</span><hr class="svelte-9zwk14"></li><li class="nav-item toc2 svelte-9zwk14" data-id="" title="See all blogs..."><a class="nav-link btn btn-sm w-fit px-3 mx-auto svelte-9zwk14 lr-arrow text-uppercase" href="/blogs/"><i class="bi bi-arrow-right-circle svelte-9zwk14"></i> <span class="btn-link">ALL BLOGS</span></a></li><li class="nav-item svelte-9zwk14 active" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest-update1.6.2/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest Update 1.6.2</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Automatic REST API for PostgreSQL Database as .NET8 Middleware"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/npgsqlrest/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>NpgsqlRest NuGet Library</a></li><li class="nav-item svelte-9zwk14" data-id="" title="What are the Micro ORM libraries, why do they even exist, what are their purpose, what are they used for, and what are the alternatives?"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/micro-orm/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>What is Micro ORM?</a></li><li class="nav-item svelte-9zwk14" data-id="" title="The world's tiniest, smallest ORM for .NET"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/piko-orm/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Piko ORM</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Apart from security, performance, maintainability, and availability, what STORED PROCEDURES have ever really done for us?"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/what-have-stored-procedures-ever-done/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>What have the STORED PROCEDURES ever done for us?</a></li><li class="nav-item svelte-9zwk14" data-id="" title="You take the blue pill - the story ends, ... etc, select option 1 or option 2. Which one is better?"><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/where-to/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Which Way .NET Developer?</a></li><li class="nav-item svelte-9zwk14" data-id="" title="PostgreSQL script that implements temporal tables without extension."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/postgresql-temporal-tables/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Custom Temporal Tables in PostgreSQL</a></li><li class="nav-item svelte-9zwk14" data-id="" title='Some opinions on software architecture and design. What are the "ilities" what are quality attributes and why are they important for software architecture and design?'><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/haters-build-software/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Haters Build Software</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Exploring a different approach to recursion with PostgreSQL by using recursive plpgsql function instead of recursive CTE query."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part1-different-type-of-recursion/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 1 - A Different Type of Recursion</a></li><li class="nav-item svelte-9zwk14" data-id="" title="Follow-Up 1 on PostgreSQL recursive function. Some performance optimizations."><a class="nav-link svelte-9zwk14 lr-arrow text-uppercase" href="/blog/recursion-postgresql/part2-performances/"><i class="bi bi-chat-left-text svelte-9zwk14"></i>Recursion with PostgreSQL Part 2 - Performances</a></li></ul></div></div><div class="content svelte-9zwk14"><div class="banner svelte-1jzqpn5" style="background-image: url(/eleph1.jpg); background-position: center; background-blend-mode: luminosity;"></div><div class="container-sm main-content blog svelte-1jzqpn5 bannered"><div class="blog-head svelte-1jzqpn5"><a href="https://github.com/vb-consulting/blog/blob/master/LICENSE" class="text-shadow svelte-1jzqpn5" style="color: white">CC0-1.0 license</a></div><div class="categories svelte-1jzqpn5"><a href="/blogs/npgsqlrest" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># npgsqlrest</span> </a><a href="/blogs/rest" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># rest</span> </a><a href="/blogs/postgres" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># postgres</span> </a><a href="/blogs/postgresql" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># postgresql</span> </a><a href="/blogs/dotnet" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># dotnet</span> </a><a href="/blogs/net8" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># net8</span> </a><a href="/blogs/c#" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># c#</span> </a><a href="/blogs/aot" class="btn btn-sm text-shadow svelte-1jzqpn5"><span class="cat btn-link"># aot</span></a></div><h1 class="text-shadow" id="npgsqlrest-162-update">NpgsqlRest 1.6.2 Update</h1><div class="post-meta text-shadow"><div class="post-share"><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fnpgsqlrest-update1.6.2%2F" class="me-1 bi-linkedin" data-bs-toggle="tooltip" data-bs-html="true" title="Share on LinkedIn"><i class=""></i></a> <a href="http://twitter.com/share?text=NpgsqlRest%20Update%201.6.2%0AAutomatic%20REST%20API%20for%20PostgreSQL%20Database%20as%20.NET8%20Middleware%0A&url=https%3A%2F%2Fvb-consulting.github.io%2Fblog%2Fnpgsqlrest-update1.6.2%2F&hashtags=npgsqlrest%2Crest%2Cpostgres%2Cpostgresql%2Cdotnet%2Cnet8%2Cc%23%2Caot" class="me-1 bi-twitter-x" data-bs-toggle="tooltip" data-bs-html="true" title="Share on X"><i class=""></i></a> <a href="#" class="copy-url bi-clipboard" data-bs-toggle="tooltip" data-bs-html="true" title="Copy URL"><i class=""></i></a></div><div class="post-details"><div class="post-pic" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog." style="background-image: url(/floki.jpeg)"></div><div class="post-details-right"><div class="post-author">floki</div><div class="post-date">Feb 6, 2024</div></div></div></div><p>I'm glad to see that the NpgsqlRest Nuget library is getting matured and refined. Here are some highlights from the <a href="/npgsqlrest/changelog/#version-162-2024-02-03">changelog</a> since version 1.4.0:</p><h3 id="strict-function-support"><a href="/npgsqlrest/changelog/#1-new-feature-strict-function-support">Strict Function Support</a></h3><p>Functions in a strict mode (labeled as <code>STRICT</code> or <code>RETURNS NULL ON NULL INPUT</code>) are the functions that will always return <code>NULL</code> if at least one of the parameters is <code>NULL</code>. In that case, the function isn't even executed.</p><p>NpgsqlRest will not even try to execute strict functions when at least one of the parameters is <code>NULL</code>. Instead, the call will return <code>HTTP 204 NoContent</code> and bypass talking to the database altogether.</p><h3 id="command-callback"><a href="/npgsqlrest/changelog/#3-command-callback">Command Callback</a></h3><p>You can add a lambda callback that will receive a created data reader for the PostgreSQL function and the current HTTP context. If you choose to modify the HTTP response, the default behavior will be skipped in favor of your customized response.</p><p>For example, if we have some function that returns data, we can add a handler to render CSV instead of the default JSON response:</p><div class="code csharp"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #9CDCFE">app</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">UseNpgsqlRest</span><span style="color: #E6E6E6">(</span><span style="color: #569CD6">new</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">connectionString</span><span style="color: #E6E6E6">)</span></span>
<span class="line"><span style="color: #E6E6E6">{</span></span>
<span class="line"><span style="color: #E6E6E6">    </span><span style="color: #9CDCFE">CommandCallbackAsync</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">async</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=></span></span>
<span class="line"><span style="color: #E6E6E6">    {</span></span>
<span class="line"><span style="color: #E6E6E6">        </span><span style="color: #C586C0">if</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">string</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">Equals</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">routine</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Name</span><span style="color: #E6E6E6"> , </span><span style="color: #CE9178">"get_csv_data"</span><span style="color: #E6E6E6">))</span></span>
<span class="line"><span style="color: #E6E6E6">        {</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Response</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">ContentType</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">"text/csv"</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #C586C0">using</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">command</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ExecuteReaderAsync</span><span style="color: #E6E6E6">();</span></span>
<span class="line"><span style="color: #E6E6E6">            </span><span style="color: #C586C0">while</span><span style="color: #E6E6E6"> (</span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">reader</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">ReadAsync</span><span style="color: #E6E6E6">())</span></span>
<span class="line"><span style="color: #E6E6E6">            {</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">var</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">line</span><span style="color: #E6E6E6"> </span><span style="color: #D4D4D4">=</span><span style="color: #E6E6E6"> </span><span style="color: #CE9178">$"{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">[</span><span style="color: #B5CEA8">0</span><span style="color: #CE9178">]},{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">[</span><span style="color: #B5CEA8">1</span><span style="color: #CE9178">]},{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">.</span><span style="color: #DCDCAA">GetDateTime</span><span style="color: #CE9178">(</span><span style="color: #B5CEA8">2</span><span style="color: #CE9178">)</span><span style="color: #D4D4D4">:</span><span style="color: #9CDCFE">s</span><span style="color: #CE9178">},{</span><span style="color: #9CDCFE">reader</span><span style="color: #CE9178">.</span><span style="color: #DCDCAA">GetBoolean</span><span style="color: #CE9178">(</span><span style="color: #B5CEA8">3</span><span style="color: #CE9178">).</span><span style="color: #DCDCAA">ToString</span><span style="color: #CE9178">().</span><span style="color: #DCDCAA">ToLowerInvariant</span><span style="color: #CE9178">()}</span><span style="color: #D7BA7D">\n</span><span style="color: #CE9178">"</span><span style="color: #E6E6E6">;</span></span>
<span class="line"><span style="color: #E6E6E6">                </span><span style="color: #569CD6">await</span><span style="color: #E6E6E6"> </span><span style="color: #9CDCFE">p</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">context</span><span style="color: #E6E6E6">.</span><span style="color: #9CDCFE">Response</span><span style="color: #E6E6E6">.</span><span style="color: #DCDCAA">WriteAsync</span><span style="color: #E6E6E6">(</span><span style="color: #9CDCFE">line</span><span style="color: #E6E6E6">);</span></span>
<span class="line"><span style="color: #E6E6E6">            }</span></span>
<span class="line"><span style="color: #E6E6E6">        }</span></span>
<span class="line"><span style="color: #E6E6E6">    }</span></span>
<span class="line"><span style="color: #E6E6E6">});</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">UseNpgsqlRest</span><span style="color: #000000">(</span><span style="color: #0000FF">new</span><span style="color: #000000">(</span><span style="color: #001080">connectionString</span><span style="color: #000000">)</span></span>
<span class="line"><span style="color: #000000">{</span></span>
<span class="line"><span style="color: #000000">    </span><span style="color: #001080">CommandCallbackAsync</span><span style="color: #000000"> = </span><span style="color: #0000FF">async</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000"> =></span></span>
<span class="line"><span style="color: #000000">    {</span></span>
<span class="line"><span style="color: #000000">        </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #0000FF">string</span><span style="color: #000000">.</span><span style="color: #795E26">Equals</span><span style="color: #000000">(</span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">routine</span><span style="color: #000000">.</span><span style="color: #001080">Name</span><span style="color: #000000"> , </span><span style="color: #A31515">"get_csv_data"</span><span style="color: #000000">))</span></span>
<span class="line"><span style="color: #000000">        {</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Response</span><span style="color: #000000">.</span><span style="color: #001080">ContentType</span><span style="color: #000000"> = </span><span style="color: #A31515">"text/csv"</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #AF00DB">using</span><span style="color: #000000"> </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000"> = </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">command</span><span style="color: #000000">.</span><span style="color: #795E26">ExecuteReaderAsync</span><span style="color: #000000">();</span></span>
<span class="line"><span style="color: #000000">            </span><span style="color: #AF00DB">while</span><span style="color: #000000"> (</span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">reader</span><span style="color: #000000">.</span><span style="color: #795E26">ReadAsync</span><span style="color: #000000">())</span></span>
<span class="line"><span style="color: #000000">            {</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">var</span><span style="color: #000000"> </span><span style="color: #001080">line</span><span style="color: #000000"> = </span><span style="color: #A31515">$"{</span><span style="color: #001080">reader</span><span style="color: #A31515">[</span><span style="color: #098658">0</span><span style="color: #A31515">]},{</span><span style="color: #001080">reader</span><span style="color: #A31515">[</span><span style="color: #098658">1</span><span style="color: #A31515">]},{</span><span style="color: #001080">reader</span><span style="color: #A31515">.</span><span style="color: #795E26">GetDateTime</span><span style="color: #A31515">(</span><span style="color: #098658">2</span><span style="color: #A31515">)</span><span style="color: #000000">:</span><span style="color: #001080">s</span><span style="color: #A31515">},{</span><span style="color: #001080">reader</span><span style="color: #A31515">.</span><span style="color: #795E26">GetBoolean</span><span style="color: #A31515">(</span><span style="color: #098658">3</span><span style="color: #A31515">).</span><span style="color: #795E26">ToString</span><span style="color: #A31515">().</span><span style="color: #795E26">ToLowerInvariant</span><span style="color: #A31515">()}</span><span style="color: #EE0000">\n</span><span style="color: #A31515">"</span><span style="color: #000000">;</span></span>
<span class="line"><span style="color: #000000">                </span><span style="color: #0000FF">await</span><span style="color: #000000"> </span><span style="color: #001080">p</span><span style="color: #000000">.</span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">Response</span><span style="color: #000000">.</span><span style="color: #795E26">WriteAsync</span><span style="color: #000000">(</span><span style="color: #001080">line</span><span style="color: #000000">);</span></span>
<span class="line"><span style="color: #000000">            }</span></span>
<span class="line"><span style="color: #000000">        }</span></span>
<span class="line"><span style="color: #000000">    }</span></span>
<span class="line"><span style="color: #000000">});</span></span></code></pre></div><h3 id="logging-commands"><a href="/npgsqlrest/changelog/#3-logging-commands">Logging Commands</a></h3><p>There is now the <code>LogCommands</code> options switch (default is false) that, when enabled (true), logs current commands:</p><div class="code console"><div class="toolbar"><div class="copy-code bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copy code to clipboard"></div></div><pre class="shiki slack-dark" style="background-color: #222222" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #E6E6E6">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #E6E6E6">      -- POST http://localhost:5000/api/perf-test</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $1 integer = 1</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $2 text = 'XYZ'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $3 integer = 3</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $4 timestamp without time zone = '2024-04-04T03:03:03'</span></span>
<span class="line"><span style="color: #E6E6E6">      -- $5 boolean = false</span></span>
<span class="line"><span style="color: #E6E6E6">      select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from public.perf_test($1, $2, $3, $4, $5)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #E6E6E6">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #E6E6E6">      -- GET http://localhost:5000/api/get-csv-data</span></span>
<span class="line"><span style="color: #E6E6E6">      select id, name, date, status from public.get_csv_data()</span></span></code></pre><pre class="shiki light-plus" style="background-color: #FFFFFF" tabindex="0"><code class="code-highlight"><span class="line"><span style="color: #000000">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #000000">      -- POST http://localhost:5000/api/perf-test</span></span>
<span class="line"><span style="color: #000000">      -- $1 integer = 1</span></span>
<span class="line"><span style="color: #000000">      -- $2 text = 'XYZ'</span></span>
<span class="line"><span style="color: #000000">      -- $3 integer = 3</span></span>
<span class="line"><span style="color: #000000">      -- $4 timestamp without time zone = '2024-04-04T03:03:03'</span></span>
<span class="line"><span style="color: #000000">      -- $5 boolean = false</span></span>
<span class="line"><span style="color: #000000">      select id1, foo1, bar1, datetime1, id2, foo2, bar2, datetime2, long_foo_bar, is_foobar from public.perf_test($1, $2, $3, $4, $5)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #000000">info: NpgsqlRest[0]</span></span>
<span class="line"><span style="color: #000000">      -- GET http://localhost:5000/api/get-csv-data</span></span>
<span class="line"><span style="color: #000000">      select id, name, date, status from public.get_csv_data()</span></span></code></pre></div><h3 id="other-fixes-and-improvements">Other Fixes and Improvements</h3><ul><li><a href="/npgsqlrest/changelog/#version-151-2024-27-01">Fix</a> timestamp rendering in JSON arrays.</li><li><a href="/npgsqlrest/changelog/#2-comment-annotation-breaking-change">Change</a> in annotation comment parser: Annotations don't have to start with HTTP anymore.</li><li><a href="/npgsqlrest/changelog/#1-http-file-improvements">Fix</a> HTTP files. Now they'll include a single body parameter if defined.</li><li><a href="/npgsqlrest/changelog/#4-other-changes">Fix</a> default name and URL converters (snake case, camel case) made public for use in custom builds.</li><li><a href="/npgsqlrest/changelog/#3-fix-using-identifiers">Fix</a> edge case when quoted SQL identifier was used as a parameter or function name.</li><li><a href="/npgsqlrest/changelog/#2-logging-improvements">Fix</a> logging. The default logger is now created by the NpgsqlRest and is configurable through configuration.</li><li><a href="/npgsqlrest/changelog/#1-smaller-options-tweaks">Fix</a> - better options handling.</li><li><a href="/npgsqlrest/changelog/#version-162-2024-02-03">Fix</a> support for the standard PostgreSQL stored procedures instead of just user-defined functions.</li></ul><h2 id="aot-build-template-and-aot-release">AOT Build Template and AOT Release.</h2><p>In addition to these, a template project was also added suitable for doing AOT builds. You can find it <a href="https://github.com/vb-consulting/NpgsqlRest/tree/master/AotBuildTemplate">here</a>.</p><p>This template also includes an <a href="https://github.com/vb-consulting/NpgsqlRest/blob/master/AotBuildTemplate/appsettings.json"><code>appsettings.json</code> configuration file</a> that can be used to configure every available option.</p><p>In addition to this customizable template (instructions included), there is also the <a href="https://github.com/vb-consulting/NpgsqlRest/releases">first official release</a> that contains framework-independent executable binaries (from that same AOT template) for Windows and Linux ready for download and run.</p><h2 id="perfomance-benachmark-scripts">Perfomance Benachmark Scripts</h2><p>Finally, the performance benchmark tasks were consolidated and automated (see the <a href="https://github.com/vb-consulting/NpgsqlRest/tree/master/PerfomanceTests">scripts here</a>).</p><p>Latest results are here (NpgsqlRest 1.6.1 vs PostgREST 12.0.2):</p><table class="table table-sm table-hover table-bordered" style="width: initial;"><thead><tr><th align="right">Records</th><th align="left">Function</th><th align="right">NpgsqlRest Requests</th><th align="right">PostgREST Requests</th><th align="right">Ratio</th></tr></thead><tbody class="table-group-divider"><tr><td align="right">10</td><td align="left"><code>perf_test</code></td><td align="right">392.212</td><td align="right">74.621</td><td align="right">5.26</td></tr><tr><td align="right">100</td><td align="left"><code>perf_test</code></td><td align="right">407.844</td><td align="right">60.704</td><td align="right">6.72</td></tr><tr><td align="right">10</td><td align="left"><code>perf_test_arrays</code></td><td align="right">292.392</td><td align="right">50.549</td><td align="right">5.78</td></tr><tr><td align="right">100</td><td align="left"><code>perf_test_arrays</code></td><td align="right">240.158</td><td align="right">50.911</td><td align="right">4.72</td></tr><tr><td align="right">10</td><td align="left"><code>perf_test_record</code></td><td align="right">518.515</td><td align="right">57.665</td><td align="right">8.99</td></tr><tr><td align="right">100</td><td align="left"><code>perf_test_record</code></td><td align="right">439.220</td><td align="right">59.413</td><td align="right">7.39</td></tr><tr><td align="right">10</td><td align="left"><code>perf_test_record_arrays</code></td><td align="right">383.549</td><td align="right">52.951</td><td align="right">7.24</td></tr><tr><td align="right">100</td><td align="left"><code>perf_test_record_arrays</code></td><td align="right">338.835</td><td align="right">51.507</td><td align="right">6.58</td></tr></tbody></table><div class="my-5 px-5 border-top links svelte-1jzqpn5"><div><div class="link-title text-start svelte-1jzqpn5">PREVIOUS</div><a class="btn btn-link text-start" href="/blog/npgsqlrest/">NpgsqlRest NuGet Library</a></div><div><div class="link-title text-end svelte-1jzqpn5 text-muted">NEXT</div></div></div><div class="w-fit mx-auto mt-5 mb-3 border-top"><div class="alert text-center fs-smaller text-muted">To receive notifications about new posts and updates, consider subscribing to my LinkdIn page:<br><a class="btn btn-sm" href="https://www.linkedin.com/in/vb-software/"><i class="bi-linkedin"></i> <span class="text-primary">vb-software linkedin</span></a><br><br>You will receive notifications about new posts on your LinkedIn feed.</div></div><div class="pt-5 border-top"><div id="comments-section" class="h3">Comments</div><script defer src="https://cdn.commento.io/js/commento.js" data-no-fonts="true" data-css-override="https://vb-consulting.github.io/style.css"></script><div id="commento"></div></div><footer class="mt-5 py-5 text-center"><div style="display: flex; justify-content: center;"><a class="btn btn-link rl-arrow" target="_blank" href="mailto: vbilopav@gmail.com" style="display: inline-grid;">Ask for Availability <i class="bi bi-envelope"></i></a> <a class="btn btn-link rl-arrow" target="_blank" href="https://www.linkedin.com/in/vb-software/" style="display: inline-grid;">Follow me on LinkedIn <i class="bi bi-linkedin"></i></a></div><div class="mt-5 mb-5 background-floki svelte-1fna8f1" data-bs-toggle="tooltip" data-bs-html="true" title="Floki is a developer dog."></div></footer><div class="mb-5"></div></div></div><div class="rightside svelte-9zwk14"><div class="svelte-9zwk14"><ul class="navbar-nav sidenav svelte-9zwk14"><li class="nav-txt-divider text-muted svelte-9zwk14"><hr class="svelte-9zwk14"><span class="svelte-9zwk14">on this page</span><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="npgsqlrest-162-update" title="NpgsqlRest 1.6.2 Update"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#npgsqlrest-162-update">NpgsqlRest 1.6.2 Update</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="strict-function-support" title="Strict Function Support"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#strict-function-support">Strict Function Support</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="command-callback" title="Command Callback"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#command-callback">Command Callback</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="logging-commands" title="Logging Commands"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#logging-commands">Logging Commands</a></li><li class="nav-item toc3 right svelte-9zwk14 bookmark-nav" data-id="other-fixes-and-improvements" title="Other Fixes and Improvements"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#other-fixes-and-improvements">Other Fixes and Improvements</a></li><li class="nav-item toc2 mt-2 right svelte-9zwk14 bookmark-nav" data-id="aot-build-template-and-aot-release" title="AOT Build Template and AOT Release."><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#aot-build-template-and-aot-release">AOT Build Template and AOT Release.</a></li><li class="nav-item toc2 right svelte-9zwk14 bookmark-nav" data-id="perfomance-benachmark-scripts" title="Perfomance Benachmark Scripts"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#perfomance-benachmark-scripts">Perfomance Benachmark Scripts</a></li><li class="nav-divider svelte-9zwk14"><hr class="svelte-9zwk14"></li><li class="nav-item toc1 right svelte-9zwk14 bookmark-nav" data-id="comments-section" title="Comments"><a class="nav-link auto-close svelte-9zwk14 bookmark-link" href="#comments-section">Comments</a></li><li><hr class="svelte-9zwk14"><div class="navbar-nav sidenav"><div class="text-muted fs-_7rem mx-2">PREVIOUS</div><a class="btn btn-link btn-sm text-start" href="/blog/npgsqlrest/">NpgsqlRest NuGet Library</a></div></li></ul></div></div></main><script>!function(){var i=document.querySelector("nav.navbar"),f=document.getElementsByTagName("main")[0],L=f.getElementsByClassName("sidebar")[0],w=f.getElementsByClassName("content")[0],o=document.querySelectorAll("div.code"),k=i.querySelector(".home");function E(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n])}function T(e,t){for(var n=1;n<arguments.length;n++)e.classList.remove(arguments[n]);E(e,t),e.classList.add(t)}function t(e,t){var n=e.currentTarget;if(!n.classList.contains("bi-check")){for(var i="",o=0;o<n.classList.length;o++)if(n.classList[o].startsWith("bi-")){i=n.classList[o];break}n.classList.remove(i),n.classList.add("spinner-border-sm"),n.classList.add("spinner-border");e=bootstrap.Tooltip.getInstance(n);e&&(e.setContent({".tooltip-inner":"Copying..."}),e.show()),t(n,function(){var e;n.classList.remove(i),n.classList.remove("spinner-border-sm"),n.classList.remove("spinner-border"),n.classList.add("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&(e.setContent({".tooltip-inner":"Copied!"}),e.show()),setTimeout(function(){var e;n.classList.add(i),n.classList.remove("bi-check"),bootstrap&&(e=bootstrap.Tooltip.getInstance(n))&&e.setContent({".tooltip-inner":n.dataset.bsTitle})},2e3)})}}"/"==document.location.pathname&&T(k,"d-none");var e=document.querySelector(".post-share > .copy-url"),n=(e&&e.addEventListener("click",function(e){t(e,function(e,t){navigator.clipboard.writeText(document.location.origin+document.location.pathname),t()})}),document.getElementsByTagName("html")[0]),a=i.querySelector("#theme-btn"),s="theme";function l(e){var t=a.getElementsByTagName("svg");"dark"===e?(t[0].style.display="",t[1].style.display="none",a.getElementsByClassName("check")[0].classList.add("checked")):(t[0].style.display="none",t[1].style.display="",a.getElementsByClassName("check")[0].classList.remove("checked"));for(var n=0;n<o.length;n++){var i=o[n];"dark"===e?(i.children[1].style.display="inherit",i.children[2].style.display="none"):"light"===e&&(i.children[1].style.display="none",i.children[2].style.display="inherit")}window._theme&&window._theme(e)}function r(e){t(e,function(e,t){navigator.clipboard.writeText(e.parentElement.nextSibling.innerText),t()})}function c(e){t(e,function(e,t){var n=localStorage.getItem(s);e="dark"===n?e.parentElement.parentElement.children[1]:e.parentElement.parentElement.children[2],setTimeout(function(){html2canvas(e).then(e=>{e.toBlob(e=>navigator.clipboard.write([new ClipboardItem({"image/png":e})])),t()})},0)})}a.addEventListener("click",()=>{var e="dark"===localStorage.getItem(s)?"light":"dark";localStorage.setItem(s,e),l(n.dataset.bsTheme=e)}),l(localStorage.getItem(s)),a.children[0].classList.remove("hidden");for(var d=0;d<o.length;d++){o[d].getElementsByClassName("copy-code")[0].addEventListener("click",r);var m=o[d].getElementsByClassName("photo-code");m.length&&m.addEventListener("click",c)}for(var S=function(){var a,o,s;if(f.children[2]&&"none"!=f.children[2].style.display)return a=f.querySelector(".main-content").querySelectorAll("[id]"),o=void 0,this.initNavs=function(e){s=e.querySelectorAll("li.bookmark-nav");for(var t=0;t<a.length;t++){for(var n=a[t].id,i=null,o=0;o<s.length;o++)if(s[o].dataset.id==n){i=s[o];break}a[t].nav=i}setTimeout(function(){for(var e=0;e<a.length;e++){var t=a[e];if(l(t).visible&&t.nav)return void t.nav.classList.add("active")}},1e3),r()},f.children[1].addEventListener("scroll",r),this;function l(e){var e=e.getBoundingClientRect(),t=Math.max(document.documentElement.clientHeight,window.innerHeight),n=0<e.top&&!(e.bottom<0||0<=e.top-t)||e.top<0&&e.bottom>t,i=!1;return{visible:n,above:i=n?i:e.bottom<t}}function r(){if(s&&s.length){for(var e=0;e<s.length;e++)s[e].classList.remove("active");for(var t=void 0,e=0;e<a.length;e++){const i=a[e];var n=l(i);if(!n.visible&&n.above&&(t=i.nav),n.visible&&i.nav&&!i.nav.classList.contains("active"))return i.nav.classList.add("active"),o&&clearTimeout(o),void(o=setTimeout(function(){i.nav.scrollIntoView({behavior:"smooth"}),o=void 0},250))}t&&!t.classList.contains("active")&&(t.classList.add("active"),o&&clearTimeout(o),o=setTimeout(function(){t.scrollIntoView({behavior:"smooth"}),o=void 0},250))}}}(),h=function(){var l,r=i.querySelector("#nav-btn"),c=480,d="200px",m="0.25fr",h=730,v=535,u=f.children[0].children[0].children[0],g=f.children[2]&&f.children[2].children[0].children[0],t="sidebar-pinned",p=null==localStorage.getItem(t)||"true"==localStorage.getItem(t),y=!1,b=!1;function n(){window._onresize&&window._onresize();var e=window.outerWidth||window.innerWidth,t=e<c,n=t?y?"100%":"0":p?""+d:"0",i=`grid-template-columns: ${n} 1fr`,o=t&&y?"width: 100%":"0"!=n?"":"display: none",a=t&&y?"display: none":"",s=t?y?"sidebar-show":"sidebar-hide":p?"sidebar-show":"sidebar-hide",n="0"==n;f.children[2]&&(m&&h&&v&&(n&&e<v||!n&&e<h?b||(u.innerHTML=l+g.innerHTML,S.initNavs(u),b=!0):b&&(u.innerHTML=l,S.initNavs(g),b=!1)),!m||t||b?(i+=";",f.children[2].style.display="none"):(i+=` ${m};`,f.children[2].style.display="")),T(r,!t&&p||t&&y?"rotate":"rotate-back","rotate","rotate-back"),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),f.style=L?i:"display: grid;",L&&T(L,s,"sidebar-show","sidebar-hide"),L&&(L.firstChild.style=o),w.style=a,t&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),t&&y&&T(k,"d-none")}function e(){var e=window.outerWidth<c;e?y=!y:p=!p,localStorage.setItem(t,p.toString()),n(),p?(r.classList.add("text-shadow"),null==document.querySelector("main .sidebar .accordion > [title='VB-Consulting'] > .collapsed")&&T(k,"d-none")):("/"!=document.location.pathname&&E(k,"d-none"),r.classList.remove("text-shadow")),e&&!y&&"/"!=document.location.pathname&&E(k,"d-none"),e&&y&&T(k,"d-none")}return m&&h&&v&&g&&(l=u.innerHTML,S.initNavs(g)),r.addEventListener("click",e),(window.onresize=n)(),this.closeSidebar=function(){window.outerWidth<c&&y&&e()},this}(),v=document.getElementsByClassName("auto-close"),u=0;u<v.length;u++)v[u].addEventListener("click",function(e){h.closeSidebar()});location.hash&&(e=document.getElementById(location.hash.replace("#","")))&&e.scrollIntoView()}();</script><script src="/bootstrap.bundle.min.js"></script><script>!function(){for(var e=document.querySelectorAll('[data-bs-toggle="tooltip"]'),t=0;t<e.length;t++)new bootstrap.Tooltip(e[t]);var n=document.getElementsByClassName("accordion-item");if(n.length){for(t=0;t<n.length;t++){var o=n[t];o.querySelectorAll("[href='"+document.location.pathname+"']").length&&o.firstChild.click()}var l=document.querySelector("nav.navbar").querySelector(".home"),a=document.getElementsByClassName("accordion");"/"==document.location.pathname&&l.classList.add("d-none");for(t=0;t<n.length;t++){var s=a[t];s&&s.firstChild&&"VB-Consulting"==s.firstChild.title&&(null!=s.firstChild.querySelector(".collapse")&&l.classList.contains("d-none")&&"/"!=document.location.pathname&&l.classList.remove("d-none"),s.addEventListener("show.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none"),l.classList.add("d-none")}),s.addEventListener("hide.bs.collapse",function(){"/"!=document.location.pathname&&l.classList.remove("d-none")}))}}}();</script><script src="/html2canvas.min.js"></script><script async defer src="https://buttons.github.io/buttons.js"></script></body><script async data-id="101435862" src="//static.getclicky.com/js"></script></html>